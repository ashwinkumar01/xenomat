<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<script id="versionArea" type="text/javascript">
//<![CDATA[
var version = {title: "TiddlyWiki", major: 2, minor: 5, revision: 3, date: new Date("Aug 18, 2009"), extensions: {}};
//]]>
</script>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="copyright" content="
TiddlyWiki created by Jeremy Ruston, (jeremy [at] osmosoft [dot] com)

Copyright (c) UnaMesa Association 2004-2009

Redistribution and use in source and binary forms, with or without modification,
are permitted provided that the following conditions are met:

Redistributions of source code must retain the above copyright notice, this
list of conditions and the following disclaimer.

Redistributions in binary form must reproduce the above copyright notice, this
list of conditions and the following disclaimer in the documentation and/or other
materials provided with the distribution.

Neither the name of the UnaMesa Association nor the names of its contributors may be
used to endorse or promote products derived from this software without specific
prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS 'AS IS' AND ANY
EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT
SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH
DAMAGE.
" />
<!--PRE-HEAD-START-->
<!--{{{-->
<link rel='alternate' type='application/rss+xml' title='RSS' href='index.xml' />
<link rel='shortcut icon' href='data:image/x-icon;base64,AAABAAEAEBAQAAAAAAAoAQAAFgAAACgAAAAQAAAAIAAAAAEABAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAA0c7LAICAgAD%2F%2F%2F8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAzMwAzMwAAADEjADEjAAAAMhMAMhMAAAAzMwAzMwAAADIjADIjAAAAMiMAMiMAAAAyIwAyIwAAADIjADIjAAAAMiMAMiMgAAAyIwAyIwAAADIhMxIjAAAAMiIiIhMAAAAyIyIhMAAAADMzMzMAAAAAAAAAAAAAD%2F%2FwAA4YcAAOGHAADhhwAA4YcAAOGHAADhhwAA4YcAAOGHAADhhwAA4YcAAOAHAADgBwAA4A8AAOAfAAD%2F%2FwAA' type='image/x-icon' />
<!--}}}-->

<!--PRE-HEAD-END-->
<title> XENOmat - the eXtensible Engine for Networked Objects </title>
<style id="styleArea" type="text/css">
#saveTest {display:none;}
#messageArea {display:none;}
#copyright {display:none;}
#storeArea {display:none;}
#storeArea div {padding:0.5em; margin:1em 0em 0em 0em; border-color:#fff #666 #444 #ddd; border-style:solid; border-width:2px; overflow:auto;}
#shadowArea {display:none;}
#javascriptWarning {width:100%; text-align:center; font-weight:bold; background-color:#dd1100; color:#fff; padding:1em 0em;}
</style>
<!--POST-HEAD-START-->

<!--POST-HEAD-END-->
</head>
<body onload="main();" onunload="if(window.unload) unload();">
<!--PRE-BODY-START-->

<!--PRE-BODY-END-->
<div id="copyright">
Welcome to TiddlyWiki created by Jeremy Ruston, Copyright &copy; 2007 UnaMesa Association
</div>
<noscript>
<div id="javascriptWarning">
This page requires JavaScript to function properly.<br /><br />If you are using Microsoft Internet Explorer you may need to click on the yellow bar above and select 'Allow Blocked Content'. You must then click 'Yes' on the following security warning.
</div>
</noscript>
<div id="saveTest"></div>
<div id="backstageCloak"></div>
<div id="backstageButton"></div>
<div id="backstageArea"><div id="backstageToolbar"></div></div>
<div id="backstage">
  <div id="backstagePanel"></div>
</div>
<div id="contentWrapper"></div>
<div id="contentStash"></div>
<div id="shadowArea">
<div title="MarkupPreHead">
<pre>&lt;!--{{{--&gt;
&lt;link rel='alternate' type='application/rss+xml' title='RSS' href='index.xml' /&gt;
&lt;!--}}}--&gt;
</pre>
</div>
<div title="ColorPalette">
<pre>Background: #fff
Foreground: #000
PrimaryPale: #8cf
PrimaryLight: #18f
PrimaryMid: #04b
PrimaryDark: #014
SecondaryPale: #ffc
SecondaryLight: #fe8
SecondaryMid: #db4
SecondaryDark: #841
TertiaryPale: #eee
TertiaryLight: #ccc
TertiaryMid: #999
TertiaryDark: #666
Error: #f88
</pre>
</div>
<div title="StyleSheetColors">
<pre>/*{{{*/
body {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];}

a {color:[[ColorPalette::PrimaryMid]];}
a:hover {background-color:[[ColorPalette::PrimaryMid]]; color:[[ColorPalette::Background]];}
a img {border:0;}

h1,h2,h3,h4,h5,h6 {color:[[ColorPalette::SecondaryDark]]; background:transparent;}
h1 {border-bottom:2px solid [[ColorPalette::TertiaryLight]];}
h2,h3 {border-bottom:1px solid [[ColorPalette::TertiaryLight]];}

.button {color:[[ColorPalette::PrimaryDark]]; border:1px solid [[ColorPalette::Background]];}
.button:hover {color:[[ColorPalette::PrimaryDark]]; background:[[ColorPalette::SecondaryLight]]; border-color:[[ColorPalette::SecondaryMid]];}
.button:active {color:[[ColorPalette::Background]]; background:[[ColorPalette::SecondaryMid]]; border:1px solid [[ColorPalette::SecondaryDark]];}

.header {background:[[ColorPalette::PrimaryMid]];}
.headerShadow {color:[[ColorPalette::Foreground]];}
.headerShadow a {font-weight:normal; color:[[ColorPalette::Foreground]];}
.headerForeground {color:[[ColorPalette::Background]];}
.headerForeground a {font-weight:normal; color:[[ColorPalette::PrimaryPale]];}

.tabSelected{color:[[ColorPalette::PrimaryDark]];
  background:[[ColorPalette::TertiaryPale]];
  border-left:1px solid [[ColorPalette::TertiaryLight]];
  border-top:1px solid [[ColorPalette::TertiaryLight]];
  border-right:1px solid [[ColorPalette::TertiaryLight]];
}
.tabUnselected {color:[[ColorPalette::Background]]; background:[[ColorPalette::TertiaryMid]];}
.tabContents {color:[[ColorPalette::PrimaryDark]]; background:[[ColorPalette::TertiaryPale]]; border:1px solid [[ColorPalette::TertiaryLight]];}
.tabContents .button {border:0;}

#sidebar {}
#sidebarOptions input {border:1px solid [[ColorPalette::PrimaryMid]];}
#sidebarOptions .sliderPanel {background:[[ColorPalette::PrimaryPale]];}
#sidebarOptions .sliderPanel a {border:none;color:[[ColorPalette::PrimaryMid]];}
#sidebarOptions .sliderPanel a:hover {color:[[ColorPalette::Background]]; background:[[ColorPalette::PrimaryMid]];}
#sidebarOptions .sliderPanel a:active {color:[[ColorPalette::PrimaryMid]]; background:[[ColorPalette::Background]];}

.wizard {background:[[ColorPalette::PrimaryPale]]; border:1px solid [[ColorPalette::PrimaryMid]];}
.wizard h1 {color:[[ColorPalette::PrimaryDark]]; border:none;}
.wizard h2 {color:[[ColorPalette::Foreground]]; border:none;}
.wizardStep {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];
  border:1px solid [[ColorPalette::PrimaryMid]];}
.wizardStep.wizardStepDone {background:[[ColorPalette::TertiaryLight]];}
.wizardFooter {background:[[ColorPalette::PrimaryPale]];}
.wizardFooter .status {background:[[ColorPalette::PrimaryDark]]; color:[[ColorPalette::Background]];}
.wizard .button {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::SecondaryLight]]; border: 1px solid;
  border-color:[[ColorPalette::SecondaryPale]] [[ColorPalette::SecondaryDark]] [[ColorPalette::SecondaryDark]] [[ColorPalette::SecondaryPale]];}
.wizard .button:hover {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::Background]];}
.wizard .button:active {color:[[ColorPalette::Background]]; background:[[ColorPalette::Foreground]]; border: 1px solid;
  border-color:[[ColorPalette::PrimaryDark]] [[ColorPalette::PrimaryPale]] [[ColorPalette::PrimaryPale]] [[ColorPalette::PrimaryDark]];}

.wizard .notChanged {background:transparent;}
.wizard .changedLocally {background:#80ff80;}
.wizard .changedServer {background:#8080ff;}
.wizard .changedBoth {background:#ff8080;}
.wizard .notFound {background:#ffff80;}
.wizard .putToServer {background:#ff80ff;}
.wizard .gotFromServer {background:#80ffff;}

#messageArea {border:1px solid [[ColorPalette::SecondaryMid]]; background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]];}
#messageArea .button {color:[[ColorPalette::PrimaryMid]]; background:[[ColorPalette::SecondaryPale]]; border:none;}

.popupTiddler {background:[[ColorPalette::TertiaryPale]]; border:2px solid [[ColorPalette::TertiaryMid]];}

.popup {background:[[ColorPalette::TertiaryPale]]; color:[[ColorPalette::TertiaryDark]]; border-left:1px solid [[ColorPalette::TertiaryMid]]; border-top:1px solid [[ColorPalette::TertiaryMid]]; border-right:2px solid [[ColorPalette::TertiaryDark]]; border-bottom:2px solid [[ColorPalette::TertiaryDark]];}
.popup hr {color:[[ColorPalette::PrimaryDark]]; background:[[ColorPalette::PrimaryDark]]; border-bottom:1px;}
.popup li.disabled {color:[[ColorPalette::TertiaryMid]];}
.popup li a, .popup li a:visited {color:[[ColorPalette::Foreground]]; border: none;}
.popup li a:hover {background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]]; border: none;}
.popup li a:active {background:[[ColorPalette::SecondaryPale]]; color:[[ColorPalette::Foreground]]; border: none;}
.popupHighlight {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];}
.listBreak div {border-bottom:1px solid [[ColorPalette::TertiaryDark]];}

.tiddler .defaultCommand {font-weight:bold;}

.shadow .title {color:[[ColorPalette::TertiaryDark]];}

.title {color:[[ColorPalette::SecondaryDark]];}
.subtitle {color:[[ColorPalette::TertiaryDark]];}

.toolbar {color:[[ColorPalette::PrimaryMid]];}
.toolbar a {color:[[ColorPalette::TertiaryLight]];}
.selected .toolbar a {color:[[ColorPalette::TertiaryMid]];}
.selected .toolbar a:hover {color:[[ColorPalette::Foreground]];}

.tagging, .tagged {border:1px solid [[ColorPalette::TertiaryPale]]; background-color:[[ColorPalette::TertiaryPale]];}
.selected .tagging, .selected .tagged {background-color:[[ColorPalette::TertiaryLight]]; border:1px solid [[ColorPalette::TertiaryMid]];}
.tagging .listTitle, .tagged .listTitle {color:[[ColorPalette::PrimaryDark]];}
.tagging .button, .tagged .button {border:none;}

.footer {color:[[ColorPalette::TertiaryLight]];}
.selected .footer {color:[[ColorPalette::TertiaryMid]];}

.sparkline {background:[[ColorPalette::PrimaryPale]]; border:0;}
.sparktick {background:[[ColorPalette::PrimaryDark]];}

.error, .errorButton {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::Error]];}
.warning {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::SecondaryPale]];}
.lowlight {background:[[ColorPalette::TertiaryLight]];}

.zoomer {background:none; color:[[ColorPalette::TertiaryMid]]; border:3px solid [[ColorPalette::TertiaryMid]];}

.imageLink, #displayArea .imageLink {background:transparent;}

.annotation {background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]]; border:2px solid [[ColorPalette::SecondaryMid]];}

.viewer .listTitle {list-style-type:none; margin-left:-2em;}
.viewer .button {border:1px solid [[ColorPalette::SecondaryMid]];}
.viewer blockquote {border-left:3px solid [[ColorPalette::TertiaryDark]];}

.viewer table, table.twtable {border:2px solid [[ColorPalette::TertiaryDark]];}
.viewer th, .viewer thead td, .twtable th, .twtable thead td {background:[[ColorPalette::SecondaryMid]]; border:1px solid [[ColorPalette::TertiaryDark]]; color:[[ColorPalette::Background]];}
.viewer td, .viewer tr, .twtable td, .twtable tr {border:1px solid [[ColorPalette::TertiaryDark]];}

.viewer pre {border:1px solid [[ColorPalette::SecondaryLight]]; background:[[ColorPalette::SecondaryPale]];}
.viewer code {color:[[ColorPalette::SecondaryDark]];}
.viewer hr {border:0; border-top:dashed 1px [[ColorPalette::TertiaryDark]]; color:[[ColorPalette::TertiaryDark]];}

.highlight, .marked {background:[[ColorPalette::SecondaryLight]];}

.editor input {border:1px solid [[ColorPalette::PrimaryMid]];}
.editor textarea {border:1px solid [[ColorPalette::PrimaryMid]]; width:100%;}
.editorFooter {color:[[ColorPalette::TertiaryMid]];}

#backstageArea {background:[[ColorPalette::Foreground]]; color:[[ColorPalette::TertiaryMid]];}
#backstageArea a {background:[[ColorPalette::Foreground]]; color:[[ColorPalette::Background]]; border:none;}
#backstageArea a:hover {background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]]; }
#backstageArea a.backstageSelTab {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];}
#backstageButton a {background:none; color:[[ColorPalette::Background]]; border:none;}
#backstageButton a:hover {background:[[ColorPalette::Foreground]]; color:[[ColorPalette::Background]]; border:none;}
#backstagePanel {background:[[ColorPalette::Background]]; border-color: [[ColorPalette::Background]] [[ColorPalette::TertiaryDark]] [[ColorPalette::TertiaryDark]] [[ColorPalette::TertiaryDark]];}
.backstagePanelFooter .button {border:none; color:[[ColorPalette::Background]];}
.backstagePanelFooter .button:hover {color:[[ColorPalette::Foreground]];}
#backstageCloak {background:[[ColorPalette::Foreground]]; opacity:0.6; filter:'alpha(opacity=60)';}
/*}}}*/</pre>
</div>
<div title="StyleSheetLayout">
<pre>/*{{{*/
* html .tiddler {height:1%;}

body {font-size:.75em; font-family:arial,helvetica; margin:0; padding:0;}

h1,h2,h3,h4,h5,h6 {font-weight:bold; text-decoration:none;}
h1,h2,h3 {padding-bottom:1px; margin-top:1.2em;margin-bottom:0.3em;}
h4,h5,h6 {margin-top:1em;}
h1 {font-size:1.35em;}
h2 {font-size:1.25em;}
h3 {font-size:1.1em;}
h4 {font-size:1em;}
h5 {font-size:.9em;}

hr {height:1px;}

a {text-decoration:none;}

dt {font-weight:bold;}

ol {list-style-type:decimal;}
ol ol {list-style-type:lower-alpha;}
ol ol ol {list-style-type:lower-roman;}
ol ol ol ol {list-style-type:decimal;}
ol ol ol ol ol {list-style-type:lower-alpha;}
ol ol ol ol ol ol {list-style-type:lower-roman;}
ol ol ol ol ol ol ol {list-style-type:decimal;}

.txtOptionInput {width:11em;}

#contentWrapper .chkOptionInput {border:0;}

.externalLink {text-decoration:underline;}

.indent {margin-left:3em;}
.outdent {margin-left:3em; text-indent:-3em;}
code.escaped {white-space:nowrap;}

.tiddlyLinkExisting {font-weight:bold;}
.tiddlyLinkNonExisting {font-style:italic;}

/* the 'a' is required for IE, otherwise it renders the whole tiddler in bold */
a.tiddlyLinkNonExisting.shadow {font-weight:bold;}

#mainMenu .tiddlyLinkExisting,
  #mainMenu .tiddlyLinkNonExisting,
  #sidebarTabs .tiddlyLinkNonExisting {font-weight:normal; font-style:normal;}
#sidebarTabs .tiddlyLinkExisting {font-weight:bold; font-style:normal;}

.header {position:relative;}
.header a:hover {background:transparent;}
.headerShadow {position:relative; padding:4.5em 0 1em 1em; left:-1px; top:-1px;}
.headerForeground {position:absolute; padding:4.5em 0 1em 1em; left:0px; top:0px;}

.siteTitle {font-size:3em;}
.siteSubtitle {font-size:1.2em;}

#mainMenu {position:absolute; left:0; width:10em; text-align:right; line-height:1.6em; padding:1.5em 0.5em 0.5em 0.5em; font-size:1.1em;}

#sidebar {position:absolute; right:3px; width:16em; font-size:.9em;}
#sidebarOptions {padding-top:0.3em;}
#sidebarOptions a {margin:0 0.2em; padding:0.2em 0.3em; display:block;}
#sidebarOptions input {margin:0.4em 0.5em;}
#sidebarOptions .sliderPanel {margin-left:1em; padding:0.5em; font-size:.85em;}
#sidebarOptions .sliderPanel a {font-weight:bold; display:inline; padding:0;}
#sidebarOptions .sliderPanel input {margin:0 0 0.3em 0;}
#sidebarTabs .tabContents {width:15em; overflow:hidden;}

.wizard {padding:0.1em 1em 0 2em;}
.wizard h1 {font-size:2em; font-weight:bold; background:none; padding:0; margin:0.4em 0 0.2em;}
.wizard h2 {font-size:1.2em; font-weight:bold; background:none; padding:0; margin:0.4em 0 0.2em;}
.wizardStep {padding:1em 1em 1em 1em;}
.wizard .button {margin:0.5em 0 0; font-size:1.2em;}
.wizardFooter {padding:0.8em 0.4em 0.8em 0;}
.wizardFooter .status {padding:0 0.4em; margin-left:1em;}
.wizard .button {padding:0.1em 0.2em;}

#messageArea {position:fixed; top:2em; right:0; margin:0.5em; padding:0.5em; z-index:2000; _position:absolute;}
.messageToolbar {display:block; text-align:right; padding:0.2em;}
#messageArea a {text-decoration:underline;}

.tiddlerPopupButton {padding:0.2em;}
.popupTiddler {position: absolute; z-index:300; padding:1em; margin:0;}

.popup {position:absolute; z-index:300; font-size:.9em; padding:0; list-style:none; margin:0;}
.popup .popupMessage {padding:0.4em;}
.popup hr {display:block; height:1px; width:auto; padding:0; margin:0.2em 0;}
.popup li.disabled {padding:0.4em;}
.popup li a {display:block; padding:0.4em; font-weight:normal; cursor:pointer;}
.listBreak {font-size:1px; line-height:1px;}
.listBreak div {margin:2px 0;}

.tabset {padding:1em 0 0 0.5em;}
.tab {margin:0 0 0 0.25em; padding:2px;}
.tabContents {padding:0.5em;}
.tabContents ul, .tabContents ol {margin:0; padding:0;}
.txtMainTab .tabContents li {list-style:none;}
.tabContents li.listLink { margin-left:.75em;}

#contentWrapper {display:block;}
#splashScreen {display:none;}

#displayArea {margin:1em 17em 0 14em;}

.toolbar {text-align:right; font-size:.9em;}

.tiddler {padding:1em 1em 0;}

.missing .viewer,.missing .title {font-style:italic;}

.title {font-size:1.6em; font-weight:bold;}

.missing .subtitle {display:none;}
.subtitle {font-size:1.1em;}

.tiddler .button {padding:0.2em 0.4em;}

.tagging {margin:0.5em 0.5em 0.5em 0; float:left; display:none;}
.isTag .tagging {display:block;}
.tagged {margin:0.5em; float:right;}
.tagging, .tagged {font-size:0.9em; padding:0.25em;}
.tagging ul, .tagged ul {list-style:none; margin:0.25em; padding:0;}
.tagClear {clear:both;}

.footer {font-size:.9em;}
.footer li {display:inline;}

.annotation {padding:0.5em; margin:0.5em;}

* html .viewer pre {width:99%; padding:0 0 1em 0;}
.viewer {line-height:1.4em; padding-top:0.5em;}
.viewer .button {margin:0 0.25em; padding:0 0.25em;}
.viewer blockquote {line-height:1.5em; padding-left:0.8em;margin-left:2.5em;}
.viewer ul, .viewer ol {margin-left:0.5em; padding-left:1.5em;}

.viewer table, table.twtable {border-collapse:collapse; margin:0.8em 1.0em;}
.viewer th, .viewer td, .viewer tr,.viewer caption,.twtable th, .twtable td, .twtable tr,.twtable caption {padding:3px;}
table.listView {font-size:0.85em; margin:0.8em 1.0em;}
table.listView th, table.listView td, table.listView tr {padding:0px 3px 0px 3px;}

.viewer pre {padding:0.5em; margin-left:0.5em; font-size:1.2em; line-height:1.4em; overflow:auto;}
.viewer code {font-size:1.2em; line-height:1.4em;}

.editor {font-size:1.1em;}
.editor input, .editor textarea {display:block; width:100%; font:inherit;}
.editorFooter {padding:0.25em 0; font-size:.9em;}
.editorFooter .button {padding-top:0px; padding-bottom:0px;}

.fieldsetFix {border:0; padding:0; margin:1px 0px;}

.sparkline {line-height:1em;}
.sparktick {outline:0;}

.zoomer {font-size:1.1em; position:absolute; overflow:hidden;}
.zoomer div {padding:1em;}

* html #backstage {width:99%;}
* html #backstageArea {width:99%;}
#backstageArea {display:none; position:relative; overflow: hidden; z-index:150; padding:0.3em 0.5em;}
#backstageToolbar {position:relative;}
#backstageArea a {font-weight:bold; margin-left:0.5em; padding:0.3em 0.5em;}
#backstageButton {display:none; position:absolute; z-index:175; top:0; right:0;}
#backstageButton a {padding:0.1em 0.4em; margin:0.1em;}
#backstage {position:relative; width:100%; z-index:50;}
#backstagePanel {display:none; z-index:100; position:absolute; width:90%; margin-left:3em; padding:1em;}
.backstagePanelFooter {padding-top:0.2em; float:right;}
.backstagePanelFooter a {padding:0.2em 0.4em;}
#backstageCloak {display:none; z-index:20; position:absolute; width:100%; height:100px;}

.whenBackstage {display:none;}
.backstageVisible .whenBackstage {display:block;}
/*}}}*/
</pre>
</div>
<div title="StyleSheetLocale">
<pre>/***
StyleSheet for use when a translation requires any css style changes.
This StyleSheet can be used directly by languages such as Chinese, Japanese and Korean which need larger font sizes.
***/
/*{{{*/
body {font-size:0.8em;}
#sidebarOptions {font-size:1.05em;}
#sidebarOptions a {font-style:normal;}
#sidebarOptions .sliderPanel {font-size:0.95em;}
.subtitle {font-size:0.8em;}
.viewer table.listView {font-size:0.95em;}
/*}}}*/</pre>
</div>
<div title="StyleSheetPrint">
<pre>/*{{{*/
@media print {
#mainMenu, #sidebar, #messageArea, .toolbar, #backstageButton, #backstageArea {display: none !important;}
#displayArea {margin: 1em 1em 0em;}
noscript {display:none;} /* Fixes a feature in Firefox 1.5.0.2 where print preview displays the noscript content */
}
/*}}}*/</pre>
</div>
<div title="PageTemplate">
<pre>&lt;!--{{{--&gt;
&lt;div class='header' macro='gradient vert [[ColorPalette::PrimaryLight]] [[ColorPalette::PrimaryMid]]'&gt;
&lt;div class='headerShadow'&gt;
&lt;span class='siteTitle' refresh='content' tiddler='SiteTitle'&gt;&lt;/span&gt;&amp;nbsp;
&lt;span class='siteSubtitle' refresh='content' tiddler='SiteSubtitle'&gt;&lt;/span&gt;
&lt;/div&gt;
&lt;div class='headerForeground'&gt;
&lt;span class='siteTitle' refresh='content' tiddler='SiteTitle'&gt;&lt;/span&gt;&amp;nbsp;
&lt;span class='siteSubtitle' refresh='content' tiddler='SiteSubtitle'&gt;&lt;/span&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id='mainMenu' refresh='content' tiddler='MainMenu'&gt;&lt;/div&gt;
&lt;div id='sidebar'&gt;
&lt;div id='sidebarOptions' refresh='content' tiddler='SideBarOptions'&gt;&lt;/div&gt;
&lt;div id='sidebarTabs' refresh='content' force='true' tiddler='SideBarTabs'&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div id='displayArea'&gt;
&lt;div id='messageArea'&gt;&lt;/div&gt;
&lt;div id='tiddlerDisplay'&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;!--}}}--&gt;</pre>
</div>
<div title="ViewTemplate">
<pre>&lt;!--{{{--&gt;
&lt;div class='toolbar' macro='toolbar [[ToolbarCommands::ViewToolbar]]'&gt;&lt;/div&gt;
&lt;div class='title' macro='view title'&gt;&lt;/div&gt;
&lt;div class='subtitle'&gt;&lt;span macro='view modifier link'&gt;&lt;/span&gt;, &lt;span macro='view modified date'&gt;&lt;/span&gt; (&lt;span macro='message views.wikified.createdPrompt'&gt;&lt;/span&gt; &lt;span macro='view created date'&gt;&lt;/span&gt;)&lt;/div&gt;
&lt;div class='tagging' macro='tagging'&gt;&lt;/div&gt;
&lt;div class='tagged' macro='tags'&gt;&lt;/div&gt;
&lt;div class='viewer' macro='view text wikified'&gt;&lt;/div&gt;
&lt;div class='tagClear'&gt;&lt;/div&gt;
&lt;!--}}}--&gt;</pre>
</div>
<div title="EditTemplate">
<pre>&lt;!--{{{--&gt;
&lt;div class='toolbar' macro='toolbar [[ToolbarCommands::EditToolbar]]'&gt;&lt;/div&gt;
&lt;div class='title' macro='view title'&gt;&lt;/div&gt;
&lt;div class='editor' macro='edit title'&gt;&lt;/div&gt;
&lt;div macro='annotations'&gt;&lt;/div&gt;
&lt;div class='editor' macro='edit text'&gt;&lt;/div&gt;
&lt;div class='editor' macro='edit tags'&gt;&lt;/div&gt;&lt;div class='editorFooter'&gt;&lt;span macro='message views.editor.tagPrompt'&gt;&lt;/span&gt;&lt;span macro='tagChooser excludeLists'&gt;&lt;/span&gt;&lt;/div&gt;
&lt;!--}}}--&gt;</pre>
</div>
<div title="GettingStarted">
<pre>To get started with this blank [[TiddlyWiki]], you'll need to modify the following tiddlers:
* [[SiteTitle]] &amp; [[SiteSubtitle]]: The title and subtitle of the site, as shown above (after saving, they will also appear in the browser title bar)
* [[MainMenu]]: The menu (usually on the left)
* [[DefaultTiddlers]]: Contains the names of the tiddlers that you want to appear when the TiddlyWiki is opened
You'll also need to enter your username for signing your edits: &lt;&lt;option txtUserName&gt;&gt;</pre>
</div>
<div title="OptionsPanel">
<pre>These [[InterfaceOptions]] for customising [[TiddlyWiki]] are saved in your browser

Your username for signing your edits. Write it as a [[WikiWord]] (eg [[JoeBloggs]])

&lt;&lt;option txtUserName&gt;&gt;
&lt;&lt;option chkSaveBackups&gt;&gt; [[SaveBackups]]
&lt;&lt;option chkAutoSave&gt;&gt; [[AutoSave]]
&lt;&lt;option chkRegExpSearch&gt;&gt; [[RegExpSearch]]
&lt;&lt;option chkCaseSensitiveSearch&gt;&gt; [[CaseSensitiveSearch]]
&lt;&lt;option chkAnimate&gt;&gt; [[EnableAnimations]]

----
Also see [[AdvancedOptions]]</pre>
</div>
<div title="ImportTiddlers">
<pre>&lt;&lt;importTiddlers&gt;&gt;</pre>
</div>
</div>
<!--POST-SHADOWAREA-->
<div id="storeArea">
<div title="12 April 2013" modifier="YourName" created="201304121916" modified="201304122249" tags="journal InformationSpaces" changecount="13">
<pre>Yay! 100 Hz with 4 floating-point channels . 
Requesting all 4 channels in a single LocalBus request - sampling them each 10 ms and plotting simultaneously gives a really smooth experience.
And according to ''top'' there is 0% CPU usage. No wonder, since all processing is pushed down to the hardware by means of an asynchronous architecture. UART write, UART interrupt-on-receive, UART read. That all takes place in the kernel.
The actual processing, correcting for byte order, scaling, converting values to screen coordinates, and finally manipulating the Linux framebuffer device to turn on coloured pixels on the display, is done in quite a few milliseconds.

!!InformationSpaces
</pre>
</div>
<div title="3 April 2014" modifier="Peter Hübel" created="201404030037" modified="201404032232" tags="journal" changecount="5">
<pre>Marathon Coding!

After having refactored the Calibrator out in a separate component, the orchestration in the main PDM Service is now complete.

Remains TODO:
* Some serious timing, handling of lacks, etc.
* Handshaking, 

!!Story
The Sampler is a Pipe which takes an initial Frame as input. It the does its job (request/response), and stores the sampled data in the provided frame.
It then queues the frame up for the rest of the PipeLine.

Instead of discarding the oldest frame, then, the oldest frame goes into the sampler again.



</pre>
</div>
<div title="&lt;netropy:fbdev/&gt;" modifier="PeterHübel" created="201206012123" modified="201210042235" changecount="11">
<pre>{{{
&lt;/&gt;

}}}

An SVG description of fonts you can get from a source like http://www.fileformat.info/info/unicode/char/1e47/index.htm. Note that the URL of this encodes the ''utf-16'' code for the char. Your ''utf-8'' must be transcoded on the fly.</pre>
</div>
<div title="&lt;netropy:inifile/&gt;" modifier="Peter Hübel" created="201310080325" modified="201310080438" changecount="24">
<pre>!!Synopsis
Converts a text file in INI format (Windows) to a structure on the stack. You may specify how certain recurring patterns, like
{{{
[Comm]
baud=31250
start=1
data=8
stop=1

[Calibration]
NumberOfPoints=3

[Point1]
X=20
Y=30
[Point2]
X=100
Y=200
[Point3]
X=160
Y=190
}}}
describes a sequence of points, and how this is handled in structuring this as XML.

!!Example
{{{
&lt;netropy:inifile wrap='configuration'/&gt;
}}}
would transform the INI file above to 
{{{
&lt;configuration&gt;
  &lt;comm baud=&quot;31&quot; start=&quot;1&quot; data=&quot;8&quot; stop=&quot;1&quot;/&gt;
  &lt;calibration NumberOfPoints=&quot;3&quot;/&gt;
  &lt;Point1 X=&quot;20&quot; Y=&quot;30&quot;/&gt;
  &lt;Point2 X=&quot;100&quot; Y=&quot;200&quot;/&gt;
  &lt;Point3 X=&quot;160&quot; Y=&quot;190&quot;/&gt;
&lt;/configuration&gt;
}}}

Use {{{printf}}} style masks, not ''regex''.</pre>
</div>
<div title="&lt;netropy:outer/&gt;" modifier="Peter Hübel" created="201205152249" changecount="1">
<pre></pre>
</div>
<div title="&lt;netropy:service module='sql'/&gt;" modifier="PeterHübel" created="200905121942" modified="200909162118" changecount="112">
<pre>!!!Synopsis
This module acts as an interface to an ODBC database.
!!!Content
The inner structure of the ''sql'' service contains the SQL to execute on the database.

The SQL //must// be surrounded by an XML element (which then will wrap each row of the result) and it  //must// start immediately after the opening tag. Apart from the SQL being wellformed in respect to the configured ''database'', these are the only requirements. 
!!!Example 1
Here is a sample of what an instance of this service may look like.
{{{
&lt;netropy:service module=&quot;sql&quot; database=&quot;Northwind&quot; style=&quot;productstyle&quot; type=&quot;text/xml&quot; encoding=&quot;iso-8859-1&quot; batch=&quot;products&quot; xmlns:sql=&quot;http://www.strxtrs.net/netropy/sql&quot;&gt;
  &lt;product&gt;
    SELECT
    &lt;sql:attribute name=&quot;id&quot;&gt;p.ProductID&lt;/sql:attribute&gt;,
    &lt;name&gt;p.ProductName&lt;/name&gt;,
    &lt;quantity&gt;p.QuantityPerUnit&lt;/quantity&gt;,
    &lt;price&gt;p.UnitPrice&lt;/price&gt;,
    &lt;stock&gt;p.UnitsInStock&lt;/stock&gt;,
    &lt;supplier&gt;s.CompanyName&lt;/supplier&gt;
    FROM
      Products p, Suppliers s
    WHERE
      p.SupplierID = s.SupplierID
    ORDER BY ProductName
  &lt;/product&gt;
&lt;/netropy:service&gt;
}}}
and the result will be something like
{{{
&lt;?xml version=&quot;1.0&quot; encoding=&quot;iso-8859-1&quot; standalone=&quot;yes&quot; ?&gt;
&lt;?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;productstyle&quot;?&gt;
&lt;products&gt;
  &lt;product id=&quot;17&quot;&gt;&lt;name&gt;Alice Mutton&lt;/name&gt;&lt;quantity&gt;20 - 1 kg tins&lt;/quantity&gt;&lt;price&gt;39.0000&lt;/price&gt;&lt;stock&gt;0&lt;/stock&gt;&lt;supplier&gt;Pavlova, Ltd.&lt;/supplier&gt;&lt;/product&gt;
  &lt;product id=&quot;3&quot;&gt;&lt;name&gt;Aniseed Syrup&lt;/name&gt;&lt;quantity&gt;12 - 550 ml bottles&lt;/quantity&gt;&lt;price&gt;10.0000&lt;/price&gt;&lt;stock&gt;13&lt;/stock&gt;&lt;supplier&gt;Exotic Liquids&lt;/supplier&gt;&lt;/product&gt;
  ...
&lt;/products&gt;
}}}
You can execute the example right [[here|/northwind/products/]].
!!!Attributes
*''database''&lt;br/&gt;(required) name of an ODBC data source.
*''style''&lt;br/&gt;(optional) URL to a stylesheet to refer to in the result.
*''type''&lt;br/&gt;(optional) the MIME type of the result (default &quot;text/xml&quot;).
*''encoding''&lt;br/&gt;(optional) the encoding of the result (default &quot;utf-8&quot;)&lt;br/&gt;Many ODBC data sources contain data encoded with ''iso-8859-1'', the default Windows encoding.
*''batch''&lt;br/&gt;(optional) name of a tag to enclose lists of the items specified in the inner structure.
!!!Service Tags
*''sql:attribute''&lt;br/&gt;injects the value selected from the database as an attribute of the surrounding tag.
*''sql:text''&lt;br/&gt;injects the value selected from the database as a child text node of the surrounding tag.
!!!Example 2
This example shows how you can use the ''sql'' service as a way to generate HTML fragments, which you may use to generate bits and pieces for an AJAX applicaton.
{{{
&lt;category-options&gt;
  &lt;!-- example of a service which directly returns an html fragment --&gt;
  &lt;netropy:service database=&quot;Northwind&quot; module=&quot;sql&quot; type=&quot;text/xml; charset=iso-8859-1&quot; wrap=&quot;select&quot; xmlns:sql=&quot;http://www.strxtrs.net/netropy/sql&quot;&gt;
    &lt;option xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;
      SELECT
      &lt;sql:attribute name=&quot;value&quot;&gt;CategoryID&lt;/sql:attribute&gt;,
      &lt;sql:text&gt;CategoryName&lt;/sql:text&gt;
      FROM
      Categories
      ORDER BY CategoryName
    &lt;/option&gt;
  &lt;/netropy:service&gt;
&lt;/category-options&gt;
}}}
!!!Example 3
Inserting data into a database is just as easy:
{{{
&lt;netropy:service database=&quot;Escapa Highscore Spreadsheet&quot; encoding=&quot;iso-8859-1&quot; module=&quot;sql&quot;&gt;
  &lt;score&gt;
    INSERT INTO HIGHSCORE ( NAME, SCORE ) 
    VALUES (&lt;name&gt;?&lt;/name&gt;, &lt;seconds&gt;?&lt;/seconds&gt;)
  &lt;/score&gt;
&lt;/netropy:service&gt;
}}}
</pre>
</div>
<div title="&lt;netropy:system/&gt;" modifier="Peter Hübel" created="201201282214" modified="201205232149" changecount="5">
<pre>!!!Synopsis
Gives system information about the available services
</pre>
</div>
<div title="&lt;netropy:wiki/&gt;" modifier="Peter Hübel" created="201205160105" modified="201205160105" changecount="2">
<pre>WikiInBluePrint or ServerInWiki</pre>
</div>
<div title="&lt;xeno:blueprint/&gt;" modifier="Peter Hübel" created="200905122044" modified="201402212356" changecount="117">
<pre>!!!Synopsis
This module lets you inspect the blueprint of the [[&lt;netropy:space/&gt;]] that hosts it.
!!!Content
There is no inner structure to the blueprint. Rather the service acts as a generic XML service, returning the content of the blueprint at a given location.
!!!Example
Viewing the definition of the ''Hello World'' application at {{{/hello/world}}} on this server can be accomplished by visiting {{{/blueprint/hello/world}}}.

This works, because there is a blueprint service located at {{{/blueprint}}}, a convention used for allowing introspection into a [[&lt;netropy:space/&gt;]]
 
The following {{{&lt;iframe/&gt;}}} shows the content of the blueprint at {{{/hello/world}}}. Depending on your browser, you may have to view the source of the frame to see the actual XML.

&lt;html&gt;&lt;iframe src=&quot;/blueprint/hello/world&quot; style=&quot;width:100%;&quot;/&gt;&lt;/html&gt;
!!!Attributes
*''type''&lt;br/&gt;(optional) the MIME type of the result. It defaults to {{{text/xml}}}. See the note below.
*''style''&lt;br/&gt;(optional) URL for an XSL stylesheet to refer to in the generated result. The default is not to style the result.
&gt;//''NOTE!''//
&gt;The service does //always// generate XML on success. The ''type'' attribute is only a hint for the client, and is //not// used, nor checked, by the service itself. Reasonable values are {{{text/xml}}} or {{{text/plain}}}.

!!!Other Issues
Beware that the generated XML may become quite large, and that XSL transformation of such huge documents puts a heavy load on a browser. 

Also, some browsers are quite unforgiving about illformed XML, which shows up from time to time. Mostly when some &quot;bad javascript&quot; gets pasted into the blueprint.

In particular Firefox/Mozilla has an issue with generating {{{&lt;base/&gt;}}} tags in XSL style sheets, leading to an error:
{{{
Error during XSLT transformation: Waiting for …
}}}</pre>
</div>
<div title="&lt;xeno:build/&gt;" modifier="Peter Hübel" created="200910032105" modified="201402212318" tags="service undocumented" changecount="13">
<pre>!!!Synopsis
This service, when given a blueprint, produces a new executable instance of &lt;&lt;tiddler xeno&gt;&gt; with the hosting servers architecture.

!!!Attributes
</pre>
</div>
<div title="&lt;xeno:callback/&gt;" modifier="Peter Hübel" created="201403210408" modified="201403222000" changecount="3">
<pre>!!!Synopsis
The visitor has information on from where he originated. So we use this to call back for further information.
!!!

!!!Discussion
Knowing that the visitor's origin is a space structured just like the origin's space can have great benefits. You can treat the other part like yourself then... same structure, same words (namespace)... </pre>
</div>
<div title="&lt;xeno:copy/&gt;" modifier="Peter Hübel" created="201112170212" modified="201604191833" tags="service" changecount="45">
<pre>!!!Synopsis
This module lets you copy information.
!!!Attributes
*''init''&lt;br/&gt;(optional) An URL from where the information shall be copied at service initialisation time. If the service fails to retrieve the information, it may fall back on the content provided in the inner structure.&lt;br/&gt;If no information was retrieved and no inner structure is given, the service is in an invalid state, and requests will fail with a ''500 Internal Server Error''.
*''type''&lt;br/&gt;(optional) The MIME type which will be used as Content-Type in the reply as well as an Accept header if the content is fetched from elsewhere via HTTP.&lt;br/&gt;The default is {{{text/plain}}}, which may be overruled by the Content-Type of the actual content fetched.&lt;br/&gt;Note that XML types will be parsed, whereas scripts and CSS will be enclosed in a CDATA section. See ''Embedding scripts'' below.
!!!Example
This server has mounted [[jQuery]] in the following manner:
{{{
&lt;jquery&gt;
  &lt;xeno:copy init=&quot;http://code.jquery.com/jquery-1.9.1.min.js&quot; type=&quot;application/javascript&quot;/&gt;
&lt;/jquery&gt;
}}}

!!!Embedding scripts
Due to the definition of XML, symbols like ''&lt;'' and ''&gt;'' are not valid in text nodes.
And writing {{{&amp;lt;}}} and {{{&amp;gt;}}} would make the code next to unreadable.
The solution is to embed the script in a CDATA section, e.g.
{{{
&lt;mytoolbar&gt;
    &lt;xeno:copy type=&quot;text/javascript&quot;/&gt;
//&lt;![CDATA[
        // Application specific code
        $(jQuery).fn.myToolBar() 
//]]&gt;
    &lt;/xeno:copy&gt;
&lt;/mytoolbar&gt;
}}}
Note that the tags for the CDATA section are inside comments, as the ''copy'' service returns //everything// between the tags.
You may use another syntax, which relies on the ''copy'' service returning only the contents of the CDATA section in the case where the inner structure consists of only one such section (which mostly will be the case when you want to serve a script):
{{{
&lt;mytoolbar&gt;
    &lt;xeno:copy type=&quot;text/javascript&quot;/&gt;&lt;![CDATA[
        // Application specific code
        $(jQuery).fn.myToolBar = function(parameters) {
        ...
]]&gt;&lt;/xeno:copy&gt;
&lt;/mytoolbar&gt;
}}}</pre>
</div>
<div title="&lt;xeno:disk/&gt;" modifier="Peter Hübel" created="200908200248" modified="201403132120" changecount="55">
<pre>!!!Synopsis
This module acts as an interface to the hosting computers file system. It is a ProtocolResolver, translating an http:// URL to a file:// URL. Mozilla browsers also do that, as you can see if you click [[here|file:/]].
!!!Attributes
*''mount''&lt;br/&gt;(required) a path to the file system object that should be made available. Both absolute and relative paths are allowed. The syntax is OS dependent.
*''mode''&lt;br/&gt;(optional) can be ''static'' or ''dynamic'' (the default).
*''type''&lt;br/&gt;(optional) forces a specific MIME type of the result (the default is determined by the ''disk:mime'' mappings -- see below).
!!!Example
This server has mounted the directory where XSLTForms is installed as a dynamic file service:
{{{
&lt;xeno:disk mount=&quot;./xsltforms-beta&quot;/&gt;
}}}
!!!Service Tags
*''disk:mime''&lt;br/&gt;defines a mapping from a file extension to a specific MIME type. The default set of mappings is: 
{{{
&lt;disk:mime type=&quot;text/xml&quot;&gt;xml&lt;/disk:mime&gt;
&lt;disk:mime type=&quot;text/xml&quot;&gt;xsl&lt;/disk:mime&gt;
&lt;disk:mime type=&quot;text/css&quot;&gt;css&lt;/disk:mime&gt;
&lt;disk:mime type=&quot;text/javascript&quot;&gt;js&lt;/disk:mime&gt;
&lt;disk:mime type=&quot;text/html&quot;&gt;htm&lt;/disk:mime&gt;
&lt;disk:mime type=&quot;text/html&quot;&gt;html&lt;/disk:mime&gt;
&lt;disk:mime type=&quot;text/plain&quot;&gt;txt&lt;/disk:mime&gt;
&lt;disk:mime type=&quot;image/gif&quot;&gt;gif&lt;/disk:mime&gt;
&lt;disk:mime type=&quot;image/jpeg&quot;&gt;jpg&lt;/disk:mime&gt;
&lt;disk:mime type=&quot;image/jpeg&quot;&gt;jpeg&lt;/disk:mime&gt;
&lt;disk:mime type=&quot;image/png&quot;&gt;png&lt;/disk:mime&gt;
&lt;disk:mime type=&quot;application/octet-stream&quot;&gt;exe&lt;/disk:mime&gt;
&lt;disk:mime type=&quot;application/octet-stream&quot;&gt;*&lt;/disk:mime&gt;
}}}
*''disk:default''&lt;br/&gt;(only used for ''type='dynamic' '' in connection with a mounted directory)&lt;br/&gt;declares a file to be served when the request otherwise would result in a ''404 Not Found'' response.&lt;br/&gt;This is quite useful when serving e.g. pictures of employees, based on their initials, where you can use this feature as a fallback to serve a &quot;no image available&quot; picture. 
!!!Example: 
{{{
&lt;xeno:disk mount=&quot;images/employees&quot; default=&quot;no-image.png&quot;/&gt;
}}}</pre>
</div>
<div title="&lt;xeno:display/&gt;" modifier="Peter Hübel" created="201201282213" modified="201403132123" tags="service" changecount="4">
<pre>!!!Synopsis
A service of spatial nature, which displays information on a window. 
Works pretty much like an &lt;iframe/&gt; in HTML.
You can manipulate the DOM by exploiting the spatial nature like in the following example:

!!!Example
In some &lt;xeno:space/&gt; define
{{{
&lt;touch-screen&gt;
&lt;xeno:display src=&quot;/hello/world&quot;/&gt;
&lt;/touch-screen&gt;
}}}




!!!Attributes
style (for having your own &quot;display&quot; MarkupLanguage).

</pre>
</div>
<div title="&lt;xeno:duct_tape/&gt;" modifier="Peter Hübel" created="201201200206" modified="201604191936" tags="service" changecount="20">
<pre>!!!Synopsis
This module lets you insert loose fragments into the structure of a [[&lt;netropy:space/&gt;]]. No need to say, use this at your own risk and don't bet your life on it. But it is good for tinkering, and an expression of the fact, that the programmer has had a poor imagination, not foreseeing every possible use of the information present in an InformationSpace.
!!!Content
!!!Example
{{{
&lt;xeno:space ...&gt;
  &lt;xeno:http port=&quot;8901&quot;/&gt;
  &lt;xeno:duct_tape doctype=&quot;html&quot;/&gt;
  &lt;xeno:copy type=&quot;text/html&quot;&gt;
    &lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;
      &lt;head&gt;
        ...
  &lt;/xeno:copy&gt;
&lt;/xeno:space&gt;
}}}
This is a minimal space, serving one wellformed static ''HTML'' document on port ''8901''.</pre>
</div>
<div title="&lt;xeno:extend/&gt;" modifier="Peter Hübel" created="201310091411" modified="201403221938" tags="ToDo" changecount="7">
<pre>!!Synopsis
This service installs extension services into &lt;&lt;tiddler xeno&gt;&gt;.</pre>
</div>
<div title="&lt;xeno:http/&gt;" modifier="Peter Hübel" created="201310100415" modified="201403210903" changecount="12">
<pre>!!!Synopsis
This module maintains an HTTP port into a [[&lt;xeno:space/&gt;]].
!!!Attributes
*''addr''&lt;br/&gt;(default 0.0.0.0/0::0) The IP address to bind to.
*''port''&lt;br/&gt;(default 8901) An IP port number. Remember the first 1024 are reserved for the system. If you want the [[xeno]] to behave like a normal webserver, use port 80 and make sure the user running the process has rights to open that port.

!!!Notes
* Services which should be private can be exposed on the loopback (127.0.0.1) interface.</pre>
</div>
<div title="&lt;xeno:pattern/&gt;" modifier="Peter Hübel" created="201112040232" modified="201403222136" tags="space unimplemented" changecount="42">
<pre>!!!Synopsis
This service declares a template which may be referenced later.
!!!Attributes

Remaining attributes are taken as variable names, which may be used for substitution in the inner structure. 
!!![[AttributeSyntax]]
!!!Hello World Example
{{{
...
&lt;xeno:pattern module='hello' xmlns='this' greeting='Hello' subtext='world'&gt;
  &lt;hello&gt;
    &lt;xeno:copy init='@subtext'&gt;
      &lt;netropy:copy type='text/xml'&gt;
        ...
        &lt;xeno:pattern/&gt;
        ...
        &lt;div&gt;
          &lt;xeno:copy src='@greeting'/&gt;  &lt;xeno:copy src='@subtext'/&gt;!
        &lt;/div&gt;
        ...
        &lt;xeno:pattern/&gt;
        ...
      &lt;/xeno:copy&gt;
    &lt;/xeno:copy&gt;
  &lt;/hello&gt;
&lt;/xeno:pattern&gt;
...
}}}
Here we define a pattern which shall be known as ''hello''.
The pattern uses copies of the variable {{{ subtext}}} twice. First as the name of a tag, and a second time (inside the {{{&lt;div/&gt;}}}) as simple text.

!!!Using variables
Variables are accessed with the ''copy'' service, which actually is being executed when instantiating the pattern. That happens when compiling the blueprint of the containing space.
To illustrate, the above pattern when used like this
{{{
&lt;this:hello/&gt;
}}}
will result in a structure which looks like this:
{{{
...
  &lt;hello&gt;
    &lt;world&gt;
      &lt;xeno:copy type='text/xml'&gt;
        ...
        &lt;div&gt;Hello world!&lt;/div&gt;
        ...
      &lt;/xeno:copy&gt;
    &lt;/world&gt;
  &lt;/hello&gt;
...
}}}
!!!Using patterns
To use a pattern, you simply write:
{{{
&lt;xeno:pattern module='hello' subtext='XENOmat'/&gt;
}}}
The resulting structure is left as an exercise for the reader.
!!!Missing attributes
In case we don't supply an attribute, and the pattern declaration has no default value for it, the ''copy'' will produce nothing. //It takes two to tango//, you might say. 
So a use of ''hello'' with no {{{subtext}}} will result in
{{{
...
  &lt;hello/&gt;
...
}}}

!!!Etymology
This service is named in honor of the BETA Programming Language, which (inevitably) has had its influence on this technology.</pre>
</div>
<div title="&lt;xeno:space/&gt;" modifier="Peter Hübel" created="200908200047" modified="201403221939" changecount="64">
<pre>You may visualise an information space in many ways.

The programming philosophy of &lt;&lt;tiddler xeno&gt;&gt; is not to push any particular view about the implementation, but to focus on the structures within a ''&lt;xeno:space/&gt;''. We can only talk about these structures in general by using spacial terms. But since spatial concepts map quite well to most domains (as shall be given with the next few examples) this hardly imposes any problems.

!!!Embedded systems
As a hardware or embedded software developer, working with embedded systems, you might interpret a ''&lt;xeno:space/&gt;'' as a set of registers, which you may read and write to. This is not a completely wrong picture, since &lt;&lt;tiddler xeno&gt;&gt; is designed from the bottom up to maximise utilisation of the hardware which runs below. Also some simple I/O-service designed for a specific device might use exactly that interpretation in the structure of the space, e.g.
{{{
&lt;xeno:space host=&quot;boiler.example.net&quot;&gt;
  ...
  &lt;temperature&gt;
    &lt;custom:AR4 register=&quot;33&quot; offset=&quot;32&quot; scale=&quot;1.4&quot;/&gt;
  &lt;temperature&gt;
  ...
&lt;/xeno:space&gt;
}}}
where navigating to {{{/temperature}}} returns some sensory input -- a temperature value in the example above -- offset and scaled, ready for consumption by any client of the device. And with minimal overhead.

The &quot;~AR4&quot; service can be implemented in native C or C++.

!!!Continuous Integration
The dynamic nature of a ''&lt;xeno:space/&gt;'' and the versatility of services allows you easily to make mockups, like from the example above:
{{{
  ...
  &lt;temperature&gt;
    &lt;xeno:stash/&gt;
  &lt;temperature&gt;
  ...
}}}
where a ''stash'' is simulating the register and some tool as simple as the local [[editor|editor]] can be used to change its values.
Part of your development team may start coding the application building on the XML interface, while others finish the hardware and implement the device or platform specific services needed.
The whole team does continuous integration by gradually replacing the mockups with real implementations.
!!!!Code coverage
Due to the nature of a ''&lt;xeno:space/&gt;'', you have information at hand on the number of visits to a particual place. This information can be used as data for statistics, as well as for optimising the structure of your data. Often visited subspaces might benefit from having a port of their own, maybe with restricted access, localhost only.

!!!Systems integration
In another context, a ''&lt;xeno:space/&gt;'' may look more like a huge XML document, tying together information from a number of different sources into a logical unit, e.g.
{{{
&lt;xeno:space host=&quot;people.example.com&quot;&gt;
  ...
  &lt;staff&gt;
    &lt;!-- database data --&gt;
    &lt;xeno:sql style=&quot;employee-list&quot; ... /&gt;
    &lt;images&gt;
      &lt;!-- serving pictures for employees --&gt;
      &lt;xeno:disk mount=&quot;/photos/employees/&quot;&gt;
        &lt;disk:default path=&quot;/photos/employees/missing.jpg&quot; /&gt;
      &lt;/xeno:disk&gt;
    &lt;/images&gt;
    &lt;employee-list&gt;
      &lt;!-- stylesheet for presenting employees, also using images --&gt;
      &lt;xeno:copy type=&quot;text/xsl&quot;&gt;
        &lt;xsl:stylesheet .../&gt;
      &lt;/xeno:copy&gt;
    &lt;/employee-list&gt;
  &lt;/staff&gt;
  ...
&lt;/xeno:space&gt;
}}}
While developing a web application, the use of mockups also can come in handy.</pre>
</div>
<div title="&lt;xeno:sql/&gt;" modifier="Peter Hübel" created="200905121942" modified="201604172239" tags="service" changecount="2">
<pre>!!!Synopsis
This module acts as an interface to an SQL database.
!!!Content
The inner structure of the ''sql'' service contains the SQL to execute on the database.

The SQL //must// be surrounded by an XML element (which then will wrap each row of the result) and it  //must// start immediately after the opening tag. Apart from the SQL being wellformed in respect to the configured ''database'', these are the only requirements. 
!!!Example 1
Here is a sample of what an instance of this service may look like.
{{{
&lt;xeno:sql database=&quot;Northwind&quot; style=&quot;productstyle&quot; type=&quot;text/xml&quot; encoding=&quot;iso-8859-1&quot; batch=&quot;products&quot; xmlns:sql=&quot;http://www.strxtrs.net/netropy/sql&quot;&gt;
  &lt;product&gt;
    SELECT
    &lt;sql:attribute name=&quot;id&quot;&gt;p.ProductID&lt;/sql:attribute&gt;,
    &lt;name&gt;p.ProductName&lt;/name&gt;,
    &lt;quantity&gt;p.QuantityPerUnit&lt;/quantity&gt;,
    &lt;price&gt;p.UnitPrice&lt;/price&gt;,
    &lt;stock&gt;p.UnitsInStock&lt;/stock&gt;,
    &lt;supplier&gt;s.CompanyName&lt;/supplier&gt;
    FROM
      Products p, Suppliers s
    WHERE
      p.SupplierID = s.SupplierID
    ORDER BY ProductName
  &lt;/product&gt;
&lt;/xeno:sql&gt;
}}}
and the result will be something like
{{{
&lt;?xml version=&quot;1.0&quot; encoding=&quot;iso-8859-1&quot; standalone=&quot;yes&quot; ?&gt;
&lt;?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;productstyle&quot;?&gt;
&lt;products&gt;
  &lt;product id=&quot;17&quot;&gt;&lt;name&gt;Alice Mutton&lt;/name&gt;&lt;quantity&gt;20 - 1 kg tins&lt;/quantity&gt;&lt;price&gt;39.0000&lt;/price&gt;&lt;stock&gt;0&lt;/stock&gt;&lt;supplier&gt;Pavlova, Ltd.&lt;/supplier&gt;&lt;/product&gt;
  &lt;product id=&quot;3&quot;&gt;&lt;name&gt;Aniseed Syrup&lt;/name&gt;&lt;quantity&gt;12 - 550 ml bottles&lt;/quantity&gt;&lt;price&gt;10.0000&lt;/price&gt;&lt;stock&gt;13&lt;/stock&gt;&lt;supplier&gt;Exotic Liquids&lt;/supplier&gt;&lt;/product&gt;
  ...
&lt;/products&gt;
}}}
You can execute the example right [[here|/northwind/products/]] or check the [[used SQL|/blueprint/raw/northwind/products/real]].
!!!Attributes
*''database''&lt;br/&gt;(required) name of an ODBC data source.
*''style''&lt;br/&gt;(optional) URL to a stylesheet to refer to in the result.
*''type''&lt;br/&gt;(optional) the MIME type of the result (default &quot;text/xml&quot;).
*''encoding''&lt;br/&gt;(optional) the encoding of the result (default &quot;utf-8&quot;)&lt;br/&gt;Many ODBC data sources contain data encoded with ''iso-8859-1'', the default Windows encoding.
*''batch''&lt;br/&gt;(optional) name of a tag to enclose lists of the items specified in the inner structure.
!!!Service Tags
*''sql:attribute''&lt;br/&gt;injects the value selected from the database as an attribute of the surrounding tag.
*''sql:text''&lt;br/&gt;injects the value selected from the database as a child text node of the surrounding tag.
!!!Example 2
This example shows how you can use the ''sql'' service as a way to generate HTML fragments, which you may use to generate bits and pieces for an AJAX applicaton.
{{{
&lt;category-options&gt;
  &lt;!-- example of a service which directly returns an html fragment --&gt;
  &lt;xeno:sql wrap=&quot;select&quot; database=&quot;Northwind&quot; type=&quot;text/xml; charset=iso-8859-1&quot; xmlns:sql=&quot;http://www.strxtrs.net/netropy/sql&quot;&gt;
    &lt;option xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;
      SELECT
      &lt;sql:attribute name=&quot;value&quot;&gt;CategoryID&lt;/sql:attribute&gt;,
      &lt;sql:text&gt;CategoryName&lt;/sql:text&gt;
      FROM
      Categories
      ORDER BY CategoryName
    &lt;/option&gt;
  &lt;/xeno:sql&gt;
&lt;/category-options&gt;
}}}
!!!Example 3
Inserting data into a database is just as easy:
{{{
&lt;xeno:sql database=&quot;Escapa Highscore Spreadsheet&quot; encoding=&quot;iso-8859-1&quot;&gt;
  &lt;score&gt;
    INSERT INTO HIGHSCORE ( NAME, SCORE ) 
    VALUES (&lt;name&gt;?&lt;/name&gt;, &lt;seconds&gt;?&lt;/seconds&gt;)
  &lt;/score&gt;
&lt;/xeno:sql&gt;
}}}
</pre>
</div>
<div title="A short introduction to the XENOmat" modifier="Peter Hübel" created="200909181432" modified="201403222128" changecount="60">
<pre>&lt;&lt;tiddler xeno&gt;&gt; is a machine designed to transport and transform structured information while using a minimum of energy on the physical level. It achieves that goal by leveraging the tension inherent in any representation of information - the difference between “something” and “nothing” - and putting that tension to work in a physical sense. To quote one of the great minds in cybernetics and system theory of the last century:
&gt;What we mean by information — the elementary unit of information — is a difference 
&gt;which makes a difference.
&gt; 
&gt;//Gregory Bateson//
&gt;//1904-1980//
This basic principle of acting on some potential relates &lt;&lt;tiddler xeno&gt;&gt; more to the family of [[Cellular Automata|http://en.wikipedia.org/wiki/Cellular_automata]] than to the tribe of traditional information processors. 
!!The physical reality
In prevailing technology the driving force for moving bits around is obtained by means of logic circuits situated separately from the information. The function and //sole purpose// of these circuits is to synthesise yet another representation (e.g. the result of a binary comparison) which in effect provides the tension for a change in state (i.e. trigger a flow of electrons in a small region of the semiconductor). 

There is no need to point out that this approach to computation demands an order more of energy, which (apart from producing thermal noise and generating secondary demands for cooling) also inhibits the use of a number of renewable energy sources which simply cannot deliver sufficient power for these kind of processors.

We simply believe, that these inhibitions neither are needed nor wanted in modern information systems.
!!Proof of concept
So far we have managed to construct a working simulation of &lt;&lt;tiddler xeno&gt;&gt; in software, so to speak a virtual machine, which is called [[xeno]]. You are reading information served from it right now.

It uses ~UTF-8 encoded XML for the representation of structured information and HTTP for transport. This choice is not completely arbitrary, since transporting XML over HTTP naturally opens up for interoperability over the internet.

As a note, the demand for the extra level of circuits mentioned in the previous section is a direct consequence from using the [[Von Neumann bottleneck architecture|http://en.wikipedia.org/wiki/Von_Neumann_architecture#Von_Neumann_bottleneck]]. This problem naturally can not be overcome in software, unless you cheat and trim your information to fit into the processors cache.
!!Further development
We're currently working on two fronts: 
*Porting &lt;&lt;tiddler xeno&gt;&gt; to other Linux dialects to have it embedded in even more electronic devices.
*Researching into the feasibility of implementing &lt;&lt;tiddler xeno&gt;&gt; in VHDL onto an FPGA.</pre>
</div>
<div title="Acknowledgements" modifier="Peter Hübel" created="201201282148" modified="201402212250" changecount="14">
<pre>While developing &lt;&lt;tiddler xeno&gt;&gt; the following publications have been a great inspiration and help to me. A warm thank you to the respective developers, initiators, writers, and publishers.

www.w3.org - the mother-source of all standards.
developer.mozilla.org - good coverage of evolvements and examples of using those standards.
www.tiddlywiki.com - a wonderful tool for organising information, a spirited sibling to &lt;&lt;tiddler xeno&gt;&gt;.

!!!Personal Thanks
Torben Nielsen, Bjarne Stroustrup, Werner Ganahl, and the whole team at [[GINS|http://www.gantner-instruments.com]].
</pre>
</div>
<div title="Agile application development" modifier="Peter Hübel" created="200905191450" modified="201404061250" tags="Benefits" changecount="26">
<pre>At the end of the day, every piece of software has to be specified, written, tested, and deployed. Developing with a &lt;&lt;tiddler xeno&gt;&gt; makes that easy.
!!!!!Small
The &lt;&lt;tiddler xeno&gt;&gt; provides a ''single infrastructure'' necessary to build and deploy applications. It works as an XML repository, lets you integrate your relational databases, and provides you with a high performance web server, giving you everything you need to fulfill your XML content delivery needs.
!!!!!Fast
This means that you can more ''quickly'' develop applications ready for market, and those applications run more efficiently and effectively because they are on a single platform, saving you both time and money.</pre>
</div>
<div title="AtYourService" modifier="YourName" created="200905121935" modified="201402020240" changecount="65">
<pre>At certain &quot;sites&quot; in your information space, there may be services who process information for visitors inside a [[&lt;netropy:space/&gt;|InformationSpaces]].

The wiki, you are reading now is defined in this servers space as
{{{
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; standalone=&quot;yes&quot;?&gt;
&lt;netropy:space xmlns:netropy=&quot;http://www.strxtrs.net/netropy/&quot;&gt;
        ...
  &lt;manual&gt;
    &lt;!-- serve a specific file (preload it) --&gt;
    &lt;netropy:disk mode=&quot;static&quot; mount=&quot;manual.html&quot; type=&quot;text/html&quot;/&gt;
  &lt;/manual&gt;
        ...
&lt;/netropy:space&gt;
}}}
A service is designated by the {{{module}}} attribute, that is {{{disk}}} in the example above.
!!!!Basic Modules
&lt;&lt;tiddler [[Built In Services]]&gt;&gt;</pre>
</div>
<div title="AttributeSyntax" modifier="PeterHübel" created="201205240125" modified="201205240236" changecount="15">
<pre>!!Referencing attributes
@attribute means the value of the attribute from the enclosing [[&lt;netropy:pattern/&gt;]]. Think of XPath navigation syntax:
{{{
||| What is this? How should the Q.reader react to this event?
HTTP/1.0 POST /measured/Q.readerDAQ/
Content-Type: x-application/not-an-iana-type
&lt;netropy:event from=&quot;/&quot;&gt;
&lt;/netropy:event&gt;
}}}

$attribute is used for runtime binding, and it has two cases:
*  $0, or any number, means the value of the attribute is taken from the remainder of the URL, relative to the ''&quot;/&quot;'' denoting the entry into the runtime instance of the &lt;netropy:pattern/&gt;.
{{{
&lt;!-- given the hello world example --&gt;
...
&lt;this:hello greeting=&quot;$1&quot; /&gt;  
...
}}}

&lt;netropy:handler/&gt; could be implemented as a pattern, taking a &lt;netropy:event/&gt; which itself is a structure, where the sender can fill in some attributes.</pre>
</div>
<div title="Basic Concepts" modifier="Peter Hübel" created="200905191515" modified="201604210540" changecount="48">
<pre>Working with &lt;&lt;tiddler xeno&gt;&gt; has very few prerequisites. 
!!Introductory Articles
* [[InformationSpaces]]&lt;br/&gt;A primer on the &quot;world view&quot; of Netropy Server.&lt;br/&gt;&lt;br/&gt;
* [[Streams, Stacks, Stashes, and Spaces]]&lt;br/&gt;The fundamental components of &lt;&lt;tiddler xeno&gt;&gt;.
!!Caveat Programmer
You should have good knowledge of 
*''[[XML|http://www.w3.org/TR/xml]]'' 
and accompanying technologies like 
*''[[XSLT|http://www.w3.org/TR/xslt]]''
*''[[XPath|http://www.w3.org/TR/xpath]]''
Read those specs from the ~W3C if you haven't already! &lt;&lt;smiley ;-)&gt;&gt;

Eine hervoragende [[deutsche version|http://www.linkwerk.com/]] gibt es beim Team von [[linkwerk]].</pre>
</div>
<div title="Blueprint" modifier="Peter Hübel" created="200905192110" modified="201402212346" changecount="8">
<pre>The blueprint for this &lt;&lt;tiddler xeno&gt;&gt;:

&lt;html&gt;&lt;iframe src='/blueprint' style='width:100%;height:32em;'/&gt;&lt;/html&gt;

Read more about this service [[here|&lt;netropy:blueprint/&gt;]].</pre>
</div>
<div title="Built In Services" modifier="Peter Hübel" created="200905122049" modified="201604210543" changecount="86">
<pre>&lt;&lt;tiddler xeno&gt;&gt; comes with a number of built in service modules:
*[[copy|&lt;xeno:copy/&gt;]] - copies the content of the service back through the port, where the request entered. Assumes copyright for content. &lt;&lt;smiley ;-)&gt;&gt;
*[[disk|&lt;xeno:disk/&gt;]] - maps a file or file system to a site and serves the content of disk based files.
*''stash'' - a place to get and put variable structured or unstructured information.
*''space'' - a place to extend simply by going there and setting up the structure on the way.
*[[sql|&lt;xeno:sql/&gt;]] - a place to interface with a database (ODBC in this version). ODBC also allows you also to use an Excel&amp;reg; spreadsheet as your data source as in the [[Escapa!|/escapa/]] sample application.
*[[blueprint|&lt;xeno:blueprint/&gt;]] - a service which allows you to introspect on the [[&lt;xeno:space/&gt;]] it resides in.
*[[http|&lt;xeno:http/&gt;]] - sets up a HTTP server to access this space from the outside.
</pre>
</div>
<div title="BuzzWords" modifier="Peter Hübel" created="201201290044" changecount="1">
<pre>ProgrammingByExample
InventingByExample</pre>
</div>
<div title="C++ API" modifier="PeterHübel" created="200908200216" modified="200908302140" changecount="17">
<pre>You don't have to manipulate an XML DOM to program services for Netropy Server.

The C++ API consists of a number of templates, which lets you define service objects, and help you map your own classes directly to the native structures of Netropy Server.</pre>
</div>
<div title="Clock2" modifier="PeterHübel" created="200903160941" modified="200903160941" tags="systemConfig" changecount="7">
<pre>/***
| Name:|Clock2|
| Author:|Simon Baird|
| Description:|A skinnable, sizeable analog clock|
| Source:|http://tiddlyspot.com/mptw/#Clock2|
| Requires:|Firefox 1.5.x or maybe Safari|
| Version:|1.0.3|
| Date:|4-Aug-2006|
!!Note
* Does not work in IE or Opera due to lack of canvas support.
* If you make a nice skin send it to me and I will include it here.
!!Ideas
* Can we support IE with this? http://sourceforge.net/projects/excanvas
* Skin should specify order of drawing so things can be on top of other things
* Fix it so we can have filled and/or stroked elements
* Skin should allow any number of moving and static elements
* Make download and example for non-TW use
* Make floating draggable?
!!Examples
{{{
&lt;&lt;clock2 fancy&gt;&gt;&lt;&lt;clock2 120&gt;&gt;
&lt;&lt;clock2 chunkySwiss&gt;&gt; &lt;&lt;clock2 60 chunkySwiss noSeconds&gt;&gt;&lt;&lt;clock2 '{
 outerBorder: { lineWidth: 60, radius:55, color: &quot;#dd8877&quot;, alpha: 1 },
 smallIndicator: { lineWidth: 4, startAt: 80, endAt: 95, color: &quot;white&quot;, alpha: 1 },
 largeIndicator: { lineWidth: 12, startAt: 77, endAt: 89, color: &quot;#dd8877&quot;, alpha: 1 },
 hourHand: { lineWidth: 15, startAt: -15, endAt: 50, color: &quot;white&quot;, alpha: 1 },
 minuteHand: { lineWidth: 10, startAt: 24, endAt: 200, color: &quot;#771100&quot;, alpha: 0.6 },
 secondHand: { lineWidth: 3, startAt: 22, endAt: 83, color: &quot;green&quot;, alpha: 0 },
 secondDecoration: { lineWidth: 1, startAt: 52, radius: 26, fillColor: &quot;white&quot;, color: &quot;red&quot;, alpha: 0.2 }
}'&gt;&gt;

}}}
&lt;&lt;clock2 fancy&gt;&gt;&lt;&lt;clock2 120&gt;&gt;
&lt;&lt;clock2 chunkySwiss&gt;&gt; &lt;&lt;clock2 60 chunkySwiss noSeconds&gt;&gt;&lt;&lt;clock2 '{
 outerBorder: { lineWidth: 60, radius:55, color: &quot;#dd8877&quot;, alpha: 1 },
 smallIndicator: { lineWidth: 4, startAt: 80, endAt: 95, color: &quot;white&quot;, alpha: 1 },
 largeIndicator: { lineWidth: 12, startAt: 77, endAt: 89, color: &quot;#dd8877&quot;, alpha: 1 },
 hourHand: { lineWidth: 15, startAt: -15, endAt: 50, color: &quot;white&quot;, alpha: 1 },
 minuteHand: { lineWidth: 10, startAt: 24, endAt: 200, color: &quot;#771100&quot;, alpha: 0.6 },
 secondHand: { lineWidth: 3, startAt: 22, endAt: 83, color: &quot;green&quot;, alpha: 0 },
 secondDecoration: { lineWidth: 1, startAt: 52, radius: 26, fillColor: &quot;white&quot;, color: &quot;red&quot;, alpha: 0.2 }
}'&gt;&gt;

See also BigClock.
!!Code
***/
//{{{

window.CoolClock = function(canvasId,displayRadius,skinId,showSecondHand) {
 return this.init(canvasId,displayRadius,skinId,showSecondHand);
}

CoolClock.config = {
 clockTracker: {},
 tickDelay: 1000,
 longTickDelay: 15000,
 defaultRadius: 85,
 renderRadius: 100,
 defaultSkin: &quot;swissRail&quot;,
 skins: {
 // try making your own...
 swissRail: {
 outerBorder: { lineWidth: 1, radius:95, color: &quot;black&quot;, alpha: 1 },
 smallIndicator: { lineWidth: 2, startAt: 89, endAt: 93, color: &quot;black&quot;, alpha: 1 },
 largeIndicator: { lineWidth: 4, startAt: 80, endAt: 93, color: &quot;black&quot;, alpha: 1 },
 hourHand: { lineWidth: 8, startAt: -15, endAt: 50, color: &quot;black&quot;, alpha: 1 },
 minuteHand: { lineWidth: 7, startAt: -15, endAt: 75, color: &quot;black&quot;, alpha: 1 },
 secondHand: { lineWidth: 1, startAt: -20, endAt: 85, color: &quot;red&quot;, alpha: 1 },
 secondDecoration: { lineWidth: 1, startAt: 70, radius: 4, fillColor: &quot;red&quot;, color: &quot;red&quot;, alpha: 1 }
 },
 chunkySwiss: {
 outerBorder: { lineWidth: 5, radius:97, color: &quot;black&quot;, alpha: 1 },
 smallIndicator: { lineWidth: 4, startAt: 89, endAt: 93, color: &quot;black&quot;, alpha: 1 },
 largeIndicator: { lineWidth: 8, startAt: 80, endAt: 93, color: &quot;black&quot;, alpha: 1 },
 hourHand: { lineWidth: 12, startAt: -15, endAt: 60, color: &quot;black&quot;, alpha: 1 },
 minuteHand: { lineWidth: 10, startAt: -15, endAt: 85, color: &quot;black&quot;, alpha: 1 },
 secondHand: { lineWidth: 4, startAt: -20, endAt: 85, color: &quot;red&quot;, alpha: 1 },
 secondDecoration: { lineWidth: 2, startAt: 70, radius: 8, fillColor: &quot;red&quot;, color: &quot;red&quot;, alpha: 1 }
 },
 fancy: {
 outerBorder: { lineWidth: 5, radius:95, color: &quot;green&quot;, alpha: 0.7 },
 smallIndicator: { lineWidth: 1, startAt: 80, endAt: 93, color: &quot;black&quot;, alpha: 0.4 },
 largeIndicator: { lineWidth: 1, startAt: 30, endAt: 93, color: &quot;black&quot;, alpha: 0.5 },
 hourHand: { lineWidth: 8, startAt: -15, endAt: 50, color: &quot;blue&quot;, alpha: 0.7 },
 minuteHand: { lineWidth: 7, startAt: -15, endAt: 92, color: &quot;red&quot;, alpha: 0.7 },
 secondHand: { lineWidth: 10, startAt: 80, endAt: 85, color: &quot;blue&quot;, alpha: 0.3 },
 secondDecoration: { lineWidth: 1, startAt: 30, radius: 50, fillColor: &quot;blue&quot;, color: &quot;red&quot;, alpha: 0.15 }
 }
 }
};

CoolClock.prototype = {
 init: function(canvasId,displayRadius,skinId,showSecondHand) {
 this.canvasId = canvasId;
 this.displayRadius = displayRadius || CoolClock.config.defaultRadius;
 this.skinId = skinId || CoolClock.config.defaultSkin;
 this.showSecondHand = typeof showSecondHand == &quot;boolean&quot; ? showSecondHand : true;
 this.tickDelay = CoolClock.config[ this.showSecondHand ? &quot;tickDelay&quot; : &quot;longTickDelay&quot;];

 this.canvas = document.getElementById(canvasId);
 this.canvas.setAttribute(&quot;width&quot;,this.displayRadius*2);
 this.canvas.setAttribute(&quot;height&quot;,this.displayRadius*2);

 this.renderRadius = CoolClock.config.renderRadius; 

 var scale = this.displayRadius / this.renderRadius;
 this.ctx = this.canvas.getContext(&quot;2d&quot;);
 this.ctx.scale(scale,scale);

 CoolClock.config.clockTracker[canvasId] = this;
 this.tick();
 return this;
 },

 fullCircle: function(skin) {
 this.fullCircleAt(this.renderRadius,this.renderRadius,skin);
 },

 fullCircleAt: function(x,y,skin) {
 with (this.ctx) {
 save();
 globalAlpha = skin.alpha;
 lineWidth = skin.lineWidth;
 beginPath();
 arc(x, y, skin.radius, 0, 2*Math.PI, false);
 if (skin.fillColor) {
 fillStyle = skin.fillColor
 fill();
 }
 else {
 // XXX why not stroke and fill
 strokeStyle = skin.color;
 stroke();
 }
 restore();
 }
 },

 radialLineAtAngle: function(angleFraction,skin) {
 with (this.ctx) {
 save();
 translate(this.renderRadius,this.renderRadius);
 rotate(Math.PI * (2 * angleFraction - 0.5));
 globalAlpha = skin.alpha;
 strokeStyle = skin.color;
 lineWidth = skin.lineWidth;
 if (skin.radius) {
 this.fullCircleAt(skin.startAt,0,skin)
 }
 else {
 beginPath();
 moveTo(skin.startAt,0)
 lineTo(skin.endAt,0);
 stroke();
 }
 restore();
 }
 },

 render: function(hour,min,sec) {
 var skin = CoolClock.config.skins[this.skinId];
 this.ctx.clearRect(0,0,this.renderRadius*2,this.renderRadius*2);

 this.fullCircle(skin.outerBorder);

 for (var i=0;i&lt;60;i++)
 this.radialLineAtAngle(i/60,skin[ i%5 ? &quot;smallIndicator&quot; : &quot;largeIndicator&quot;]);
 
 this.radialLineAtAngle((hour+min/60)/12,skin.hourHand);
 this.radialLineAtAngle((min+sec/60)/60,skin.minuteHand);
 if (this.showSecondHand) {
 this.radialLineAtAngle(sec/60,skin.secondHand);
 this.radialLineAtAngle(sec/60,skin.secondDecoration);
 }
 },


 nextTick: function() {
 setTimeout(&quot;CoolClock.config.clockTracker['&quot;+this.canvasId+&quot;'].tick()&quot;,this.tickDelay);
 },

 stillHere: function() {
 return document.getElementById(this.canvasId) != null;
 },

 refreshDisplay: function() {
 var now = new Date();
 this.render(now.getHours(),now.getMinutes(),now.getSeconds());
 },

 tick: function() {
 if (this.stillHere()) {
 this.refreshDisplay()
 this.nextTick();
 }
 }
}



config.macros.clock2 = {
 counter: 0,
 handler: function (place,macroName,params,wikifier,paramString,tiddler) {
 var size,skin,seconds,skinData;
 for (var i=0;i&lt;params.length;i++)
 if (/^\d+$/.exec(params[i]))
 size = params[i];
 else if (params[i] == &quot;noSeconds&quot;)
 seconds = false;
 else if (/^\{/.exec(params[i]))
 eval(&quot;skinData = &quot; + params[i]);
 else
 skin = params[i];
 if (skinData) {
 CoolClock.config.skins.customSkin = skinData;
 skin = &quot;customSkin&quot;;
 }
 var canvas = createTiddlyElement(place,&quot;canvas&quot;,&quot;clockcanvas&quot;+this.counter);
 var clock = new CoolClock(&quot;clockcanvas&quot;+this.counter,size,skin,seconds);
 this.counter++;
 }
}

//}}}
</pre>
</div>
<div title="CodeSource" modifier="Peter Hübel" created="201202090715" modified="201202090718" changecount="2">
<pre>Who ever invented word SourceCode should be flogged with a wet baguette.

What mostly is meant, is the text which is used as a source for some compiler or assembler for the program to produce code. The bit-patterns which machines understand. //That// is the code. Others are computer languages, which basically are used to instruct other programs to emit code. Which, when stuffed into different segments in the machines, is interpreted as instructions or data. Or both. ROM and RAM.

Probably another instance of the Anglo-Saxon DownsideUpSyndrome.</pre>
</div>
<div title="Codon" modifier="Peter Hübel" created="201204131134" changecount="1">
<pre>&lt;html&gt;&lt;img src=&quot;http://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/RNA-codons.png/220px-RNA-codons.png&quot;&gt;&lt;/html&gt;</pre>
</div>
<div title="CommandLineSyntax" modifier="PeterHübel" created="201210042148" modified="201210142353" changecount="31">
<pre>// Version 2.0 only //

''netropy ?''
Will list all running instances of netropy on this machine.

''netropy HELP'' or ''netropy -h''
Lists the syntax for the command line.

''netropy blueprint.xml''
Will run an instance of [[NetropyServer]] using the designated file as a blueprint.
The blueprint contains the information about ports and so on.

''netropy GET http://hostname/path/to/some/resource''
Will get the resource from the designated server. Might use a binary protocol.

''netropy GET /path/to/some/resource''
Will get the resource from the default port (8901) on the local host.

''netropy GET 8901 /path/to/some/resource''
Will get the resource via the designated port on the local host.

''netropy PUT http://hostname/path/to/some/resource content.xml''
Replace the designated resource with the file //content.xml//. As the file extension belongs to the basic known set of MIME types, the {{{Content-Type}}} will be set to {{{application/xml}}}.

''netropy PUT http://hostname/path/to/some/resource''
Replace the designated resource with the data from the standard input.
The {{{Content-Type}}} of the data will be {{{text/plain}}} for HTTP, or ASCII for FTP.
Just type along, and press Ctrl+D on Linux/OSX or Ctrl+Z on Windows to end the filing of your input directly to your target. The request will not contain any Content-Length and the target service should pipe or stream what is being delivered. This can be used for implementing command console services.</pre>
</div>
<div title="Content-Type" modifier="Peter Hübel" created="201201160532" modified="201201160639" changecount="6">
<pre>The HTTP header used to identify how to interpret the reply.
See [[the standard about the meaning of Content-Type|http://http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.17]].</pre>
</div>
<div title="CopyingLikeInTheXeroxAge" modifier="YourName" created="200910062309" modified="200910082050" changecount="10">
<pre>Back around when a photocopier replaced the old spirit duplicators in more and more places, more and more things got &quot;copied&quot;. To wit: Even parts of peoples bodies! That's hard to do on a spirit duplicator, and you might ask yourself: Why? Why do people copy things? Documents, for instance. Or crazy cartoons. Or funny diagrams. The usual office wall stuff. For one, those things are easy to make an almost perfect copy from. And because we can, thanks to technology. All it requires is a push on a button.

Few people would take the work to copy such a drawing by hand - and hence we live in //tempora et mores//, where very few people also have the skill to do it well. This is a direct consequence of the former. Any skill requires amounts of talent and practice, and like any form of learning, you start out your practice by copying. As a child you copy the behavior of those around you. Later on you copy the letters and digits, and symbols, the teachers shows you at school. And so on.

The driving force in copying might be viewed at as a urge to achieve some form of symmetry (GregoryBateson). Symmetry is one concept extremely important to communication theory, as it expresses itself as a way of ensuring that &quot;the message got across&quot;. And in relation to our own profession as information technicians and technologists, we may use symmetry for obtaining simplicity in design (Henney, 2001).

Complementarity is the other force in the field of information theory. This is the &quot;difference&quot; that makes stuff interesting (as opposed to InformationDeprivation), since on a physical level such differences are conceptualised as a potential for energy transfer.

!!Case AO.dk

</pre>
</div>
<div title="CrazyConnections" modifier="Peter Hübel" created="201201180143" modified="201403160411" changecount="31">
<pre>//This might be a list of ConceptualBlends //

!!TiddlyWiki and NetropyServer
Should it be WikiInBluePrint or BluePrintInWiki

!!NameSpaces and StringTables
Two instances having identical vocabulary do not need to transport the markup as text, but can only refer to an index into the collection of static strings.
These namespaces may be negotiated at times, and a new revision is propagated to the participants in the network.

String tables may be implemented with a {{{strxtrs::basic_stack&lt;char&gt;}}} with a set of algorithms.

Notable is:
* strlen(s) =&gt; stack[s.level]
* output must be performed &quot;upwards&quot; - which is not bad, I think.

Storage model: Each char is a step, a final NUL is stored as sentinel, and that nul contains the id of the string (simply an integer). Or the index of the NUL cell is simply the id.

Backwards processing can be done anytime by entering the table on index.

!!The Omnipresent &lt;netropy:copy/&gt; and TransferOfContext
{{{
&lt;netropy:call href=&quot;http://qstation132/configuration/&quot; method=&quot;PUT&quot;&gt;
&lt;/netropy:call&gt;
}}}

The [[&lt;netropy:copy/&gt;]] service has a special behavior when using AttributeSyntax, which is used for describing how a [[&lt;netropy:pattern/&gt;]] should be described.

- Sagt Euch dies was?
{{{
&lt;SetPoint_1&gt;%8.3f&lt;/SetPoint_1&gt;&lt;Trigger&gt;%8B&lt;/Trigger&gt;
}}}
//Hier bedeutet {{{%8B}}} das selbe wie ''~BitSet8''//

- Hat das etwa mehr Informationen als diese Kodierung?
{{{
&lt;Variable Name=&quot;SetPoint_1&quot; Type=&quot;Float&quot; Precision=&quot;3&quot;/&gt;
}}}

</pre>
</div>
<div title="DasKannEsDochNichtSein?" modifier="PeterHübel" created="201210142246" modified="201210160750" changecount="10">
<pre>!!XMLRCP (Q.station)
RPCMeas.GetVariables
!!!!Timing
Waiting: 21ms
Receiving: 11ms
!!!!Request
{{{
POST / HTTP/1.1
Host: 192.168.5.61:1200
Connection: keep-alive
Content-Length: 331
Cache-Control: no-cache
Origin: http://192.168.5.61
Pragma: no-cache
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_6_8) AppleWebKit/537.4 (KHTML, like Gecko) Chrome/22.0.1229.94 Safari/537.4
Content-type: text/xml
Accept: text/xml
Referer: http://192.168.5.61/local/jsxmlrcp/debugger.html
Accept-Encoding: gzip,deflate,sdch
Accept-Language: en-US,en;q=0.8
Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.3

&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;methodCall&gt;
&lt;methodName&gt;RPCMeas.GetVariables&lt;/methodName&gt;
&lt;params&gt;&lt;param&gt;
&lt;value&gt;&lt;struct&gt;
&lt;member&gt;&lt;name&gt;MethodID&lt;/name&gt;
&lt;value&gt;&lt;string&gt;RPCMeas::GetVariables&lt;/string&gt;&lt;/value&gt;
&lt;/member&gt;
&lt;member&gt;&lt;name&gt;VariableIndex&lt;/name&gt;
&lt;value&gt;&lt;int&gt;-1&lt;/int&gt;&lt;/value&gt;
&lt;/member&gt;
&lt;/struct&gt;&lt;/value&gt;
&lt;/param&gt;
&lt;/params&gt;
&lt;/methodCall&gt;
}}}
!!!!Response
{{{
HTTP/1.1 200 OK
Server: GINSXMLRPC++ 1.0
Access-Control-Allow-Origin: *
Content-Type: text/xml
Content-length: 9753

&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;
&lt;methodResponse&gt;
  &lt;params&gt;
    &lt;param&gt;
      &lt;value&gt;
        &lt;struct&gt;
          &lt;member&gt;
            &lt;name&gt;MethodID&lt;/name&gt;
            &lt;value&gt;RPCMeas::GetVariables&lt;/value&gt;
          &lt;/member&gt;
          &lt;member&gt;
            &lt;name&gt;VariableList&lt;/name&gt;
            &lt;value&gt;
              &lt;array&gt;
                &lt;data&gt;
                  &lt;value&gt;
                    &lt;struct&gt;
                      &lt;member&gt;
                        &lt;name&gt;AccessIndex&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;0&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;DataRate&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;0&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;DataType&lt;/name&gt;
                        &lt;value&gt;USINT64&lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;DataTypeCode&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;12&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;Format&lt;/name&gt;
                        &lt;value&gt;&lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;InputByteOffset&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;0&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;InputIndex&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;0&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;IsInput&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;1&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;IsOutput&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;0&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;Name&lt;/name&gt;
                        &lt;value&gt;Timestamp&lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;OutputByteOffset&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;-1&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;OutputIndex&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;-1&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;RangeMax&lt;/name&gt;
                        &lt;value&gt;
                          &lt;double&gt;0&lt;/double&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;RangeMin&lt;/name&gt;
                        &lt;value&gt;
                          &lt;double&gt;0&lt;/double&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;Unit&lt;/name&gt;
                        &lt;value&gt;&lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;VariableType&lt;/name&gt;
                        &lt;value&gt;ARI&lt;/value&gt;
                      &lt;/member&gt;
                    &lt;/struct&gt;
                  &lt;/value&gt;
                  &lt;value&gt;
                    &lt;struct&gt;
                      &lt;member&gt;
                        &lt;name&gt;AccessIndex&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;0&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;DataRate&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;0&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;DataType&lt;/name&gt;
                        &lt;value&gt;FLOAT&lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;DataTypeCode&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;14&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;Format&lt;/name&gt;
                        &lt;value&gt;&lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;InputByteOffset&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;8&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;InputIndex&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;1&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;IsInput&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;1&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;IsOutput&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;0&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;Name&lt;/name&gt;
                        &lt;value&gt;Variable 1_1&lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;OutputByteOffset&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;-1&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;OutputIndex&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;-1&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;RangeMax&lt;/name&gt;
                        &lt;value&gt;
                          &lt;double&gt;5&lt;/double&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;RangeMin&lt;/name&gt;
                        &lt;value&gt;
                          &lt;double&gt;-5&lt;/double&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;Unit&lt;/name&gt;
                        &lt;value&gt;mV/V&lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;VariableType&lt;/name&gt;
                        &lt;value&gt;AIN&lt;/value&gt;
                      &lt;/member&gt;
                    &lt;/struct&gt;
                  &lt;/value&gt;
                  &lt;value&gt;
                    &lt;struct&gt;
                      &lt;member&gt;
                        &lt;name&gt;AccessIndex&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;0&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;DataRate&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;0&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;DataType&lt;/name&gt;
                        &lt;value&gt;FLOAT&lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;DataTypeCode&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;14&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;Format&lt;/name&gt;
                        &lt;value&gt;&lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;InputByteOffset&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;12&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;InputIndex&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;2&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;IsInput&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;1&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;IsOutput&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;0&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;Name&lt;/name&gt;
                        &lt;value&gt;Variable 2_1&lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;OutputByteOffset&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;-1&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;OutputIndex&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;-1&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;RangeMax&lt;/name&gt;
                        &lt;value&gt;
                          &lt;double&gt;2.5&lt;/double&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;RangeMin&lt;/name&gt;
                        &lt;value&gt;
                          &lt;double&gt;-2.5&lt;/double&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;Unit&lt;/name&gt;
                        &lt;value&gt;mV/V&lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;VariableType&lt;/name&gt;
                        &lt;value&gt;AIN&lt;/value&gt;
                      &lt;/member&gt;
                    &lt;/struct&gt;
                  &lt;/value&gt;
                  &lt;value&gt;
                    &lt;struct&gt;
                      &lt;member&gt;
                        &lt;name&gt;AccessIndex&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;0&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;DataRate&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;0&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;DataType&lt;/name&gt;
                        &lt;value&gt;FLOAT&lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;DataTypeCode&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;14&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;Format&lt;/name&gt;
                        &lt;value&gt;&lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;InputByteOffset&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;16&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;InputIndex&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;3&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;IsInput&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;1&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;IsOutput&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;1&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;Name&lt;/name&gt;
                        &lt;value&gt;Variable 3_1&lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;OutputByteOffset&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;0&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;OutputIndex&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;0&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;RangeMax&lt;/name&gt;
                        &lt;value&gt;
                          &lt;double&gt;0&lt;/double&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;RangeMin&lt;/name&gt;
                        &lt;value&gt;
                          &lt;double&gt;0&lt;/double&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;Unit&lt;/name&gt;
                        &lt;value&gt;&lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;VariableType&lt;/name&gt;
                        &lt;value&gt;SPT&lt;/value&gt;
                      &lt;/member&gt;
                    &lt;/struct&gt;
                  &lt;/value&gt;
                  &lt;value&gt;
                    &lt;struct&gt;
                      &lt;member&gt;
                        &lt;name&gt;AccessIndex&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;0&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;DataRate&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;0&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;DataType&lt;/name&gt;
                        &lt;value&gt;FLOAT&lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;DataTypeCode&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;14&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;Format&lt;/name&gt;
                        &lt;value&gt;&lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;InputByteOffset&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;20&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;InputIndex&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;4&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;IsInput&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;1&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;IsOutput&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;1&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;Name&lt;/name&gt;
                        &lt;value&gt;Variable 4_1&lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;OutputByteOffset&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;4&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;OutputIndex&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;1&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;RangeMax&lt;/name&gt;
                        &lt;value&gt;
                          &lt;double&gt;0&lt;/double&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;RangeMin&lt;/name&gt;
                        &lt;value&gt;
                          &lt;double&gt;0&lt;/double&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;Unit&lt;/name&gt;
                        &lt;value&gt;&lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;VariableType&lt;/name&gt;
                        &lt;value&gt;SPT&lt;/value&gt;
                      &lt;/member&gt;
                    &lt;/struct&gt;
                  &lt;/value&gt;
                  &lt;value&gt;
                    &lt;struct&gt;
                      &lt;member&gt;
                        &lt;name&gt;AccessIndex&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;0&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;DataRate&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;0&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;DataType&lt;/name&gt;
                        &lt;value&gt;FLOAT&lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;DataTypeCode&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;14&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;Format&lt;/name&gt;
                        &lt;value&gt;&lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;InputByteOffset&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;24&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;InputIndex&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;5&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;IsInput&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;1&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;IsOutput&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;0&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;Name&lt;/name&gt;
                        &lt;value&gt;Potiz&lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;OutputByteOffset&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;-1&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;OutputIndex&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;-1&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;RangeMax&lt;/name&gt;
                        &lt;value&gt;
                          &lt;double&gt;100&lt;/double&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;RangeMin&lt;/name&gt;
                        &lt;value&gt;
                          &lt;double&gt;0&lt;/double&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;Unit&lt;/name&gt;
                        &lt;value&gt;%&lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;VariableType&lt;/name&gt;
                        &lt;value&gt;AIN&lt;/value&gt;
                      &lt;/member&gt;
                    &lt;/struct&gt;
                  &lt;/value&gt;
                  &lt;value&gt;
                    &lt;struct&gt;
                      &lt;member&gt;
                        &lt;name&gt;AccessIndex&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;0&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;DataRate&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;0&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;DataType&lt;/name&gt;
                        &lt;value&gt;FLOAT&lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;DataTypeCode&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;14&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;Format&lt;/name&gt;
                        &lt;value&gt;&lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;InputByteOffset&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;28&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;InputIndex&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;6&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;IsInput&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;1&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;IsOutput&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;0&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;Name&lt;/name&gt;
                        &lt;value&gt;I 1&lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;OutputByteOffset&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;-1&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;OutputIndex&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;-1&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;RangeMax&lt;/name&gt;
                        &lt;value&gt;
                          &lt;double&gt;20&lt;/double&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;RangeMin&lt;/name&gt;
                        &lt;value&gt;
                          &lt;double&gt;4&lt;/double&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;Unit&lt;/name&gt;
                        &lt;value&gt; mA&lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;VariableType&lt;/name&gt;
                        &lt;value&gt;AIN&lt;/value&gt;
                      &lt;/member&gt;
                    &lt;/struct&gt;
                  &lt;/value&gt;
                  &lt;value&gt;
                    &lt;struct&gt;
                      &lt;member&gt;
                        &lt;name&gt;AccessIndex&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;0&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;DataRate&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;0&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;DataType&lt;/name&gt;
                        &lt;value&gt;FLOAT&lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;DataTypeCode&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;14&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;Format&lt;/name&gt;
                        &lt;value&gt;&lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;InputByteOffset&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;32&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;InputIndex&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;7&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;IsInput&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;1&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;IsOutput&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;0&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;Name&lt;/name&gt;
                        &lt;value&gt;I 2&lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;OutputByteOffset&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;-1&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;OutputIndex&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;-1&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;RangeMax&lt;/name&gt;
                        &lt;value&gt;
                          &lt;double&gt;20&lt;/double&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;RangeMin&lt;/name&gt;
                        &lt;value&gt;
                          &lt;double&gt;4&lt;/double&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;Unit&lt;/name&gt;
                        &lt;value&gt; mA&lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;VariableType&lt;/name&gt;
                        &lt;value&gt;AIN&lt;/value&gt;
                      &lt;/member&gt;
                    &lt;/struct&gt;
                  &lt;/value&gt;
                  &lt;value&gt;
                    &lt;struct&gt;
                      &lt;member&gt;
                        &lt;name&gt;AccessIndex&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;0&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;DataRate&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;0&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;DataType&lt;/name&gt;
                        &lt;value&gt;FLOAT&lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;DataTypeCode&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;14&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;Format&lt;/name&gt;
                        &lt;value&gt;&lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;InputByteOffset&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;36&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;InputIndex&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;8&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;IsInput&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;1&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;IsOutput&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;0&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;Name&lt;/name&gt;
                        &lt;value&gt;Temp 1&lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;OutputByteOffset&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;-1&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;OutputIndex&lt;/name&gt;
                        &lt;value&gt;
                          &lt;i4&gt;-1&lt;/i4&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;RangeMax&lt;/name&gt;
                        &lt;value&gt;
                          &lt;double&gt;850&lt;/double&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;RangeMin&lt;/name&gt;
                        &lt;value&gt;
                          &lt;double&gt;-200&lt;/double&gt;
                        &lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;Unit&lt;/name&gt;
                        &lt;value&gt; °C&lt;/value&gt;
                      &lt;/member&gt;
                      &lt;member&gt;
                        &lt;name&gt;VariableType&lt;/name&gt;
                        &lt;value&gt;AIN&lt;/value&gt;
                      &lt;/member&gt;
                    &lt;/struct&gt;
                  &lt;/value&gt;
                &lt;/data&gt;
              &lt;/array&gt;
            &lt;/value&gt;
          &lt;/member&gt;
        &lt;/struct&gt;
      &lt;/value&gt;
    &lt;/param&gt;
  &lt;/params&gt;
&lt;/methodResponse&gt;
}}}</pre>
</div>
<div title="DashHashSlash" modifier="Peter Hübel" created="201402171250" modified="201402220029" changecount="2">
<pre>Noticable, the punctuation marks used in computing often have received short names. Instead of minus, you call it ''dash'' - because it was also used in the days of (tele-)typewriters. 
Equally, the ''#'' is a ''hash'', and ''/'' is dubbed ''slash''.</pre>
</div>
<div title="Data" modifier="YourName" created="201402020210" modified="201402020226" changecount="19">
<pre>TODO:
make the styling stick to the data
&lt;html&gt;
&lt;style type=&quot;text/css&quot;&gt;
@import &quot;http://raspberrypi:8901/style/online-xml.css&quot;;
&lt;/style&gt;
&lt;iframe src=&quot;http://raspberrypi:8901/leutert/pdm/channels/1&quot;&gt;&lt;/iframe&gt;
&lt;/div&gt;
&lt;/html&gt;</pre>
</div>
<div title="DefaultTiddlers" modifier="Peter Hübel" created="200903160940" modified="201404061033" changecount="10">
<pre>[[Welcome]]
</pre>
</div>
<div title="Definitions" modifier="Peter Hübel" created="201403210413" modified="201403210415" changecount="3">
<pre>* The ''origin'' (or ''root'') of a //xeno::context// is the enclosing [[&lt;xeno:space/&gt;]].</pre>
</div>
<div title="DeveloperRoadmap" modifier="Peter Hübel" created="201201200159" modified="201402192239" changecount="45">
<pre>!!!Up Next
# [[&lt;xeno:fbdev/&gt;]]
# [[&lt;xeno:disk/&gt;]] has a problem with methods ''stream'' and ''send''...
# Use xeno as a client as well. E.g. {{{ xeno 8901 PUT /some/stash?disposition=download c:\My Documents\file.xml }}}, i.e. a CommandLineSyntax - simple implement it as a grammar with a special actionpack.
# [[&lt;xeno:system/&gt;]] look into registry, metadata, statistics, etc.
# [[&lt;xeno:display/&gt;]] using webkit as a space. One might even use some kind of attribution on the content, like {{{}}}
# [[&lt;xeno:blueprint/&gt;]] to render &quot;text/javascript&quot; as well as providing CSS styling to the XML.
# HTTP parser.
# Combine async request with parser (UserState might be a stackless coroutine-object implementing the handler)...
# Given server runs as a daemon, it could be bootstrapped directly from the serial port
# Let the server re-source the blueprint.xml when it is changed by an editor. Not a good idea, first investigate how {{{asio_dir_monitor}}} could me reimplemented to fit.

!!!Crazy
Implement a ''netropyfs''. Each directory has a virtual file ''.blueprint''

!!!Done - might improve
# [[&lt;netropy:duct_tape/&gt;]] just for {{{ doctype=&quot;html&quot;}}}. CHECK!
# Pull through the ''http:'' namespace for the lower layer stack: replace {{{HTTPRequest}}} with {{{http:Request xmlns:http=&quot;http://www.strxtrs.net/netropy/http/1.0&quot;}}}
# &lt;empty&gt;&lt;/empty&gt; tags should preserve the separation.
# {{{Content-Length}}} ''must'' be right for Google Chrome.
# Server now runs as a daemon.</pre>
</div>
<div title="DevelopingStepByStep" modifier="PeterHübel" created="201205240010" modified="201205240138" tags="steps" changecount="18">
<pre>!![[WeNeedYourHelp]]
&gt;Remember: You is the old plural. U iz the new [[singular|Singularity]]. Thou ere ye olde plurale.

Please translate this to your native language, by opening a &lt;&lt;new&gt;&gt; tiddler and give it a name like the name of this tiddler your language is written in your language, like [[EntwickelnSchrittFürSchritt]] or [[UdviklingSkridtForSkridt]].

That is, please make a new tiddler which is a translation of title, the content of the title. Mind the syntax!

Now [[this]] was the first step, or what? If you came from the OtherPlace.

!!FirstStep
&lt;&lt;tiddler FirstStep&gt;&gt;
Or should I write it here?</pre>
</div>
<div title="ECMAscript" modifier="Peter Hübel" created="201403132125" changecount="1">
<pre>Mostly named Javascript, but actually a w3c standard:</pre>
</div>
<div title="Efficient resource management" modifier="Peter Hübel" created="200905191452" modified="201404061246" changecount="31">
<pre>Ultimately all information systems must run on hardware, and &lt;&lt;tiddler xeno&gt;&gt; is designed from the bottom up for efficient resource utilisation.
!!!!!Space
We have gone to extreme lengths to avoid caching of data where the operating system readily does this (like serving content from a file system). This leads to a measurable much more efficient management of resources.
!!!!!Time
Apart from being an engine with an extremely small memory footprint, the &lt;&lt;tiddler xeno&gt;&gt; ''VM'' also uses a minimal amount of synchronisation, as the necessary concurrency control already is in place in most hosting operating systems. This results in response times far below those of traditional application servers.</pre>
</div>
<div title="EineKürzereVersion" modifier="PeterHübel" created="201210150642" modified="201210151321" changecount="7">
<pre>!!ReST (Q.reader)
http://192.168.5.41:8901/qreader/measured/
!!!!Timing
Waiting: 40ms
Receiving: 1ms
!!!!Request
{{{
GET /qreader/measured/ HTTP/1.1
Host: 192.168.5.41:8901
Connection: keep-alive
Cache-Control: no-cache
Pragma: no-cache
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_6_8) AppleWebKit/537.4 (KHTML, like Gecko) Chrome/22.0.1229.94 Safari/537.4
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Encoding: gzip,deflate,sdch
Accept-Language: en-US,en;q=0.8
Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.3
}}}
!!!!Response
{{{
HTTP/1.0 200 OK
Server: netropy/1.6.5 (Linux)
Content-Length: 673
Content-Type: application/xml

&lt;channels&gt;
&lt;channel name=&quot;AIN1&quot; color=&quot;red&quot; display=&quot;&quot; unit=&quot;V&quot;&gt;11.67&lt;/channel&gt;
&lt;channel name=&quot;AIN2&quot; color=&quot;red&quot; display=&quot;&quot; unit=&quot;Ω&quot;&gt;3187.89&lt;/channel&gt;
&lt;channel name=&quot;DIN1&quot; color=&quot;red&quot; display=&quot;&quot; unit=&quot;&quot;&gt;OFF&lt;/channel&gt;
&lt;channel name=&quot;AIN3&quot; color=&quot;red&quot; display=&quot;&quot; unit=&quot;V&quot;&gt;6.51&lt;/channel&gt;
&lt;channel name=&quot;AIN4&quot; color=&quot;red&quot; display=&quot;&quot; unit=&quot;V&quot;&gt;9.37&lt;/channel&gt;
&lt;channel name=&quot;DIN2&quot; color=&quot;red&quot; display=&quot;&quot; unit=&quot;&quot;&gt;0&lt;/channel&gt;
&lt;channel name=&quot;DIN3&quot; color=&quot;red&quot; display=&quot;&quot; unit=&quot;&quot;&gt;0&lt;/channel&gt;
&lt;channel name=&quot;DIN4&quot; color=&quot;red&quot; display=&quot;&quot; unit=&quot;&quot;&gt;0&lt;/channel&gt;
&lt;channel name=&quot;LUA1&quot; color=&quot;red&quot; display=&quot;&quot; unit=&quot;&quot;&gt;11.6686&lt;/channel&gt;
&lt;/channels&gt;
}}}</pre>
</div>
<div title="ErrorCodes" modifier="PeterHübel" created="201206012213" modified="201206012220" changecount="2">
<pre>The &quot;return value&quot; may be an error code. Or should we say problem kode?
In normal cases, 
{{{
problem = false;
assert(problem == 0);
assert(!problem); /* or NOT PROBLEM in Pascal or Ada */
}}}

{{{
#define NO_PROBLEMS = 0;
#define problems(context) { }
}}}</pre>
</div>
<div title="ExternalTiddler" modifier="Peter Hübel" created="201201192026" modified="201201291051" changecount="3">
<pre>A tiddler which is actually located at a different node, and will be referenced on demand. It might be cached (or merged into the current TiddlyWiki).</pre>
</div>
<div title="FirstStep" modifier="PeterHübel" created="201205240012" modified="201205240105" tags="steps" changecount="5">
<pre>&gt;Well, I followed the instruction, but now I don't know...
Should I write it here? Or in the OtherPlace?</pre>
</div>
<div title="FragenAnDieKollegen" modifier="PeterHübel" created="201209291408" modified="201210151310" changecount="8">
<pre>!Middleware
Können wir das ganze EEPROM in einem Zug lesen und schreiben?
Die Logik zur Verarbeitung der Parameter könnte dann beliebig auch woanders sein?
Vielleicht könnte man es dann mit dem [[Woetzel]] lösen?

!!
Hast Du bedacht, das Du eine besondere variable definieren könntest... nennen wir sie erstmals {{{ all }}}</pre>
</div>
<div title="Glück" modifier="PeterHübel" created="201211232043" changecount="1">
<pre>Glück, luck, lykke, whatever you will call it in your tounge...</pre>
</div>
<div title="GregoryBateson" modifier="Peter Hübel" created="200910070012" modified="201204131131" changecount="3">
<pre>Gregory Bateson was a British anthropologist, cyberneticist, psychologist, and philosopher.
&lt;&lt;tiddler Bateson&gt;&gt;</pre>
</div>
<div title="HTTPErrors" modifier="Peter Hübel" created="201205232035" modified="201205232135" changecount="38">
<pre>!Why and when you should use which codes

!!!204 No Content
Saves you from sending or parsing any headers, when there explicitly is no content.

!!!404 Not Found
When part of the URL denotes a nonexisting item.

E.g., this code will be returned when there is no display &quot;15&quot; configured in the ''measured'' service, and you request the URL
{{{
/measured/display/15
}}}
Assuming no display &quot;15&quot; is configured on this device, you can try clicking &lt;html&gt;&lt;a href=&quot;/measured/display/15&quot; class=&quot;externalLink&quot; target=&quot;_blank&quot;&gt;/measured/display/15&lt;/a&gt;&lt;/html&gt;.

or when the value named &quot;SB01.Temperature&quot; does not exist
{{{
/measured/values/SB01.Temperature
}}}

{{{
}}}
{{{
}}}
{{{
}}}
{{{
}}}

&lt;code&gt;hello&lt;/code&gt;


!!!503 Service Unavailable
A service may depend on hardware being initialized. From the time when the service starts until it is ready, the service should return this code. Generally, this is a temporary state.

!!!504 Gateway Timeout
A service may be forwarding requests to some device. When the service does not receive a timely response from the upstream server, this code is appropriate.
</pre>
</div>
<div title="Information Hub" modifier="PeterHübel" created="200905190809" modified="200905191413" changecount="7">
<pre>Since you have full control over the information architecture in a Netropy Server, you may collect information from all kinds of sources and structure it to your needs.

Having full control over the data flow in your information network, enables you to address scalability issues very easy.</pre>
</div>
<div title="InformationSpaces" modifier="Peter Hübel" created="200905190826" modified="201201200216" changecount="20">
<pre>!!The Geographical Metaphor
Thinking of information &quot;residing&quot; at some geographical location is not uncommon. Cognitive research has also shown that geography has strong influence on the ability to recall memories. Most people have experienced memories suddenly coming back when revisiting a place.

It seems to have been an evolutionary advantage for our species that the human brain organizes information such that our learned knowledge is accessible in a context dependent manner. It keeps our thoughts from getting in a muddle. E.g. when we stand at the banks of a river, our knowledge about fishing will be easy to recall, whereas our knowledge about programming languages hardly is relevant in that context. And vice versa when we're in the office.

The space metaphor also makes use of &quot;maps&quot; which may enable the user to get an overview over otherwise immensurable amounts of information.

If we imagine all of our information located in some form of &quot;space&quot;, we need additional information to aid us in navigating around. Think of signs placed in a landscape. The same information we the can use for making a map of that space, so we can navigate it efficiently.
!!Using Markup to Structure Space
&lt;&lt;tiddler UsingNameSpaces&gt;&gt;
</pre>
</div>
<div title="Inherent problems with OOP" modifier="YourName" created="201205291434" modified="201402040406" changecount="2">
<pre>Most interfaces to the hardware are implemented in C, and provide therefore an API in that same language. Worshipers of (as well as devotees to) ObjectOrientedProgramming are not happy with the abstract notion of a, e.g. [[file descriptor|FileDescriptor]], and hence encapsulate that with another abstraction of, e.g. a derivative of {{{std::istream}}}, {{{java.io.AbstractStream}}} for the WitnessesOfJava, or the class {{{System.IO.Stream}}} found in .NET runtime. 
Ideally the abstractions written in C++ would disappear at runtime because a modern compiler can inline code and optimize the added level of abstraction away. This leaves the generated code with only the necessary functionality to accomplish the task, given the API to the hardware. On the other hand, given Linux or any modern OS for that matter, there //is already a whole lot of abstraction made// in the system API, and most attempts to implement services start for an ObjectIDiot with &quot;defining a framework&quot;.</pre>
</div>
<div title="Internet of Things" modifier="Peter Hübel" created="201404030059" modified="201404030100" changecount="2">
<pre>ConnectAbility - the ability to connect.</pre>
</div>
<div title="MainMenu" modifier="Peter Hübel" created="200903160942" modified="201604172241" changecount="63">
<pre>[[Welcome]] [[Built In Services]] &lt;html&gt;&lt;a href='/' class='tiddlyLink tiddlyLinkExisting' title='Back to the server main page'&gt;Server Main&lt;/a&gt;&lt;/html&gt;</pre>
</div>
<div title="MarkupPreHead" modifier="PeterHübel" created="201203221051" modified="201205240130" tags="notable" changecount="3">
<pre>&lt;!--{{{--&gt;
&lt;link rel='alternate' type='application/rss+xml' title='RSS' href='index.xml' /&gt;
&lt;link rel='shortcut icon' href='data:image/x-icon;base64,AAABAAEAEBAQAAAAAAAoAQAAFgAAACgAAAAQAAAAIAAAAAEABAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAA0c7LAICAgAD%2F%2F%2F8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAzMwAzMwAAADEjADEjAAAAMhMAMhMAAAAzMwAzMwAAADIjADIjAAAAMiMAMiMAAAAyIwAyIwAAADIjADIjAAAAMiMAMiMgAAAyIwAyIwAAADIhMxIjAAAAMiIiIhMAAAAyIyIhMAAAADMzMzMAAAAAAAAAAAAAD%2F%2FwAA4YcAAOGHAADhhwAA4YcAAOGHAADhhwAA4YcAAOGHAADhhwAA4YcAAOAHAADgBwAA4A8AAOAfAAD%2F%2FwAA' type='image/x-icon' /&gt;
&lt;!--}}}--&gt;
</pre>
</div>
<div title="NerdRemarkOfTheDay" modifier="PeterHübel" created="201211232021" modified="201211232022" changecount="3">
<pre>Java is a {{{False}}} God.

Its (es) all about a StructuredAccess to information, to language. This way we can communicate more efficiently.</pre>
</div>
<div title="NetropyServer" modifier="YourName" created="200905101617" modified="201210042211" changecount="15">
<pre>From a technical point, as a piece of software, there are several views on it:
*netropy is an XMLCompiler
*netropy is a WebServer
*netropy is an [[InformationSpace|Structuring Information]]
</pre>
</div>
<div title="NoProblems" modifier="PeterHübel" created="201206012211" modified="201206220158" changecount="5">
<pre>!!ErrorCodes
&lt;&lt;tiddler ErrorCodes&gt;&gt;
!!ToDo
&lt;&lt;tiddler ToDo&gt;&gt;</pre>
</div>
<div title="On the verbosity of XML" modifier="Peter Hübel" created="201606032224" modified="201606040157" changecount="30">
<pre>Lets look at a HAR log from Chrome. JSON, as you can see. These are the data used for displaying the Network info in Developer Tools:
&lt;html&gt;&lt;div style=&quot;height: 50vh; overflow: scroll;&quot;&gt;
&lt;img src=&quot;images/fast.png&quot; width=&quot;99%&quot; style=&quot;border: 1px solid #ABC;&quot;/&gt;
Given only a few resources, there is quite a lot of data:
&lt;pre&gt;
{
  &quot;log&quot;: {
    &quot;version&quot;: &quot;1.2&quot;,
    &quot;creator&quot;: {
      &quot;name&quot;: &quot;WebInspector&quot;,
      &quot;version&quot;: &quot;537.36&quot;
    },
    &quot;pages&quot;: [
      {
        &quot;startedDateTime&quot;: &quot;2016-06-03T22:13:57.609Z&quot;,
        &quot;id&quot;: &quot;page_1&quot;,
        &quot;title&quot;: &quot;http://netropy.huebel.freeshells.org:8901/&quot;,
        &quot;pageTimings&quot;: {
          &quot;onContentLoad&quot;: 15458.580000035,
          &quot;onLoad&quot;: 15458.465000032447
        }
      }
    ],
    &quot;entries&quot;: [
      {
        &quot;startedDateTime&quot;: &quot;2016-06-03T22:13:57.609Z&quot;,
        &quot;time&quot;: 7579.862000013236,
        &quot;request&quot;: {
          &quot;method&quot;: &quot;GET&quot;,
          &quot;url&quot;: &quot;http://netropy.huebel.freeshells.org:8901/&quot;,
          &quot;httpVersion&quot;: &quot;HTTP/1.1&quot;,
          &quot;headers&quot;: [
            {
              &quot;name&quot;: &quot;Accept-Encoding&quot;,
              &quot;value&quot;: &quot;gzip, deflate, sdch&quot;
            },
            {
              &quot;name&quot;: &quot;Host&quot;,
              &quot;value&quot;: &quot;netropy.huebel.freeshells.org:8901&quot;
            },
            {
              &quot;name&quot;: &quot;Accept-Language&quot;,
              &quot;value&quot;: &quot;en-US,en;q=0.8,de;q=0.6,da;q=0.4&quot;
            },
            {
              &quot;name&quot;: &quot;Upgrade-Insecure-Requests&quot;,
              &quot;value&quot;: &quot;1&quot;
            },
            {
              &quot;name&quot;: &quot;User-Agent&quot;,
              &quot;value&quot;: &quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/50.0.2661.102 Safari/537.36&quot;
            },
            {
              &quot;name&quot;: &quot;Accept&quot;,
              &quot;value&quot;: &quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8&quot;
            },
            {
              &quot;name&quot;: &quot;Cache-Control&quot;,
              &quot;value&quot;: &quot;max-age=0&quot;
            },
            {
              &quot;name&quot;: &quot;Cookie&quot;,
              &quot;value&quot;: &quot;txtMainTab=More; txtMoreTab=Orphans&quot;
            },
            {
              &quot;name&quot;: &quot;Connection&quot;,
              &quot;value&quot;: &quot;keep-alive&quot;
            }
          ],
          &quot;queryString&quot;: [],
          &quot;cookies&quot;: [
            {
              &quot;name&quot;: &quot;txtMainTab&quot;,
              &quot;value&quot;: &quot;More&quot;,
              &quot;expires&quot;: null,
              &quot;httpOnly&quot;: false,
              &quot;secure&quot;: false
            },
            {
              &quot;name&quot;: &quot;txtMoreTab&quot;,
              &quot;value&quot;: &quot;Orphans&quot;,
              &quot;expires&quot;: null,
              &quot;httpOnly&quot;: false,
              &quot;secure&quot;: false
            }
          ],
          &quot;headersSize&quot;: 493,
          &quot;bodySize&quot;: 0
        },
        &quot;response&quot;: {
          &quot;status&quot;: 200,
          &quot;statusText&quot;: &quot;OK&quot;,
          &quot;httpVersion&quot;: &quot;HTTP/1.1&quot;,
          &quot;headers&quot;: [
            {
              &quot;name&quot;: &quot;Access-Control-Allow-Origin&quot;,
              &quot;value&quot;: &quot;*&quot;
            },
            {
              &quot;name&quot;: &quot;Server&quot;,
              &quot;value&quot;: &quot;XENOmat/2.4.8 (Linux)&quot;
            },
            {
              &quot;name&quot;: &quot;Connection&quot;,
              &quot;value&quot;: &quot;Keep-Alive&quot;
            },
            {
              &quot;name&quot;: &quot;Keep-Alive&quot;,
              &quot;value&quot;: &quot;timeout=10&quot;
            },
            {
              &quot;name&quot;: &quot;Content-Length&quot;,
              &quot;value&quot;: &quot;15646&quot;
            },
            {
              &quot;name&quot;: &quot;Content-Type&quot;,
              &quot;value&quot;: &quot;text/html;charset=utf-8&quot;
            }
          ],
          &quot;cookies&quot;: [],
          &quot;content&quot;: {
            &quot;size&quot;: 15646,
            &quot;mimeType&quot;: &quot;text/html&quot;,
            &quot;compression&quot;: 0
          },
          &quot;redirectURL&quot;: &quot;&quot;,
          &quot;headersSize&quot;: 192,
          &quot;bodySize&quot;: 15646,
          &quot;_transferSize&quot;: 15838
        },
        &quot;cache&quot;: {},
        &quot;timings&quot;: {
          &quot;blocked&quot;: 0.479000038467348,
          &quot;dns&quot;: 1148.5279999906227,
          &quot;connect&quot;: 1831.75599999958,
          &quot;send&quot;: 0.05299999611997919,
          &quot;wait&quot;: 1714.43499997258,
          &quot;receive&quot;: 2884.611000015866,
          &quot;ssl&quot;: -1
        },
        &quot;connection&quot;: &quot;892766&quot;,
        &quot;pageref&quot;: &quot;page_1&quot;
      },
      {
        &quot;startedDateTime&quot;: &quot;2016-06-03T22:14:02.324Z&quot;,
        &quot;time&quot;: 2863.8439999776892,
        &quot;request&quot;: {
          &quot;method&quot;: &quot;GET&quot;,
          &quot;url&quot;: &quot;http://netropy.huebel.freeshells.org:8901/styles&quot;,
          &quot;httpVersion&quot;: &quot;HTTP/1.1&quot;,
          &quot;headers&quot;: [
            {
              &quot;name&quot;: &quot;Accept-Encoding&quot;,
              &quot;value&quot;: &quot;gzip, deflate, sdch&quot;
            },
            {
              &quot;name&quot;: &quot;Host&quot;,
              &quot;value&quot;: &quot;netropy.huebel.freeshells.org:8901&quot;
            },
            {
              &quot;name&quot;: &quot;Accept-Language&quot;,
              &quot;value&quot;: &quot;en-US,en;q=0.8,de;q=0.6,da;q=0.4&quot;
            },
            {
              &quot;name&quot;: &quot;User-Agent&quot;,
              &quot;value&quot;: &quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/50.0.2661.102 Safari/537.36&quot;
            },
            {
              &quot;name&quot;: &quot;Accept&quot;,
              &quot;value&quot;: &quot;text/css,*/*;q=0.1&quot;
            },
            {
              &quot;name&quot;: &quot;Referer&quot;,
              &quot;value&quot;: &quot;http://netropy.huebel.freeshells.org:8901/&quot;
            },
            {
              &quot;name&quot;: &quot;Cookie&quot;,
              &quot;value&quot;: &quot;txtMainTab=More; txtMoreTab=Orphans&quot;
            },
            {
              &quot;name&quot;: &quot;Connection&quot;,
              &quot;value&quot;: &quot;keep-alive&quot;
            },
            {
              &quot;name&quot;: &quot;Cache-Control&quot;,
              &quot;value&quot;: &quot;max-age=0&quot;
            }
          ],
          &quot;queryString&quot;: [],
          &quot;cookies&quot;: [
            {
              &quot;name&quot;: &quot;txtMainTab&quot;,
              &quot;value&quot;: &quot;More&quot;,
              &quot;expires&quot;: null,
              &quot;httpOnly&quot;: false,
              &quot;secure&quot;: false
            },
            {
              &quot;name&quot;: &quot;txtMoreTab&quot;,
              &quot;value&quot;: &quot;Orphans&quot;,
              &quot;expires&quot;: null,
              &quot;httpOnly&quot;: false,
              &quot;secure&quot;: false
            }
          ],
          &quot;headersSize&quot;: 466,
          &quot;bodySize&quot;: 0
        },
        &quot;response&quot;: {
          &quot;status&quot;: 200,
          &quot;statusText&quot;: &quot;OK&quot;,
          &quot;httpVersion&quot;: &quot;HTTP/1.1&quot;,
          &quot;headers&quot;: [
            {
              &quot;name&quot;: &quot;Access-Control-Allow-Origin&quot;,
              &quot;value&quot;: &quot;*&quot;
            },
            {
              &quot;name&quot;: &quot;Server&quot;,
              &quot;value&quot;: &quot;XENOmat/2.4.8 (Linux)&quot;
            },
            {
              &quot;name&quot;: &quot;Connection&quot;,
              &quot;value&quot;: &quot;Keep-Alive&quot;
            },
            {
              &quot;name&quot;: &quot;Keep-Alive&quot;,
              &quot;value&quot;: &quot;timeout=10&quot;
            },
            {
              &quot;name&quot;: &quot;Content-Length&quot;,
              &quot;value&quot;: &quot;1149&quot;
            },
            {
              &quot;name&quot;: &quot;Content-Type&quot;,
              &quot;value&quot;: &quot;text/css&quot;
            }
          ],
          &quot;cookies&quot;: [],
          &quot;content&quot;: {
            &quot;size&quot;: 1149,
            &quot;mimeType&quot;: &quot;text/css&quot;,
            &quot;compression&quot;: 0
          },
          &quot;redirectURL&quot;: &quot;&quot;,
          &quot;headersSize&quot;: 176,
          &quot;bodySize&quot;: 1149,
          &quot;_transferSize&quot;: 1325
        },
        &quot;cache&quot;: {},
        &quot;timings&quot;: {
          &quot;blocked&quot;: 0.743000011425465,
          &quot;dns&quot;: 0.591999967582525,
          &quot;connect&quot;: 1336.355999985242,
          &quot;send&quot;: 0.1139999949398316,
          &quot;wait&quot;: 322.4490000284302,
          &quot;receive&quot;: 1203.5899999900691,
          &quot;ssl&quot;: -1
        },
        &quot;connection&quot;: &quot;892780&quot;,
        &quot;pageref&quot;: &quot;page_1&quot;
      },
      {
        &quot;startedDateTime&quot;: &quot;2016-06-03T22:14:02.324Z&quot;,
        &quot;time&quot;: 10711.25899994513,
        &quot;request&quot;: {
          &quot;method&quot;: &quot;GET&quot;,
          &quot;url&quot;: &quot;http://netropy.huebel.freeshells.org:8901/jquery&quot;,
          &quot;httpVersion&quot;: &quot;HTTP/1.1&quot;,
          &quot;headers&quot;: [
            {
              &quot;name&quot;: &quot;Accept-Encoding&quot;,
              &quot;value&quot;: &quot;gzip, deflate, sdch&quot;
            },
            {
              &quot;name&quot;: &quot;Host&quot;,
              &quot;value&quot;: &quot;netropy.huebel.freeshells.org:8901&quot;
            },
            {
              &quot;name&quot;: &quot;Accept-Language&quot;,
              &quot;value&quot;: &quot;en-US,en;q=0.8,de;q=0.6,da;q=0.4&quot;
            },
            {
              &quot;name&quot;: &quot;User-Agent&quot;,
              &quot;value&quot;: &quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/50.0.2661.102 Safari/537.36&quot;
            },
            {
              &quot;name&quot;: &quot;Accept&quot;,
              &quot;value&quot;: &quot;*/*&quot;
            },
            {
              &quot;name&quot;: &quot;Referer&quot;,
              &quot;value&quot;: &quot;http://netropy.huebel.freeshells.org:8901/&quot;
            },
            {
              &quot;name&quot;: &quot;Cookie&quot;,
              &quot;value&quot;: &quot;txtMainTab=More; txtMoreTab=Orphans&quot;
            },
            {
              &quot;name&quot;: &quot;Connection&quot;,
              &quot;value&quot;: &quot;keep-alive&quot;
            },
            {
              &quot;name&quot;: &quot;Cache-Control&quot;,
              &quot;value&quot;: &quot;max-age=0&quot;
            }
          ],
          &quot;queryString&quot;: [],
          &quot;cookies&quot;: [
            {
              &quot;name&quot;: &quot;txtMainTab&quot;,
              &quot;value&quot;: &quot;More&quot;,
              &quot;expires&quot;: null,
              &quot;httpOnly&quot;: false,
              &quot;secure&quot;: false
            },
            {
              &quot;name&quot;: &quot;txtMoreTab&quot;,
              &quot;value&quot;: &quot;Orphans&quot;,
              &quot;expires&quot;: null,
              &quot;httpOnly&quot;: false,
              &quot;secure&quot;: false
            }
          ],
          &quot;headersSize&quot;: 451,
          &quot;bodySize&quot;: 0
        },
        &quot;response&quot;: {
          &quot;status&quot;: 200,
          &quot;statusText&quot;: &quot;OK&quot;,
          &quot;httpVersion&quot;: &quot;HTTP/1.1&quot;,
          &quot;headers&quot;: [
            {
              &quot;name&quot;: &quot;Access-Control-Allow-Origin&quot;,
              &quot;value&quot;: &quot;*&quot;
            },
            {
              &quot;name&quot;: &quot;Server&quot;,
              &quot;value&quot;: &quot;XENOmat/2.4.8 (Linux)&quot;
            },
            {
              &quot;name&quot;: &quot;Connection&quot;,
              &quot;value&quot;: &quot;Keep-Alive&quot;
            },
            {
              &quot;name&quot;: &quot;Keep-Alive&quot;,
              &quot;value&quot;: &quot;timeout=10&quot;
            },
            {
              &quot;name&quot;: &quot;Content-Length&quot;,
              &quot;value&quot;: &quot;92647&quot;
            },
            {
              &quot;name&quot;: &quot;Content-Type&quot;,
              &quot;value&quot;: &quot;application/javascript&quot;
            }
          ],
          &quot;cookies&quot;: [],
          &quot;content&quot;: {
            &quot;size&quot;: 92647,
            &quot;mimeType&quot;: &quot;application/javascript&quot;,
            &quot;compression&quot;: 0
          },
          &quot;redirectURL&quot;: &quot;&quot;,
          &quot;headersSize&quot;: 191,
          &quot;bodySize&quot;: 92647,
          &quot;_transferSize&quot;: 92838
        },
        &quot;cache&quot;: {},
        &quot;timings&quot;: {
          &quot;blocked&quot;: 0.666999956592917,
          &quot;dns&quot;: 0.48200000310316304,
          &quot;connect&quot;: 1336.4920000312839,
          &quot;send&quot;: 0.05299999611997919,
          &quot;wait&quot;: 339.26999999675013,
          &quot;receive&quot;: 9034.29499996128,
          &quot;ssl&quot;: -1
        },
        &quot;connection&quot;: &quot;892781&quot;,
        &quot;pageref&quot;: &quot;page_1&quot;
      },
      {
        &quot;startedDateTime&quot;: &quot;2016-06-03T22:14:02.468Z&quot;,
        &quot;time&quot;: 1353.2439999980852,
        &quot;request&quot;: {
          &quot;method&quot;: &quot;GET&quot;,
          &quot;url&quot;: &quot;http://www.leutert.com/media/oilgas/images/artificial-lift/pdm/fg-thumbs/pdm_display.jpg&quot;,
          &quot;httpVersion&quot;: &quot;HTTP/1.1&quot;,
          &quot;headers&quot;: [
            {
              &quot;name&quot;: &quot;Cookie&quot;,
              &quot;value&quot;: &quot;wb_9296_session_id=93a3ntqlphqhhveq2r7u9n1gt5&quot;
            },
            {
              &quot;name&quot;: &quot;Accept-Encoding&quot;,
              &quot;value&quot;: &quot;gzip, deflate, sdch&quot;
            },
            {
              &quot;name&quot;: &quot;Host&quot;,
              &quot;value&quot;: &quot;www.leutert.com&quot;
            },
            {
              &quot;name&quot;: &quot;Accept-Language&quot;,
              &quot;value&quot;: &quot;en-US,en;q=0.8,de;q=0.6,da;q=0.4&quot;
            },
            {
              &quot;name&quot;: &quot;User-Agent&quot;,
              &quot;value&quot;: &quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/50.0.2661.102 Safari/537.36&quot;
            },
            {
              &quot;name&quot;: &quot;Accept&quot;,
              &quot;value&quot;: &quot;image/webp,image/*,*/*;q=0.8&quot;
            },
            {
              &quot;name&quot;: &quot;Cache-Control&quot;,
              &quot;value&quot;: &quot;max-age=0&quot;
            },
            {
              &quot;name&quot;: &quot;If-None-Match&quot;,
              &quot;value&quot;: &quot;\&quot;e02b27cd-1049-4f712f41f3300\&quot;&quot;
            },
            {
              &quot;name&quot;: &quot;Connection&quot;,
              &quot;value&quot;: &quot;keep-alive&quot;
            },
            {
              &quot;name&quot;: &quot;If-Modified-Since&quot;,
              &quot;value&quot;: &quot;Tue, 15 Apr 2014 11:18:04 GMT&quot;
            },
            {
              &quot;name&quot;: &quot;Referer&quot;,
              &quot;value&quot;: &quot;http://netropy.huebel.freeshells.org:8901/&quot;
            }
          ],
          &quot;queryString&quot;: [],
          &quot;cookies&quot;: [
            {
              &quot;name&quot;: &quot;wb_9296_session_id&quot;,
              &quot;value&quot;: &quot;93a3ntqlphqhhveq2r7u9n1gt5&quot;,
              &quot;expires&quot;: null,
              &quot;httpOnly&quot;: false,
              &quot;secure&quot;: false
            }
          ],
          &quot;headersSize&quot;: 622,
          &quot;bodySize&quot;: 0
        },
        &quot;response&quot;: {
          &quot;status&quot;: 304,
          &quot;statusText&quot;: &quot;Not Modified&quot;,
          &quot;httpVersion&quot;: &quot;HTTP/1.1&quot;,
          &quot;headers&quot;: [
            {
              &quot;name&quot;: &quot;Date&quot;,
              &quot;value&quot;: &quot;Fri, 03 Jun 2016 22:14:03 GMT&quot;
            },
            {
              &quot;name&quot;: &quot;Server&quot;,
              &quot;value&quot;: &quot;nginx/1.8.1&quot;
            },
            {
              &quot;name&quot;: &quot;Connection&quot;,
              &quot;value&quot;: &quot;keep-alive&quot;
            },
            {
              &quot;name&quot;: &quot;ETag&quot;,
              &quot;value&quot;: &quot;\&quot;e02b27cd-1049-4f712f41f3300\&quot;&quot;
            }
          ],
          &quot;cookies&quot;: [],
          &quot;content&quot;: {
            &quot;size&quot;: 4169,
            &quot;mimeType&quot;: &quot;image/jpeg&quot;
          },
          &quot;redirectURL&quot;: &quot;&quot;,
          &quot;headersSize&quot;: 148,
          &quot;bodySize&quot;: 0,
          &quot;_transferSize&quot;: 148
        },
        &quot;cache&quot;: {},
        &quot;timings&quot;: {
          &quot;blocked&quot;: 0.888000009581447,
          &quot;dns&quot;: 1193.3369999751485,
          &quot;connect&quot;: 80.64300002297,
          &quot;send&quot;: 0.09799998952007627,
          &quot;wait&quot;: 69.5030000060799,
          &quot;receive&quot;: 8.774999994785276,
          &quot;ssl&quot;: -1
        },
        &quot;connection&quot;: &quot;892792&quot;,
        &quot;pageref&quot;: &quot;page_1&quot;
      },
      {
        &quot;startedDateTime&quot;: &quot;2016-06-03T22:14:03.821Z&quot;,
        &quot;time&quot;: 9137.228999985382,
        &quot;request&quot;: {
          &quot;method&quot;: &quot;GET&quot;,
          &quot;url&quot;: &quot;http://netropy.huebel.freeshells.org:8901/download/images/xenobot.png&quot;,
          &quot;httpVersion&quot;: &quot;HTTP/1.1&quot;,
          &quot;headers&quot;: [
            {
              &quot;name&quot;: &quot;Accept-Encoding&quot;,
              &quot;value&quot;: &quot;gzip, deflate, sdch&quot;
            },
            {
              &quot;name&quot;: &quot;Host&quot;,
              &quot;value&quot;: &quot;netropy.huebel.freeshells.org:8901&quot;
            },
            {
              &quot;name&quot;: &quot;Accept-Language&quot;,
              &quot;value&quot;: &quot;en-US,en;q=0.8,de;q=0.6,da;q=0.4&quot;
            },
            {
              &quot;name&quot;: &quot;User-Agent&quot;,
              &quot;value&quot;: &quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/50.0.2661.102 Safari/537.36&quot;
            },
            {
              &quot;name&quot;: &quot;Accept&quot;,
              &quot;value&quot;: &quot;image/webp,image/*,*/*;q=0.8&quot;
            },
            {
              &quot;name&quot;: &quot;Referer&quot;,
              &quot;value&quot;: &quot;http://netropy.huebel.freeshells.org:8901/&quot;
            },
            {
              &quot;name&quot;: &quot;Cookie&quot;,
              &quot;value&quot;: &quot;txtMainTab=More; txtMoreTab=Orphans&quot;
            },
            {
              &quot;name&quot;: &quot;Connection&quot;,
              &quot;value&quot;: &quot;keep-alive&quot;
            },
            {
              &quot;name&quot;: &quot;Cache-Control&quot;,
              &quot;value&quot;: &quot;max-age=0&quot;
            }
          ],
          &quot;queryString&quot;: [],
          &quot;cookies&quot;: [
            {
              &quot;name&quot;: &quot;txtMainTab&quot;,
              &quot;value&quot;: &quot;More&quot;,
              &quot;expires&quot;: null,
              &quot;httpOnly&quot;: false,
              &quot;secure&quot;: false
            },
            {
              &quot;name&quot;: &quot;txtMoreTab&quot;,
              &quot;value&quot;: &quot;Orphans&quot;,
              &quot;expires&quot;: null,
              &quot;httpOnly&quot;: false,
              &quot;secure&quot;: false
            }
          ],
          &quot;headersSize&quot;: 497,
          &quot;bodySize&quot;: 0
        },
        &quot;response&quot;: {
          &quot;status&quot;: 200,
          &quot;statusText&quot;: &quot;OK&quot;,
          &quot;httpVersion&quot;: &quot;HTTP/1.0&quot;,
          &quot;headers&quot;: [
            {
              &quot;name&quot;: &quot;Content-Length&quot;,
              &quot;value&quot;: &quot;50577&quot;
            },
            {
              &quot;name&quot;: &quot;Server&quot;,
              &quot;value&quot;: &quot;XENOmat/2.4.8 (Linux)&quot;
            },
            {
              &quot;name&quot;: &quot;Content-Type&quot;,
              &quot;value&quot;: &quot;image/png&quot;
            }
          ],
          &quot;cookies&quot;: [],
          &quot;content&quot;: {
            &quot;size&quot;: 50577,
            &quot;mimeType&quot;: &quot;image/png&quot;,
            &quot;compression&quot;: 0
          },
          &quot;redirectURL&quot;: &quot;&quot;,
          &quot;headersSize&quot;: 98,
          &quot;bodySize&quot;: 50577,
          &quot;_transferSize&quot;: 50675
        },
        &quot;cache&quot;: {},
        &quot;timings&quot;: {
          &quot;blocked&quot;: 0.484000018332154,
          &quot;dns&quot;: 0.43399998685345,
          &quot;connect&quot;: 1366.1790000041944,
          &quot;send&quot;: 0.1049999846100036,
          &quot;wait&quot;: 2036.9490000303,
          &quot;receive&quot;: 5733.077999961091,
          &quot;ssl&quot;: -1
        },
        &quot;connection&quot;: &quot;892801&quot;,
        &quot;pageref&quot;: &quot;page_1&quot;
      },
      {
        &quot;startedDateTime&quot;: &quot;2016-06-03T22:14:13.067Z&quot;,
        &quot;time&quot;: 175.4320000181906,
        &quot;request&quot;: {
          &quot;method&quot;: &quot;GET&quot;,
          &quot;url&quot;: &quot;http://netropy.huebel.freeshells.org:8901/escapa/highscore&quot;,
          &quot;httpVersion&quot;: &quot;HTTP/1.1&quot;,
          &quot;headers&quot;: [
            {
              &quot;name&quot;: &quot;Cookie&quot;,
              &quot;value&quot;: &quot;txtMainTab=More; txtMoreTab=Orphans&quot;
            },
            {
              &quot;name&quot;: &quot;Accept-Encoding&quot;,
              &quot;value&quot;: &quot;gzip, deflate, sdch&quot;
            },
            {
              &quot;name&quot;: &quot;Host&quot;,
              &quot;value&quot;: &quot;netropy.huebel.freeshells.org:8901&quot;
            },
            {
              &quot;name&quot;: &quot;Accept-Language&quot;,
              &quot;value&quot;: &quot;en-US,en;q=0.8,de;q=0.6,da;q=0.4&quot;
            },
            {
              &quot;name&quot;: &quot;User-Agent&quot;,
              &quot;value&quot;: &quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/50.0.2661.102 Safari/537.36&quot;
            },
            {
              &quot;name&quot;: &quot;Accept&quot;,
              &quot;value&quot;: &quot;*/*&quot;
            },
            {
              &quot;name&quot;: &quot;Referer&quot;,
              &quot;value&quot;: &quot;http://netropy.huebel.freeshells.org:8901/&quot;
            },
            {
              &quot;name&quot;: &quot;X-Requested-With&quot;,
              &quot;value&quot;: &quot;XMLHttpRequest&quot;
            },
            {
              &quot;name&quot;: &quot;Connection&quot;,
              &quot;value&quot;: &quot;keep-alive&quot;
            },
            {
              &quot;name&quot;: &quot;Cache-Control&quot;,
              &quot;value&quot;: &quot;max-age=0&quot;
            }
          ],
          &quot;queryString&quot;: [],
          &quot;cookies&quot;: [
            {
              &quot;name&quot;: &quot;txtMainTab&quot;,
              &quot;value&quot;: &quot;More&quot;,
              &quot;expires&quot;: null,
              &quot;httpOnly&quot;: false,
              &quot;secure&quot;: false
            },
            {
              &quot;name&quot;: &quot;txtMoreTab&quot;,
              &quot;value&quot;: &quot;Orphans&quot;,
              &quot;expires&quot;: null,
              &quot;httpOnly&quot;: false,
              &quot;secure&quot;: false
            }
          ],
          &quot;headersSize&quot;: 495,
          &quot;bodySize&quot;: 0
        },
        &quot;response&quot;: {
          &quot;status&quot;: 200,
          &quot;statusText&quot;: &quot;OK&quot;,
          &quot;httpVersion&quot;: &quot;HTTP/1.1&quot;,
          &quot;headers&quot;: [
            {
              &quot;name&quot;: &quot;Access-Control-Allow-Origin&quot;,
              &quot;value&quot;: &quot;*&quot;
            },
            {
              &quot;name&quot;: &quot;Server&quot;,
              &quot;value&quot;: &quot;XENOmat/2.4.8 (Linux)&quot;
            },
            {
              &quot;name&quot;: &quot;Connection&quot;,
              &quot;value&quot;: &quot;Keep-Alive&quot;
            },
            {
              &quot;name&quot;: &quot;Keep-Alive&quot;,
              &quot;value&quot;: &quot;timeout=10&quot;
            },
            {
              &quot;name&quot;: &quot;Content-Length&quot;,
              &quot;value&quot;: &quot;61&quot;
            },
            {
              &quot;name&quot;: &quot;Content-Type&quot;,
              &quot;value&quot;: &quot;text/javascript&quot;
            }
          ],
          &quot;cookies&quot;: [],
          &quot;content&quot;: {
            &quot;size&quot;: 61,
            &quot;mimeType&quot;: &quot;text/javascript&quot;,
            &quot;compression&quot;: 0
          },
          &quot;redirectURL&quot;: &quot;&quot;,
          &quot;headersSize&quot;: 181,
          &quot;bodySize&quot;: 61,
          &quot;_transferSize&quot;: 242
        },
        &quot;cache&quot;: {},
        &quot;timings&quot;: {
          &quot;blocked&quot;: 0.645000021904707,
          &quot;dns&quot;: -1,
          &quot;connect&quot;: -1,
          &quot;send&quot;: 0.0429999781772491,
          &quot;wait&quot;: 167.23200003616503,
          &quot;receive&quot;: 7.511999981943603,
          &quot;ssl&quot;: -1
        },
        &quot;connection&quot;: &quot;892781&quot;,
        &quot;pageref&quot;: &quot;page_1&quot;
      }
    ]
  }
}

&lt;/pre&gt;&lt;/div&gt;&lt;/html&gt;
Now the interesting part is the request of the small image shown above:
&lt;html&gt;&lt;div&gt;&lt;pre&gt;
        &quot;request&quot;: {
          &quot;method&quot;: &quot;GET&quot;,
          &quot;url&quot;: &quot;http://netropy.huebel.freeshells.org:8901/download/images/xenobot.png&quot;,
          &quot;httpVersion&quot;: &quot;HTTP/1.1&quot;,
          &quot;headers&quot;: [
            {
              &quot;name&quot;: &quot;Accept-Encoding&quot;,
              &quot;value&quot;: &quot;gzip, deflate, sdch&quot;
            },
            {
              &quot;name&quot;: &quot;Host&quot;,
              &quot;value&quot;: &quot;netropy.huebel.freeshells.org:8901&quot;
            },
            {
              &quot;name&quot;: &quot;Accept-Language&quot;,
              &quot;value&quot;: &quot;en-US,en;q=0.8,de;q=0.6,da;q=0.4&quot;
            },
            {
              &quot;name&quot;: &quot;User-Agent&quot;,
              &quot;value&quot;: &quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/50.0.2661.102 Safari/537.36&quot;
            },
            {
              &quot;name&quot;: &quot;Accept&quot;,
              &quot;value&quot;: &quot;image/webp,image/*,*/*;q=0.8&quot;
            },
            {
              &quot;name&quot;: &quot;Referer&quot;,
              &quot;value&quot;: &quot;http://netropy.huebel.freeshells.org:8901/&quot;
            },
            {
              &quot;name&quot;: &quot;Cookie&quot;,
              &quot;value&quot;: &quot;txtMainTab=More; txtMoreTab=Orphans&quot;
            },
            {
              &quot;name&quot;: &quot;Connection&quot;,
              &quot;value&quot;: &quot;keep-alive&quot;
            },
            {
              &quot;name&quot;: &quot;Cache-Control&quot;,
              &quot;value&quot;: &quot;max-age=0&quot;
            }
          ],
        },
&lt;/pre&gt;&lt;/div&gt;&lt;/html&gt;
</pre>
</div>
<div title="PageTemplate" modifier="Peter Hübel" created="200905140844" modified="201404060809" changecount="43">
<pre>&lt;!--{{{--&gt;
&lt;div class='header'&gt;
     &lt;div class='gradient' macro='gradient vert #FF8614 #DA4A0D '&gt;
  &lt;div class='titleLine'&gt;
    &lt;div refresh='content' tiddler='xenoma.svg'&gt;&lt;/div&gt;
    &lt;span class='siteTitle' refresh='content' tiddler='SiteTitle'&gt;&lt;/span&gt;&amp;nbsp;&amp;nbsp;&amp;ndash;&amp;nbsp;&amp;nbsp;&lt;span class='siteSubtitle' refresh='content' tiddler='SiteSubtitle'&gt;&lt;/span&gt;
  &lt;/div&gt;
&lt;div id='topMenu' refresh='content' tiddler='MainMenu'&gt;&lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;div id='bodywrapper'&gt;
&lt;div id='sidebar'&gt;
  &lt;div id='sidebarOptions' refresh='content'   tiddler='SideBarOptions'&gt;&lt;/div&gt;
  &lt;div id='sidebarTabs' refresh='content' force='true' tiddler='SideBarTabs'&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div id='displayArea'&gt;
  &lt;div id='messageArea'&gt;&lt;/div&gt;
  &lt;div id='tiddlerDisplay'&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div id='contentFooter'&gt;XENOEMA Handbook &amp;copy; 2004-2014 by Peter Hübel&lt;/div&gt;
&lt;/div&gt;

&lt;!--}}}--&gt;</pre>
</div>
<div title="Parallel Processing" modifier="Peter Hübel" created="201402280836" modified="201402280847" changecount="2">
<pre>{{{
...
  &lt;result channel='3' op='*'&gt;
    &lt;push op='+'&gt; 
      &lt;push channel=&quot;0&quot; as=&quot;float&quot;/&gt;
      &lt;push channel=&quot;1&quot; as=&quot;float&quot;/&gt;
    &lt;/push&gt;
    &lt;push op='/'&gt;
      &lt;push channel=&quot;2&quot; as=&quot;float&quot;/&gt;
      &lt;push const=&quot;3.14&quot; as=&quot;float&quot;/&gt;
    &lt;/push&gt;
  &lt;/result&gt;
...
}}}</pre>
</div>
<div title="Peter Hübel" modifier="Peter Hübel" created="201403132104" changecount="1">
<pre>The guy programming most of this stuff.</pre>
</div>
<div title="Policies" modifier="Peter Hübel" created="200909071749" modified="201205232150" changecount="41">
<pre>Inside every ''&lt;netropy:space/&gt;'' there may be defined a policy.

The policy of a space has direct effect on the behaviour of any visitor in it.

A policy may govern:
* How the visitor navigates in the space
**using a &quot;greedy algorithm&quot;, which also gives us an heuristic for disambiguation of paths for free - not very unlike the algorithm used for parsing an URI Reference (see Section 4.3 and Appendix B of [[RFC2396|http://www.ietf.org/rfc/rfc2396.txt]])
**or using a &quot;lazy&quot; approach, polling every service on the way to handle the payload. This policy is especially useful when building &quot;service pipelines&quot; for visitors to step through.
* The criteria for goal completion - when has the visitor has reached his goal (or died in the attempt)
* What to do when the visitor has reached his goal
**leave at once with the payload,
**or leave (most of) the payload and receive a ticket for later retrieval. In most cases you don't really want all 120.000 records from some SQL query returned in one big XML document. Really not. What you want is pagination, and this policy helps you implement it easily.
* What a visitor may collect from the space, while he moves towards his goal.
** structural information (a blueprint module implements a space with such a policy)
** contextual information (the products of services consulted)

For interoperability, a space should make the blueprint of its policy publicly available, so that clients know what to expect from sending a visitor to that space.

!!Default policy
When not specified, the default policy of a &lt;netropy:space/&gt; is as follows:
* Use a &quot;greedy algorithm&quot; to reach as far into the space as possible, before even considering to consult a service. In other words: Walk as far as you can, until you find yourself at your goal, or have run into a dead end.
* Arriving at a place with all steps taken, the visitor has reached his goal and hands over the request to whatever services or spaces there are present at that place.
* Have not all steps been taken, apparently there is a dead end, and the only way out must lead into another space. Hence any services will be ignored, and only the spaces may take a punch at resolving the full path.
* If a full path does not exist, and the visitor tries to deliver a payload (i.e. a HTTP PUT or POST), the missing places are constructed, and the payload inserted at the newly constructed site.
* If the visitor has some payload after consulting a service or visiting some (sub-)space, the job is considered done and the visitor leaves at once.</pre>
</div>
<div title="PrinzIpien" modifier="Peter Hübel" created="201205232344" modified="201205232351" changecount="5">
<pre>//Im Königreich der Sachsen hatte König Huumlbel zwei Kinder, einen Sohn und ein kleines Töchterlein. Prinz Ipien war der Älteste und selbstverständlich auch der Klügste von den Beien, wo hingegen Prinzesschen Scharlotte ständig über dieses eine ganz andere Meinung hatte...//

!!Man darf --sagen-- was man sagen muss</pre>
</div>
<div title="Proverbs" modifier="YourName" created="201301230902" modified="201301230902" changecount="2">
<pre>If someone says: 
&quot;That's impossible!&quot;
You should understand that as:
&quot;According to my very limited experience and narrow understanding of reality, that's very unlikely.&quot;</pre>
</div>
<div title="QuotationExample" modifier="PeterHübel" created="200701130044" modified="200908302143" changecount="15">
<pre>&lt;html&gt;&lt;span&gt;
&lt;pre&gt;
&lt;quote attribute=&quot;George Bateson&quot;&gt;What we mean by &lt;term&gt;information&lt;/term&gt; - the elementary unit of information - is a &lt;selection&gt;&lt;category&gt;difference&lt;/category&gt; &lt;predicate&gt;which makes a &lt;category&gt;difference&lt;/category&gt;&lt;/predicate&gt;&lt;/selection&gt;.&lt;/quote&gt;
&lt;/pre&gt;
&lt;/span&gt;&lt;/html&gt;The source of which is:
{{{
&lt;html&gt;&lt;span&gt;
&lt;pre&gt;
&lt;quote attribute=&quot;Gregory Bateson&quot;&gt;What we mean by &lt;term&gt;information&lt;/term&gt; - the elementary unit of information - is a &lt;selection&gt;&lt;category&gt;difference&lt;/category&gt; &lt;predicate&gt;which makes a &lt;category&gt;difference&lt;/category&gt;&lt;/predicate&gt;&lt;/selection&gt;.&lt;/quote&gt;
&lt;/pre&gt;
&lt;/span&gt;&lt;/html&gt;
}}}</pre>
</div>
<div title="Rants" modifier="Peter Hübel" created="201201282115" modified="201201282128" changecount="3">
<pre>Code generation is always a brute force attempt to solve a problem. The key problem we always face, is finding the right abstraction, and then implementing it. Of course, due to the large increase in computing power, things like the Kinect have actually been built and are available now in any consumer electronics outlet around the globe.</pre>
</div>
<div title="ReST" modifier="PeterHübel" created="201210042226" modified="201210042227" changecount="2">
<pre>short for ''Representational State Transfer'', is the basic idea behind the HTTP protocol.</pre>
</div>
<div title="Related Work" modifier="Peter Hübel" created="201201282331" changecount="1">
<pre>* The BETA Programming Language</pre>
</div>
<div title="Selfattributing services - a discussion" modifier="Peter Hübel" created="201310080322" modified="201403222142" changecount="7">
<pre>''Pro:'' When a service tag is encountered during parsing of the blueprint, it could be parsed until the opening tag is complete (that means all attributes are on the stack).

This (incomplete) context is being passed on to the generator. Many services will ignore this context, but it could be used to 
* select among different generators based on the value of an attribute
* make a general check of required attributes (we have woetzel meta info for that already)
* add attributes onto the stack, which do not even exist in the blueprint //per se//
* add content prior to initialisation (since the final context can only be appended to)
A well behaved service would announce in advance (based on the initial context) how much space it needs on the stack.

''Contra:'' If somebody needs to change the attributes on a dynamic base, maybe this information should be conveyed in some other way, i.e. as part of the application protocol. There should be no need to implement this in a general way, as some but not all will use that. And you should only pay as you go.</pre>
</div>
<div title="Shared Objects (revisited)" modifier="Peter Hübel" created="201403020359" changecount="1">
<pre>The code layout of [[xeno]] is a perfect fit for shared memories, as everything is code - even the data.

!!Traditional models of shared c++ objects
have trouble, because the object could change class because of object slicing?
</pre>
</div>
<div title="SideBarWG" modifier="PeterHübel" created="200905140845" modified="200905192116" changecount="2">
<pre>/***
This CSS by Dave Birss.
***/
/*{{{*/


.tabSelected {
 background: #fff;
}

.tabUnselected {
 background: #eee;
}

#sidebar {
 color: #000;
 background: transparent; 
}

#sidebarOptions {
 background: #fff;
}

#sidebarOptions input {
  border: 1px solid #ccc;
}

#sidebarOptions input:hover, #sidebarOptions input:active,  #sidebarOptions input:focus {
  border: 1px solid #000;
}

#sidebarOptions .button {
 color: #999;
}

#sidebarOptions .button:hover {
 color: #000;
 background: #fff;
 border-color:white;
}

#sidebarOptions .button:active {
 color: #000;
 background: #fff;
}

#sidebarOptions .sliderPanel {
 background: transparent;
}

#sidebarOptions .sliderPanel A {
 color: #999;
}

#sidebarOptions .sliderPanel A:hover {
 color: #000;
 background: #fff;
}

#sidebarOptions .sliderPanel A:active {
 color: #000;
 background: #fff;
}

.sidebarSubHeading {
 color: #000;
}

#sidebarTabs {`
 background: #fff
}

#sidebarTabs .tabSelected {
 color: #000;
 background: #fff;
 border-top: solid 1px #ccc;
 border-left: solid 1px #ccc;
 border-right: solid 1px #ccc;
 border-bottom: none;
}

#sidebarTabs .tabUnselected {
 color: #999;
 background: #eee;
 border-top: solid 1px #ccc;
 border-left: solid 1px #ccc;
 border-right: solid 1px #ccc;
 border-bottom: none;
}

#sidebarTabs .tabContents {
 background: #fff;
}


#sidebarTabs .txtMoreTab .tabSelected {
 background: #fff;
}

#sidebarTabs .txtMoreTab .tabUnselected {
 background: #eee;
}

#sidebarTabs .txtMoreTab .tabContents {
 background: #fff;
}

#sidebarTabs .tabContents .tiddlyLink {
 color: #999;
 border:none;
}

#sidebarTabs .tabContents .tiddlyLink:hover {
 background: #fff;
 color: #000;
 border:none;
}

#sidebarTabs .tabContents {
 color: #000;
}

#sidebarTabs .button {
 color: #666;
}

#sidebarTabs .tabContents .button:hover {
 color: #000;
 background: #fff;
}

#sidebar {color:#999;}
/*}}}*/</pre>
</div>
<div title="Simulation" modifier="PeterHübel" created="201210041953" modified="201210042227" changecount="3">
<pre>Check out CSS3 for drag-and-drop

Move boxes representing the cells of a stack</pre>
</div>
<div title="Singularity" modifier="Peter Hübel" created="201205152202" modified="201403132105" tags="Singularity" changecount="6">
<pre>[[Singularity]]
</pre>
</div>
<div title="SiteSubtitle" modifier="Peter Hübel" created="200903160939" modified="201404032231" changecount="32">
<pre>//the e''X''tensible ''E''ngine for ''N''etworked ''O''bjects//</pre>
</div>
<div title="SiteTitle" modifier="Peter Hübel" created="200903160939" modified="201404032226" changecount="48">
<pre>&lt;&lt;tiddler xeno&gt;&gt;</pre>
</div>
<div title="StrangeChains" modifier="Peter Hübel" created="201205160031" modified="201205240008" tags="DeveloperRoadMap" changecount="4">
<pre>TiddlyWiki &gt; Osmosoft &gt; BT.com &gt;
    http://www.btplc.com/Innovation/Innovation/Internet/index.htm

http://tidalblog.blogspot.com/2006/07/treeline-view-of-tiddlywiki.html

DevelopingStepByStep</pre>
</div>
<div title="Streams, Stacks, Stashes, and Spaces" modifier="Peter Hübel" created="200905191526" modified="201201200218" changecount="95">
<pre>//The following is inspired by Gregory Batesons &quot;Metalogues&quot;, and the setting is an adult trying to answer some of the odd questions a child may asks about [[InformationSystems]]. My own son knows not much more than the fact that I spend a lot of time working on and with them.//
!!What //is// information?
&gt;- Well... that depends who you ask. It is something that helps you make decisions.
&gt;- But how?
&gt;- Well, for instance: If you knew, that you'd get dessert today, if you tidy up your room...
&gt;- O.k., I'll do it now!!!
&gt;- No, wait - first I'll answer your question... An Englishman named Gregory Bateson, who lived in the last century, once defined information as &quot;a difference which makes a difference&quot;. I think he came quite close to the point.&lt;br/&gt;Think of the way you sense sounds around you. Much of it is noise. The computer humming, cars on the street. Background noise. You don't notice it. But when suddenly there is an unexpected sound - that tells you something. It makes a difference.

In physics, you may equal information and energy. Surely on any level in the world of information systems, there is some dependency on the physical level. Computers use electric power, take up space, generate heat... All those are limiting factors, and all are consequences of a loss of information.


&gt;When you grow older you can read...
&gt;''Steps to an ecology of mind'' by Gregory Bateson.
!!But where does information come from?
Information in the form of ''XML'' is one-dimensional. Don't get deluded by the tree-like structures, it mostly is represented as. This apparent structure comes from meta information embedded in the text, the ''tags''.

Think of the physical reality of Web Tech. In a network information flows through cables or optical fibers until it reaches its destination. We use the concept of a ''stream'' to describe this movement of information.

Imagine the stream below entering a Netropy Server (scroll the data):
{{{
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; standalone=&quot;yes&quot;?&gt;&lt;information&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;lots/&gt;&lt;/information&gt;
}}}
Inside the server the information is folded in a structure we call a ''stack'':
{{{
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; standalone=&quot;yes&quot;?&gt;
&lt;information&gt;
  &lt;lots/&gt;
  &lt;lots/&gt;
  &lt;lots/&gt;
  &lt;!-- stuff omitted --&gt;
  &lt;lots/&gt;
  &lt;lots/&gt;
  &lt;lots/&gt;
  &lt;lots/&gt;
&lt;/information&gt;
}}}
!!Wait! That's not a stack!
You mean a stack is like this?
|&amp;rarr;{{{top}}}|
| ... |
| ... |
| ... |
| ... |
| ... |
| ... |
| ... |
| ... |
No, sorry, the stack we mean is not so abstract. It is more like this: 
[img[Part of a Conventional Information Processing System|/download/real-stack.jpg]]

Services may operate on this stack and transform it:
{{{
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; standalone=&quot;yes&quot;?&gt;
&lt;information&gt;
  &lt;lots/&gt;
  &lt;!-- stuff deleted --&gt;
  &lt;lots/&gt;
  &lt;even&gt;
    &lt;more&gt;new data added&lt;/more&gt;
  &lt;/even&gt;
&lt;/information&gt;
}}}
and the result may be flushed out on a ''stream'' again.

Quick and effective information processing due to structure.

!!Ah, those memories!
Netropy Server has a clean desk policy internally. That means those stacks disappear whenever work is done.

To prevent your information from disappearing, it can be put into a ''stash'', a place in the information space, from where you can get it later on.

It is not possible to apply transformations to information residing in a ''stash'', because Netropy Server treats it as unstructured information.
!!Sorting out stuff
To structure your information, you arrange it in a ''space''. You can learn more about spaces in the tiddler [[InformationSpaces]].</pre>
</div>
<div title="Structuring Information" modifier="PeterHübel" created="200701121746" modified="200905192029" changecount="105">
<pre>!!!Form and function
Before even attempting to structure information, we should take a look at the ''form'' (or //shape//) of the information.

In the context of Netropy Server the form of information is mostly ''XML''. The rationale behind that decision is that ''XML'' goes well with any &lt;html&gt;&lt;abbr title=&quot;Content Management System&quot;&gt;CMS&lt;/abbr&gt;&lt;/html&gt; and gives you many integration points for your information.

Furthermore the choice of ''XML'' (like in &quot;extensible&quot;) as the syntax for describing the structure of our information gives us a lot of extra benefits when addressing the Javascript/XML/HTTP world.

!!![[Using Markup Language|UsingMarkupLanguage]]
&lt;&lt;tiddler UsingMarkupLanguage&gt;&gt;
!!![[Using Namespaces|UsingNameSpaces]]
&lt;&lt;tiddler UsingNameSpaces&gt;&gt;
!!![[At Your Service|AtYourService]]
&lt;&lt;tiddler AtYourService&gt;&gt;
</pre>
</div>
<div title="StyleSheet" modifier="Peter Hübel" created="200905140844" modified="201404032229" changecount="10">
<pre>[[SideBarWG]]

/***
!Top Menu Styles
***/
/*{{{*/
#topMenu br {display:none; }
#topMenu { background: #000 ; color:#fff;padding: 1em 1em;}
/*}}}*/

/***
!General
***/
/*{{{*/
body {
 background: #444;
 margin: 0 auto;
}

pre {
  -webkit-tab-size: 2;
  -moz-tab-size: 2;
}

#contentWrapper{
 background: #fff;
 border: 0;
 margin: 0 auto;
 width: 792px;
 padding:0;
}
/*}}}*/

/***
!Header rules
***/
/*{{{*/
.titleLine{
 margin: 20px auto 0em ;
 margin-left:1.7em;
 margin-bottom: 40px;
 padding: 0;
 text-align: left;
 color: #fff;
}

.siteTitle {
  font-size: 2em;
        font-weight: bold;
}

.siteSubtitle {
  font-size: 1.1em;
        margin: .5em auto 1em;
}

.gradient {margin: 0 auto;}



.header {
 background: #fff; 
 margin: 0 auto;
 padding:0 12px;
 width: 768px;
}
/*}}}*/

/***
!Display Area
***/
/*{{{*/
#bodywrapper {margin:0 12px; padding:0;background:#fff; height:1%}

#displayArea{
 margin: 0em 16em 0em 1em;
 text-align: left;
}

.tiddler {
  padding: 1em 1em 0em 0em;
}

h1,h2,h3,h4,h5 { color: #000; background: transparent; padding-bottom:2px; border-bottom: 1px dotted #666; }
.title {color:black; font-size:1.8em; border-bottom:1px solid #333; padding-bottom:0.3px;}
.subtitle { font-size:90%; color:#ccc; padding-left:0.25em; margin-top:0.1em; }

.shadow .title {
  color: #aaa;
}

.tagClear{
  clear: none; 
}

* html .viewer pre {
  margin-left: 0em;
}

* html .editor textarea, * html .editor input {
  width: 98%;
}

.tiddler {margin-bottom:1em; padding-bottom:0em;}


.toolbar .button {color:#bbb; border:none;}
.toolbar .button:hover, .toolbar .highlight, .toolbar .marked, .toolbar a.button:active {background:transparent; color:#111; border:none; text-decoration:underline;}

#sidebar .highlight, #sidebar .marked {background:transparent;}

.tagging, .tagged {
        display: none;
  border: 1px solid #eee;
  background-color: #F7F7F7;
}

.selected .tagging, .selected .tagged {
  background-color: #eee;
  border: 1px solid #bbb;
}

 .tagging .listTitle, .tagged .listTitle {
  color: #bbb;
}

.selected .tagging .listTitle, .selected .tagged .listTitle {
  color: #222; 
}


.tagging .button:hover, .tagged .button:hover {
  border: none; background:transparent; text-decoration:underline; color:#000;
}

.tagging .button, .tagged .button {
  color:#aaa;
}

.selected .tagging .button, .selected .tagged .button {
  color:#000;
}

.viewer blockquote {
  border-left: 3px solid #000;
}

.viewer pre, .viewer code {
  border: 1px dashed #ccc;
  background: #eee;}

.viewer hr {
  border: 0;
  border-top: solid 1px #333;
  margin: 0 8em;
  color: #333;
}

.highlight, .marked {
  background:transparent; 
  color:#111; 
  border:none; 
  text-decoration:underline;
}

.viewer .highlight, .viewer .marked {
  text-decoration:none;
}

#sidebarTabs .highlight, #sidebarTabs .marked {color:#000; text-decoration:none;}

.tabSelected {
 color: #000;
 background: #fff;
 border-top: solid 1px #ccc;
 border-left: solid 1px #ccc;
 border-right: solid 1px #ccc;
 border-bottom: none;
}

.viewer .tabSelected:hover{color:#000;}

.viewer .tabSelected {font-weight:bold;}

.tabUnselected {
 color: #999;
 background: #eee;
 border-top: solid 1px #ccc;
 border-left: solid 1px #ccc;
 border-right: solid 1px #ccc;
 border-bottom: solid 1px #ccc;
 padding-bottom:1px;
}

.tabContents {
 background: #fff;
  color: #000;
}
/*}}}*/
/***
!!!Tables
***/
/*{{{*/
.viewer table {
  border: 1px solid #000;
}

.viewer th, thead td {
  background: #000;
  border: 1px solid #000;
  color: #fff;
}

.viewer td, .viewer tr {
  border: 1px solid #111;
}
/*}}}*/


/***
!!!Editor area
***/
/*{{{*/
.editor input, .editor textarea {
  border: 1px solid #ccc;
}

.editor {padding-top:0.3em;}

.editor textarea:focus, .editor input:focus {
  border: 1px solid #333;
}
/*}}}*/

/***
!Sidebar
***/
/*{{{*/
#sidebar{
position:relative;
float:right;
margin-bottom:1em;
display:inline;
width: 16em;
}

#sidebarOptions .sliderPanel {
  background: #eee; border:1px solid #ccc;
}

/*}}}*/

/***
!Body Footer rules
***/
/*{{{*/
#contentFooter {
 text-align: left;
 clear: both;
 color:#fff;
 background: #000;
 padding: 1em 2em;
font-weight:bold;
}

/*}}}*/
/***
!Link Styles
***/
/*{{{*/
a {
  color: #000;
        text-decoration: none;
}

a:hover {
        color: #FF6600;
        background:#fff;
}


.button {
  color: #000;
  border: 1px solid #fff;
}

.button:hover {
  color: #fff;
  background: #ff8614;
  border-color: #000;
}

.button:active {
  color: #fff;
  background: #ff8614;
  border: 1px solid #000;
}

.tiddlyLink { /* border-bottom: 1px dotted #000; */ }
.tiddlyLink:hover {border-bottom: 1px dotted #FF6600;} 

.titleLine a { /*border-bottom: 1px dotted #FF9900; */ }

.titleLine a:hover { border-bottom: 1px dotted #fff;}

.siteTitle a, .siteSubtitle a {
        color: #fff;
}

.viewer .button {border: 1px solid #ff8614; font-weight:bold;}
.viewer .button:hover, .viewer .marked, .viewer .highlight{background:#ff8614; color:#fff; font-weight:bold; border: 1px solid #000;}

#topMenu .button, #topMenu .tiddlyLink {
 margin-left:0.5em; margin-right:0.5em;
 padding-left:3px; padding-right:3px;
 color:white;
}
#topMenu .button:hover, #topMenu .tiddlyLink:hover { background:#000; color:#FF8814}

#topMenu a{border:none;}
/*}}}*/

/***
!Message Area /%=================================================%/
***/
/*{{{*/
#messageArea {
  border: 4px dotted #ff8614;
  background: #000;
  color: #fff;
        font-size:90%;
}

#messageArea .button {
  padding: 0.2em;
  color: #000;
  background: #fff;
        text-decoration:none;
        font-weight:bold;
        border:1px solid #000; 
}

#messageArea a {color:#fff;}

#messageArea a:hover {color:#ff8614; background:transparent;}

#messageArea .button:hover {background: #FF8614; color:#fff; border:1px solid #fff; }

/*}}}*/

/***
!Popup /%=================================================%/
***/
/*{{{*/
.popup {
  background: #ff8814;
  border: 1px solid #333;
}

.popup hr {
  color: #333;
  background: #333;
  border-bottom: 1px;
}

.popup li.disabled {
  color: #333;
}

.popup li a, .popup li a:visited {
  color: #eee;
  border: none;
}

.popup li a:hover {
  background: #ff8614;
  color: #fff;
  border: none;
        text-decoration:underline;
}
/*}}}*/

/*{{{*/
.blog h2, .blog h3, .blog h4{
  margin:0;
  padding:0;
  border-bottom:none;
}

.blog {margin-left:1.5em;}  

.blog .excerpt {
  margin:0;
  margin-top:0.3em;
  padding: 0;
  margin-left:1em;
  padding-left:1em;
  font-size:90%;
  border-left:1px solid #ddd;
}

#tiddlerWhatsNew h1, #tiddlerWhatsNew h2 {border-bottom:none;}
div[tags~=&quot;RecentUpdates&quot;], div[tags~=&quot;lewcidExtension&quot;] {margin-bottom: 2em;}

#hoverMenu  .button, #hoverMenu  .tiddlyLink {border:none; font-weight:bold; background:#f37211; color:#fff; padding:0 5px; float:right; margin-bottom:4px;}
#hoverMenu .button:hover, #hoverMenu .tiddlyLink:hover {font-weight:bold; border:none; color:#f37211; background:#000; padding:0 5px; float:right; margin-bottom:4px;}

#topMenu .fontResizer {float:right;}

#topMenu .fontResizer .button{border:1px solid #000;}
#topMenu .fontResizer .button:hover {border:1px solid #f37211; color:#fff;}
#sidebarTabs .txtMainTab .tiddlyLinkExisting {
 font-weight: normal;
 font-style: normal;
}

#sidebarTabs .txtMoreTab .tiddlyLinkExisting {
 font-weight: bold;
 font-style: normal;
}

.blog h2, .blog h3, .blog h4{
  margin:0;
  padding:0;
border-bottom:none;
}
.blog {margin-left:1.5em;}  


.blog .excerpt {
  margin:0;
margin-top:0.3em;
  padding: 0;
  margin-left:1em;
  padding-left:1em;
  font-size:90%;
  border-left:1px solid #ddd;
}

#tiddlerWhatsNew h1, #tiddlerWhatsNew h2 {border-bottom:none;}
div[tags~=&quot;RecentUpdates&quot;], div[tags~=&quot;lewcidExtension&quot;] {margin-bottom: 2em;}

#hoverMenu {background:transparent;}
#hoverMenu  .button, #hoverMenu  .tiddlyLink {border:none; font-weight:bold; background:#f37211; color:#fff; padding:0 5px; float:right; margin-bottom:4px;}
#hoverMenu .button:hover, #hoverMenu .tiddlyLink:hover {font-weight:bold; border:none; color:#f37211; background:#000; padding:0 5px; float:right; margin-bottom:4px;}

#topMenu .fontResizer {float:right;}

#topMenu .fontResizer .button{border:1px solid #000;}
#topMenu .fontResizer .button:hover {border:1px solid #f37211; color:#fff;}
#sidebarTabs .txtMainTab .tiddlyLinkExisting {
 font-weight: normal;
 font-style: normal;
}

#sidebarTabs .txtMoreTab .tiddlyLinkExisting {
 font-weight: bold;
 font-style: normal;
}

/*}}}*/</pre>
</div>
<div title="SwissArmyKnife" modifier="PeterHübel" created="201205152254" modified="201205291436" tags="Swarkn" changecount="2">
<pre>|Overview over tasks in application development|c
|!Task|!Description|!Process|!Language or Protocol|!Tool(s)|
|Data Acquisition|Gathering information|Hardware Interfacing|C/C++|Eclipse|
|Publishing|Making information available|Structuring|C++ &amp;rarr; XML&amp;nbsp;/&amp;nbsp;JSON|~|
|~|~|Transport|IP / TCP / HTTP|Wireshark|
|Presentation |Making things visible and touchable|Structuring|HTML|Eclipse (or ''any editor'') &amp; //Modern&amp;nbsp;Browser//|
|~|~|Styling|CSS|~|
|Interaction|~|Adding behaviour|ECMAscript|~|

* IP ~SubProtocols (TCP or UDP or IMPC &gt; FTP or HTTP or DNS) for interoperability and means of transport (but it might be any protocol of serial nature). Remember: [[HTTP is an application protocol.]]
* XML or JSON (or any block structured format) for interoperability.
* C/C++ (serializable to XML or JSON) objects for abstracting hardware. ''Note:'' Most interfaces to the hardware are implemented in C, and provide therefore an API in that same language.
* HTML(5) and CSS for representation.
* ECMAscript for adding behaviour.</pre>
</div>
<div title="TalkToWerner" modifier="Peter Hübel" created="201201290147" modified="201202281609" changecount="6">
<pre>TiddlyWiki (and -Spaces)
some kind of hardware-platform for this?

!!Employee
Contract, Salary, Holidays

!!ITC Solar
Lechtaler

!!Licencing
I don't want the code floundering about on the net. </pre>
</div>
<div title="Technical Specifications" modifier="Peter Hübel" created="200905190822" modified="201403061955" changecount="22">
<pre>!!!Footprint
Less than 400 kB with all services installed. The core processor (without the HTTP server and services) is about 2kB (!) on a 32-bit architecture.
!!!Memory Usage
About 5 MB for this server, having cashed some content in memory due to disk constraints (live data available shortly).
!!!Deployment
The &lt;&lt;tiddler xeno&gt;&gt; ''VM'' consists of one single executable. Extension modules may be added by means of dynamic libraries (platform specific), and eventually the ''boost'' runtime libraries [[may have to be installed|ListOfDistributions]].

The configuration of a server instance consists of one single XML document (the [[Blueprint]]), which may be changed at runtime.
!!!Platforms
32-bit Windows (netropy.exe versions prior to 1.0 only), embedded Linux (debian/arm9), Mac OS X (not planned yet)</pre>
</div>
<div title="TiddlySlide" modifier="Peter Hübel" created="201201290046" modified="201201290046" changecount="2">
<pre>http://www.tiddlyslide.org</pre>
</div>
<div title="TiddlyWiki" modifier="Peter Hübel" created="201201192035" modified="201201290131" tags="diary" changecount="2">
<pre>I see very much NetropyServer and [[TiddlyWiki|http://www.tiddlywiki.org]] merging together. I might make a [[&lt;netropy:wiki/&gt;]] service...

Look at this: http://psd.tiddlyspace.com/#[[Open%20Toilet%20Data]]</pre>
</div>
<div title="ToDo" modifier="PeterHübel" created="201206220159" modified="201209291406" changecount="2">
<pre>* Ihi &amp; Ussi
* FragenAnDieKollegen</pre>
</div>
<div title="ToolbarCommands" modifier="Peter Hübel" created="201205232053" modified="201205232054" changecount="4">
<pre>|~ViewToolbar|closeTiddler closeOthers +editTiddler &gt; fields syncing permalink references jump|
|~EditToolbar|closeOthers +saveTiddler -cancelTiddler deleteTiddler|</pre>
</div>
<div title="TrustByConvolution" modifier="PeterHübel" created="201205240200" changecount="1">
<pre>A PrinzIpel</pre>
</div>
<div title="UsingMarkupLanguage" modifier="Peter Hübel" created="200905121938" modified="201402121451" changecount="72">
<pre>Markup should be a non-intrusive as possible.

Take a look at the following quote from [[Gregory Bateson|http://en.wikipedia.org/wiki/Gregory_Bateson]]:
&lt;&lt;tiddler QuotationExample&gt;&gt;
What you see displayed is the result of your browser trying to interpret the information found in the XML (actually XHTML) delivered from this server. 

The browser knows about the {{{&lt;html&gt;}}}-tags, so the result is boxed. But since your browser does not know how to interpret that {{{&lt;quote&gt;}}} stuff, it just passes along the pure contents - without the tags - for you to read on the display. This is very reasonable behaviour, as you can see.

&lt;html&gt;&lt;iframe src=&quot;/blueprint/quote/netropy:copy/quote&quot; style=&quot;width:100%;height:32em;&quot;/&gt;&lt;/html&gt;

For an elaboration on the meaning of Batesons words, see the quote in its original context [[here|http://plato.acadiau.ca/courses/educ/reid/papers/PME25-WS4/SEM.html]].</pre>
</div>
<div title="UsingNameSpaces" modifier="Peter Hübel" created="200905121939" modified="201402121449" changecount="74">
<pre>The concept of markup, or tagging, blends well into the concept of a &quot;space&quot;, where information
resides at different &quot;sites&quot; within that space.

To be able to navigate in that information space, you assign names to those sites and use markup to divide the information space into smaller spaces:
{{{
&lt;netropy:space xmlns=&quot;http://lab.strxtrs.net/2009/05/14&quot; xmlns:netropy=&quot;http://www.strxtrs.net/2009/netropy&quot; port=&quot;80&quot;&gt;
  &lt;somewhere&gt;Information&lt;/somewhere&gt;
  &lt;elsewhere&gt;&lt;deeply&gt;&lt;hidden&gt;&lt;away&gt;Garbage&lt;/away&gt;&lt;/hidden&gt;&lt;/deeply&gt;&lt;/elsewhere&gt;
&lt;/netropy:space&gt;
}}}
Such an XML document we call a [[blueprint|Blueprint]]. It describes an information space to be realised by a Netropy Server. Note that every server instance defines an XML namespace itself (the default namespace {{{xmlns}}}), which in turn defines the vocabulary for navigating its content.

Navigation is performed by using paths. In the example above, the path will start at the entry
port (the XML document root {{{/}}}) of the space (which is bound to an HTTP connection on port 80). 
Then the expression
{{{
/elsewhere/deeply/hidden/away
}}}
would be such a path, showing the way to the garbage.

Netropy Server uses the knowledge of the namespace to perform ultrafast lookups throughout the entire information structure.

It is worth noticing, that all the names you define for structuring your model, are your own, and mostly subject only to the limitations for qualified names given by XML.

That means for one, you can model in your own language, e.g.
{{{

}}}

</pre>
</div>
<div title="VillageSign" modifier="Peter Hübel" created="201202090659" modified="201310110556" changecount="29">
<pre>&lt;html&gt;
&lt;head&gt;
&lt;style&gt;
.town-sign { 
height: 120px; width: 200px; 
border: 1px solid black; 
position: relative; overflow: hidden;
display: inline-block;
padding: 0 auto;
}
.blue-stripe, .white-stripe { margin: 0px; padding: 0px; position: static; }
.blue-stripe { background: blue; height: 25%; }
.white-stripe { background: white; height: 50%; text-align: center; vertical-align: center; }
.red-bar { 
background: red; 
height: 20px; width: 150%; 
z-order: 1; 
position: absolute; 
top: -10px; left: 0px; 
transform: rotate(30deg);
transform-origin: 0 0;
}
.name { font-size: 20pt; vertical-align: center; line-height: 60px; }
&lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;div class=&quot;town-sign&quot;&gt;
&lt;div class=&quot;blue-stripe&quot;&gt;&lt;/div&gt;
&lt;div class=&quot;white-stripe&quot;&gt;&lt;span class=&quot;name&quot;&gt;Stag Nation&lt;/span&gt;&lt;/div&gt;
&lt;div class=&quot;blue-stripe&quot;&gt;&lt;/div&gt;
&lt;div class=&quot;red-bar&quot;&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;div class=&quot;town-sign&quot;&gt;
&lt;div class=&quot;blue-stripe&quot;&gt;&lt;/div&gt;
&lt;div class=&quot;white-stripe&quot;&gt;&lt;span class=&quot;name&quot;&gt;Stag Nation&lt;/span&gt;&lt;/div&gt;
&lt;div class=&quot;blue-stripe&quot;&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;/body&gt;
&lt;/html&gt;</pre>
</div>
<div title="Welcome" modifier="Peter Hübel" created="200905101444" modified="201404061255" tags="Introduction" changecount="231">
<pre>!!&lt;&lt;tiddler xeno&gt;&gt; is ...

... a ''lightweight'' virtual machine for processing ''structured data'' with support for &lt;html&gt;&lt;abbr title='eXtensible Markup Language'&gt;XML&lt;/abbr&gt;&lt;/html&gt;, &lt;html&gt;&lt;abbr title='JavaScript Object Notation'&gt;JSON&lt;/abbr&gt;&lt;/html&gt;, and just about any binary format you can imagine. It has been built for the [[Internet of Things]].

Its [[specifications|Technical Specifications]] in terms of speed, low overhead and robustness makes &lt;&lt;tiddler xeno&gt;&gt; well suited for ''embedded'' applications.

On heavily loaded systems, it may also serve as an extremely efficient [[information hub|Information Hub]] to back a &lt;html&gt;&lt;abbr title=&quot;Content Management System&quot;&gt;CMS&lt;/abbr&gt;&lt;/html&gt; or for gathering, processing, and visualising ''real time data''.

In general, a &lt;&lt;tiddler xeno&gt;&gt; is a flexible tool for making legacy data accessible via web services.

The programming model is [[XML centric|XML Centric Programming Model]], and enables developers to build applications in an ''agile way''. Just load your content into a &lt;&lt;tiddler xeno&gt;&gt; and you're ready to go. Add other kinds of content, modify existing structures and keep going. ''Develop'', ''test'', and ''deploy'' with extremely&amp;nbsp;&amp;nbsp;''fast turnaround'' times.

Or develop [[extensions|&lt;xeno:extend/&gt;]] in ''C/C++''.
!!The &lt;&lt;tiddler xeno&gt;&gt; is //not//...
... another web server, CMS, &quot;integration platform&quot;, or whatever it may look like to you, when you interact with it on an IP network, like you do now.

The case is, that this particular software implementation uses ~UTF-8 encoded XML or JSON for the representation of structured information and HTTP for transport. That choice is not completely arbitrary, since transporting ''XML'' or ''JSON'' over ''HTTP'' naturally opens up for interoperability over the internet.

!!The &lt;&lt;tiddler xeno&gt;&gt; is rather ...
... a ''virtual machine'', a spin-off product from an ongoing [[R&amp;D project|http://www.strxtrs.net/strXtrs/Evolving%20Technologies.html]] on information processing and intelligent networks.

As much of the structured data in embedded systems is represented as ''C/C++'' structures, &lt;&lt;tiddler xeno&gt;&gt; also supports direct mapping of services to memory and other devices of a machine.

If you are interested in the physical levels of information processing, you might get a better understanding of the design of this software by reading [[a short introduction to the XENOmat|A short introduction to the XENOmat]].

!!What's the netropy stuff about?

''netropy'' is the name of the technology, on which &lt;&lt;tiddler xeno&gt;&gt; is built.

The name is a play on words, derived from the concept of [[entropy|http://en.wikipedia.org/wiki/Entropy]]. The concept of entropy has often been loosely associated with the amount of ''order'', ''disorder'', and/or ''chaos'' in a system.

From the Wikipedia entry about [[Information Theory|http://en.wikipedia.org/wiki/Information_theory]]:
&gt;A key measure of information in the theory is known as [[entropy|http://en.wikipedia.org/wiki/Entropy_(information_theory)]], which is usually expressed by the average number of bits needed for storage or communication.  Intuitively, entropy quantifies the uncertainty involved when encountering a [[random variable|http://en.wikipedia.org/wiki/Random_variable]]. For example, a fair coin flip (2 equally likely outcomes) will have less entropy than a roll of a die (6 equally likely outcomes).

Real life data are a lot more complex than that. As entropy increases steadily in our information society, Xenoma really likes the concept of ''change'', and we see and address the need for information to ''spread'' as fast and ''frictionless'' on the net as possible.

Controlling entropy - which in itself may be brought to good uses. This is the main design rationale behind &lt;&lt;tiddler xeno&gt;&gt;.

!!Benefits
!![[... for developers|Agile application development]]
&lt;&lt;tiddler [[Agile application development]]&gt;&gt;
!![[... for machines|Efficient resource management]]
&lt;&lt;tiddler [[Efficient resource management]]&gt;&gt;

!!Where do I go from here?
A good starting point would be to read about some of the [[basic concepts|Basic Concepts]] of &lt;&lt;tiddler xeno&gt;&gt;.

You can also jump right to the [[Technical Specifications]] to see if a &lt;&lt;tiddler xeno&gt;&gt; fits your needs.</pre>
</div>
<div title="WikiWords" modifier="Peter Hübel" created="201201192020" modified="201201192026" changecount="5">
<pre>When you write concepts with each word capitalised and squashed together like this. More about WikiWords (note the [[Singularity]]) in [[this| ]] ExternalTiddler.</pre>
</div>
<div title="WishlistForThisMedia" modifier="YourName" created="201201180137" modified="201402020539" tags="systemConfig" changecount="20">
<pre>/***
* When in ''search'' mode, rename the ''close'' button to ''not this one!'' and the ''close others'' (which should be named ''focus'') to ''YES!''. Might be a good idea to use red/green coloring for that.
* a &lt;&lt;netropy:service&gt;&gt;
* When rendering WikiWords, render them as ''Wiki Words''.
* A screen reader based on [[Google Translate|http://translate.google.com/translate_tts?q=Google Translate]].
* Map the caret position in the displayView to the editView. Needs some negotiation with the browser, i think. WeNeedYourHelp.

!!Changes already performed in this media
!!!Tiddlers
* ToolbarCommands
!!!Javascript
***/
/*{{{*/
config.commands.closeOthers.text = &quot;focus&quot;;
/*}}}*/</pre>
</div>
<div title="Woetzel" modifier="PeterHübel" created="201209291412" modified="201209291531" changecount="38">
<pre>//pr.// ''['Wutsl]''
Woetzel is a technique for traversing an object structure in C++, solely based on language features present since the 1980's. Traversal is a prerequisite for serialization, which is the application of the technique used as an example throughout this introduction.
!The object &quot;life cyclus&quot; in C++
This section is a small recapitulation of object creation and destruction in C++, and you may skip it at your convenience.
Objects in C++ are instances of classes. A class may have a number of special methods for initialization, called the ''constructor'' (or in programmer jargon //''ctor''//). 
Constructors are named like the class and do not return anything. You also can not invoke them directly, as we shall see in a while. A constructor without any arguments is called the //default contructor//.
Likewise there may be a special method called the ''destructor'' (or ''//dtor//''), which is invoked when the object ends its life cyclus. It also is named like the class, but is prefixed with a negation operator.
We can see these methods in action with the following small example C++ program:
{{{
#include &lt;iostream&gt;
#include &lt;string&gt;
using namespace std;

class Sample {
public:
  Sample() { cout &lt;&lt; &quot;ctor&quot; &lt;&lt; endl; }
  ~Sample() { cout &lt;&lt; &quot;dtor&quot; &lt;&lt; endl; }
  void do() { cout &lt;&lt; &quot;i=&quot; &lt;&lt; i &lt;&lt; &quot;, s='&quot; &lt;&lt; s &lt;&lt; &quot;'\n&quot;; }
private:
  int i;
  std::string s;
};

int main(int argc, char** argv)
{
  for (int i=0; i&lt;3; ++i) {
    cout &lt;&lt; &quot;Enter: &quot;;
    Sample test;
    cout &lt;&lt; &quot;Do: &quot;;
    test.do();
    cout &lt;&lt; &quot;Exit: &quot;;
  }
  return 0;
}
}}}
Compiled and executed, we see a number of things from the output:
{{{
ctor
i=0, s=''
dtor
ctor
i=0, s=''
dtor
ctor
i=0, s=''
dtor
}}}
* The members {{{i}}} and {{{s}}} are initialized by default.
&gt; C++ guarantees that members get initialized to their default values. That means mostly zero for numeric types, the default constructor
* The object {{{test}}} is constructed and destroyed in every execution of the loop. 
&gt; C++ being a block structured language, this holds for all blocks, and it is considered good practice to use this language feature to control the acquisition and release of shared resources such as memory or file handles.
!Where in memory is the object?
In the example above the {{{Sample}}} object was created on the stack. This also is the case for the {{{std::string}}}&amp;nbsp;object embedded inside it.
The compiler knows how many bytes it needs for the object, so it reserves an adequate range of memory for it on the stack and passes the address of that memory to the constructor. The constructor on its side can refer to that memory through a special pointer called ''this''.
</pre>
</div>
<div title="WorkingWithXML?" modifier="Peter Hübel" created="201201282030" modified="201403132132" tags="ToDo" changecount="24">
<pre>''Q:'' Do I really need to use XSLT to convert my data into HTML, so they can be displayed in a browser?
''A:'' No, actually you have several other options. XSLT has merely the benefit, that you can build a library of components for rendering your data in a consistent way.
Your other options for visualizing XML data are:
* Using CSS for styling, as described in [[this document from W3C|http://www.w3.org/Style/styling-XML.html]]. As a remark aside, note how the page uses HTTP to give you multiple choices for language. An &quot;intelligent&quot; service might use the information on that page to do an automatic redirect.
* Do the transformation with ''&lt;script/&gt;ing''. This site uses [[jQuery|http://www.jquery.com]] in some instances to traverse a XML document and generate a dynamic GUI.
* Use a ''&lt;xeno:service/&gt;'' as an endpoint for a ''ReST'' service and code the GUI in the framework of your choice. Most platforms have bindings for ReST (TODO! References)</pre>
</div>
<div title="XENOmat" modifier="Peter Hübel" created="201402020140" modified="201403210905" changecount="38">
<pre>!!XENOEMA
&lt;&lt;tiddler SiteSubtitle&gt;&gt;
!!XENACE
//- eXtensible Embedding of Networked Objects in Asynchronous Computing Engines
!!XENOASE


&lt;html&gt;&lt;img width=&quot;10%&quot; height=&quot;10%&quot; src=&quot;data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIj8+Cjxzdmcgd2lkdGg9IjM2MCIgaGVpZ2h0PSIyMjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6c3ZnPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CiA8Zz4KICA8dGl0bGU+QWxpZW48L3RpdGxlPgogIDxnIGZpbHRlcj0idXJsKCNhbGllbl9ibHVyKSIgaWQ9ImFsaWVuIj4KICAgPGcgaWQ9InN2Z18yIj4KICAgIDxwYXRoIGQ9Im0yMTIuMDk2OTg1LDcxLjEwNDc2N2MyMi42NDI4MjIsLTIuMjY5ODkgMzQuMDQwMjk4LC03LjEzNDE5NyAzOS41LC0xMS40OTcyNTdjMTcuNzU0MjExLC0xNC4xODgwMyAxMS4zMjUzNDgsLTI3LjM1MzgzMiAyMiwtMjQuNDMxNzIxYzEwLjUsMi44NzQzMjEgMTAuNDc2NzQ2LDE0LjA3OTMxMSAxNy41LDE3LjI0NTkyMmM4LjUsMy44MzI0MjggLTIuMDM3MTA5LC0zMy42OTQ1MyA2LjUsLTMxLjEzODQ2YzgsMi4zOTUyNjkgOC45NzE4NjMsMjEuNDA4OTc5IDIxLDI2LjM0NzkyOWMxMC41LDQuMzExNDgxIC02LjYwOTAwOSwtNDQuNjMxMTggOCwtMzQuMDEyNzhjMTQuNSwxMC41MzkxNyAzNSw1Mi42OTU4NTUgMSw2NC4xOTMxNDdjLTM0LDExLjQ5NzI4NCAtODQuNDQ2NjcxLDE0LjgzODA1MSAtMTAxLDE0LjM3MTYwNWMtMTcsLTAuNDc5MDY1IC0zMi42NTk4ODIsLTE5LjI1NzgxMyAtMTQuNSwtMjEuMDc4MzU0bDAsLTAuMDAwMDMxeiIgaWQ9InBhdGgyMzk5IiBzdHJva2UtbWl0ZXJsaW1pdD0iNCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgc3Ryb2tlLXdpZHRoPSI1IiBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGZpbGw9IiNiYThkNzMiIHN0cm9rZT0iIzAwMDAwMCIvPgogICAgPHBhdGggZD0ibTE0OS41LDcxLjEwNDc2N2MtMjIuNjQyNzc2LC0yLjI2OTg5IC0zNC4wNDAyODMsLTcuMTM0MTk3IC0zOS40OTk5OTIsLTExLjQ5NzI1N2MtMTcuNzU0MTgxLC0xNC4xODgwMyAtMTEuMzI1MzQsLTI3LjM1MzgzMiAtMjIsLTI0LjQzMTcyMWMtMTAuNSwyLjg3NDMyMSAtMTAuNDc2NzMsMTQuMDc5MzExIC0xNy41MDAwMDgsMTcuMjQ1OTIyYy04LjUsMy44MzI0MjggMi4wMzcxMzIsLTMzLjY5NDUzIC02LjUsLTMxLjEzODQ2Yy04LDIuMzk1MjY5IC04Ljk3MTg0LDIxLjQwODk3OSAtMjEsMjYuMzQ3OTI5Yy0xMC41LDQuMzExNDgxIDYuNjA5MDMyLC00NC42MzExOCAtOCwtMzQuMDEyNzhjLTE0LjUsMTAuNTM5MTcgLTM1LDUyLjY5NTg1NSAtMSw2NC4xOTMxNDdjMzQsMTEuNDk3Mjg0IDg0LjQ0NjY2MywxNC44MzgwNTEgMTAxLjAwMDAxNSwxNC4zNzE2MDVjMTcsLTAuNDc5MDY1IDMyLjY1OTg4MiwtMTkuMjU3ODEzIDE0LjQ5OTk4NSwtMjEuMDc4MzU0bDAsLTAuMDAwMDMxeiIgaWQ9InBhdGgzMTcxIiBzdHJva2UtbWl0ZXJsaW1pdD0iNCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgc3Ryb2tlLXdpZHRoPSI1IiBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGZpbGw9IiNhZDdlNjEiIHN0cm9rZT0iIzAwMDAwMCIvPgogICA8L2c+CiAgIDxwYXRoIHN0cm9rZT0iIzAwMDAwMCIgaWQ9InBhdGg0IiBkPSJtMTgzLjU4MDEzOSw5LjQxNzI2Yy0zMy42OTc3MjMsMCAtODAuMjE1NTQ2LDIxLjU5NTkyIC04MC4yMTU1NDYsNzcuNzg1NTA2YzAsMC4xODQ2ODUgMCwwLjM5MDgyMyAwLDAuNTc1NWMwLjM4NTc2NSw1NS45MzU5MDUgNTYuNDExMzAxLDEyNS4xNDgyNzcgODAuMjE1NTQ2LDEyNS4xNDgyNzdjMjMuODkzNzY4LDAgODAuMjE0OTA1LC02OS41MzQxOCA4MC4yMTQ5MDUsLTEyNS43MjM3NzhjMCwtNTYuMTg5NTg3IC00Ni41MTgxMTIsLTc3Ljc4NTUwNiAtODAuMjE0OTA1LC03Ny43ODU1MDZsMCwwem0tNzIuMTU5OTIsODIuNzQwMTcyYzM5LjI1Njg4OSwwIDY3LjYyMTIzOSwyOC4xMTgxNDEgNjcuNjIxMjM5LDcwLjI5NDM4Yy00MS4wNzE4ODQsMCAtNjcuNjIxMjM5LC0yNi45NjUyNzEgLTY3LjYyMTIzOSwtNzAuMjk0Mzh6bTE0NS42ODA2MTEsMGMwLDQzLjMyOTEwOSAtMjcuMDkzOTY0LDcwLjI5NDM4IC02OC45ODI5NzEsNzAuMjk0MzhjMCwtNDIuMTc2MjM5IDI4LjkzMjM4OCwtNzAuMjk0MzggNjguOTgyOTcxLC03MC4yOTQzOHoiIGZpbGw9IiNhYWJiYWEiIHN0cm9rZS13aWR0aD0iNCIvPgogIDwvZz4KIDwvZz4KIDxkZWZzPgogIDxmaWx0ZXIgaGVpZ2h0PSIyMDAlIiB3aWR0aD0iMjAwJSIgeT0iLTUwJSIgeD0iLTUwJSIgaWQ9ImFsaWVuX2JsdXIiPgogICA8ZmVHYXVzc2lhbkJsdXIgc3RkRGV2aWF0aW9uPSIxIi8+CiAgPC9maWx0ZXI+CiA8L2RlZnM+Cjwvc3ZnPg==&quot;&gt;&lt;/html&gt;

[[XENOS?|http://en.wikipedia.org/wiki/Xenos_vesparum]]</pre>
</div>
<div title="XML Centric Programming Model" modifier="Peter Hübel" created="200905191449" modified="201402121542" changecount="24">
<pre>The system model in XENO Server is expressed in XML.

The behaviour of an instance of XENO Server -- as well as the content it serves -- itself is defined in an XML document we call the ''[[blueprint|Blueprint]]''.

!!Implications of the Model on Programming
XML is (as the name implies) a Markup Language. That means for some information, e.g. a document, the text has been tagged with additional information about how the reader should interpret different parts of the document.


!!Tools you will need
Working with XENO Server requires nothing more than a good XML editor and a decent browser.

The Eclipse CDT has the possibility for installing the Eclipse Web Tools, which contain a very decent XML editor. Personally I use this for editing the blueprint while debugging in Eclipse.
</pre>
</div>
<div title="XSLTForms" modifier="YourName" created="200910032128" modified="200910082216" changecount="27">
<pre>XSLTForms allows common browsers to manipulate XForms. It is an open source client-side implementation of an XForms engine, not a plug-in or install, that works with all major browser (Internet Explorer, FireFox, Opera, Safari, Chrome and more).

The products home page is at http://www.agencexml.com/xsltforms, and is hosted at ~SourceForge.
&lt;html&gt;&lt;a href=&quot;http://sourceforge.net/projects/xsltforms/&quot;&gt;&lt;img src=&quot;http://sflogo.sourceforge.net/sflogo.php?group_id=242651&amp;type=12&quot;/&gt;&lt;/a&gt;&lt;/html&gt;

As part of the Netropy project we want to experiment more with [[XRX|http://en.wikipedia.org/wiki/XRX_(web_application_architecture)]] and have mounted the package from the XSLTForms project on this Netropy Server at &lt;html&gt;&lt;a href='/xsltforms/index.htm' class='tiddlyLink tiddlyLinkExisting' title='Opens the XSLTForms demo'&gt;/xsltforms&lt;/a&gt;&lt;/html&gt;.</pre>
</div>
<div title="netropy" modifier="Peter Hübel" created="201604210531" changecount="1">
<pre>''netropy'' is the name of the technology, on which &lt;&lt;tiddler xeno&gt;&gt; is built.

The name is a play on words, derived from the concept of [[entropy|http://en.wikipedia.org/wiki/Entropy]]. The concept of entropy has often been loosely associated with the amount of ''order'', ''disorder'', and/or ''chaos'' in a system.

From the Wikipedia entry about [[Information Theory|http://en.wikipedia.org/wiki/Information_theory]]:
&gt;A key measure of information in the theory is known as [[entropy|http://en.wikipedia.org/wiki/Entropy_(information_theory)]], which is usually expressed by the average number of bits needed for storage or communication.  Intuitively, entropy quantifies the uncertainty involved when encountering a [[random variable|http://en.wikipedia.org/wiki/Random_variable]]. For example, a fair coin flip (2 equally likely outcomes) will have less entropy than a roll of a die (6 equally likely outcomes).

Real life data are a lot more complex than that. As entropy increases steadily in our information society, we see and address the need for information to ''spread'' as fast and ''frictionless'' on the net as possible.

Controlling entropy - which in itself may be brought to good uses. This is the main design rationale behind &lt;&lt;tiddler xeno&gt;&gt;.
</pre>
</div>
<div title="netropy-macro" modifier="Peter Hübel" created="201205240005" modified="201604191837" tags="systemConfig" changecount="6">
<pre>// Don't know what will change when i change ''place'' to ''context''. iPhone? 
// FirstStep: Write the code or set a breakpoint in the script with a {{{debugger;}}} statement.
/*{{{*/
version.extensions.netropyMacro = {major: 0, minor: 1, revision: 0, date: new Date(2005,7,20)};
//Author: Alan Hecht
//Modified by Peter Hübel
config.macros.netropy = {}
config.macros.netropy.handler = function(context,macroName,params)
{
  debugger;
  var palette = [&quot;transparent&quot;,&quot;#000000&quot;,&quot;#1a1507&quot;,&quot;#352e18&quot;,&quot;#464646&quot;,&quot;#666666&quot;,&quot;#a3141e&quot;,&quot;#b06b63&quot;,&quot;#cc9900&quot;,&quot;#dd9030&quot;,&quot;#dddddd&quot;,&quot;#e89d00&quot;,&quot;#edc32a&quot;,&quot;#f3cb3c&quot;,&quot;#fdf201&quot;,&quot;#fdf526&quot;,&quot;#ff3149&quot;,&quot;#ffac00&quot;,&quot;#ffbf06&quot;,&quot;#ffc846&quot;,&quot;#ffcc66&quot;,&quot;#ffd758&quot;,&quot;#ffdd01&quot;,&quot;#ffea7b&quot;,&quot;#ffed55&quot;,&quot;#ffffff&quot;];
  var data = params;
  var imageMap = null;
  if(data[0] == &quot;:-)&quot; || data[0] == &quot;:)&quot;)

    imageMap = &quot;aaaaabbbbbaaaaaaaabdtyyvtdbaaaaabnyxxxxxujbaaabmyyffyffuujbaadyyyeeyeetttdabppppddyddpmmlbbwoooooooowsrlbbwwpooooowwmrlbbwwboooowwwbllbbwwwboooowbrllbacwwwbbbbbrllcaablswwwwsrrlibaaablsssrrllibaaaaabcrrlllcbaaaaaaaabbbbbaaaaa&quot;;
  else if(data[0] == &quot;:-(&quot; || data[0] == &quot;:(&quot;)
    imageMap = &quot;aaaaabbbbbaaaaaaaabdtyyvtdbaaaaabnyxxxxxujbaaabmyyyyyyyuujbaadyyyeeyeetttdabppppddyddpmmlbbwoooooooowsrlbbwwpooooowwmrlbbwwoooooowwrllbbwwwwbbbbbsrllbacwwbwwwwsbllcaablswwwwsrrlibaaablsssrrllibaaaaabcrrlllcbaaaaaaaabbbbbaaaaa&quot;;
  else if(data[0] == &quot;;-)&quot; || data[0] == &quot;;)&quot;)
    imageMap = &quot;aaaaabbbbbaaaaaaaabdtyyvtdbaaaaabnyxxxxxujbaaabmyyxxxxxuujbaadyyyxxxeetttdabppphddyddpmmlbbwoooooooowsrlbbwwpooooowwmrlbbwwboooowwwbllbbwwwboooowbrllbacwwwbbbbbrllcaablswwwwsrrlibaaablsssrrllibaaaaabcrrlllcbaaaaaaaabbbbbaaaaa&quot;;
  else if(data[0] == &quot;:-|&quot; || data[0] == &quot;:|&quot;)
    imageMap = &quot;aaaaabbbbbaaaaaaaabdtyyvtdbaaaaabnyxxxxxujbaaabmyyffyffuujbaadyyyeeyeetttdabppppddyddpmmlbbwoooooooowsrlbbwwpooooowwmrlbbwwoooooowwrllbbwwwwbbbbbsrllbacwwwwwwwsrllcaablswwwwsrrlibaaablsssrrllibaaaaabcrrlllcbaaaaaaaabbbbbaaaaa&quot;;
  else if(data[0] == &quot;:-D&quot; || data[0] == &quot;:D&quot;)
    imageMap = &quot;aaaaabbbbbaaaaaaaabdtyyvtdbaaaaabnyxxxxxujbaaabmyyeeyeeuujbaadyyyeeyeetttdabppppyyyyypmmlbbwbbbbbbbbbbblbbwbkzzzzzzzkbwbbwbfzzzzzzzfbwbbwbkzzzzzzzkbwbacwbkzzzzzkblcaablsbkzzzkblibaaablsbbbbblibaaaaabcrrlllcbaaaaaaaabbbbbaaaaa&quot;;
  else
    createTiddlyElement(place,&quot;span&quot;,null,&quot;errorNoSuchMacro&quot;,&quot;unknown netropy&quot;);
  if(imageMap)
    {
    var box = createTiddlyElement(place,&quot;span&quot;,null,&quot;netropy&quot;,String.fromCharCode(160));
    box.style.position = &quot;relative&quot;;
    box.style.width = &quot;15px&quot;;
    box.style.height = &quot;15px&quot;;
    box.style.marginLeft = &quot;1px&quot;;
    box.style.marginRight = &quot;1px&quot;;
    box.style.paddingRight = &quot;12px&quot;;
    box.style.verticalAlign = &quot;top&quot;;

    //now divide into 15x15 grid and create each pixel
    // rows
    for(r=0; r&lt;15; r++)
      {
      // columns
      for(c=0; c&lt;15; c++)
        {
        //create each pixel with the correct background
        var pix = document.createElement(&quot;img&quot;);
        pix.className = &quot;netropyPixel&quot;;
        pix.style.position = &quot;absolute&quot;;
        pix.border = 0;
        pix.style.top = r + &quot;px&quot;;
        pix.style.left = c + &quot;px&quot;;
        pix.style.width = &quot;1px&quot;;
        pix.style.height = &quot;1px&quot;;
        pix.style.backgroundColor = palette[imageMap.charCodeAt((r*15)+c)-97];
        pix.src = &quot;data:image/gif,GIF89a%01%00%01%00%91%FF%00%FF%FF%FF%00%00%00%C0%C0%C0%00%00%00!%F9%04%01%00%00%02%00%2C%00%00%00%00%01%00%01%00%40%02%02T%01%00%3B&quot;;
        box.appendChild(pix);
        }
      }
    }
}
/*}}}*/</pre>
</div>
<div title="smiley" modifier="Peter Hübel" created="200905101623" modified="201403132104" tags="systemConfig" changecount="5">
<pre>//Copied here by [[Peter Hübel]]
/*{{{*/
version.extensions.smileyMacro = {major: 0, minor: 1, revision: 0, date: new Date(2005,7,20)};
//Author: Alan Hecht
config.macros.smiley = {}
config.macros.smiley.handler = function(place,macroName,params)
{
  var palette = [&quot;transparent&quot;,&quot;#000000&quot;,&quot;#1a1507&quot;,&quot;#352e18&quot;,&quot;#464646&quot;,&quot;#666666&quot;,&quot;#a3141e&quot;,&quot;#b06b63&quot;,&quot;#cc9900&quot;,&quot;#dd9030&quot;,&quot;#dddddd&quot;,&quot;#e89d00&quot;,&quot;#edc32a&quot;,&quot;#f3cb3c&quot;,&quot;#fdf201&quot;,&quot;#fdf526&quot;,&quot;#ff3149&quot;,&quot;#ffac00&quot;,&quot;#ffbf06&quot;,&quot;#ffc846&quot;,&quot;#ffcc66&quot;,&quot;#ffd758&quot;,&quot;#ffdd01&quot;,&quot;#ffea7b&quot;,&quot;#ffed55&quot;,&quot;#ffffff&quot;];
  var data = params;
  var imageMap = null;
  if(data[0] == &quot;:-)&quot; || data[0] == &quot;:)&quot;)

    imageMap = &quot;aaaaabbbbbaaaaaaaabdtyyvtdbaaaaabnyxxxxxujbaaabmyyffyffuujbaadyyyeeyeetttdabppppddyddpmmlbbwoooooooowsrlbbwwpooooowwmrlbbwwboooowwwbllbbwwwboooowbrllbacwwwbbbbbrllcaablswwwwsrrlibaaablsssrrllibaaaaabcrrlllcbaaaaaaaabbbbbaaaaa&quot;;
  else if(data[0] == &quot;:-(&quot; || data[0] == &quot;:(&quot;)
    imageMap = &quot;aaaaabbbbbaaaaaaaabdtyyvtdbaaaaabnyxxxxxujbaaabmyyyyyyyuujbaadyyyeeyeetttdabppppddyddpmmlbbwoooooooowsrlbbwwpooooowwmrlbbwwoooooowwrllbbwwwwbbbbbsrllbacwwbwwwwsbllcaablswwwwsrrlibaaablsssrrllibaaaaabcrrlllcbaaaaaaaabbbbbaaaaa&quot;;
  else if(data[0] == &quot;;-)&quot; || data[0] == &quot;;)&quot;)
    imageMap = &quot;aaaaabbbbbaaaaaaaabdtyyvtdbaaaaabnyxxxxxujbaaabmyyxxxxxuujbaadyyyxxxeetttdabppphddyddpmmlbbwoooooooowsrlbbwwpooooowwmrlbbwwboooowwwbllbbwwwboooowbrllbacwwwbbbbbrllcaablswwwwsrrlibaaablsssrrllibaaaaabcrrlllcbaaaaaaaabbbbbaaaaa&quot;;
  else if(data[0] == &quot;:-|&quot; || data[0] == &quot;:|&quot;)
    imageMap = &quot;aaaaabbbbbaaaaaaaabdtyyvtdbaaaaabnyxxxxxujbaaabmyyffyffuujbaadyyyeeyeetttdabppppddyddpmmlbbwoooooooowsrlbbwwpooooowwmrlbbwwoooooowwrllbbwwwwbbbbbsrllbacwwwwwwwsrllcaablswwwwsrrlibaaablsssrrllibaaaaabcrrlllcbaaaaaaaabbbbbaaaaa&quot;;
  else if(data[0] == &quot;:-D&quot; || data[0] == &quot;:D&quot;)
    imageMap = &quot;aaaaabbbbbaaaaaaaabdtyyvtdbaaaaabnyxxxxxujbaaabmyyeeyeeuujbaadyyyeeyeetttdabppppyyyyypmmlbbwbbbbbbbbbbblbbwbkzzzzzzzkbwbbwbfzzzzzzzfbwbbwbkzzzzzzzkbwbacwbkzzzzzkblcaablsbkzzzkblibaaablsbbbbblibaaaaabcrrlllcbaaaaaaaabbbbbaaaaa&quot;;
  else
    createTiddlyElement(place,&quot;span&quot;,null,&quot;errorNoSuchMacro&quot;,&quot;unknown smiley&quot;);
  if(imageMap)
    {
    var box = createTiddlyElement(place,&quot;span&quot;,null,&quot;smiley&quot;,String.fromCharCode(160));
    box.style.position = &quot;relative&quot;;
    box.style.width = &quot;15px&quot;;
    box.style.height = &quot;15px&quot;;
    box.style.marginLeft = &quot;1px&quot;;
    box.style.marginRight = &quot;1px&quot;;
    box.style.paddingRight = &quot;12px&quot;;
    box.style.verticalAlign = &quot;top&quot;;

    //now divide into 15x15 grid and create each pixel
    // rows
    for(r=0; r&lt;15; r++)
      {
      // columns
      for(c=0; c&lt;15; c++)
        {
        //create each pixel with the correct background
        var pix = document.createElement(&quot;img&quot;);
        pix.className = &quot;smileyPixel&quot;;
        pix.style.position = &quot;absolute&quot;;
        pix.border = 0;
        pix.style.top = r + &quot;px&quot;;
        pix.style.left = c + &quot;px&quot;;
        pix.style.width = &quot;1px&quot;;
        pix.style.height = &quot;1px&quot;;
        pix.style.backgroundColor = palette[imageMap.charCodeAt((r*15)+c)-97];
        pix.src = &quot;data:image/gif,GIF89a%01%00%01%00%91%FF%00%FF%FF%FF%00%00%00%C0%C0%C0%00%00%00!%F9%04%01%00%00%02%00%2C%00%00%00%00%01%00%01%00%40%02%02T%01%00%3B&quot;;
        box.appendChild(pix);
        }
      }
    }
}
/*}}}*/</pre>
</div>
<div title="strXtrs" modifier="Peter Hübel" created="200903160943" modified="201205160113" changecount="42">
<pre>&lt;html&gt;&lt;a href=&quot;http://www.strxtrs.net&quot; style=&quot;text-decoration:none;&quot; target=&quot;_blank&quot;&gt;&lt;span style=&quot;font-family:Courier;font-weight:normal;font-size:18pt;color:white;background:#aba;padding:2px 7px 5px 5px;border: thin solid #898;&quot;&gt;str&amp;chi;trs&lt;/span&gt;&lt;/a&gt;&lt;/html&gt;</pre>
</div>
<div title="xeno" modifier="Peter Hübel" created="201402212241" modified="201604210539" changecount="4">
<pre>''~XENOmat''</pre>
</div>
<div title="xeno-alien" modifier="Peter Hübel" created="201404060836" modified="201404060857" changecount="11">
<pre>&lt;html&gt;
   &lt;alien&gt;
      &lt;div&gt;
        &lt;svg width=&quot;360&quot; height=&quot;240&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; xmlns:svg=&quot;http://www.w3.org/2000/svg&quot;&gt;
 &lt;defs&gt;
  &lt;filter id=&quot;xeno-alien-blur&quot;&gt;
   &lt;feGaussianBlur stdDeviation=&quot;0.1&quot;/&gt;
  &lt;/filter&gt;
 &lt;/defs&gt;
          &lt;g id=&quot;xeno-alien&quot; filter=&quot;url(#xeno-alien-blur)&quot;&gt;
            &lt;g id=&quot;xeno-alien-antlers&quot;&gt;
              &lt;path stroke=&quot;#66aaff&quot; fill=&quot;#ba8d73&quot; fill-rule=&quot;evenodd&quot; stroke-linejoin=&quot;round&quot; stroke-miterlimit=&quot;4&quot; d=&quot;m212.09698,84.10477c22.64282,-2.26989 34.0403,-7.13419 39.5,-11.49725c17.75421,-14.18803 11.32535,-27.35383 22,-24.43172c10.5,2.87432 10.47675,14.07931 17.5,17.24592c8.5,3.83243 -2.03711,-33.69453 6.5,-31.13846c8,2.39527 8.97186,21.40898 21,26.34793c10.5,4.31148 -6.60901,-44.63118 8,-34.01278c14.5,10.53917 35,52.69585 1,64.19315c-34,11.49728 -84.44667,14.83805 -101,14.3716c-17,-0.47906 -32.65988,-19.25781 -14.5,-21.07835l0,-0.00003l0,-0.00002l0,0.00001z&quot;/&gt;
              &lt;path stroke=&quot;#66aaff&quot; fill=&quot;#ad7e61&quot; fill-rule=&quot;evenodd&quot; stroke-linejoin=&quot;round&quot; stroke-miterlimit=&quot;4&quot; d=&quot;m149.5,84.10477c-22.64278,-2.26989 -34.04028,-7.13419 -39.49999,-11.49725c-17.75418,-14.18803 -11.32534,-27.35383 -22,-24.43172c-10.5,2.87432 -10.47673,14.07931 -17.50001,17.24592c-8.5,3.83243 2.03713,-33.69453 -6.5,-31.13846c-8,2.39527 -8.97184,21.40898 -21,26.34793c-10.5,4.31148 6.60903,-44.63118 -8,-34.01278c-14.5,10.53917 -35,52.69585 -1,64.19315c34,11.49728 84.44666,14.83805 101.00002,14.3716c17,-0.47906 32.65991,-19.25781 14.49998,-21.07835l0,-0.00003l0,-0.00002l0,0.00001z&quot;/&gt;
            &lt;/g&gt;
            &lt;ellipse id=&quot;xeno-alien-lid&quot; cx=&quot;185&quot; cy=&quot;100&quot; rx=&quot;70&quot; ry=&quot;50&quot; fill=&quot;#aba&quot; stroke-width=&quot;3&quot; stroke=&quot;black&quot;/&gt;
            &lt;path id=&quot;xeno-alien-scull&quot; stroke=&quot;#66aaff&quot; fill=&quot;#aabbaa&quot; d=&quot;m183.58014,22.41726c-33.69772,0 -80.21555,21.59592 -80.21555,77.78551c0,0.18468 0,0.39082 0,0.5755c0.38577,55.93592 56.4113,125.14828 80.21555,125.14828c23.89377,0 80.2149,-69.53418 80.2149,-125.72378c0,-56.18959 -46.51811,-77.78551 -80.2149,-77.78551l0,0zm-72.15992,82.74017c39.25689,0 67.62124,28.11814 67.62124,70.29438c-41.07188,0 -67.62124,-26.96527 -67.62124,-70.29438zm145.68061,0c0,43.32911 -27.09396,70.29438 -68.98299,70.29438c0,-42.17624 28.93237,-70.29438 68.98299,-70.29438z&quot;/&gt;
  &lt;g id=&quot;xeno-alien-cloud&quot; transform=&quot;rotate(-175, 183.781, 59.1591)&quot; filter=&quot;url(#xeno-alien-blur)&quot;&gt;
   &lt;path id=&quot;path2844&quot; d=&quot;m214.16611,33.88718c0,13.95767 -14.30699,25.27265 -31.95561,25.27265c-17.64862,0 -31.95558,-11.31499 -31.95558,-25.27265c0,-13.95769 14.30696,-25.27264 31.95558,-25.27264c17.64862,0 31.95561,11.31495 31.95561,25.27264z&quot; fill-rule=&quot;nonzero&quot; fill=&quot;#729fcf&quot;/&gt;
   &lt;path id=&quot;path2844-3&quot; d=&quot;m212.74486,34.75774c0,13.85592 -13.72656,25.08839 -30.6591,25.08839c-16.93256,0 -30.65912,-11.23248 -30.65912,-25.08839c0,-13.85591 13.72658,-25.08838 30.65912,-25.08838c16.93254,0 30.6591,11.23247 30.6591,25.08838z&quot; fill-rule=&quot;nonzero&quot; fill=&quot;#eeeeec&quot;/&gt;
   &lt;path id=&quot;path2844-9&quot; d=&quot;m215.4758,65.934c0,12.66261 -11.60977,22.92763 -25.9312,22.92763c-14.32143,0 -25.93118,-10.26501 -25.93118,-22.92763c0,-12.66266 11.60976,-22.92779 25.93118,-22.92779c14.32143,0 25.9312,10.26513 25.9312,22.92779z&quot; fill-rule=&quot;nonzero&quot; fill=&quot;#eeeeec&quot;/&gt;
   &lt;path id=&quot;path2844-5&quot; d=&quot;m235.90642,48.21708c0,12.66263 -11.60979,22.92778 -25.93115,22.92778c-14.3214,0 -25.93121,-10.26516 -25.93121,-22.92778c0,-12.66266 11.60982,-22.92772 25.93121,-22.92772c14.32137,0 25.93115,10.26506 25.93115,22.92772z&quot; fill-rule=&quot;nonzero&quot; fill=&quot;#729fcf&quot;/&gt;
   &lt;path id=&quot;path2844-11&quot; d=&quot;m178.28154,55.51225c0,12.66266 -11.60979,22.92772 -25.93118,22.92772c-14.32146,0 -25.93123,-10.26505 -25.93123,-22.92772c0,-12.66266 11.60977,-22.92777 25.93123,-22.92777c14.3214,0 25.93118,10.26511 25.93118,22.92777z&quot; fill-rule=&quot;nonzero&quot; fill=&quot;#729fcf&quot;/&gt;
   &lt;path id=&quot;path2844-11-1&quot; d=&quot;m180.79059,56.68127c0,12.66264 -11.89996,22.92769 -26.57947,22.92769c-14.67935,0 -26.57941,-10.26505 -26.57941,-22.92769c0,-12.66264 11.90005,-22.92778 26.57941,-22.92778c14.6795,0 26.57947,10.26514 26.57947,22.92778z&quot; fill-rule=&quot;nonzero&quot; fill=&quot;#eeeeec&quot;/&gt;
   &lt;path id=&quot;path2844-1&quot; d=&quot;m147.37369,75.57402c0,10.21645 -9.26437,18.49847 -20.6925,18.49847c-11.42827,0 -20.6926,-8.28202 -20.6926,-18.49847c0,-10.21644 9.26431,-18.49849 20.6926,-18.49849c11.42815,0 20.6925,8.28205 20.6925,18.49849z&quot; fill-rule=&quot;nonzero&quot; fill=&quot;#729fcf&quot;/&gt;
   &lt;path id=&quot;path2844-1-76&quot; d=&quot;m147.95515,76.01443c0,9.59975 -9.09853,17.38191 -20.32208,17.38191c-11.22359,0 -20.32215,-7.78217 -20.32215,-17.38191c0,-9.59987 9.09856,-17.38203 20.32215,-17.38203c11.22356,0 20.32208,7.78217 20.32208,17.38203z&quot; fill-rule=&quot;nonzero&quot; fill=&quot;#eeeeec&quot;/&gt;
   &lt;path id=&quot;path2844-5-4&quot; d=&quot;m236.35464,50.41742c0,13.27312 -11.81717,24.0331 -26.39427,24.0331c-14.57715,0 -26.39421,-10.75996 -26.39421,-24.0331c0,-13.27314 11.81706,-24.03315 26.39421,-24.03315c14.5771,0 26.39427,10.76001 26.39427,24.03315z&quot; fill-rule=&quot;nonzero&quot; fill=&quot;#eeeeec&quot;/&gt;
   &lt;path id=&quot;path2844-2&quot; d=&quot;m261.57568,56.03331c0,12.66272 -11.60979,22.92778 -25.93118,22.92778c-14.32141,0 -25.93118,-10.26507 -25.93118,-22.92778c0,-12.66258 11.60977,-22.92772 25.93118,-22.92772c14.3214,0 25.93118,10.26514 25.93118,22.92772z&quot; fill-rule=&quot;nonzero&quot; fill=&quot;#729fcf&quot;/&gt;
   &lt;path id=&quot;path2844-2-2&quot; d=&quot;m260.80273,55.94434c0,11.95045 -11.69267,21.63804 -26.11636,21.63804c-14.42369,0 -26.11642,-9.68758 -26.11642,-21.63804c0,-11.9504 11.69273,-21.63815 26.11642,-21.63815c14.42369,0 26.11636,9.68777 26.11636,21.63815z&quot; fill-rule=&quot;nonzero&quot; fill=&quot;#eeeeec&quot;/&gt;
   &lt;path id=&quot;path2844-1-7&quot; d=&quot;m148.94524,90.42492c0,6.76295 -5.39445,12.24546 -12.04884,12.24546c-6.65434,0 -12.04882,-5.48253 -12.04882,-12.24546c0,-6.76307 5.39448,-12.24554 12.04882,-12.24554c6.65439,0 12.04884,5.48246 12.04884,12.24554z&quot; fill-rule=&quot;nonzero&quot; fill=&quot;#729fcf&quot;/&gt;
   &lt;path id=&quot;path2844-1-7-2&quot; d=&quot;m149.31294,89.65868c0,6.66121 -5.31154,12.06121 -11.86362,12.06121c-6.55203,0 -11.86359,-5.4 -11.86359,-12.06121c0,-6.66116 5.31154,-12.06132 11.86359,-12.06132c6.55206,0 11.86362,5.40015 11.86362,12.06132z&quot; fill-rule=&quot;nonzero&quot; fill=&quot;#eeeeec&quot;/&gt;
   &lt;path id=&quot;path2844-4&quot; d=&quot;m192.94972,86.77734c0,12.6627 -11.60977,22.92775 -25.93123,22.92775c-14.32141,0 -25.93117,-10.26505 -25.93117,-22.92775c0,-12.66265 11.60976,-22.92769 25.93117,-22.92769c14.32146,0 25.93123,10.26504 25.93123,22.92769z&quot; fill-rule=&quot;nonzero&quot; fill=&quot;#729fcf&quot;/&gt;
   &lt;path id=&quot;path2844-4-2&quot; d=&quot;m193.09142,86.18201c0,12.39523 -11.33678,22.44341 -25.32135,22.44341c-13.98454,0 -25.32129,-10.04817 -25.32129,-22.44341c0,-12.3952 11.33675,-22.44352 25.32129,-22.44352c13.9846,0 25.32135,10.04832 25.32135,22.44352z&quot; fill-rule=&quot;nonzero&quot; fill=&quot;#eeeeec&quot; stroke-width=&quot;9&quot;/&gt;
   &lt;path id=&quot;path2844-8&quot; d=&quot;m250.05074,76.35563c0,12.66267 -11.6098,22.92787 -25.9312,22.92787c-14.32144,0 -25.93118,-10.2652 -25.93118,-22.92787c0,-12.66262 11.60976,-22.9277 25.93118,-22.9277c14.3214,0 25.9312,10.26507 25.9312,22.9277z&quot; fill-rule=&quot;nonzero&quot; fill=&quot;#729fcf&quot;/&gt;
   &lt;path id=&quot;path2844-8-1&quot; d=&quot;m248.67133,76.0716c0,12.17935 -11.63055,22.05274 -25.97752,22.05274c-14.34702,0 -25.97751,-9.87339 -25.97751,-22.05274c0,-12.17928 11.63049,-22.05262 25.97751,-22.05262c14.34697,0 25.97752,9.87333 25.97752,22.05262z&quot; fill-rule=&quot;nonzero&quot; fill=&quot;#eeeeec&quot;/&gt;
   &lt;path id=&quot;path2844-1-7-6&quot; d=&quot;m199.81541,105.18665c-8.26813,1.36013 -16.07886,-3.92541 -17.44579,-11.80544c-1.36694,-7.88001 4.22757,-15.37059 12.49565,-16.73054c8.2681,-1.36009 16.07883,3.9254 17.44579,11.80544c1.36697,7.88004 -4.22752,15.37053 -12.49565,16.73055z&quot; fill-rule=&quot;nonzero&quot; fill=&quot;#729fcf&quot;/&gt;
   &lt;path id=&quot;path2844-1-7-6-5&quot; d=&quot;m200.13701,103.74516c-8.12935,1.36001 -15.80901,-3.92554 -17.15297,-11.80546c-1.34404,-7.88001 4.15659,-15.37065 12.28595,-16.73066c8.12936,-1.36008 15.80902,3.92541 17.15306,11.80556c1.34399,7.87991 -4.15666,15.3704 -12.28603,16.73056l-0.00003,0l0.00002,0z&quot; fill-rule=&quot;nonzero&quot; fill=&quot;#eeeeec&quot;/&gt;
  &lt;/g&gt;
          &lt;/g&gt;
        &lt;/svg&gt;
      &lt;/div&gt;
      &lt;p&gt;Lost? Try the &lt;a href=&quot;/leutert/overview&quot;&gt;overview&lt;/a&gt;!&lt;/p&gt;
      &lt;script type=&quot;text/javascript&quot;&gt;//&lt;![CDATA[
(function(window){
  var alien_lid = window.document.getElementById('xeno-alien-lid');
  function blink(lid, pos, min, max, delta) {
    pos += delta;
    if (pos &lt; min) {
      pos = min; delta = -delta;
    }
    else if (pos &gt; max) {
      pos = max; delta = -delta;
    }
    lid.setAttribute('ry', pos);
    window.setTimeout(blink, 100, lid, pos, min, max, delta);
  };
window.setTimeout(blink, 100, alien_lid, 10, 10, 70, 5);
})(window);
///]]&gt;&lt;/script&gt;
    &lt;/alien&gt;
&lt;/html&gt;</pre>
</div>
<div title="xenoma.svg" modifier="Peter Hübel" created="201402051526" modified="201404060829" changecount="13">
<pre>&lt;html&gt;&lt;svg width=&quot;360&quot; height=&quot;240&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot;&gt;
 &lt;defs&gt;
  &lt;filter id=&quot;alien_blur&quot;&gt;
   &lt;feGaussianBlur stdDeviation=&quot;0.1&quot;/&gt;
  &lt;/filter&gt;
 &lt;/defs&gt;
 &lt;g&gt;
  &lt;title&gt;xenome&lt;/title&gt;
  &lt;g id=&quot;alien&quot;&gt;
   &lt;g filter=&quot;url(#alien_blur)&quot; id=&quot;antlers&quot;&gt;
    &lt;path stroke=&quot;#66aaff&quot; fill=&quot;#ba8d73&quot; fill-rule=&quot;evenodd&quot; stroke-linejoin=&quot;round&quot; stroke-miterlimit=&quot;4&quot; d=&quot;m212.09698,84.10477c22.64282,-2.26989 34.0403,-7.13419 39.5,-11.49725c17.75421,-14.18803 11.32535,-27.35383 22,-24.43172c10.5,2.87432 10.47675,14.07931 17.5,17.24592c8.5,3.83243 -2.03711,-33.69453 6.5,-31.13846c8,2.39527 8.97186,21.40898 21,26.34793c10.5,4.31148 -6.60901,-44.63118 8,-34.01278c14.5,10.53917 35,52.69585 1,64.19315c-34,11.49728 -84.44667,14.83805 -101,14.3716c-17,-0.47906 -32.65988,-19.25781 -14.5,-21.07835l0,-0.00003l0,-0.00002l0,0.00001z&quot; id=&quot;svg_1&quot;/&gt;
    &lt;path stroke=&quot;#66aaff&quot; fill=&quot;#ad7e61&quot; fill-rule=&quot;evenodd&quot; stroke-linejoin=&quot;round&quot; stroke-miterlimit=&quot;4&quot; d=&quot;m149.5,84.10477c-22.64278,-2.26989 -34.04028,-7.13419 -39.49999,-11.49725c-17.75418,-14.18803 -11.32534,-27.35383 -22,-24.43172c-10.5,2.87432 -10.47673,14.07931 -17.50001,17.24592c-8.5,3.83243 2.03713,-33.69453 -6.5,-31.13846c-8,2.39527 -8.97184,21.40898 -21,26.34793c-10.5,4.31148 6.60903,-44.63118 -8,-34.01278c-14.5,10.53917 -35,52.69585 -1,64.19315c34,11.49728 84.44666,14.83805 101.00002,14.3716c17,-0.47906 32.65991,-19.25781 14.49998,-21.07835l0,-0.00003l0,-0.00002l0,0.00001z&quot; id=&quot;svg_2&quot;/&gt;
   &lt;/g&gt;
   &lt;path id=&quot;scull&quot; stroke=&quot;#66aaff&quot; fill=&quot;#aabbaa&quot; d=&quot;m183.58014,22.41726c-33.69772,0 -80.21555,21.59592 -80.21555,77.78551c0,0.18468 0,0.39082 0,0.5755c0.38577,55.93592 56.4113,125.14828 80.21555,125.14828c23.89377,0 80.2149,-69.53418 80.2149,-125.72378c0,-56.18959 -46.51811,-77.78551 -80.2149,-77.78551l0,0zm-72.15992,82.74017c39.25689,0 67.62124,28.11814 67.62124,70.29438c-41.07188,0 -67.62124,-26.96527 -67.62124,-70.29438zm145.68061,0c0,43.32911 -27.09396,70.29438 -68.98299,70.29438c0,-42.17624 28.93237,-70.29438 68.98299,-70.29438z&quot;/&gt;
  &lt;/g&gt;
  &lt;g transform=&quot;rotate(-175, 183.781, 59.1591)&quot; filter=&quot;url(#alien_blur)&quot; id=&quot;cloud&quot;&gt;
   &lt;path id=&quot;path2844&quot; d=&quot;m214.16611,33.88718c0,13.95767 -14.30699,25.27265 -31.95561,25.27265c-17.64862,0 -31.95558,-11.31499 -31.95558,-25.27265c0,-13.95769 14.30696,-25.27264 31.95558,-25.27264c17.64862,0 31.95561,11.31495 31.95561,25.27264z&quot; fill-rule=&quot;nonzero&quot; fill=&quot;#729fcf&quot;/&gt;
   &lt;path id=&quot;path2844-3&quot; d=&quot;m212.74486,34.75774c0,13.85592 -13.72656,25.08839 -30.6591,25.08839c-16.93256,0 -30.65912,-11.23248 -30.65912,-25.08839c0,-13.85591 13.72658,-25.08838 30.65912,-25.08838c16.93254,0 30.6591,11.23247 30.6591,25.08838z&quot; fill-rule=&quot;nonzero&quot; fill=&quot;#eeeeec&quot;/&gt;
   &lt;path id=&quot;path2844-9&quot; d=&quot;m215.4758,65.934c0,12.66261 -11.60977,22.92763 -25.9312,22.92763c-14.32143,0 -25.93118,-10.26501 -25.93118,-22.92763c0,-12.66266 11.60976,-22.92779 25.93118,-22.92779c14.32143,0 25.9312,10.26513 25.9312,22.92779z&quot; fill-rule=&quot;nonzero&quot; fill=&quot;#eeeeec&quot;/&gt;
   &lt;path id=&quot;path2844-5&quot; d=&quot;m235.90642,48.21708c0,12.66263 -11.60979,22.92778 -25.93115,22.92778c-14.3214,0 -25.93121,-10.26516 -25.93121,-22.92778c0,-12.66266 11.60982,-22.92772 25.93121,-22.92772c14.32137,0 25.93115,10.26506 25.93115,22.92772z&quot; fill-rule=&quot;nonzero&quot; fill=&quot;#729fcf&quot;/&gt;
   &lt;path id=&quot;path2844-11&quot; d=&quot;m178.28154,55.51225c0,12.66266 -11.60979,22.92772 -25.93118,22.92772c-14.32146,0 -25.93123,-10.26505 -25.93123,-22.92772c0,-12.66266 11.60977,-22.92777 25.93123,-22.92777c14.3214,0 25.93118,10.26511 25.93118,22.92777z&quot; fill-rule=&quot;nonzero&quot; fill=&quot;#729fcf&quot;/&gt;
   &lt;path id=&quot;path2844-11-1&quot; d=&quot;m180.79059,56.68127c0,12.66264 -11.89996,22.92769 -26.57947,22.92769c-14.67935,0 -26.57941,-10.26505 -26.57941,-22.92769c0,-12.66264 11.90005,-22.92778 26.57941,-22.92778c14.6795,0 26.57947,10.26514 26.57947,22.92778z&quot; fill-rule=&quot;nonzero&quot; fill=&quot;#eeeeec&quot;/&gt;
   &lt;path id=&quot;path2844-1&quot; d=&quot;m147.37369,75.57402c0,10.21645 -9.26437,18.49847 -20.6925,18.49847c-11.42827,0 -20.6926,-8.28202 -20.6926,-18.49847c0,-10.21644 9.26431,-18.49849 20.6926,-18.49849c11.42815,0 20.6925,8.28205 20.6925,18.49849z&quot; fill-rule=&quot;nonzero&quot; fill=&quot;#729fcf&quot;/&gt;
   &lt;path id=&quot;path2844-1-76&quot; d=&quot;m147.95515,76.01443c0,9.59975 -9.09853,17.38191 -20.32208,17.38191c-11.22359,0 -20.32215,-7.78217 -20.32215,-17.38191c0,-9.59987 9.09856,-17.38203 20.32215,-17.38203c11.22356,0 20.32208,7.78217 20.32208,17.38203z&quot; fill-rule=&quot;nonzero&quot; fill=&quot;#eeeeec&quot;/&gt;
   &lt;path id=&quot;path2844-5-4&quot; d=&quot;m236.35464,50.41742c0,13.27312 -11.81717,24.0331 -26.39427,24.0331c-14.57715,0 -26.39421,-10.75996 -26.39421,-24.0331c0,-13.27314 11.81706,-24.03315 26.39421,-24.03315c14.5771,0 26.39427,10.76001 26.39427,24.03315z&quot; fill-rule=&quot;nonzero&quot; fill=&quot;#eeeeec&quot;/&gt;
   &lt;path id=&quot;path2844-2&quot; d=&quot;m261.57568,56.03331c0,12.66272 -11.60979,22.92778 -25.93118,22.92778c-14.32141,0 -25.93118,-10.26507 -25.93118,-22.92778c0,-12.66258 11.60977,-22.92772 25.93118,-22.92772c14.3214,0 25.93118,10.26514 25.93118,22.92772z&quot; fill-rule=&quot;nonzero&quot; fill=&quot;#729fcf&quot;/&gt;
   &lt;path id=&quot;path2844-2-2&quot; d=&quot;m260.80273,55.94434c0,11.95045 -11.69267,21.63804 -26.11636,21.63804c-14.42369,0 -26.11642,-9.68758 -26.11642,-21.63804c0,-11.9504 11.69273,-21.63815 26.11642,-21.63815c14.42369,0 26.11636,9.68777 26.11636,21.63815z&quot; fill-rule=&quot;nonzero&quot; fill=&quot;#eeeeec&quot;/&gt;
   &lt;path id=&quot;path2844-1-7&quot; d=&quot;m148.94524,90.42492c0,6.76295 -5.39445,12.24546 -12.04884,12.24546c-6.65434,0 -12.04882,-5.48253 -12.04882,-12.24546c0,-6.76307 5.39448,-12.24554 12.04882,-12.24554c6.65439,0 12.04884,5.48246 12.04884,12.24554z&quot; fill-rule=&quot;nonzero&quot; fill=&quot;#729fcf&quot;/&gt;
   &lt;path id=&quot;path2844-1-7-2&quot; d=&quot;m149.31294,89.65868c0,6.66121 -5.31154,12.06121 -11.86362,12.06121c-6.55203,0 -11.86359,-5.4 -11.86359,-12.06121c0,-6.66116 5.31154,-12.06132 11.86359,-12.06132c6.55206,0 11.86362,5.40015 11.86362,12.06132z&quot; fill-rule=&quot;nonzero&quot; fill=&quot;#eeeeec&quot;/&gt;
   &lt;path id=&quot;path2844-4&quot; d=&quot;m192.94972,86.77734c0,12.6627 -11.60977,22.92775 -25.93123,22.92775c-14.32141,0 -25.93117,-10.26505 -25.93117,-22.92775c0,-12.66265 11.60976,-22.92769 25.93117,-22.92769c14.32146,0 25.93123,10.26504 25.93123,22.92769z&quot; fill-rule=&quot;nonzero&quot; fill=&quot;#729fcf&quot;/&gt;
   &lt;path id=&quot;path2844-4-2&quot; d=&quot;m193.09142,86.18201c0,12.39523 -11.33678,22.44341 -25.32135,22.44341c-13.98454,0 -25.32129,-10.04817 -25.32129,-22.44341c0,-12.3952 11.33675,-22.44352 25.32129,-22.44352c13.9846,0 25.32135,10.04832 25.32135,22.44352z&quot; fill-rule=&quot;nonzero&quot; fill=&quot;#eeeeec&quot; stroke-width=&quot;9&quot;/&gt;
   &lt;path id=&quot;path2844-8&quot; d=&quot;m250.05074,76.35563c0,12.66267 -11.6098,22.92787 -25.9312,22.92787c-14.32144,0 -25.93118,-10.2652 -25.93118,-22.92787c0,-12.66262 11.60976,-22.9277 25.93118,-22.9277c14.3214,0 25.9312,10.26507 25.9312,22.9277z&quot; fill-rule=&quot;nonzero&quot; fill=&quot;#729fcf&quot;/&gt;
   &lt;path id=&quot;path2844-8-1&quot; d=&quot;m248.67133,76.0716c0,12.17935 -11.63055,22.05274 -25.97752,22.05274c-14.34702,0 -25.97751,-9.87339 -25.97751,-22.05274c0,-12.17928 11.63049,-22.05262 25.97751,-22.05262c14.34697,0 25.97752,9.87333 25.97752,22.05262z&quot; fill-rule=&quot;nonzero&quot; fill=&quot;#eeeeec&quot;/&gt;
   &lt;path id=&quot;path2844-1-7-6&quot; d=&quot;m199.81541,105.18665c-8.26813,1.36013 -16.07886,-3.92541 -17.44579,-11.80544c-1.36694,-7.88001 4.22757,-15.37059 12.49565,-16.73054c8.2681,-1.36009 16.07883,3.9254 17.44579,11.80544c1.36697,7.88004 -4.22752,15.37053 -12.49565,16.73055z&quot; fill-rule=&quot;nonzero&quot; fill=&quot;#729fcf&quot;/&gt;
   &lt;path id=&quot;path2844-1-7-6-5&quot; d=&quot;m200.13701,103.74516c-8.12935,1.36001 -15.80901,-3.92554 -17.15297,-11.80546c-1.34404,-7.88001 4.15659,-15.37065 12.28595,-16.73066c8.12936,-1.36008 15.80902,3.92541 17.15306,11.80556c1.34399,7.87991 -4.15666,15.3704 -12.28603,16.73056l-0.00003,0l0.00002,0z&quot; fill-rule=&quot;nonzero&quot; fill=&quot;#eeeeec&quot;/&gt;
  &lt;/g&gt;
 &lt;/g&gt;
&lt;/svg&gt;&lt;/html&gt;</pre>
</div>
</div>
<!--POST-STOREAREA-->
<!--POST-BODY-START-->
<!--POST-BODY-END-->
<script id="jsArea" type="text/javascript">
//<![CDATA[
//
// Please note:
//
// * This code is designed to be readable but for compactness it only includes brief comments. You can see fuller comments
//   in the project Subversion repository at http://svn.tiddlywiki.org/Trunk/core/
//
// * You should never need to modify this source code directly. TiddlyWiki is carefully designed to allow deep customisation
//   without changing the core code. Please consult the development group at http://groups.google.com/group/TiddlyWikiDev
//

//--
//-- Configuration repository
//--

// Miscellaneous options
var config = {
  numRssItems: 20, // Number of items in the RSS feed
  animDuration: 400, // Duration of UI animations in milliseconds
  cascadeFast: 20, // Speed for cascade animations (higher == slower)
  cascadeSlow: 60, // Speed for EasterEgg cascade animations
  cascadeDepth: 5, // Depth of cascade animation
  locale: "en" // W3C language tag
};

// Hashmap of alternative parsers for the wikifier
config.parsers = {};

// Adaptors
config.adaptors = {};
config.defaultAdaptor = null;

// Backstage tasks
config.tasks = {};

// Annotations
config.annotations = {};

// Custom fields to be automatically added to new tiddlers
config.defaultCustomFields = {};

// Messages
config.messages = {
  messageClose: {},
  dates: {},
  tiddlerPopup: {}
};

// Options that can be set in the options panel and/or cookies
config.options = {
  chkRegExpSearch: false,
  chkCaseSensitiveSearch: false,
  chkIncrementalSearch: true,
  chkAnimate: true,
  chkSaveBackups: true,
  chkAutoSave: false,
  chkGenerateAnRssFeed: false,
  chkSaveEmptyTemplate: false,
  chkOpenInNewWindow: true,
  chkToggleLinks: false,
  chkHttpReadOnly: true,
  chkForceMinorUpdate: false,
  chkConfirmDelete: true,
  chkInsertTabs: false,
  chkUsePreForStorage: true, // Whether to use <pre> format for storage
  chkDisplayInstrumentation: false,
  txtBackupFolder: "",
  txtEditorFocus: "text",
  txtMainTab: "tabTimeline",
  txtMoreTab: "moreTabAll",
  txtMaxEditRows: "30",
  txtFileSystemCharSet: "UTF-8",
  txtTheme: ""
  };
config.optionsDesc = {};

// Default tiddler templates
var DEFAULT_VIEW_TEMPLATE = 1;
var DEFAULT_EDIT_TEMPLATE = 2;
config.tiddlerTemplates = {
  1: "ViewTemplate",
  2: "EditTemplate"
};

// More messages (rather a legacy layout that should not really be like this)
config.views = {
  wikified: {
    tag: {}
  },
  editor: {
    tagChooser: {}
  }
};

// Backstage tasks
config.backstageTasks = ["save","sync","importTask","tweak","upgrade","plugins"];

// Extensions
config.extensions = {};

// Macros; each has a 'handler' member that is inserted later
config.macros = {
  today: {},
  version: {},
  search: {sizeTextbox: 15},
  tiddler: {},
  tag: {},
  tags: {},
  tagging: {},
  timeline: {},
  allTags: {},
  list: {
    all: {},
    missing: {},
    orphans: {},
    shadowed: {},
    touched: {},
    filter: {}
  },
  closeAll: {},
  permaview: {},
  saveChanges: {},
  slider: {},
  option: {},
  options: {},
  newTiddler: {},
  newJournal: {},
  tabs: {},
  gradient: {},
  message: {},
  view: {defaultView: "text"},
  edit: {},
  tagChooser: {},
  toolbar: {},
  plugins: {},
  refreshDisplay: {},
  importTiddlers: {},
  upgrade: {
    source: "http://www.tiddlywiki.com/upgrade/",
    backupExtension: "pre.core.upgrade"
  },
  sync: {},
  annotations: {}
};

// Commands supported by the toolbar macro
config.commands = {
  closeTiddler: {},
  closeOthers: {},
  editTiddler: {},
  saveTiddler: {hideReadOnly: true},
  cancelTiddler: {},
  deleteTiddler: {hideReadOnly: true},
  permalink: {},
  references: {type: "popup"},
  jump: {type: "popup"},
  syncing: {type: "popup"},
  fields: {type: "popup"}
};

// Browser detection... In a very few places, there's nothing else for it but to know what browser we're using.
config.userAgent = navigator.userAgent.toLowerCase();
config.browser = {
  isIE: config.userAgent.indexOf("msie") != -1 && config.userAgent.indexOf("opera") == -1,
  isGecko: config.userAgent.indexOf("gecko") != -1,
  ieVersion: /MSIE (\d.\d)/i.exec(config.userAgent), // config.browser.ieVersion[1], if it exists, will be the IE version string, eg "6.0"
  isSafari: config.userAgent.indexOf("applewebkit") != -1,
  isBadSafari: !((new RegExp("[\u0150\u0170]","g")).test("\u0150")),
  firefoxDate: /gecko\/(\d{8})/i.exec(config.userAgent), // config.browser.firefoxDate[1], if it exists, will be Firefox release date as "YYYYMMDD"
  isOpera: config.userAgent.indexOf("opera") != -1,
  isLinux: config.userAgent.indexOf("linux") != -1,
  isUnix: config.userAgent.indexOf("x11") != -1,
  isMac: config.userAgent.indexOf("mac") != -1,
  isWindows: config.userAgent.indexOf("win") != -1
};

// Basic regular expressions
config.textPrimitives = {
  upperLetter: "[A-Z\u00c0-\u00de\u0150\u0170]",
  lowerLetter: "[a-z0-9_\\-\u00df-\u00ff\u0151\u0171]",
  anyLetter:   "[A-Za-z0-9_\\-\u00c0-\u00de\u00df-\u00ff\u0150\u0170\u0151\u0171]",
  anyLetterStrict: "[A-Za-z0-9\u00c0-\u00de\u00df-\u00ff\u0150\u0170\u0151\u0171]"
};
if(config.browser.isBadSafari) {
  config.textPrimitives = {
    upperLetter: "[A-Z\u00c0-\u00de]",
    lowerLetter: "[a-z0-9_\\-\u00df-\u00ff]",
    anyLetter:   "[A-Za-z0-9_\\-\u00c0-\u00de\u00df-\u00ff]",
    anyLetterStrict: "[A-Za-z0-9\u00c0-\u00de\u00df-\u00ff]"
  };
}
config.textPrimitives.sliceSeparator = "::";
config.textPrimitives.sectionSeparator = "##";
config.textPrimitives.urlPattern = "(?:file|http|https|mailto|ftp|irc|news|data):[^\\s'\"]+(?:/|\\b)";
config.textPrimitives.unWikiLink = "~";
config.textPrimitives.wikiLink = "(?:(?:" + config.textPrimitives.upperLetter + "+" +
  config.textPrimitives.lowerLetter + "+" +
  config.textPrimitives.upperLetter +
  config.textPrimitives.anyLetter + "*)|(?:" +
  config.textPrimitives.upperLetter + "{2,}" +
  config.textPrimitives.lowerLetter + "+))";

config.textPrimitives.cssLookahead = "(?:(" + config.textPrimitives.anyLetter + "+)\\(([^\\)\\|\\n]+)(?:\\):))|(?:(" + config.textPrimitives.anyLetter + "+):([^;\\|\\n]+);)";
config.textPrimitives.cssLookaheadRegExp = new RegExp(config.textPrimitives.cssLookahead,"mg");

config.textPrimitives.brackettedLink = "\\[\\[([^\\]]+)\\]\\]";
config.textPrimitives.titledBrackettedLink = "\\[\\[([^\\[\\]\\|]+)\\|([^\\[\\]\\|]+)\\]\\]";
config.textPrimitives.tiddlerForcedLinkRegExp = new RegExp("(?:" + config.textPrimitives.titledBrackettedLink + ")|(?:" +
  config.textPrimitives.brackettedLink + ")|(?:" +
  config.textPrimitives.urlPattern + ")","mg");
config.textPrimitives.tiddlerAnyLinkRegExp = new RegExp("("+ config.textPrimitives.wikiLink + ")|(?:" +
  config.textPrimitives.titledBrackettedLink + ")|(?:" +
  config.textPrimitives.brackettedLink + ")|(?:" +
  config.textPrimitives.urlPattern + ")","mg");

config.glyphs = {
  browsers: [
    function() {return config.browser.isIE;},
    function() {return true;}
  ],
  currBrowser: null,
  codes: {
    downTriangle: ["\u25BC","\u25BE"],
    downArrow: ["\u2193","\u2193"],
    bentArrowLeft: ["\u2190","\u21A9"],
    bentArrowRight: ["\u2192","\u21AA"]
  }
};

//--
//-- Shadow tiddlers
//--

config.shadowTiddlers = {
  StyleSheet: "",
  MarkupPreHead: "",
  MarkupPostHead: "",
  MarkupPreBody: "",
  MarkupPostBody: "",
  TabTimeline: '<<timeline>>',
  TabAll: '<<list all>>',
  TabTags: '<<allTags excludeLists>>',
  TabMoreMissing: '<<list missing>>',
  TabMoreOrphans: '<<list orphans>>',
  TabMoreShadowed: '<<list shadowed>>',
  AdvancedOptions: '<<options>>',
  PluginManager: '<<plugins>>',
  ToolbarCommands: '|~ViewToolbar|closeTiddler closeOthers +editTiddler > fields syncing permalink references jump|\n|~EditToolbar|+saveTiddler -cancelTiddler deleteTiddler|'
};

//--
//-- Translateable strings
//--

// Strings in "double quotes" should be translated; strings in 'single quotes' should be left alone

merge(config.options,{
  txtUserName: "YourName"});

merge(config.tasks,{
  save: {text: "save", tooltip: "Save your changes to this TiddlyWiki", action: saveChanges},
  sync: {text: "sync", tooltip: "Synchronise changes with other TiddlyWiki files and servers", content: '<<sync>>'},
  importTask: {text: "import", tooltip: "Import tiddlers and plugins from other TiddlyWiki files and servers", content: '<<importTiddlers>>'},
  tweak: {text: "tweak", tooltip: "Tweak the appearance and behaviour of TiddlyWiki", content: '<<options>>'},
  upgrade: {text: "upgrade", tooltip: "Upgrade TiddlyWiki core code", content: '<<upgrade>>'},
  plugins: {text: "plugins", tooltip: "Manage installed plugins", content: '<<plugins>>'}
});

// Options that can be set in the options panel and/or cookies
merge(config.optionsDesc,{
  txtUserName: "Username for signing your edits",
  chkRegExpSearch: "Enable regular expressions for searches",
  chkCaseSensitiveSearch: "Case-sensitive searching",
  chkIncrementalSearch: "Incremental key-by-key searching",
  chkAnimate: "Enable animations",
  chkSaveBackups: "Keep backup file when saving changes",
  chkAutoSave: "Automatically save changes",
  chkGenerateAnRssFeed: "Generate an RSS feed when saving changes",
  chkSaveEmptyTemplate: "Generate an empty template when saving changes",
  chkOpenInNewWindow: "Open external links in a new window",
  chkToggleLinks: "Clicking on links to open tiddlers causes them to close",
  chkHttpReadOnly: "Hide editing features when viewed over HTTP",
  chkForceMinorUpdate: "Don't update modifier username and date when editing tiddlers",
  chkConfirmDelete: "Require confirmation before deleting tiddlers",
  chkInsertTabs: "Use the tab key to insert tab characters instead of moving between fields",
  txtBackupFolder: "Name of folder to use for backups",
  txtMaxEditRows: "Maximum number of rows in edit boxes",
  txtTheme: "Name of the theme to use",
  txtFileSystemCharSet: "Default character set for saving changes (Firefox/Mozilla only)"});

merge(config.messages,{
  customConfigError: "Problems were encountered loading plugins. See PluginManager for details",
  pluginError: "Error: %0",
  pluginDisabled: "Not executed because disabled via 'systemConfigDisable' tag",
  pluginForced: "Executed because forced via 'systemConfigForce' tag",
  pluginVersionError: "Not executed because this plugin needs a newer version of TiddlyWiki",
  nothingSelected: "Nothing is selected. You must select one or more items first",
  savedSnapshotError: "It appears that this TiddlyWiki has been incorrectly saved. Please see http://www.tiddlywiki.com/#Download for details",
  subtitleUnknown: "(unknown)",
  undefinedTiddlerToolTip: "The tiddler '%0' doesn't yet exist",
  shadowedTiddlerToolTip: "The tiddler '%0' doesn't yet exist, but has a pre-defined shadow value",
  tiddlerLinkTooltip: "%0 - %1, %2",
  externalLinkTooltip: "External link to %0",
  noTags: "There are no tagged tiddlers",
  notFileUrlError: "You need to save this TiddlyWiki to a file before you can save changes",
  cantSaveError: "It's not possible to save changes. Possible reasons include:\n- your browser doesn't support saving (Firefox, Internet Explorer, Safari and Opera all work if properly configured)\n- the pathname to your TiddlyWiki file contains illegal characters\n- the TiddlyWiki HTML file has been moved or renamed",
  invalidFileError: "The original file '%0' does not appear to be a valid TiddlyWiki",
  backupSaved: "Backup saved",
  backupFailed: "Failed to save backup file",
  rssSaved: "RSS feed saved",
  rssFailed: "Failed to save RSS feed file",
  emptySaved: "Empty template saved",
  emptyFailed: "Failed to save empty template file",
  mainSaved: "Main TiddlyWiki file saved",
  mainFailed: "Failed to save main TiddlyWiki file. Your changes have not been saved",
  macroError: "Error in macro <<\%0>>",
  macroErrorDetails: "Error while executing macro <<\%0>>:\n%1",
  missingMacro: "No such macro",
  overwriteWarning: "A tiddler named '%0' already exists. Choose OK to overwrite it",
  unsavedChangesWarning: "WARNING! There are unsaved changes in TiddlyWiki\n\nChoose OK to save\nChoose CANCEL to discard",
  confirmExit: "--------------------------------\n\nThere are unsaved changes in TiddlyWiki. If you continue you will lose those changes\n\n--------------------------------",
  saveInstructions: "SaveChanges",
  unsupportedTWFormat: "Unsupported TiddlyWiki format '%0'",
  tiddlerSaveError: "Error when saving tiddler '%0'",
  tiddlerLoadError: "Error when loading tiddler '%0'",
  wrongSaveFormat: "Cannot save with storage format '%0'. Using standard format for save.",
  invalidFieldName: "Invalid field name %0",
  fieldCannotBeChanged: "Field '%0' cannot be changed",
  loadingMissingTiddler: "Attempting to retrieve the tiddler '%0' from the '%1' server at:\n\n'%2' in the workspace '%3'",
  upgradeDone: "The upgrade to version %0 is now complete\n\nClick 'OK' to reload the newly upgraded TiddlyWiki"});

merge(config.messages.messageClose,{
  text: "close",
  tooltip: "close this message area"});

config.messages.backstage = {
  open: {text: "backstage", tooltip: "Open the backstage area to perform authoring and editing tasks"},
  close: {text: "close", tooltip: "Close the backstage area"},
  prompt: "backstage: ",
  decal: {
    edit: {text: "edit", tooltip: "Edit the tiddler '%0'"}
  }
};

config.messages.listView = {
  tiddlerTooltip: "Click for the full text of this tiddler",
  previewUnavailable: "(preview not available)"
};

config.messages.dates.months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November","December"];
config.messages.dates.days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
config.messages.dates.shortMonths = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
config.messages.dates.shortDays = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
// suffixes for dates, eg "1st","2nd","3rd"..."30th","31st"
config.messages.dates.daySuffixes = ["st","nd","rd","th","th","th","th","th","th","th",
    "th","th","th","th","th","th","th","th","th","th",
    "st","nd","rd","th","th","th","th","th","th","th",
    "st"];
config.messages.dates.am = "am";
config.messages.dates.pm = "pm";

merge(config.messages.tiddlerPopup,{
  });

merge(config.views.wikified.tag,{
  labelNoTags: "no tags",
  labelTags: "tags: ",
  openTag: "Open tag '%0'",
  tooltip: "Show tiddlers tagged with '%0'",
  openAllText: "Open all",
  openAllTooltip: "Open all of these tiddlers",
  popupNone: "No other tiddlers tagged with '%0'"});

merge(config.views.wikified,{
  defaultText: "The tiddler '%0' doesn't yet exist. Double-click to create it",
  defaultModifier: "(missing)",
  shadowModifier: "(built-in shadow tiddler)",
  dateFormat: "DD MMM YYYY",
  createdPrompt: "created"});

merge(config.views.editor,{
  tagPrompt: "Type tags separated with spaces, [[use double square brackets]] if necessary, or add existing",
  defaultText: "Type the text for '%0'"});

merge(config.views.editor.tagChooser,{
  text: "tags",
  tooltip: "Choose existing tags to add to this tiddler",
  popupNone: "There are no tags defined",
  tagTooltip: "Add the tag '%0'"});

merge(config.messages,{
  sizeTemplates:
    [
    {unit: 1024*1024*1024, template: "%0\u00a0GB"},
    {unit: 1024*1024, template: "%0\u00a0MB"},
    {unit: 1024, template: "%0\u00a0KB"},
    {unit: 1, template: "%0\u00a0B"}
    ]});

merge(config.macros.search,{
  label: "search",
  prompt: "Search this TiddlyWiki",
  accessKey: "F",
  successMsg: "%0 tiddlers found matching %1",
  failureMsg: "No tiddlers found matching %0"});

merge(config.macros.tagging,{
  label: "tagging: ",
  labelNotTag: "not tagging",
  tooltip: "List of tiddlers tagged with '%0'"});

merge(config.macros.timeline,{
  dateFormat: "DD MMM YYYY"});

merge(config.macros.allTags,{
  tooltip: "Show tiddlers tagged with '%0'",
  noTags: "There are no tagged tiddlers"});

config.macros.list.all.prompt = "All tiddlers in alphabetical order";
config.macros.list.missing.prompt = "Tiddlers that have links to them but are not defined";
config.macros.list.orphans.prompt = "Tiddlers that are not linked to from any other tiddlers";
config.macros.list.shadowed.prompt = "Tiddlers shadowed with default contents";
config.macros.list.touched.prompt = "Tiddlers that have been modified locally";

merge(config.macros.closeAll,{
  label: "close all",
  prompt: "Close all displayed tiddlers (except any that are being edited)"});

merge(config.macros.permaview,{
  label: "permaview",
  prompt: "Link to an URL that retrieves all the currently displayed tiddlers"});

merge(config.macros.saveChanges,{
  label: "save changes",
  prompt: "Save all tiddlers to create a new TiddlyWiki",
  accessKey: "S"});

merge(config.macros.newTiddler,{
  label: "new tiddler",
  prompt: "Create a new tiddler",
  title: "New Tiddler",
  accessKey: "N"});

merge(config.macros.newJournal,{
  label: "new journal",
  prompt: "Create a new tiddler from the current date and time",
  accessKey: "J"});

merge(config.macros.options,{
  wizardTitle: "Tweak advanced options",
  step1Title: "These options are saved in cookies in your browser",
  step1Html: "<input type='hidden' name='markList'></input><br><input type='checkbox' checked='false' name='chkUnknown'>Show unknown options</input>",
  unknownDescription: "//(unknown)//",
  listViewTemplate: {
    columns: [
      {name: 'Option', field: 'option', title: "Option", type: 'String'},
      {name: 'Description', field: 'description', title: "Description", type: 'WikiText'},
      {name: 'Name', field: 'name', title: "Name", type: 'String'}
      ],
    rowClasses: [
      {className: 'lowlight', field: 'lowlight'}
      ]}
  });

merge(config.macros.plugins,{
  wizardTitle: "Manage plugins",
  step1Title: "Currently loaded plugins",
  step1Html: "<input type='hidden' name='markList'></input>", // DO NOT TRANSLATE
  skippedText: "(This plugin has not been executed because it was added since startup)",
  noPluginText: "There are no plugins installed",
  confirmDeleteText: "Are you sure you want to delete these plugins:\n\n%0",
  removeLabel: "remove systemConfig tag",
  removePrompt: "Remove systemConfig tag",
  deleteLabel: "delete",
  deletePrompt: "Delete these tiddlers forever",
  listViewTemplate: {
    columns: [
      {name: 'Selected', field: 'Selected', rowName: 'title', type: 'Selector'},
      {name: 'Tiddler', field: 'tiddler', title: "Tiddler", type: 'Tiddler'},
      {name: 'Description', field: 'Description', title: "Description", type: 'String'},
      {name: 'Version', field: 'Version', title: "Version", type: 'String'},
      {name: 'Size', field: 'size', tiddlerLink: 'size', title: "Size", type: 'Size'},
      {name: 'Forced', field: 'forced', title: "Forced", tag: 'systemConfigForce', type: 'TagCheckbox'},
      {name: 'Disabled', field: 'disabled', title: "Disabled", tag: 'systemConfigDisable', type: 'TagCheckbox'},
      {name: 'Executed', field: 'executed', title: "Loaded", type: 'Boolean', trueText: "Yes", falseText: "No"},
      {name: 'Startup Time', field: 'startupTime', title: "Startup Time", type: 'String'},
      {name: 'Error', field: 'error', title: "Status", type: 'Boolean', trueText: "Error", falseText: "OK"},
      {name: 'Log', field: 'log', title: "Log", type: 'StringList'}
      ],
    rowClasses: [
      {className: 'error', field: 'error'},
      {className: 'warning', field: 'warning'}
      ]}
  });

merge(config.macros.toolbar,{
  moreLabel: "more",
  morePrompt: "Show additional commands",
  lessLabel: "less",
  lessPrompt: "Hide additional commands",
  separator: "|"
  });

merge(config.macros.refreshDisplay,{
  label: "refresh",
  prompt: "Redraw the entire TiddlyWiki display"
  });

merge(config.macros.importTiddlers,{
  readOnlyWarning: "You cannot import into a read-only TiddlyWiki file. Try opening it from a file:// URL",
  wizardTitle: "Import tiddlers from another file or server",
  step1Title: "Step 1: Locate the server or TiddlyWiki file",
  step1Html: "Specify the type of the server: <select name='selTypes'><option value=''>Choose...</option></select><br>Enter the URL or pathname here: <input type='text' size=50 name='txtPath'><br>...or browse for a file: <input type='file' size=50 name='txtBrowse'><br><hr>...or select a pre-defined feed: <select name='selFeeds'><option value=''>Choose...</option></select>",
  openLabel: "open",
  openPrompt: "Open the connection to this file or server",
  openError: "There were problems fetching the tiddlywiki file",
  statusOpenHost: "Opening the host",
  statusGetWorkspaceList: "Getting the list of available workspaces",
  step2Title: "Step 2: Choose the workspace",
  step2Html: "Enter a workspace name: <input type='text' size=50 name='txtWorkspace'><br>...or select a workspace: <select name='selWorkspace'><option value=''>Choose...</option></select>",
  cancelLabel: "cancel",
  cancelPrompt: "Cancel this import",
  statusOpenWorkspace: "Opening the workspace",
  statusGetTiddlerList: "Getting the list of available tiddlers",
  errorGettingTiddlerList: "Error getting list of tiddlers, click Cancel to try again",
  step3Title: "Step 3: Choose the tiddlers to import",
  step3Html: "<input type='hidden' name='markList'></input><br><input type='checkbox' checked='true' name='chkSync'>Keep these tiddlers linked to this server so that you can synchronise subsequent changes</input><br><input type='checkbox' name='chkSave'>Save the details of this server in a 'systemServer' tiddler called:</input> <input type='text' size=25 name='txtSaveTiddler'>",
  importLabel: "import",
  importPrompt: "Import these tiddlers",
  confirmOverwriteText: "Are you sure you want to overwrite these tiddlers:\n\n%0",
  step4Title: "Step 4: Importing %0 tiddler(s)",
  step4Html: "<input type='hidden' name='markReport'></input>", // DO NOT TRANSLATE
  doneLabel: "done",
  donePrompt: "Close this wizard",
  statusDoingImport: "Importing tiddlers",
  statusDoneImport: "All tiddlers imported",
  systemServerNamePattern: "%2 on %1",
  systemServerNamePatternNoWorkspace: "%1",
  confirmOverwriteSaveTiddler: "The tiddler '%0' already exists. Click 'OK' to overwrite it with the details of this server, or 'Cancel' to leave it unchanged",
  serverSaveTemplate: "|''Type:''|%0|\n|''URL:''|%1|\n|''Workspace:''|%2|\n\nThis tiddler was automatically created to record the details of this server",
  serverSaveModifier: "(System)",
  listViewTemplate: {
    columns: [
      {name: 'Selected', field: 'Selected', rowName: 'title', type: 'Selector'},
      {name: 'Tiddler', field: 'tiddler', title: "Tiddler", type: 'Tiddler'},
      {name: 'Size', field: 'size', tiddlerLink: 'size', title: "Size", type: 'Size'},
      {name: 'Tags', field: 'tags', title: "Tags", type: 'Tags'}
      ],
    rowClasses: [
      ]}
  });

merge(config.macros.upgrade,{
  wizardTitle: "Upgrade TiddlyWiki core code",
  step1Title: "Update or repair this TiddlyWiki to the latest release",
  step1Html: "You are about to upgrade to the latest release of the TiddlyWiki core code (from <a href='%0' class='externalLink' target='_blank'>%1</a>). Your content will be preserved across the upgrade.<br><br>Note that core upgrades have been known to interfere with older plugins. If you run into problems with the upgraded file, see <a href='http://www.tiddlywiki.org/wiki/CoreUpgrades' class='externalLink' target='_blank'>http://www.tiddlywiki.org/wiki/CoreUpgrades</a>",
  errorCantUpgrade: "Unable to upgrade this TiddlyWiki. You can only perform upgrades on TiddlyWiki files stored locally",
  errorNotSaved: "You must save changes before you can perform an upgrade",
  step2Title: "Confirm the upgrade details",
  step2Html_downgrade: "You are about to downgrade to TiddlyWiki version %0 from %1.<br><br>Downgrading to an earlier version of the core code is not recommended",
  step2Html_restore: "This TiddlyWiki appears to be already using the latest version of the core code (%0).<br><br>You can continue to upgrade anyway to ensure that the core code hasn't been corrupted or damaged",
  step2Html_upgrade: "You are about to upgrade to TiddlyWiki version %0 from %1",
  upgradeLabel: "upgrade",
  upgradePrompt: "Prepare for the upgrade process",
  statusPreparingBackup: "Preparing backup",
  statusSavingBackup: "Saving backup file",
  errorSavingBackup: "There was a problem saving the backup file",
  statusLoadingCore: "Loading core code",
  errorLoadingCore: "Error loading the core code",
  errorCoreFormat: "Error with the new core code",
  statusSavingCore: "Saving the new core code",
  statusReloadingCore: "Reloading the new core code",
  startLabel: "start",
  startPrompt: "Start the upgrade process",
  cancelLabel: "cancel",
  cancelPrompt: "Cancel the upgrade process",
  step3Title: "Upgrade cancelled",
  step3Html: "You have cancelled the upgrade process"
  });

merge(config.macros.sync,{
  listViewTemplate: {
    columns: [
      {name: 'Selected', field: 'selected', rowName: 'title', type: 'Selector'},
      {name: 'Tiddler', field: 'tiddler', title: "Tiddler", type: 'Tiddler'},
      {name: 'Server Type', field: 'serverType', title: "Server type", type: 'String'},
      {name: 'Server Host', field: 'serverHost', title: "Server host", type: 'String'},
      {name: 'Server Workspace', field: 'serverWorkspace', title: "Server workspace", type: 'String'},
      {name: 'Status', field: 'status', title: "Synchronisation status", type: 'String'},
      {name: 'Server URL', field: 'serverUrl', title: "Server URL", text: "View", type: 'Link'}
      ],
    rowClasses: [
      ],
    buttons: [
      {caption: "Sync these tiddlers", name: 'sync'}
      ]},
  wizardTitle: "Synchronize with external servers and files",
  step1Title: "Choose the tiddlers you want to synchronize",
  step1Html: "<input type='hidden' name='markList'></input>", // DO NOT TRANSLATE
  syncLabel: "sync",
  syncPrompt: "Sync these tiddlers",
  hasChanged: "Changed while unplugged",
  hasNotChanged: "Unchanged while unplugged",
  syncStatusList: {
    none: {text: "...", display:null, className:'notChanged'},
    changedServer: {text: "Changed on server", display:null, className:'changedServer'},
    changedLocally: {text: "Changed while unplugged", display:null, className:'changedLocally'},
    changedBoth: {text: "Changed while unplugged and on server", display:null, className:'changedBoth'},
    notFound: {text: "Not found on server", display:null, className:'notFound'},
    putToServer: {text: "Saved update on server", display:null, className:'putToServer'},
    gotFromServer: {text: "Retrieved update from server", display:null, className:'gotFromServer'}
    }
  });

merge(config.macros.annotations,{
  });

merge(config.commands.closeTiddler,{
  text: "close",
  tooltip: "Close this tiddler"});

merge(config.commands.closeOthers,{
  text: "close others",
  tooltip: "Close all other tiddlers"});

merge(config.commands.editTiddler,{
  text: "edit",
  tooltip: "Edit this tiddler",
  readOnlyText: "view",
  readOnlyTooltip: "View the source of this tiddler"});

merge(config.commands.saveTiddler,{
  text: "done",
  tooltip: "Save changes to this tiddler"});

merge(config.commands.cancelTiddler,{
  text: "cancel",
  tooltip: "Undo changes to this tiddler",
  warning: "Are you sure you want to abandon your changes to '%0'?",
  readOnlyText: "done",
  readOnlyTooltip: "View this tiddler normally"});

merge(config.commands.deleteTiddler,{
  text: "delete",
  tooltip: "Delete this tiddler",
  warning: "Are you sure you want to delete '%0'?"});

merge(config.commands.permalink,{
  text: "permalink",
  tooltip: "Permalink for this tiddler"});

merge(config.commands.references,{
  text: "references",
  tooltip: "Show tiddlers that link to this one",
  popupNone: "No references"});

merge(config.commands.jump,{
  text: "jump",
  tooltip: "Jump to another open tiddler"});

merge(config.commands.syncing,{
  text: "syncing",
  tooltip: "Control synchronisation of this tiddler with a server or external file",
  currentlySyncing: "<div>Currently syncing via <span class='popupHighlight'>'%0'</span> to:</"+"div><div>host: <span class='popupHighlight'>%1</span></"+"div><div>workspace: <span class='popupHighlight'>%2</span></"+"div>", // Note escaping of closing <div> tag
  notCurrentlySyncing: "Not currently syncing",
  captionUnSync: "Stop synchronising this tiddler",
  chooseServer: "Synchronise this tiddler with another server:",
  currServerMarker: "\u25cf ",
  notCurrServerMarker: "  "});

merge(config.commands.fields,{
  text: "fields",
  tooltip: "Show the extended fields of this tiddler",
  emptyText: "There are no extended fields for this tiddler",
  listViewTemplate: {
    columns: [
      {name: 'Field', field: 'field', title: "Field", type: 'String'},
      {name: 'Value', field: 'value', title: "Value", type: 'String'}
      ],
    rowClasses: [
      ],
    buttons: [
      ]}});

merge(config.shadowTiddlers,{
  DefaultTiddlers: "[[GettingStarted]]",
  MainMenu: "[[GettingStarted]]",
  SiteTitle: "My TiddlyWiki",
  SiteSubtitle: "a reusable non-linear personal web notebook",
  SiteUrl: "http://www.tiddlywiki.com/",
  SideBarOptions: '<<search>><<closeAll>><<permaview>><<newTiddler>><<newJournal "DD MMM YYYY" "journal">><<saveChanges>><<slider chkSliderOptionsPanel OptionsPanel "options \u00bb" "Change TiddlyWiki advanced options">>',
  SideBarTabs: '<<tabs txtMainTab "Timeline" "Timeline" TabTimeline "All" "All tiddlers" TabAll "Tags" "All tags" TabTags "More" "More lists" TabMore>>',
  TabMore: '<<tabs txtMoreTab "Missing" "Missing tiddlers" TabMoreMissing "Orphans" "Orphaned tiddlers" TabMoreOrphans "Shadowed" "Shadowed tiddlers" TabMoreShadowed>>'
  });

merge(config.annotations,{
  AdvancedOptions: "This shadow tiddler provides access to several advanced options",
  ColorPalette: "These values in this shadow tiddler determine the colour scheme of the ~TiddlyWiki user interface",
  DefaultTiddlers: "The tiddlers listed in this shadow tiddler will be automatically displayed when ~TiddlyWiki starts up",
  EditTemplate: "The HTML template in this shadow tiddler determines how tiddlers look while they are being edited",
  GettingStarted: "This shadow tiddler provides basic usage instructions",
  ImportTiddlers: "This shadow tiddler provides access to importing tiddlers",
  MainMenu: "This shadow tiddler is used as the contents of the main menu in the left-hand column of the screen",
  MarkupPreHead: "This tiddler is inserted at the top of the <head> section of the TiddlyWiki HTML file",
  MarkupPostHead: "This tiddler is inserted at the bottom of the <head> section of the TiddlyWiki HTML file",
  MarkupPreBody: "This tiddler is inserted at the top of the <body> section of the TiddlyWiki HTML file",
  MarkupPostBody: "This tiddler is inserted at the end of the <body> section of the TiddlyWiki HTML file immediately after the script block",
  OptionsPanel: "This shadow tiddler is used as the contents of the options panel slider in the right-hand sidebar",
  PageTemplate: "The HTML template in this shadow tiddler determines the overall ~TiddlyWiki layout",
  PluginManager: "This shadow tiddler provides access to the plugin manager",
  SideBarOptions: "This shadow tiddler is used as the contents of the option panel in the right-hand sidebar",
  SideBarTabs: "This shadow tiddler is used as the contents of the tabs panel in the right-hand sidebar",
  SiteSubtitle: "This shadow tiddler is used as the second part of the page title",
  SiteTitle: "This shadow tiddler is used as the first part of the page title",
  SiteUrl: "This shadow tiddler should be set to the full target URL for publication",
  StyleSheetColors: "This shadow tiddler contains CSS definitions related to the color of page elements. ''DO NOT EDIT THIS TIDDLER'', instead make your changes in the StyleSheet shadow tiddler",
  StyleSheet: "This tiddler can contain custom CSS definitions",
  StyleSheetLayout: "This shadow tiddler contains CSS definitions related to the layout of page elements. ''DO NOT EDIT THIS TIDDLER'', instead make your changes in the StyleSheet shadow tiddler",
  StyleSheetLocale: "This shadow tiddler contains CSS definitions related to the translation locale",
  StyleSheetPrint: "This shadow tiddler contains CSS definitions for printing",
  TabAll: "This shadow tiddler contains the contents of the 'All' tab in the right-hand sidebar",
  TabMore: "This shadow tiddler contains the contents of the 'More' tab in the right-hand sidebar",
  TabMoreMissing: "This shadow tiddler contains the contents of the 'Missing' tab in the right-hand sidebar",
  TabMoreOrphans: "This shadow tiddler contains the contents of the 'Orphans' tab in the right-hand sidebar",
  TabMoreShadowed: "This shadow tiddler contains the contents of the 'Shadowed' tab in the right-hand sidebar",
  TabTags: "This shadow tiddler contains the contents of the 'Tags' tab in the right-hand sidebar",
  TabTimeline: "This shadow tiddler contains the contents of the 'Timeline' tab in the right-hand sidebar",
  ToolbarCommands: "This shadow tiddler determines which commands are shown in tiddler toolbars",
  ViewTemplate: "The HTML template in this shadow tiddler determines how tiddlers look"
  });

//--
//-- Main
//--

var params = null; // Command line parameters
var store = null; // TiddlyWiki storage
var story = null; // Main story
var formatter = null; // Default formatters for the wikifier
var anim = typeof Animator == "function" ? new Animator() : null; // Animation engine
var readOnly = false; // Whether we're in readonly mode
var highlightHack = null; // Embarrassing hack department...
var hadConfirmExit = false; // Don't warn more than once
var safeMode = false; // Disable all plugins and cookies
var showBackstage; // Whether to include the backstage area
var installedPlugins = []; // Information filled in when plugins are executed
var startingUp = false; // Whether we're in the process of starting up
var pluginInfo,tiddler; // Used to pass information to plugins in loadPlugins()

// Whether to use the JavaSaver applet
var useJavaSaver = (config.browser.isSafari || config.browser.isOpera) && (document.location.toString().substr(0,4) != "http");

// Starting up
function main()
{
  var t10,t9,t8,t7,t6,t5,t4,t3,t2,t1,t0 = new Date();
  startingUp = true;
  jQuery.noConflict();
  window.onbeforeunload = function(e) {if(window.confirmExit) return confirmExit();};
  params = getParameters();
  if(params)
    params = params.parseParams("open",null,false);
  store = new TiddlyWiki();
  invokeParamifier(params,"oninit");
  story = new Story("tiddlerDisplay","tiddler");
  addEvent(document,"click",Popup.onDocumentClick);
  saveTest();
  loadOptionsCookie();
  for(var s=0; s<config.notifyTiddlers.length; s++)
    store.addNotification(config.notifyTiddlers[s].name,config.notifyTiddlers[s].notify);
  t1 = new Date();
  loadShadowTiddlers();
  jQuery().trigger("loadShadows");
  t2 = new Date();
  store.loadFromDiv("storeArea","store",true);
  jQuery().trigger("loadTiddlers");
  t3 = new Date();
  invokeParamifier(params,"onload");
  t4 = new Date();
  readOnly = (window.location.protocol == "file:") ? false : config.options.chkHttpReadOnly;
  var pluginProblem = loadPlugins();
  jQuery().trigger("loadPlugins");
  t5 = new Date();
  formatter = new Formatter(config.formatters);
  invokeParamifier(params,"onconfig");
  story.switchTheme(config.options.txtTheme);
  showBackstage = !readOnly;
  t6 = new Date();
  for(var m in config.macros) {
    if(config.macros[m].init)
      config.macros[m].init();
  }
  t7 = new Date();
  store.notifyAll();
  t8 = new Date();
  restart();
  refreshDisplay();
  t9 = new Date();
  if(pluginProblem) {
    story.displayTiddler(null,"PluginManager");
    displayMessage(config.messages.customConfigError);
  }
  if(showBackstage)
    backstage.init();
  t10 = new Date();
  if(config.options.chkDisplayInstrumentation) {
    displayMessage("LoadShadows " + (t2-t1) + " ms");
    displayMessage("LoadFromDiv " + (t3-t2) + " ms");
    displayMessage("LoadPlugins " + (t5-t4) + " ms");
    displayMessage("Macro init " + (t7-t6) + " ms");
    displayMessage("Notify " + (t8-t7) + " ms");
    displayMessage("Restart " + (t9-t8) + " ms");
    displayMessage("Total: " + (t10-t0) + " ms");
  }
  startingUp = false;
  jQuery().trigger("startup");
}

// Called on unload. All functions called conditionally since they themselves may have been unloaded.
function unload()
{
  if(window.checkUnsavedChanges)
    checkUnsavedChanges();
  if(window.scrubNodes)
    scrubNodes(document.body);
}

// Restarting
function restart()
{
  invokeParamifier(params,"onstart");
  if(story.isEmpty()) {
    story.displayDefaultTiddlers();
  }
  window.scrollTo(0,0);
}

function saveTest()
{
  var s = document.getElementById("saveTest");
  if(s.hasChildNodes())
    alert(config.messages.savedSnapshotError);
  s.appendChild(document.createTextNode("savetest"));
}

function loadShadowTiddlers()
{
  var shadows = new TiddlyWiki();
  shadows.loadFromDiv("shadowArea","shadows",true);
  shadows.forEachTiddler(function(title,tiddler){config.shadowTiddlers[title] = tiddler.text;});
  delete shadows;
}

function loadPlugins()
{
  if(safeMode)
    return false;
  var tiddlers = store.getTaggedTiddlers("systemConfig");
  var toLoad = [];
  var nLoaded = 0;
  var map = {};
  var nPlugins = tiddlers.length;
  installedPlugins = [];
  for(var i=0; i<nPlugins; i++) {
    var p = getPluginInfo(tiddlers[i]);
    installedPlugins[i] = p;
    var n = p.Name;
    if(n)
      map[n] = p;
    n = p.Source;
    if(n)
      map[n] = p;
  }
  var visit = function(p) {
    if(!p || p.done)
      return;
    p.done = 1;
    var reqs = p.Requires;
    if(reqs) {
      reqs = reqs.readBracketedList();
      for(var i=0; i<reqs.length; i++)
        visit(map[reqs[i]]);
    }
    toLoad.push(p);
  };
  for(i=0; i<nPlugins; i++)
    visit(installedPlugins[i]);
  for(i=0; i<toLoad.length; i++) {
    p = toLoad[i];
    pluginInfo = p;
    tiddler = p.tiddler;
    if(isPluginExecutable(p)) {
      if(isPluginEnabled(p)) {
        p.executed = true;
        var startTime = new Date();
        try {
          if(tiddler.text)
            window.eval(tiddler.text);
          nLoaded++;
        } catch(ex) {
          p.log.push(config.messages.pluginError.format([exceptionText(ex)]));
          p.error = true;
        }
        pluginInfo.startupTime = String((new Date()) - startTime) + "ms";
      } else {
        nPlugins--;
      }
    } else {
      p.warning = true;
    }
  }
  return nLoaded != nPlugins;
}

function getPluginInfo(tiddler)
{
  var p = store.getTiddlerSlices(tiddler.title,["Name","Description","Version","Requires","CoreVersion","Date","Source","Author","License","Browsers"]);
  p.tiddler = tiddler;
  p.title = tiddler.title;
  p.log = [];
  return p;
}

// Check that a particular plugin is valid for execution
function isPluginExecutable(plugin)
{
  if(plugin.tiddler.isTagged("systemConfigForce")) {
    plugin.log.push(config.messages.pluginForced);
    return true;
  }
  if(plugin["CoreVersion"]) {
    var coreVersion = plugin["CoreVersion"].split(".");
    var w = parseInt(coreVersion[0],10) - version.major;
    if(w == 0 && coreVersion[1])
      w = parseInt(coreVersion[1],10) - version.minor;
    if(w == 0 && coreVersion[2])
      w = parseInt(coreVersion[2],10) - version.revision;
    if(w > 0) {
      plugin.log.push(config.messages.pluginVersionError);
      return false;
    }
  }
  return true;
}

function isPluginEnabled(plugin)
{
  if(plugin.tiddler.isTagged("systemConfigDisable")) {
    plugin.log.push(config.messages.pluginDisabled);
    return false;
  }
  return true;
}

function invokeMacro(place,macro,params,wikifier,tiddler)
{
  try {
    var m = config.macros[macro];
    if(m && m.handler) {
      var tiddlerElem = story.findContainingTiddler(place);
      window.tiddler = tiddlerElem ? store.getTiddler(tiddlerElem.getAttribute("tiddler")) : null;
      window.place = place;
      m.handler(place,macro,params.readMacroParams(),wikifier,params,tiddler);
    } else {
      createTiddlyError(place,config.messages.macroError.format([macro]),config.messages.macroErrorDetails.format([macro,config.messages.missingMacro]));
    }
  } catch(ex) {
    createTiddlyError(place,config.messages.macroError.format([macro]),config.messages.macroErrorDetails.format([macro,ex.toString()]));
  }
}

//--
//-- Paramifiers
//--

function getParameters()
{
  var p = null;
  if(window.location.hash) {
    p = decodeURIComponent(window.location.hash.substr(1));
    if(config.browser.firefoxDate != null && config.browser.firefoxDate[1] < "20051111")
      p = convertUTF8ToUnicode(p);
  }
  return p;
}

function invokeParamifier(params,handler)
{
  if(!params || params.length == undefined || params.length <= 1)
    return;
  for(var i=1; i<params.length; i++) {
    var p = config.paramifiers[params[i].name];
    if(p && p[handler] instanceof Function)
      p[handler](params[i].value);
    else {
      var h = config.optionHandlers[params[i].name.substr(0,3)];
      if(h && h.set instanceof Function)
        h.set(params[i].name,params[i].value);
    }
  }
}

config.paramifiers = {};

config.paramifiers.start = {
  oninit: function(v) {
    safeMode = v.toLowerCase() == "safe";
  }
};

config.paramifiers.open = {
  onstart: function(v) {
    if(!readOnly || store.tiddlerExists(v) || store.isShadowTiddler(v))
      story.displayTiddler("bottom",v,null,false,null);
  }
};

config.paramifiers.story = {
  onstart: function(v) {
    var list = store.getTiddlerText(v,"").parseParams("open",null,false);
    invokeParamifier(list,"onstart");
  }
};

config.paramifiers.search = {
  onstart: function(v) {
    story.search(v,false,false);
  }
};

config.paramifiers.searchRegExp = {
  onstart: function(v) {
    story.prototype.search(v,false,true);
  }
};

config.paramifiers.tag = {
  onstart: function(v) {
    story.displayTiddlers(null,store.filterTiddlers("[tag["+v+"]]"),null,false,null);
  }
};

config.paramifiers.newTiddler = {
  onstart: function(v) {
    if(!readOnly) {
      story.displayTiddler(null,v,DEFAULT_EDIT_TEMPLATE);
      story.focusTiddler(v,"text");
    }
  }
};

config.paramifiers.newJournal = {
  onstart: function(v) {
    if(!readOnly) {
      var now = new Date();
      var title = now.formatString(v.trim());
      story.displayTiddler(null,title,DEFAULT_EDIT_TEMPLATE);
      story.focusTiddler(title,"text");
    }
  }
};

config.paramifiers.readOnly = {
  onconfig: function(v) {
    var p = v.toLowerCase();
    readOnly = p == "yes" ? true : (p == "no" ? false : readOnly);
  }
};

config.paramifiers.theme = {
  onconfig: function(v) {
    story.switchTheme(v);
  }
};

config.paramifiers.upgrade = {
  onstart: function(v) {
    upgradeFrom(v);
  }
};

config.paramifiers.recent= {
  onstart: function(v) {
    var titles=[];
    var tiddlers=store.getTiddlers("modified","excludeLists").reverse();
    for(var i=0; i<v && i<tiddlers.length; i++)
      titles.push(tiddlers[i].title);
    story.displayTiddlers(null,titles);
  }
};

config.paramifiers.filter = {
  onstart: function(v) {
    story.displayTiddlers(null,store.filterTiddlers(v),null,false);
  }
};

//--
//-- Formatter helpers
//--

function Formatter(formatters)
{
  this.formatters = [];
  var pattern = [];
  for(var n=0; n<formatters.length; n++) {
    pattern.push("(" + formatters[n].match + ")");
    this.formatters.push(formatters[n]);
  }
  this.formatterRegExp = new RegExp(pattern.join("|"),"mg");
}

config.formatterHelpers = {

  createElementAndWikify: function(w)
  {
    w.subWikifyTerm(createTiddlyElement(w.output,this.element),this.termRegExp);
  },

  inlineCssHelper: function(w)
  {
    var styles = [];
    config.textPrimitives.cssLookaheadRegExp.lastIndex = w.nextMatch;
    var lookaheadMatch = config.textPrimitives.cssLookaheadRegExp.exec(w.source);
    while(lookaheadMatch && lookaheadMatch.index == w.nextMatch) {
      var s,v;
      if(lookaheadMatch[1]) {
        s = lookaheadMatch[1].unDash();
        v = lookaheadMatch[2];
      } else {
        s = lookaheadMatch[3].unDash();
        v = lookaheadMatch[4];
      }
      if(s=="bgcolor")
        s = "backgroundColor";
      styles.push({style: s, value: v});
      w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;
      config.textPrimitives.cssLookaheadRegExp.lastIndex = w.nextMatch;
      lookaheadMatch = config.textPrimitives.cssLookaheadRegExp.exec(w.source);
    }
    return styles;
  },

  applyCssHelper: function(e,styles)
  {
    for(var t=0; t< styles.length; t++) {
      try {
        e.style[styles[t].style] = styles[t].value;
      } catch (ex) {
      }
    }
  },

  enclosedTextHelper: function(w)
  {
    this.lookaheadRegExp.lastIndex = w.matchStart;
    var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
    if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
      var text = lookaheadMatch[1];
      if(config.browser.isIE)
        text = text.replace(/\n/g,"\r");
      createTiddlyElement(w.output,this.element,null,null,text);
      w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;
    }
  },

  isExternalLink: function(link)
  {
    if(store.tiddlerExists(link) || store.isShadowTiddler(link)) {
      return false;
    }
    var urlRegExp = new RegExp(config.textPrimitives.urlPattern,"mg");
    if(urlRegExp.exec(link)) {
      return true;
    }
    if(link.indexOf(".")!=-1 || link.indexOf("\\")!=-1 || link.indexOf("/")!=-1 || link.indexOf("#")!=-1) {
      return true;
    }
    return false;
  }

};

//--
//-- Standard formatters
//--

config.formatters = [
{
  name: "table",
  match: "^\\|(?:[^\\n]*)\\|(?:[fhck]?)$",
  lookaheadRegExp: /^\|([^\n]*)\|([fhck]?)$/mg,
  rowTermRegExp: /(\|(?:[fhck]?)$\n?)/mg,
  cellRegExp: /(?:\|([^\n\|]*)\|)|(\|[fhck]?$\n?)/mg,
  cellTermRegExp: /((?:\x20*)\|)/mg,
  rowTypes: {"c":"caption", "h":"thead", "":"tbody", "f":"tfoot"},
  handler: function(w)
  {
    var table = createTiddlyElement(w.output,"table",null,"twtable");
    var prevColumns = [];
    var currRowType = null;
    var rowContainer;
    var rowCount = 0;
    w.nextMatch = w.matchStart;
    this.lookaheadRegExp.lastIndex = w.nextMatch;
    var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
    while(lookaheadMatch && lookaheadMatch.index == w.nextMatch) {
      var nextRowType = lookaheadMatch[2];
      if(nextRowType == "k") {
        table.className = lookaheadMatch[1];
        w.nextMatch += lookaheadMatch[0].length+1;
      } else {
        if(nextRowType != currRowType) {
          rowContainer = createTiddlyElement(table,this.rowTypes[nextRowType]);
          currRowType = nextRowType;
        }
        if(currRowType == "c") {
          // Caption
          w.nextMatch++;
          if(rowContainer != table.firstChild)
            table.insertBefore(rowContainer,table.firstChild);
          rowContainer.setAttribute("align",rowCount == 0?"top":"bottom");
          w.subWikifyTerm(rowContainer,this.rowTermRegExp);
        } else {
          var theRow = createTiddlyElement(rowContainer,"tr",null,(rowCount&1)?"oddRow":"evenRow");
          theRow.onmouseover = function() {addClass(this,"hoverRow");};
          theRow.onmouseout = function() {removeClass(this,"hoverRow");};
          this.rowHandler(w,theRow,prevColumns);
          rowCount++;
        }
      }
      this.lookaheadRegExp.lastIndex = w.nextMatch;
      lookaheadMatch = this.lookaheadRegExp.exec(w.source);
    }
  },
  rowHandler: function(w,e,prevColumns)
  {
    var col = 0;
    var colSpanCount = 1;
    var prevCell = null;
    this.cellRegExp.lastIndex = w.nextMatch;
    var cellMatch = this.cellRegExp.exec(w.source);
    while(cellMatch && cellMatch.index == w.nextMatch) {
      if(cellMatch[1] == "~") {
        // Rowspan
        var last = prevColumns[col];
        if(last) {
          last.rowSpanCount++;
          last.element.setAttribute("rowspan",last.rowSpanCount);
          last.element.setAttribute("rowSpan",last.rowSpanCount); // Needed for IE
          last.element.valign = "center";
        }
        w.nextMatch = this.cellRegExp.lastIndex-1;
      } else if(cellMatch[1] == ">") {
        // Colspan
        colSpanCount++;
        w.nextMatch = this.cellRegExp.lastIndex-1;
      } else if(cellMatch[2]) {
        // End of row
        if(prevCell && colSpanCount > 1) {
          prevCell.setAttribute("colspan",colSpanCount);
          prevCell.setAttribute("colSpan",colSpanCount); // Needed for IE
        }
        w.nextMatch = this.cellRegExp.lastIndex;
        break;
      } else {
        // Cell
        w.nextMatch++;
        var styles = config.formatterHelpers.inlineCssHelper(w);
        var spaceLeft = false;
        var chr = w.source.substr(w.nextMatch,1);
        while(chr == " ") {
          spaceLeft = true;
          w.nextMatch++;
          chr = w.source.substr(w.nextMatch,1);
        }
        var cell;
        if(chr == "!") {
          cell = createTiddlyElement(e,"th");
          w.nextMatch++;
        } else {
          cell = createTiddlyElement(e,"td");
        }
        prevCell = cell;
        prevColumns[col] = {rowSpanCount:1,element:cell};
        if(colSpanCount > 1) {
          cell.setAttribute("colspan",colSpanCount);
          cell.setAttribute("colSpan",colSpanCount); // Needed for IE
          colSpanCount = 1;
        }
        config.formatterHelpers.applyCssHelper(cell,styles);
        w.subWikifyTerm(cell,this.cellTermRegExp);
        if(w.matchText.substr(w.matchText.length-2,1) == " ") // spaceRight
          cell.align = spaceLeft ? "center" : "left";
        else if(spaceLeft)
          cell.align = "right";
        w.nextMatch--;
      }
      col++;
      this.cellRegExp.lastIndex = w.nextMatch;
      cellMatch = this.cellRegExp.exec(w.source);
    }
  }
},

{
  name: "heading",
  match: "^!{1,6}",
  termRegExp: /(\n)/mg,
  handler: function(w)
  {
    w.subWikifyTerm(createTiddlyElement(w.output,"h" + w.matchLength),this.termRegExp);
  }
},

{
  name: "list",
  match: "^(?:[\\*#;:]+)",
  lookaheadRegExp: /^(?:(?:(\*)|(#)|(;)|(:))+)/mg,
  termRegExp: /(\n)/mg,
  handler: function(w)
  {
    var stack = [w.output];
    var currLevel = 0, currType = null;
    var listLevel, listType, itemType, baseType;
    w.nextMatch = w.matchStart;
    this.lookaheadRegExp.lastIndex = w.nextMatch;
    var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
    while(lookaheadMatch && lookaheadMatch.index == w.nextMatch) {
      if(lookaheadMatch[1]) {
        listType = "ul";
        itemType = "li";
      } else if(lookaheadMatch[2]) {
        listType = "ol";
        itemType = "li";
      } else if(lookaheadMatch[3]) {
        listType = "dl";
        itemType = "dt";
      } else if(lookaheadMatch[4]) {
        listType = "dl";
        itemType = "dd";
      }
      if(!baseType)
        baseType = listType;
      listLevel = lookaheadMatch[0].length;
      w.nextMatch += lookaheadMatch[0].length;
      var t;
      if(listLevel > currLevel) {
        for(t=currLevel; t<listLevel; t++) {
          var target = (currLevel == 0) ? stack[stack.length-1] : stack[stack.length-1].lastChild;
          stack.push(createTiddlyElement(target,listType));
        }
      } else if(listType!=baseType && listLevel==1) {
        w.nextMatch -= lookaheadMatch[0].length;
        return;
      } else if(listLevel < currLevel) {
        for(t=currLevel; t>listLevel; t--)
          stack.pop();
      } else if(listLevel == currLevel && listType != currType) {
        stack.pop();
        stack.push(createTiddlyElement(stack[stack.length-1].lastChild,listType));
      }
      currLevel = listLevel;
      currType = listType;
      var e = createTiddlyElement(stack[stack.length-1],itemType);
      w.subWikifyTerm(e,this.termRegExp);
      this.lookaheadRegExp.lastIndex = w.nextMatch;
      lookaheadMatch = this.lookaheadRegExp.exec(w.source);
    }
  }
},

{
  name: "quoteByBlock",
  match: "^<<<\\n",
  termRegExp: /(^<<<(\n|$))/mg,
  element: "blockquote",
  handler: config.formatterHelpers.createElementAndWikify
},

{
  name: "quoteByLine",
  match: "^>+",
  lookaheadRegExp: /^>+/mg,
  termRegExp: /(\n)/mg,
  element: "blockquote",
  handler: function(w)
  {
    var stack = [w.output];
    var currLevel = 0;
    var newLevel = w.matchLength;
    var t;
    do {
      if(newLevel > currLevel) {
        for(t=currLevel; t<newLevel; t++)
          stack.push(createTiddlyElement(stack[stack.length-1],this.element));
      } else if(newLevel < currLevel) {
        for(t=currLevel; t>newLevel; t--)
          stack.pop();
      }
      currLevel = newLevel;
      w.subWikifyTerm(stack[stack.length-1],this.termRegExp);
      createTiddlyElement(stack[stack.length-1],"br");
      this.lookaheadRegExp.lastIndex = w.nextMatch;
      var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
      var matched = lookaheadMatch && lookaheadMatch.index == w.nextMatch;
      if(matched) {
        newLevel = lookaheadMatch[0].length;
        w.nextMatch += lookaheadMatch[0].length;
      }
    } while(matched);
  }
},

{
  name: "rule",
  match: "^----+$\\n?|<hr ?/?>\\n?",
  handler: function(w)
  {
    createTiddlyElement(w.output,"hr");
  }
},

{
  name: "monospacedByLine",
  match: "^(?:/\\*\\{\\{\\{\\*/|\\{\\{\\{|//\\{\\{\\{|<!--\\{\\{\\{-->)\\n",
  element: "pre",
  handler: function(w)
  {
    switch(w.matchText) {
    case "/*{{{*/\n": // CSS
      this.lookaheadRegExp = /\/\*\{\{\{\*\/\n*((?:^[^\n]*\n)+?)(\n*^\/\*\}\}\}\*\/$\n?)/mg;
      break;
    case "{{{\n": // monospaced block
      this.lookaheadRegExp = /^\{\{\{\n((?:^[^\n]*\n)+?)(^\}\}\}$\n?)/mg;
      break;
    case "//{{{\n": // plugin
      this.lookaheadRegExp = /^\/\/\{\{\{\n\n*((?:^[^\n]*\n)+?)(\n*^\/\/\}\}\}$\n?)/mg;
      break;
    case "<!--{{{-->\n": //template
      this.lookaheadRegExp = /<!--\{\{\{-->\n*((?:^[^\n]*\n)+?)(\n*^<!--\}\}\}-->$\n?)/mg;
      break;
    default:
      break;
    }
    config.formatterHelpers.enclosedTextHelper.call(this,w);
  }
},

{
  name: "wikifyComment",
  match: "^(?:/\\*\\*\\*|<!---)\\n",
  handler: function(w)
  {
    var termRegExp = (w.matchText == "/***\n") ? (/(^\*\*\*\/\n)/mg) : (/(^--->\n)/mg);
    w.subWikifyTerm(w.output,termRegExp);
  }
},

{
  name: "macro",
  match: "<<",
  lookaheadRegExp: /<<([^>\s]+)(?:\s*)((?:[^>]|(?:>(?!>)))*)>>/mg,
  handler: function(w)
  {
    this.lookaheadRegExp.lastIndex = w.matchStart;
    var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
    if(lookaheadMatch && lookaheadMatch.index == w.matchStart && lookaheadMatch[1]) {
      w.nextMatch = this.lookaheadRegExp.lastIndex;
      invokeMacro(w.output,lookaheadMatch[1],lookaheadMatch[2],w,w.tiddler);
    }
  }
},

{
  name: "prettyLink",
  match: "\\[\\[",
  lookaheadRegExp: /\[\[(.*?)(?:\|(~)?(.*?))?\]\]/mg,
  handler: function(w)
  {
    this.lookaheadRegExp.lastIndex = w.matchStart;
    var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
    if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
      var e;
      var text = lookaheadMatch[1];
      if(lookaheadMatch[3]) {
        // Pretty bracketted link
        var link = lookaheadMatch[3];
        e = (!lookaheadMatch[2] && config.formatterHelpers.isExternalLink(link)) ?
            createExternalLink(w.output,link) : createTiddlyLink(w.output,decodeURIComponent(link),false,null,w.isStatic,w.tiddler);
      } else {
        // Simple bracketted link
        e = createTiddlyLink(w.output,decodeURIComponent(text),false,null,w.isStatic,w.tiddler);
      }
      createTiddlyText(e,text);
      w.nextMatch = this.lookaheadRegExp.lastIndex;
    }
  }
},

{
  name: "wikiLink",
  match: config.textPrimitives.unWikiLink+"?"+config.textPrimitives.wikiLink,
  handler: function(w)
  {
    if(w.matchText.substr(0,1) == config.textPrimitives.unWikiLink) {
      w.outputText(w.output,w.matchStart+1,w.nextMatch);
      return;
    }
    if(w.matchStart > 0) {
      var preRegExp = new RegExp(config.textPrimitives.anyLetterStrict,"mg");
      preRegExp.lastIndex = w.matchStart-1;
      var preMatch = preRegExp.exec(w.source);
      if(preMatch.index == w.matchStart-1) {
        w.outputText(w.output,w.matchStart,w.nextMatch);
        return;
      }
    }
    if(w.autoLinkWikiWords || store.isShadowTiddler(w.matchText)) {
      var link = createTiddlyLink(w.output,w.matchText,false,null,w.isStatic,w.tiddler);
      w.outputText(link,w.matchStart,w.nextMatch);
    } else {
      w.outputText(w.output,w.matchStart,w.nextMatch);
    }
  }
},

{
  name: "urlLink",
  match: config.textPrimitives.urlPattern,
  handler: function(w)
  {
    w.outputText(createExternalLink(w.output,w.matchText),w.matchStart,w.nextMatch);
  }
},

{
  name: "image",
  match: "\\[[<>]?[Ii][Mm][Gg]\\[",
  lookaheadRegExp: /\[([<]?)(>?)[Ii][Mm][Gg]\[(?:([^\|\]]+)\|)?([^\[\]\|]+)\](?:\[([^\]]*)\])?\]/mg,
  handler: function(w)
  {
    this.lookaheadRegExp.lastIndex = w.matchStart;
    var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
    if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
      var e = w.output;
      if(lookaheadMatch[5]) {
        var link = lookaheadMatch[5];
        e = config.formatterHelpers.isExternalLink(link) ? createExternalLink(w.output,link) : createTiddlyLink(w.output,link,false,null,w.isStatic,w.tiddler);
        addClass(e,"imageLink");
      }
      var img = createTiddlyElement(e,"img");
      if(lookaheadMatch[1])
        img.align = "left";
      else if(lookaheadMatch[2])
        img.align = "right";
      if(lookaheadMatch[3]) {
        img.title = lookaheadMatch[3];
        img.setAttribute("alt",lookaheadMatch[3]);
      }
      img.src = lookaheadMatch[4];
      w.nextMatch = this.lookaheadRegExp.lastIndex;
    }
  }
},

{
  name: "html",
  match: "<[Hh][Tt][Mm][Ll]>",
  lookaheadRegExp: /<[Hh][Tt][Mm][Ll]>((?:.|\n)*?)<\/[Hh][Tt][Mm][Ll]>/mg,
  handler: function(w)
  {
    this.lookaheadRegExp.lastIndex = w.matchStart;
    var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
    if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
      createTiddlyElement(w.output,"span").innerHTML = lookaheadMatch[1];
      w.nextMatch = this.lookaheadRegExp.lastIndex;
    }
  }
},

{
  name: "commentByBlock",
  match: "/%",
  lookaheadRegExp: /\/%((?:.|\n)*?)%\//mg,
  handler: function(w)
  {
    this.lookaheadRegExp.lastIndex = w.matchStart;
    var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
    if(lookaheadMatch && lookaheadMatch.index == w.matchStart)
      w.nextMatch = this.lookaheadRegExp.lastIndex;
  }
},

{
  name: "characterFormat",
  match: "''|//|__|\\^\\^|~~|--(?!\\s|$)|\\{\\{\\{",
  handler: function(w)
  {
    switch(w.matchText) {
    case "''":
      w.subWikifyTerm(w.output.appendChild(document.createElement("strong")),/('')/mg);
      break;
    case "//":
      w.subWikifyTerm(createTiddlyElement(w.output,"em"),/(\/\/)/mg);
      break;
    case "__":
      w.subWikifyTerm(createTiddlyElement(w.output,"u"),/(__)/mg);
      break;
    case "^^":
      w.subWikifyTerm(createTiddlyElement(w.output,"sup"),/(\^\^)/mg);
      break;
    case "~~":
      w.subWikifyTerm(createTiddlyElement(w.output,"sub"),/(~~)/mg);
      break;
    case "--":
      w.subWikifyTerm(createTiddlyElement(w.output,"strike"),/(--)/mg);
      break;
    case "{{{":
      var lookaheadRegExp = /\{\{\{((?:.|\n)*?)\}\}\}/mg;
      lookaheadRegExp.lastIndex = w.matchStart;
      var lookaheadMatch = lookaheadRegExp.exec(w.source);
      if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
        createTiddlyElement(w.output,"code",null,null,lookaheadMatch[1]);
        w.nextMatch = lookaheadRegExp.lastIndex;
      }
      break;
    }
  }
},

{
  name: "customFormat",
  match: "@@|\\{\\{",
  handler: function(w)
  {
    switch(w.matchText) {
    case "@@":
      var e = createTiddlyElement(w.output,"span");
      var styles = config.formatterHelpers.inlineCssHelper(w);
      if(styles.length == 0)
        e.className = "marked";
      else
        config.formatterHelpers.applyCssHelper(e,styles);
      w.subWikifyTerm(e,/(@@)/mg);
      break;
    case "{{":
      var lookaheadRegExp = /\{\{[\s]*([\w]+[\s\w]*)[\s]*\{(\n?)/mg;
      lookaheadRegExp.lastIndex = w.matchStart;
      var lookaheadMatch = lookaheadRegExp.exec(w.source);
      if(lookaheadMatch) {
        w.nextMatch = lookaheadRegExp.lastIndex;
        e = createTiddlyElement(w.output,lookaheadMatch[2] == "\n" ? "div" : "span",null,lookaheadMatch[1]);
        w.subWikifyTerm(e,/(\}\}\})/mg);
      }
      break;
    }
  }
},

{
  name: "mdash",
  match: "--",
  handler: function(w)
  {
    createTiddlyElement(w.output,"span").innerHTML = "&mdash;";
  }
},

{
  name: "lineBreak",
  match: "\\n|<br ?/?>",
  handler: function(w)
  {
    createTiddlyElement(w.output,"br");
  }
},

{
  name: "rawText",
  match: "\"{3}|<nowiki>",
  lookaheadRegExp: /(?:\"{3}|<nowiki>)((?:.|\n)*?)(?:\"{3}|<\/nowiki>)/mg,
  handler: function(w)
  {
    this.lookaheadRegExp.lastIndex = w.matchStart;
    var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
    if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
      createTiddlyElement(w.output,"span",null,null,lookaheadMatch[1]);
      w.nextMatch = this.lookaheadRegExp.lastIndex;
    }
  }
},

{
  name: "htmlEntitiesEncoding",
  match: "(?:(?:&#?[a-zA-Z0-9]{2,8};|.)(?:&#?(?:x0*(?:3[0-6][0-9a-fA-F]|1D[c-fC-F][0-9a-fA-F]|20[d-fD-F][0-9a-fA-F]|FE2[0-9a-fA-F])|0*(?:76[89]|7[7-9][0-9]|8[0-7][0-9]|761[6-9]|76[2-7][0-9]|84[0-3][0-9]|844[0-7]|6505[6-9]|6506[0-9]|6507[0-1]));)+|&#?[a-zA-Z0-9]{2,8};)",
  handler: function(w)
  {
    createTiddlyElement(w.output,"span").innerHTML = w.matchText;
  }
}

];

//--
//-- Wikifier
//--

function getParser(tiddler,format)
{
  if(tiddler) {
    if(!format)
      format = tiddler.fields["wikiformat"];
    var i;
    if(format) {
      for(i in config.parsers) {
        if(format == config.parsers[i].format)
          return config.parsers[i];
      }
    } else {
      for(i in config.parsers) {
        if(tiddler.isTagged(config.parsers[i].formatTag))
          return config.parsers[i];
      }
    }
  }
  return formatter;
}

function wikify(source,output,highlightRegExp,tiddler)
{
  if(source) {
    var wikifier = new Wikifier(source,getParser(tiddler),highlightRegExp,tiddler);
    var t0 = new Date();
    wikifier.subWikify(output);
    if(tiddler && config.options.chkDisplayInstrumentation)
      displayMessage("wikify:" +tiddler.title+ " in " + (new Date()-t0) + " ms");
  }
}

function wikifyStatic(source,highlightRegExp,tiddler,format)
{
  var e = createTiddlyElement(document.body,"pre");
  e.style.display = "none";
  var html = "";
  if(source && source != "") {
    if(!tiddler)
      tiddler = new Tiddler("temp");
    var wikifier = new Wikifier(source,getParser(tiddler,format),highlightRegExp,tiddler);
    wikifier.isStatic = true;
    wikifier.subWikify(e);
    html = e.innerHTML;
    removeNode(e);
  }
  return html;
}

function wikifyPlain(title,theStore,limit)
{
  if(!theStore)
    theStore = store;
  if(theStore.tiddlerExists(title) || theStore.isShadowTiddler(title)) {
    return wikifyPlainText(theStore.getTiddlerText(title),limit,tiddler);
  } else {
    return "";
  }
}

function wikifyPlainText(text,limit,tiddler)
{
  if(limit > 0)
    text = text.substr(0,limit);
  var wikifier = new Wikifier(text,formatter,null,tiddler);
  return wikifier.wikifyPlain();
}

function highlightify(source,output,highlightRegExp,tiddler)
{
  if(source) {
    var wikifier = new Wikifier(source,formatter,highlightRegExp,tiddler);
    wikifier.outputText(output,0,source.length);
  }
}

function Wikifier(source,formatter,highlightRegExp,tiddler)
{
  this.source = source;
  this.output = null;
  this.formatter = formatter;
  this.nextMatch = 0;
  this.autoLinkWikiWords = tiddler && tiddler.autoLinkWikiWords() == false ? false : true;
  this.highlightRegExp = highlightRegExp;
  this.highlightMatch = null;
  this.isStatic = false;
  if(highlightRegExp) {
    highlightRegExp.lastIndex = 0;
    this.highlightMatch = highlightRegExp.exec(source);
  }
  this.tiddler = tiddler;
}

Wikifier.prototype.wikifyPlain = function()
{
  var e = createTiddlyElement(document.body,"div");
  e.style.display = "none";
  this.subWikify(e);
  var text = getPlainText(e);
  removeNode(e);
  return text;
};

Wikifier.prototype.subWikify = function(output,terminator)
{
  try {
    if(terminator)
      this.subWikifyTerm(output,new RegExp("(" + terminator + ")","mg"));
    else
      this.subWikifyUnterm(output);
  } catch(ex) {
    showException(ex);
  }
};

Wikifier.prototype.subWikifyUnterm = function(output)
{
  var oldOutput = this.output;
  this.output = output;
  this.formatter.formatterRegExp.lastIndex = this.nextMatch;
  var formatterMatch = this.formatter.formatterRegExp.exec(this.source);
  while(formatterMatch) {
    // Output any text before the match
    if(formatterMatch.index > this.nextMatch)
      this.outputText(this.output,this.nextMatch,formatterMatch.index);
    // Set the match parameters for the handler
    this.matchStart = formatterMatch.index;
    this.matchLength = formatterMatch[0].length;
    this.matchText = formatterMatch[0];
    this.nextMatch = this.formatter.formatterRegExp.lastIndex;
    for(var t=1; t<formatterMatch.length; t++) {
      if(formatterMatch[t]) {
        this.formatter.formatters[t-1].handler(this);
        this.formatter.formatterRegExp.lastIndex = this.nextMatch;
        break;
      }
    }
    formatterMatch = this.formatter.formatterRegExp.exec(this.source);
  }
  if(this.nextMatch < this.source.length) {
    this.outputText(this.output,this.nextMatch,this.source.length);
    this.nextMatch = this.source.length;
  }
  this.output = oldOutput;
};

Wikifier.prototype.subWikifyTerm = function(output,terminatorRegExp)
{
  var oldOutput = this.output;
  this.output = output;
  terminatorRegExp.lastIndex = this.nextMatch;
  var terminatorMatch = terminatorRegExp.exec(this.source);
  this.formatter.formatterRegExp.lastIndex = this.nextMatch;
  var formatterMatch = this.formatter.formatterRegExp.exec(terminatorMatch ? this.source.substr(0,terminatorMatch.index) : this.source);
  while(terminatorMatch || formatterMatch) {
    if(terminatorMatch && (!formatterMatch || terminatorMatch.index <= formatterMatch.index)) {
      if(terminatorMatch.index > this.nextMatch)
        this.outputText(this.output,this.nextMatch,terminatorMatch.index);
      this.matchText = terminatorMatch[1];
      this.matchLength = terminatorMatch[1].length;
      this.matchStart = terminatorMatch.index;
      this.nextMatch = this.matchStart + this.matchLength;
      this.output = oldOutput;
      return;
    }
    if(formatterMatch.index > this.nextMatch)
      this.outputText(this.output,this.nextMatch,formatterMatch.index);
    this.matchStart = formatterMatch.index;
    this.matchLength = formatterMatch[0].length;
    this.matchText = formatterMatch[0];
    this.nextMatch = this.formatter.formatterRegExp.lastIndex;
    for(var t=1; t<formatterMatch.length; t++) {
      if(formatterMatch[t]) {
        this.formatter.formatters[t-1].handler(this);
        this.formatter.formatterRegExp.lastIndex = this.nextMatch;
        break;
      }
    }
    terminatorRegExp.lastIndex = this.nextMatch;
    terminatorMatch = terminatorRegExp.exec(this.source);
    formatterMatch = this.formatter.formatterRegExp.exec(terminatorMatch ? this.source.substr(0,terminatorMatch.index) : this.source);
  }
  if(this.nextMatch < this.source.length) {
    this.outputText(this.output,this.nextMatch,this.source.length);
    this.nextMatch = this.source.length;
  }
  this.output = oldOutput;
};

Wikifier.prototype.outputText = function(place,startPos,endPos)
{
  while(this.highlightMatch && (this.highlightRegExp.lastIndex > startPos) && (this.highlightMatch.index < endPos) && (startPos < endPos)) {
    if(this.highlightMatch.index > startPos) {
      createTiddlyText(place,this.source.substring(startPos,this.highlightMatch.index));
      startPos = this.highlightMatch.index;
    }
    var highlightEnd = Math.min(this.highlightRegExp.lastIndex,endPos);
    var theHighlight = createTiddlyElement(place,"span",null,"highlight",this.source.substring(startPos,highlightEnd));
    startPos = highlightEnd;
    if(startPos >= this.highlightRegExp.lastIndex)
      this.highlightMatch = this.highlightRegExp.exec(this.source);
  }
  if(startPos < endPos) {
    createTiddlyText(place,this.source.substring(startPos,endPos));
  }
};

//--
//-- Macro definitions
//--

config.macros.today.handler = function(place,macroName,params)
{
  var now = new Date();
  var text = params[0] ? now.formatString(params[0].trim()) : now.toLocaleString();
  jQuery("<span/>").text(text).appendTo(place);
};

config.macros.version.handler = function(place)
{
  jQuery("<span/>").text(formatVersion()).appendTo(place);
};

config.macros.list.handler = function(place,macroName,params)
{
  var type = params[0] || "all";
  var list = document.createElement("ul");
  place.appendChild(list);
  if(this[type].prompt)
    createTiddlyElement(list,"li",null,"listTitle",this[type].prompt);
  var results;
  if(this[type].handler)
    results = this[type].handler(params);
  for(var t = 0; t < results.length; t++) {
    var li = document.createElement("li");
    list.appendChild(li);
    createTiddlyLink(li,typeof results[t] == "string" ? results[t] : results[t].title,true);
  }
};

config.macros.list.all.handler = function(params)
{
  return store.reverseLookup("tags","excludeLists",false,"title");
};

config.macros.list.missing.handler = function(params)
{
  return store.getMissingLinks();
};

config.macros.list.orphans.handler = function(params)
{
  return store.getOrphans();
};

config.macros.list.shadowed.handler = function(params)
{
  return store.getShadowed();
};

config.macros.list.touched.handler = function(params)
{
  return store.getTouched();
};

config.macros.list.filter.handler = function(params)
{
  var filter = params[1];
  var results = [];
  if(filter) {
    var tiddlers = store.filterTiddlers(filter);
    for(var t=0; t<tiddlers.length; t++)
      results.push(tiddlers[t].title);
  }
  return results;
};

config.macros.allTags.handler = function(place,macroName,params)
{
  var tags = store.getTags(params[0]);
  var ul = createTiddlyElement(place,"ul");
  if(tags.length == 0)
    createTiddlyElement(ul,"li",null,"listTitle",this.noTags);
  for(var t=0; t<tags.length; t++) {
    var title = tags[t][0];
    var info = getTiddlyLinkInfo(title);
    var li = createTiddlyElement(ul,"li");
    var btn = createTiddlyButton(li,title + " (" + tags[t][1] + ")",this.tooltip.format([title]),onClickTag,info.classes);
    btn.setAttribute("tag",title);
    btn.setAttribute("refresh","link");
    btn.setAttribute("tiddlyLink",title);
  }
};

config.macros.timeline.handler = function(place,macroName,params)
{
  var field = params[0] || "modified";
  var tiddlers = store.reverseLookup("tags","excludeLists",false,field);
  var lastDay = "";
  var last = params[1] ? tiddlers.length-Math.min(tiddlers.length,parseInt(params[1])) : 0;
  var dateFormat = params[2] || this.dateFormat;
  for(var t=tiddlers.length-1; t>=last; t--) {
    var tiddler = tiddlers[t];
    var theDay = tiddler[field].convertToLocalYYYYMMDDHHMM().substr(0,8);
    if(theDay != lastDay) {
      var ul = document.createElement("ul");
      place.appendChild(ul);
      createTiddlyElement(ul,"li",null,"listTitle",tiddler[field].formatString(dateFormat));
      lastDay = theDay;
    }
    createTiddlyElement(ul,"li",null,"listLink").appendChild(createTiddlyLink(place,tiddler.title,true));
  }
};

config.macros.tiddler.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
  params = paramString.parseParams("name",null,true,false,true);
  var names = params[0]["name"];
  var tiddlerName = names[0];
  var className = names[1] || null;
  var args = params[0]["with"];
  var wrapper = createTiddlyElement(place,"span",null,className);
  if(!args) {
    wrapper.setAttribute("refresh","content");
    wrapper.setAttribute("tiddler",tiddlerName);
  }
  var text = store.getTiddlerText(tiddlerName);
  if(text) {
    var stack = config.macros.tiddler.tiddlerStack;
    if(stack.indexOf(tiddlerName) !== -1)
      return;
    stack.push(tiddlerName);
    try {
      var n = args ? Math.min(args.length,9) : 0;
      for(var i=0; i<n; i++) {
        var placeholderRE = new RegExp("\\$" + (i + 1),"mg");
        text = text.replace(placeholderRE,args[i]);
      }
      config.macros.tiddler.renderText(wrapper,text,tiddlerName,params);
    } finally {
      stack.pop();
    }
  }
};

config.macros.tiddler.renderText = function(place,text,tiddlerName,params)
{
  wikify(text,place,null,store.getTiddler(tiddlerName));
};

config.macros.tiddler.tiddlerStack = [];

config.macros.tag.handler = function(place,macroName,params)
{
  createTagButton(place,params[0],null,params[1],params[2]);
};

config.macros.tags.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
  params = paramString.parseParams("anon",null,true,false,false);
  var ul = createTiddlyElement(place,"ul");
  var title = getParam(params,"anon","");
  if(title && store.tiddlerExists(title))
    tiddler = store.getTiddler(title);
  var sep = getParam(params,"sep"," ");
  var lingo = config.views.wikified.tag;
  var prompt = tiddler.tags.length == 0 ? lingo.labelNoTags : lingo.labelTags;
  createTiddlyElement(ul,"li",null,"listTitle",prompt.format([tiddler.title]));
  for(var t=0; t<tiddler.tags.length; t++) {
    var tag = store.getTiddler(tiddler.tags[t]); 
    if(!tag || !tag.tags.contains("excludeLists")) { 
      createTagButton(createTiddlyElement(ul,"li"),tiddler.tags[t],tiddler.title);
      if(t<tiddler.tags.length-1)
        createTiddlyText(ul,sep);
    }
  }
};

config.macros.tagging.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
  params = paramString.parseParams("anon",null,true,false,false);
  var ul = createTiddlyElement(place,"ul");
  var title = getParam(params,"anon","");
  if(title == "" && tiddler instanceof Tiddler)
    title = tiddler.title;
  var sep = getParam(params,"sep"," ");
  ul.setAttribute("title",this.tooltip.format([title]));
  var tagged = store.getTaggedTiddlers(title);
  var prompt = tagged.length == 0 ? this.labelNotTag : this.label;
  createTiddlyElement(ul,"li",null,"listTitle",prompt.format([title,tagged.length]));
  for(var t=0; t<tagged.length; t++) {
    createTiddlyLink(createTiddlyElement(ul,"li"),tagged[t].title,true);
    if(t<tagged.length-1)
      createTiddlyText(ul,sep);
  }
};

config.macros.closeAll.handler = function(place)
{
  createTiddlyButton(place,this.label,this.prompt,this.onClick);
};

config.macros.closeAll.onClick = function(e)
{
  story.closeAllTiddlers();
  return false;
};

config.macros.permaview.handler = function(place)
{
  createTiddlyButton(place,this.label,this.prompt,this.onClick);
};

config.macros.permaview.onClick = function(e)
{
  story.permaView();
  return false;
};

config.macros.saveChanges.handler = function(place,macroName,params)
{
  if(!readOnly)
    createTiddlyButton(place,params[0] || this.label,params[1] || this.prompt,this.onClick,null,null,this.accessKey);
};

config.macros.saveChanges.onClick = function(e)
{
  saveChanges();
  return false;
};

config.macros.slider.onClickSlider = function(ev)
{
  var e = ev || window.event;
  var n = this.nextSibling;
  var cookie = n.getAttribute("cookie");
  var isOpen = n.style.display != "none";
  if(config.options.chkAnimate && anim && typeof Slider == "function")
    anim.startAnimating(new Slider(n,!isOpen,null,"none"));
  else
    n.style.display = isOpen ? "none" : "block";
  config.options[cookie] = !isOpen;
  saveOptionCookie(cookie);
  return false;
};

config.macros.slider.createSlider = function(place,cookie,title,tooltip)
{
  var c = cookie || "";
  var btn = createTiddlyButton(place,title,tooltip,this.onClickSlider);
  var panel = createTiddlyElement(null,"div",null,"sliderPanel");
  panel.setAttribute("cookie",c);
  panel.style.display = config.options[c] ? "block" : "none";
  place.appendChild(panel);
  return panel;
};

config.macros.slider.handler = function(place,macroName,params)
{
  var panel = this.createSlider(place,params[0],params[2],params[3]);
  var text = store.getTiddlerText(params[1]);
  panel.setAttribute("refresh","content");
  panel.setAttribute("tiddler",params[1]);
  if(text)
    wikify(text,panel,null,store.getTiddler(params[1]));
};

// <<gradient [[tiddler name]] vert|horiz rgb rgb rgb rgb... >>
config.macros.gradient.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
  var panel = wikifier ? createTiddlyElement(place,"div",null,"gradient") : place;
  panel.style.position = "relative";
  panel.style.overflow = "hidden";
  panel.style.zIndex = "0";
  if(wikifier) {
    var styles = config.formatterHelpers.inlineCssHelper(wikifier);
    config.formatterHelpers.applyCssHelper(panel,styles);
  }
  params = paramString.parseParams("color");
  var locolors = [], hicolors = [];
  for(var t=2; t<params.length; t++) {
    var c = params[t].value;
    if(params[t].name == "snap") {
      hicolors[hicolors.length-1] = c;
    } else {
      locolors.push(c);
      hicolors.push(c);
    }
  }
  drawGradient(panel,params[1].value != "vert",locolors,hicolors);
  if(wikifier)
    wikifier.subWikify(panel,">>");
  if(document.all) {
    panel.style.height = "100%";
    panel.style.width = "100%";
  }
};

config.macros.message.handler = function(place,macroName,params)
{
  if(params[0]) {
    var names = params[0].split(".");
    var lookupMessage = function(root,nameIndex) {
        if(names[nameIndex] in root) {
          if(nameIndex < names.length-1)
            return (lookupMessage(root[names[nameIndex]],nameIndex+1));
          else
            return root[names[nameIndex]];
        } else
          return null;
      };
    var m = lookupMessage(config,0);
    if(m == null)
      m = lookupMessage(window,0);
    createTiddlyText(place,m.toString().format(params.splice(1)));
  }
};


config.macros.view.views = {
  text: function(value,place,params,wikifier,paramString,tiddler) {
    highlightify(value,place,highlightHack,tiddler);
  },
  link: function(value,place,params,wikifier,paramString,tiddler) {
    createTiddlyLink(place,value,true);
  },
  wikified: function(value,place,params,wikifier,paramString,tiddler) {
    if(params[2])
      value=params[2].unescapeLineBreaks().format([value]);
    wikify(value,place,highlightHack,tiddler);
  },
  date: function(value,place,params,wikifier,paramString,tiddler) {
    value = Date.convertFromYYYYMMDDHHMM(value);
    createTiddlyText(place,value.formatString(params[2] ? params[2] : config.views.wikified.dateFormat));
  }
};

config.macros.view.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
  if((tiddler instanceof Tiddler) && params[0]) {
    var value = store.getValue(tiddler,params[0]);
    if(value) {
      var type = params[1] || config.macros.view.defaultView;
      var handler = config.macros.view.views[type];
      if(handler)
        handler(value,place,params,wikifier,paramString,tiddler);
    }
  }
};

config.macros.edit.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
  var field = params[0];
  var rows = params[1] || 0;
  var defVal = params[2] || '';
  if((tiddler instanceof Tiddler) && field) {
    story.setDirty(tiddler.title,true);
    var e,v;
    if(field != "text" && !rows) {
      e = createTiddlyElement(null,"input");
      if(tiddler.isReadOnly())
        e.setAttribute("readOnly","readOnly");
      e.setAttribute("edit",field);
      e.setAttribute("type","text");
      e.value = store.getValue(tiddler,field) || defVal;
      e.setAttribute("size","40");
      e.setAttribute("autocomplete","off");
      place.appendChild(e);
    } else {
      var wrapper1 = createTiddlyElement(null,"fieldset",null,"fieldsetFix");
      var wrapper2 = createTiddlyElement(wrapper1,"div");
      e = createTiddlyElement(wrapper2,"textarea");
      if(tiddler.isReadOnly())
        e.setAttribute("readOnly","readOnly");
      e.value = v = store.getValue(tiddler,field) || defVal;
      rows = rows || 10;
      var lines = v.match(/\n/mg);
      var maxLines = Math.max(parseInt(config.options.txtMaxEditRows),5);
      if(lines != null && lines.length > rows)
        rows = lines.length + 5;
      rows = Math.min(rows,maxLines);
      e.setAttribute("rows",rows);
      e.setAttribute("edit",field);
      place.appendChild(wrapper1);
    }
    return e;
  }
};

config.macros.tagChooser.onClick = function(ev)
{
  var e = ev || window.event;
  var lingo = config.views.editor.tagChooser;
  var popup = Popup.create(this);
  var tags = store.getTags(this.getAttribute("tags"));
  if(tags.length == 0)
    jQuery("<li/>").text(lingo.popupNone).appendTo(jQuery(popup));
  for(var t=0; t<tags.length; t++) {
    var tag = createTiddlyButton(createTiddlyElement(popup,"li"),tags[t][0],lingo.tagTooltip.format([tags[t][0]]),config.macros.tagChooser.onTagClick);
    tag.setAttribute("tag",tags[t][0]);
    tag.setAttribute("tiddler",this.getAttribute("tiddler"));
  }
  Popup.show();
  e.cancelBubble = true;
  if(e.stopPropagation) e.stopPropagation();
  return false;
};

config.macros.tagChooser.onTagClick = function(ev)
{
  var e = ev || window.event;
  if(e.metaKey || e.ctrlKey) stopEvent(e); //# keep popup open on CTRL-click
  var tag = this.getAttribute("tag");
  var title = this.getAttribute("tiddler");
  if(!readOnly)
    story.setTiddlerTag(title,tag,0);
  return false;
};

config.macros.tagChooser.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
  if(tiddler instanceof Tiddler) {
    var lingo = config.views.editor.tagChooser;
    var btn = createTiddlyButton(place,lingo.text,lingo.tooltip,this.onClick);
    btn.setAttribute("tiddler",tiddler.title);
    btn.setAttribute("tags",params[0]);
  }
};

config.macros.refreshDisplay.handler = function(place)
{
  createTiddlyButton(place,this.label,this.prompt,this.onClick);
};

config.macros.refreshDisplay.onClick = function(e)
{
  refreshAll();
  return false;
};

config.macros.annotations.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
  var title = tiddler ? tiddler.title : null;
  var a = title ? config.annotations[title] : null;
  if(!tiddler || !title || !a)
    return;
  var text = a.format([title]);
  wikify(text,createTiddlyElement(place,"div",null,"annotation"),null,tiddler);
};

//--
//-- NewTiddler and NewJournal macros
//--

config.macros.newTiddler.createNewTiddlerButton = function(place,title,params,label,prompt,accessKey,newFocus,isJournal)
{
  var tags = [];
  for(var t=1; t<params.length; t++) {
    if((params[t].name == "anon" && t != 1) || (params[t].name == "tag"))
      tags.push(params[t].value);
  }
  label = getParam(params,"label",label);
  prompt = getParam(params,"prompt",prompt);
  accessKey = getParam(params,"accessKey",accessKey);
  newFocus = getParam(params,"focus",newFocus);
  var customFields = getParam(params,"fields","");
  if(!customFields && !store.isShadowTiddler(title))
    customFields = String.encodeHashMap(config.defaultCustomFields);
  var btn = createTiddlyButton(place,label,prompt,this.onClickNewTiddler,null,null,accessKey);
  btn.setAttribute("newTitle",title);
  btn.setAttribute("isJournal",isJournal ? "true" : "false");
  if(tags.length > 0)
    btn.setAttribute("params",tags.join("|"));
  btn.setAttribute("newFocus",newFocus);
  btn.setAttribute("newTemplate",getParam(params,"template",DEFAULT_EDIT_TEMPLATE));
  if(customFields !== "")
    btn.setAttribute("customFields",customFields);
  var text = getParam(params,"text");
  if(text !== undefined)
    btn.setAttribute("newText",text);
  return btn;
};

config.macros.newTiddler.onClickNewTiddler = function()
{
  var title = this.getAttribute("newTitle");
  if(this.getAttribute("isJournal") == "true") {
    title = new Date().formatString(title.trim());
  }
  var params = this.getAttribute("params");
  var tags = params ? params.split("|") : [];
  var focus = this.getAttribute("newFocus");
  var template = this.getAttribute("newTemplate");
  var customFields = this.getAttribute("customFields");
  if(!customFields && !store.isShadowTiddler(title))
    customFields = String.encodeHashMap(config.defaultCustomFields);
  story.displayTiddler(null,title,template,false,null,null);
  var tiddlerElem = story.getTiddler(title);
  if(customFields)
    story.addCustomFields(tiddlerElem,customFields);
  var text = this.getAttribute("newText");
  if(typeof text == "string" && story.getTiddlerField(title,"text"))
    story.getTiddlerField(title,"text").value = text.format([title]);
  for(var t=0;t<tags.length;t++)
    story.setTiddlerTag(title,tags[t],+1);
  story.focusTiddler(title,focus);
  return false;
};

config.macros.newTiddler.handler = function(place,macroName,params,wikifier,paramString)
{
  if(!readOnly) {
    params = paramString.parseParams("anon",null,true,false,false);
    var title = params[1] && params[1].name == "anon" ? params[1].value : this.title;
    title = getParam(params,"title",title);
    this.createNewTiddlerButton(place,title,params,this.label,this.prompt,this.accessKey,"title",false);
  }
};

config.macros.newJournal.handler = function(place,macroName,params,wikifier,paramString)
{
  if(!readOnly) {
    params = paramString.parseParams("anon",null,true,false,false);
    var title = params[1] && params[1].name == "anon" ? params[1].value : config.macros.timeline.dateFormat;
    title = getParam(params,"title",title);
    config.macros.newTiddler.createNewTiddlerButton(place,title,params,this.label,this.prompt,this.accessKey,"text",true);
  }
};

//--
//-- Search macro
//--

config.macros.search.handler = function(place,macroName,params)
{
  var searchTimeout = null;
  var btn = createTiddlyButton(place,this.label,this.prompt,this.onClick,"searchButton");
  var txt = createTiddlyElement(null,"input",null,"txtOptionInput searchField");
  if(params[0])
    txt.value = params[0];
  if(config.browser.isSafari) {
    txt.setAttribute("type","search");
    txt.setAttribute("results","5");
  } else {
    txt.setAttribute("type","text");
  }
  place.appendChild(txt);
  txt.onkeyup = this.onKeyPress;
  txt.onfocus = this.onFocus;
  txt.setAttribute("size",this.sizeTextbox);
  txt.setAttribute("accessKey",params[1] || this.accessKey);
  txt.setAttribute("autocomplete","off");
  txt.setAttribute("lastSearchText","");
};

// Global because there's only ever one outstanding incremental search timer
config.macros.search.timeout = null;

config.macros.search.doSearch = function(txt)
{
  if(txt.value.length > 0) {
    story.search(txt.value,config.options.chkCaseSensitiveSearch,config.options.chkRegExpSearch);
    txt.setAttribute("lastSearchText",txt.value);
  }
};

config.macros.search.onClick = function(e)
{
  config.macros.search.doSearch(this.nextSibling);
  return false;
};

config.macros.search.onKeyPress = function(ev)
{
  var e = ev || window.event;
  switch(e.keyCode) {
    case 13: // Ctrl-Enter
    case 10: // Ctrl-Enter on IE PC
      config.macros.search.doSearch(this);
      break;
    case 27: // Escape
      this.value = "";
      clearMessage();
      break;
  }
  if(config.options.chkIncrementalSearch) {
    if(this.value.length > 2) {
      if(this.value != this.getAttribute("lastSearchText")) {
        if(config.macros.search.timeout)
          clearTimeout(config.macros.search.timeout);
        var txt = this;
        config.macros.search.timeout = setTimeout(function() {config.macros.search.doSearch(txt);},500);
      }
    } else {
      if(config.macros.search.timeout)
        clearTimeout(config.macros.search.timeout);
    }
  }
};

config.macros.search.onFocus = function(e)
{
  this.select();
};

//--
//-- Tabs macro
//--

config.macros.tabs.handler = function(place,macroName,params)
{
  var cookie = params[0];
  var numTabs = (params.length-1)/3;
  var wrapper = createTiddlyElement(null,"div",null,"tabsetWrapper " + cookie);
  var tabset = createTiddlyElement(wrapper,"div",null,"tabset");
  tabset.setAttribute("cookie",cookie);
  var validTab = false;
  for(var t=0; t<numTabs; t++) {
    var label = params[t*3+1];
    var prompt = params[t*3+2];
    var content = params[t*3+3];
    var tab = createTiddlyButton(tabset,label,prompt,this.onClickTab,"tab tabUnselected");
    tab.setAttribute("tab",label);
    tab.setAttribute("content",content);
    tab.title = prompt;
    if(config.options[cookie] == label)
      validTab = true;
  }
  if(!validTab)
    config.options[cookie] = params[1];
  place.appendChild(wrapper);
  this.switchTab(tabset,config.options[cookie]);
};

config.macros.tabs.onClickTab = function(e)
{
  config.macros.tabs.switchTab(this.parentNode,this.getAttribute("tab"));
  return false;
};

config.macros.tabs.switchTab = function(tabset,tab)
{
  var cookie = tabset.getAttribute("cookie");
  var theTab = null;
  var nodes = tabset.childNodes;
  for(var t=0; t<nodes.length; t++) {
    if(nodes[t].getAttribute && nodes[t].getAttribute("tab") == tab) {
      theTab = nodes[t];
      theTab.className = "tab tabSelected";
    } else {
      nodes[t].className = "tab tabUnselected";
    }
  }
  if(theTab) {
    if(tabset.nextSibling && tabset.nextSibling.className == "tabContents")
      removeNode(tabset.nextSibling);
    var tabContent = createTiddlyElement(null,"div",null,"tabContents");
    tabset.parentNode.insertBefore(tabContent,tabset.nextSibling);
    var contentTitle = theTab.getAttribute("content");
    wikify(store.getTiddlerText(contentTitle),tabContent,null,store.getTiddler(contentTitle));
    if(cookie) {
      config.options[cookie] = tab;
      saveOptionCookie(cookie);
    }
  }
};

//--
//-- Tiddler toolbar
//--

// Create a toolbar command button
config.macros.toolbar.createCommand = function(place,commandName,tiddler,className)
{
  if(typeof commandName != "string") {
    var c = null;
    for(var t in config.commands) {
      if(config.commands[t] == commandName)
        c = t;
    }
    commandName = c;
  }
  if((tiddler instanceof Tiddler) && (typeof commandName == "string")) {
    var command = config.commands[commandName];
    if(command.isEnabled ? command.isEnabled(tiddler) : this.isCommandEnabled(command,tiddler)) {
      var text = command.getText ? command.getText(tiddler) : this.getCommandText(command,tiddler);
      var tooltip = command.getTooltip ? command.getTooltip(tiddler) : this.getCommandTooltip(command,tiddler);
      var cmd;
      switch(command.type) {
      case "popup":
        cmd = this.onClickPopup;
        break;
      case "command":
      default:
        cmd = this.onClickCommand;
        break;
      }
      var btn = createTiddlyButton(null,text,tooltip,cmd);
      btn.setAttribute("commandName",commandName);
      btn.setAttribute("tiddler",tiddler.title);
      addClass(btn,"command_" + commandName);
      if(className)
        addClass(btn,className);
      place.appendChild(btn);
    }
  }
};

config.macros.toolbar.isCommandEnabled = function(command,tiddler)
{
  var title = tiddler.title;
  var ro = tiddler.isReadOnly();
  var shadow = store.isShadowTiddler(title) && !store.tiddlerExists(title);
  return (!ro || (ro && !command.hideReadOnly)) && !(shadow && command.hideShadow);
};

config.macros.toolbar.getCommandText = function(command,tiddler)
{
  return tiddler.isReadOnly() && command.readOnlyText || command.text;
};

config.macros.toolbar.getCommandTooltip = function(command,tiddler)
{
  return tiddler.isReadOnly() && command.readOnlyTooltip || command.tooltip;
};

config.macros.toolbar.onClickCommand = function(ev)
{
  var e = ev || window.event;
  e.cancelBubble = true;
  if(e.stopPropagation) e.stopPropagation();
  var command = config.commands[this.getAttribute("commandName")];
  return command.handler(e,this,this.getAttribute("tiddler"));
};

config.macros.toolbar.onClickPopup = function(ev)
{
  var e = ev || window.event;
  e.cancelBubble = true;
  if(e.stopPropagation) e.stopPropagation();
  var popup = Popup.create(this);
  var command = config.commands[this.getAttribute("commandName")];
  var title = this.getAttribute("tiddler");
  var tiddler = store.fetchTiddler(title);
  popup.setAttribute("tiddler",title);
  command.handlePopup(popup,title);
  Popup.show();
  return false;
};

// Invoke the first command encountered from a given place that is tagged with a specified class
config.macros.toolbar.invokeCommand = function(place,className,event)
{
  var children = place.getElementsByTagName("a");
  for(var t=0; t<children.length; t++) {
    var c = children[t];
    if(hasClass(c,className) && c.getAttribute && c.getAttribute("commandName")) {
      if(c.onclick instanceof Function)
        c.onclick.call(c,event);
      break;
    }
  }
};

config.macros.toolbar.onClickMore = function(ev)
{
  var e = this.nextSibling;
  e.style.display = "inline";
  this.style.display = "none";
  return false;
};

config.macros.toolbar.onClickLess = function(ev)
{
  var e = this.parentNode;
  var m = e.previousSibling;
  e.style.display = "none";
  m.style.display = "inline";
  return false;
};

config.macros.toolbar.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
  for(var t=0; t<params.length; t++) {
    var c = params[t];
    switch(c) {
    case "!":
      createTiddlyText(place,this.separator);
      break;
    case "*":
      createTiddlyElement(place,"br");
      break;
    case "<":
      var btn = createTiddlyButton(place,this.lessLabel,this.lessPrompt,config.macros.toolbar.onClickLess);
      addClass(btn,"lessCommand");
      break;
    case ">":
      var btn = createTiddlyButton(place,this.moreLabel,this.morePrompt,config.macros.toolbar.onClickMore);
      addClass(btn,"moreCommand");
      var e = createTiddlyElement(place,"span",null,"moreCommand");
      e.style.display = "none";
      place = e;
      break;
    default:
      var className = "";
      switch(c.substr(0,1)) {
      case "+":
        className = "defaultCommand";
        c = c.substr(1);
        break;
      case "-":
        className = "cancelCommand";
        c = c.substr(1);
        break;
      }
      if(c in config.commands)
        this.createCommand(place,c,tiddler,className);
      break;
    }
  }
};

//--
//-- Menu and toolbar commands
//--

config.commands.closeTiddler.handler = function(event,src,title)
{
  if(story.isDirty(title) && !readOnly) {
    if(!confirm(config.commands.cancelTiddler.warning.format([title])))
      return false;
  }
  story.setDirty(title,false);
  story.closeTiddler(title,true);
  return false;
};

config.commands.closeOthers.handler = function(event,src,title)
{
  story.closeAllTiddlers(title);
  return false;
};

config.commands.editTiddler.handler = function(event,src,title)
{
  clearMessage();
  var tiddlerElem = story.getTiddler(title);
  var fields = tiddlerElem.getAttribute("tiddlyFields");
  story.displayTiddler(null,title,DEFAULT_EDIT_TEMPLATE,false,null,fields);
  story.focusTiddler(title,config.options.txtEditorFocus||"text");
  return false;
};

config.commands.saveTiddler.handler = function(event,src,title)
{
  var newTitle = story.saveTiddler(title,event.shiftKey);
  if(newTitle)
    story.displayTiddler(null,newTitle);
  return false;
};

config.commands.cancelTiddler.handler = function(event,src,title)
{
  if(story.hasChanges(title) && !readOnly) {
    if(!confirm(this.warning.format([title])))
      return false;
  }
  story.setDirty(title,false);
  story.displayTiddler(null,title);
  return false;
};

config.commands.deleteTiddler.handler = function(event,src,title)
{
  var deleteIt = true;
  if(config.options.chkConfirmDelete)
    deleteIt = confirm(this.warning.format([title]));
  if(deleteIt) {
    store.removeTiddler(title);
    story.closeTiddler(title,true);
    autoSaveChanges();
  }
  return false;
};

config.commands.permalink.handler = function(event,src,title)
{
  var t = encodeURIComponent(String.encodeTiddlyLink(title));
  if(window.location.hash != t)
    window.location.hash = t;
  return false;
};

config.commands.references.handlePopup = function(popup,title)
{
  var references = store.getReferringTiddlers(title);
  var c = false;
  for(var r=0; r<references.length; r++) {
    if(references[r].title != title && !references[r].isTagged("excludeLists")) {
      createTiddlyLink(createTiddlyElement(popup,"li"),references[r].title,true);
      c = true;
    }
  }
  if(!c)
    createTiddlyElement(popup,"li",null,"disabled",this.popupNone);
};

config.commands.jump.handlePopup = function(popup,title)
{
  story.forEachTiddler(function(title,element) {
    createTiddlyLink(createTiddlyElement(popup,"li"),title,true,null,false,null,true);
    });
};

config.commands.syncing.handlePopup = function(popup,title)
{
  var tiddler = store.fetchTiddler(title);
  if(!tiddler)
    return;
  var serverType = tiddler.getServerType();
  var serverHost = tiddler.fields["server.host"];
  var serverWorkspace = tiddler.fields["server.workspace"];
  if(!serverWorkspace)
    serverWorkspace = "";
  if(serverType) {
    var e = createTiddlyElement(popup,"li",null,"popupMessage");
    e.innerHTML = config.commands.syncing.currentlySyncing.format([serverType,serverHost,serverWorkspace]);
  } else {
    createTiddlyElement(popup,"li",null,"popupMessage",config.commands.syncing.notCurrentlySyncing);
  }
  if(serverType) {
    createTiddlyElement(createTiddlyElement(popup,"li",null,"listBreak"),"div");
    var btn = createTiddlyButton(createTiddlyElement(popup,"li"),this.captionUnSync,null,config.commands.syncing.onChooseServer);
    btn.setAttribute("tiddler",title);
    btn.setAttribute("server.type","");
  }
  createTiddlyElement(createTiddlyElement(popup,"li",null,"listBreak"),"div");
  createTiddlyElement(popup,"li",null,"popupMessage",config.commands.syncing.chooseServer);
  var feeds = store.getTaggedTiddlers("systemServer","title");
  for(var t=0; t<feeds.length; t++) {
    var f = feeds[t];
    var feedServerType = store.getTiddlerSlice(f.title,"Type");
    if(!feedServerType)
      feedServerType = "file";
    var feedServerHost = store.getTiddlerSlice(f.title,"URL");
    if(!feedServerHost)
      feedServerHost = "";
    var feedServerWorkspace = store.getTiddlerSlice(f.title,"Workspace");
    if(!feedServerWorkspace)
      feedServerWorkspace = "";
    var caption = f.title;
    if(serverType == feedServerType && serverHost == feedServerHost && serverWorkspace == feedServerWorkspace) {
      caption = config.commands.syncing.currServerMarker + caption;
    } else {
      caption = config.commands.syncing.notCurrServerMarker + caption;
    }
    btn = createTiddlyButton(createTiddlyElement(popup,"li"),caption,null,config.commands.syncing.onChooseServer);
    btn.setAttribute("tiddler",title);
    btn.setAttribute("server.type",feedServerType);
    btn.setAttribute("server.host",feedServerHost);
    btn.setAttribute("server.workspace",feedServerWorkspace);
  }
};

config.commands.syncing.onChooseServer = function(e)
{
  var tiddler = this.getAttribute("tiddler");
  var serverType = this.getAttribute("server.type");
  if(serverType) {
    store.addTiddlerFields(tiddler,{
      "server.type": serverType,
      "server.host": this.getAttribute("server.host"),
      "server.workspace": this.getAttribute("server.workspace")
      });
  } else {
    store.setValue(tiddler,"server",null);
  }
  return false;
};

config.commands.fields.handlePopup = function(popup,title)
{
  var tiddler = store.fetchTiddler(title);
  if(!tiddler)
    return;
  var items = [];
  store.forEachField(tiddler,function(tiddler,fieldName,value){items.push({field:fieldName,value:value});},true);
  items.sort(function(a,b) {return a.field < b.field ? -1 : (a.field == b.field ? 0 : +1);});
  if(items.length > 0)
    ListView.create(popup,items,this.listViewTemplate);
  else
    createTiddlyElement(popup,"div",null,null,this.emptyText);
};

//--
//-- Tiddler() object
//--

function Tiddler(title)
{
  this.title = title;
  this.text = "";
  this.modifier = null;
  this.created = new Date();
  this.modified = this.created;
  this.links = [];
  this.linksUpdated = false;
  this.tags = [];
  this.fields = {};
  return this;
}

Tiddler.prototype.getLinks = function()
{
  if(this.linksUpdated==false)
    this.changed();
  return this.links;
};

// Returns the fields that are inherited in string field:"value" field2:"value2" format
Tiddler.prototype.getInheritedFields = function()
{
  var f = {};
  for(var i in this.fields) {
    if(i=="server.host" || i=="server.workspace" || i=="wikiformat"|| i=="server.type") {
      f[i] = this.fields[i];
    }
  }
  return String.encodeHashMap(f);
};

// Increment the changeCount of a tiddler
Tiddler.prototype.incChangeCount = function()
{
  var c = this.fields['changecount'];
  c = c ? parseInt(c,10) : 0;
  this.fields['changecount'] = String(c+1);
};

// Clear the changeCount of a tiddler
Tiddler.prototype.clearChangeCount = function()
{
  if(this.fields['changecount']) {
    delete this.fields['changecount'];
  }
};

Tiddler.prototype.doNotSave = function()
{
  return this.fields['doNotSave'];
};

// Returns true if the tiddler has been updated since the tiddler was created or downloaded
Tiddler.prototype.isTouched = function()
{
  var changeCount = this.fields['changecount'];
  if(changeCount === undefined)
    changeCount = 0;
  return changeCount > 0;
};

// Change the text and other attributes of a tiddler
Tiddler.prototype.set = function(title,text,modifier,modified,tags,created,fields)
{
  this.assign(title,text,modifier,modified,tags,created,fields);
  this.changed();
  return this;
};

// Change the text and other attributes of a tiddler without triggered a tiddler.changed() call
Tiddler.prototype.assign = function(title,text,modifier,modified,tags,created,fields)
{
  if(title != undefined)
    this.title = title;
  if(text != undefined)
    this.text = text;
  if(modifier != undefined)
    this.modifier = modifier;
  if(modified != undefined)
    this.modified = modified;
  if(created != undefined)
    this.created = created;
  if(fields != undefined)
    this.fields = fields;
  if(tags != undefined)
    this.tags = (typeof tags == "string") ? tags.readBracketedList() : tags;
  else if(this.tags == undefined)
    this.tags = [];
  return this;
};

// Get the tags for a tiddler as a string (space delimited, using [[brackets]] for tags containing spaces)
Tiddler.prototype.getTags = function()
{
  return String.encodeTiddlyLinkList(this.tags);
};

// Test if a tiddler carries a tag
Tiddler.prototype.isTagged = function(tag)
{
  return this.tags.indexOf(tag) != -1;
};

// Static method to convert "\n" to newlines, "\s" to "\"
Tiddler.unescapeLineBreaks = function(text)
{
  return text ? text.unescapeLineBreaks() : "";
};

// Convert newlines to "\n", "\" to "\s"
Tiddler.prototype.escapeLineBreaks = function()
{
  return this.text.escapeLineBreaks();
};

// Updates the secondary information (like links[] array) after a change to a tiddler
Tiddler.prototype.changed = function()
{
  this.links = [];
  var text = this.text;
  // remove 'quoted' text before scanning tiddler source
  text = text.replace(/\/%((?:.|\n)*?)%\//g,"").
    replace(/\{{3}((?:.|\n)*?)\}{3}/g,"").
    replace(/"""((?:.|\n)*?)"""/g,"").
    replace(/\<nowiki\>((?:.|\n)*?)\<\/nowiki\>/g,"").
    replace(/\<html\>((?:.|\n)*?)\<\/html\>/g,"").
    replace(/\<script((?:.|\n)*?)\<\/script\>/g,"");
  var t = this.autoLinkWikiWords() ? 0 : 1;
  var tiddlerLinkRegExp = t==0 ? config.textPrimitives.tiddlerAnyLinkRegExp : config.textPrimitives.tiddlerForcedLinkRegExp;
  tiddlerLinkRegExp.lastIndex = 0;
  var formatMatch = tiddlerLinkRegExp.exec(text);
  while(formatMatch) {
    var lastIndex = tiddlerLinkRegExp.lastIndex;
    if(t==0 && formatMatch[1] && formatMatch[1] != this.title) {
      // wikiWordLink
      if(formatMatch.index > 0) {
        var preRegExp = new RegExp(config.textPrimitives.unWikiLink+"|"+config.textPrimitives.anyLetter,"mg");
        preRegExp.lastIndex = formatMatch.index-1;
        var preMatch = preRegExp.exec(text);
        if(preMatch.index != formatMatch.index-1)
          this.links.pushUnique(formatMatch[1]);
      } else {
        this.links.pushUnique(formatMatch[1]);
      }
    }
    else if(formatMatch[2-t] && !config.formatterHelpers.isExternalLink(formatMatch[3-t])) // titledBrackettedLink
      this.links.pushUnique(formatMatch[3-t]);
    else if(formatMatch[4-t] && formatMatch[4-t] != this.title) // brackettedLink
      this.links.pushUnique(formatMatch[4-t]);
    tiddlerLinkRegExp.lastIndex = lastIndex;
    formatMatch = tiddlerLinkRegExp.exec(text);
  }
  this.linksUpdated = true;
};

Tiddler.prototype.getSubtitle = function()
{
  var modifier = this.modifier;
  if(!modifier)
    modifier = config.messages.subtitleUnknown;
  var modified = this.modified;
  if(modified)
    modified = modified.toLocaleString();
  else
    modified = config.messages.subtitleUnknown;
  return config.messages.tiddlerLinkTooltip.format([this.title,modifier,modified]);
};

Tiddler.prototype.isReadOnly = function()
{
  return readOnly;
};

Tiddler.prototype.autoLinkWikiWords = function()
{
  return !(this.isTagged("systemConfig") || this.isTagged("excludeMissing"));
};

Tiddler.prototype.getServerType = function()
{
  var serverType = null;
  if(this.fields['server.type'])
    serverType = this.fields['server.type'];
  if(!serverType)
    serverType = this.fields['wikiformat'];
  if(serverType && !config.adaptors[serverType])
    serverType = null;
  return serverType;
};

Tiddler.prototype.getAdaptor = function()
{
  var serverType = this.getServerType();
  return serverType ? new config.adaptors[serverType]() : null;
};

//--
//-- TiddlyWiki() object contains Tiddler()s
//--

function TiddlyWiki()
{
  var tiddlers = {}; // Hashmap by name of tiddlers
  this.tiddlersUpdated = false;
  this.namedNotifications = []; // Array of {name:,notify:} of notification functions
  this.notificationLevel = 0;
  this.slices = {}; // map tiddlerName->(map sliceName->sliceValue). Lazy.
  this.clear = function() {
    tiddlers = {};
    this.setDirty(false);
  };
  this.fetchTiddler = function(title) {
    var t = tiddlers[title];
    return t instanceof Tiddler ? t : null;
  };
  this.deleteTiddler = function(title) {
    delete this.slices[title];
    delete tiddlers[title];
  };
  this.addTiddler = function(tiddler) {
    delete this.slices[tiddler.title];
    tiddlers[tiddler.title] = tiddler;
  };
  this.forEachTiddler = function(callback) {
    for(var t in tiddlers) {
      var tiddler = tiddlers[t];
      if(tiddler instanceof Tiddler)
        callback.call(this,t,tiddler);
    }
  };
}

TiddlyWiki.prototype.setDirty = function(dirty)
{
  this.dirty = dirty;
};

TiddlyWiki.prototype.isDirty = function()
{
  return this.dirty;
};

TiddlyWiki.prototype.tiddlerExists = function(title)
{
  var t = this.fetchTiddler(title);
  return t != undefined;
};

TiddlyWiki.prototype.isShadowTiddler = function(title)
{
  return config.shadowTiddlers[title] === undefined ? false : true;
};

TiddlyWiki.prototype.createTiddler = function(title)
{
  var tiddler = this.fetchTiddler(title);
  if(!tiddler) {
    tiddler = new Tiddler(title);
    this.addTiddler(tiddler);
    this.setDirty(true);
  }
  return tiddler;
};

TiddlyWiki.prototype.getTiddler = function(title)
{
  var t = this.fetchTiddler(title);
  if(t != undefined)
    return t;
  else
    return null;
};

TiddlyWiki.prototype.getShadowTiddlerText = function(title)
{
  if(typeof config.shadowTiddlers[title] == "string")
    return config.shadowTiddlers[title];
  else
    return "";
};

// Retrieve tiddler contents
TiddlyWiki.prototype.getTiddlerText = function(title,defaultText)
{
  if(!title)
    return defaultText;
  var pos = title.indexOf(config.textPrimitives.sectionSeparator);
  var section = null;
  if(pos != -1) {
    section = title.substr(pos + config.textPrimitives.sectionSeparator.length);
    title = title.substr(0,pos);
  }
  pos = title.indexOf(config.textPrimitives.sliceSeparator);
  if(pos != -1) {
    var slice = this.getTiddlerSlice(title.substr(0,pos),title.substr(pos + config.textPrimitives.sliceSeparator.length));
    if(slice)
      return slice;
  }
  var tiddler = this.fetchTiddler(title);
  if(tiddler) {
    if(!section)
      return tiddler.text;
    var re = new RegExp("(^!{1,6}" + section.escapeRegExp() + "[ \t]*\n)","mg");
    re.lastIndex = 0;
    var match = re.exec(tiddler.text);
    if(match) {
      var t = tiddler.text.substr(match.index+match[1].length);
      var re2 = /^!/mg;
      re2.lastIndex = 0;
      match = re2.exec(t); //# search for the next heading
      if(match)
        t = t.substr(0,match.index-1);//# don't include final \n
      return t;
    }
    return defaultText;
  }
  if(this.isShadowTiddler(title))
    return this.getShadowTiddlerText(title);
  if(defaultText != undefined)
    return defaultText;
  return null;
};

TiddlyWiki.prototype.getRecursiveTiddlerText = function(title,defaultText,depth)
{
  var bracketRegExp = new RegExp("(?:\\[\\[([^\\]]+)\\]\\])","mg");
  var text = this.getTiddlerText(title,null);
  if(text == null)
    return defaultText;
  var textOut = [];
  var lastPos = 0;
  do {
    var match = bracketRegExp.exec(text);
    if(match) {
      textOut.push(text.substr(lastPos,match.index-lastPos));
      if(match[1]) {
        if(depth <= 0)
          textOut.push(match[1]);
        else
          textOut.push(this.getRecursiveTiddlerText(match[1],"[[" + match[1] + "]]",depth-1));
      }
      lastPos = match.index + match[0].length;
    } else {
      textOut.push(text.substr(lastPos));
    }
  } while(match);
  return textOut.join("");
};

TiddlyWiki.prototype.slicesRE = /(?:^([\'\/]{0,2})~?([\.\w]+)\:\1[\t\x20]*([^\n]+)[\t\x20]*$)|(?:^\|([\'\/]{0,2})~?([\.\w]+)\:?\4\|[\t\x20]*([^\n]+)[\t\x20]*\|$)/gm;

// @internal
TiddlyWiki.prototype.calcAllSlices = function(title)
{
  var slices = {};
  var text = this.getTiddlerText(title,"");
  this.slicesRE.lastIndex = 0;
  var m = this.slicesRE.exec(text);
  while(m) {
    if(m[2])
      slices[m[2]] = m[3];
    else
      slices[m[5]] = m[6];
    m = this.slicesRE.exec(text);
  }
  return slices;
};

// Returns the slice of text of the given name
TiddlyWiki.prototype.getTiddlerSlice = function(title,sliceName)
{
  var slices = this.slices[title];
  if(!slices) {
    slices = this.calcAllSlices(title);
    this.slices[title] = slices;
  }
  return slices[sliceName];
};

// Build an hashmap of the specified named slices of a tiddler
TiddlyWiki.prototype.getTiddlerSlices = function(title,sliceNames)
{
  var r = {};
  for(var t=0; t<sliceNames.length; t++) {
    var slice = this.getTiddlerSlice(title,sliceNames[t]);
    if(slice)
      r[sliceNames[t]] = slice;
  }
  return r;
};

TiddlyWiki.prototype.suspendNotifications = function()
{
  this.notificationLevel--;
};

TiddlyWiki.prototype.resumeNotifications = function()
{
  this.notificationLevel++;
};

// Invoke the notification handlers for a particular tiddler
TiddlyWiki.prototype.notify = function(title,doBlanket)
{
  if(!this.notificationLevel) {
    for(var t=0; t<this.namedNotifications.length; t++) {
      var n = this.namedNotifications[t];
      if((n.name == null && doBlanket) || (n.name == title))
        n.notify(title);
    }
  }
};

// Invoke the notification handlers for all tiddlers
TiddlyWiki.prototype.notifyAll = function()
{
  if(!this.notificationLevel) {
    for(var t=0; t<this.namedNotifications.length; t++) {
      var n = this.namedNotifications[t];
      if(n.name)
        n.notify(n.name);
    }
  }
};

// Add a notification handler to a tiddler
TiddlyWiki.prototype.addNotification = function(title,fn)
{
  for(var i=0; i<this.namedNotifications.length; i++) {
    if((this.namedNotifications[i].name == title) && (this.namedNotifications[i].notify == fn))
      return this;
  }
  this.namedNotifications.push({name: title, notify: fn});
  return this;
};

TiddlyWiki.prototype.removeTiddler = function(title)
{
  var tiddler = this.fetchTiddler(title);
  if(tiddler) {
    this.deleteTiddler(title);
    this.notify(title,true);
    this.setDirty(true);
  }
};

// Reset the sync status of a freshly synced tiddler
TiddlyWiki.prototype.resetTiddler = function(title)
{
  var tiddler = this.fetchTiddler(title);
  if(tiddler) {
    tiddler.clearChangeCount();
    this.notify(title,true);
    this.setDirty(true);
  }
};

TiddlyWiki.prototype.setTiddlerTag = function(title,status,tag)
{
  var tiddler = this.fetchTiddler(title);
  if(tiddler) {
    var t = tiddler.tags.indexOf(tag);
    if(t != -1)
      tiddler.tags.splice(t,1);
    if(status)
      tiddler.tags.push(tag);
    tiddler.changed();
    tiddler.incChangeCount();
    this.notify(title,true);
    this.setDirty(true);
  }
};

TiddlyWiki.prototype.addTiddlerFields = function(title,fields)
{
  var tiddler = this.fetchTiddler(title);
  if(!tiddler)
    return;
  merge(tiddler.fields,fields);
  tiddler.changed();
  tiddler.incChangeCount();
  this.notify(title,true);
  this.setDirty(true);
};

// Store tiddler in TiddlyWiki instance
TiddlyWiki.prototype.saveTiddler = function(title,newTitle,newBody,modifier,modified,tags,fields,clearChangeCount,created)
{
  var tiddler = this.fetchTiddler(title);
  if(tiddler) {
    created = created || tiddler.created; // Preserve created date
    this.deleteTiddler(title);
  } else {
    created = created || modified;
    tiddler = new Tiddler();
  }
  tiddler.set(newTitle,newBody,modifier,modified,tags,created,fields);
  this.addTiddler(tiddler);
  if(clearChangeCount)
    tiddler.clearChangeCount();
  else
    tiddler.incChangeCount();
  if(title != newTitle)
    this.notify(title,true);
  this.notify(newTitle,true);
  this.setDirty(true);
  return tiddler;
};

TiddlyWiki.prototype.incChangeCount = function(title)
{
  var tiddler = this.fetchTiddler(title);
  if(tiddler)
    tiddler.incChangeCount();
};

TiddlyWiki.prototype.getLoader = function()
{
  if(!this.loader)
    this.loader = new TW21Loader();
  return this.loader;
};

TiddlyWiki.prototype.getSaver = function()
{
  if(!this.saver)
    this.saver = new TW21Saver();
  return this.saver;
};

// Return all tiddlers formatted as an HTML string
TiddlyWiki.prototype.allTiddlersAsHtml = function()
{
  return this.getSaver().externalize(store);
};

// Load contents of a TiddlyWiki from an HTML DIV
TiddlyWiki.prototype.loadFromDiv = function(src,idPrefix,noUpdate)
{
  this.idPrefix = idPrefix;
  var storeElem = (typeof src == "string") ? document.getElementById(src) : src;
  if(!storeElem)
    return;
  var tiddlers = this.getLoader().loadTiddlers(this,storeElem.childNodes);
  this.setDirty(false);
  if(!noUpdate) {
    for(var i = 0;i<tiddlers.length; i++)
      tiddlers[i].changed();
  }
  jQuery().trigger("loadTiddlers");
};

// Load contents of a TiddlyWiki from a string
// Returns null if there's an error
TiddlyWiki.prototype.importTiddlyWiki = function(text)
{
  var posDiv = locateStoreArea(text);
  if(!posDiv)
    return null;
  var content = "<" + "html><" + "body>" + text.substring(posDiv[0],posDiv[1] + endSaveArea.length) + "<" + "/body><" + "/html>";
  // Create the iframe
  var iframe = document.createElement("iframe");
  iframe.style.display = "none";
  document.body.appendChild(iframe);
  var doc = iframe.document;
  if(iframe.contentDocument)
    doc = iframe.contentDocument; // For NS6
  else if(iframe.contentWindow)
    doc = iframe.contentWindow.document; // For IE5.5 and IE6
  // Put the content in the iframe
  doc.open();
  doc.writeln(content);
  doc.close();
  // Load the content into a TiddlyWiki() object
  var storeArea = doc.getElementById("storeArea");
  this.loadFromDiv(storeArea,"store");
  // Get rid of the iframe
  iframe.parentNode.removeChild(iframe);
  return this;
};

TiddlyWiki.prototype.updateTiddlers = function()
{
  this.tiddlersUpdated = true;
  this.forEachTiddler(function(title,tiddler) {
    tiddler.changed();
  });
};

// Return an array of tiddlers matching a search regular expression
TiddlyWiki.prototype.search = function(searchRegExp,sortField,excludeTag,match)
{
  var candidates = this.reverseLookup("tags",excludeTag,!!match);
  var results = [];
  for(var t=0; t<candidates.length; t++) {
    if((candidates[t].title.search(searchRegExp) != -1) || (candidates[t].text.search(searchRegExp) != -1))
      results.push(candidates[t]);
  }
  if(!sortField)
    sortField = "title";
  results.sort(function(a,b) {return a[sortField] < b[sortField] ? -1 : (a[sortField] == b[sortField] ? 0 : +1);});
  return results;
};

// Returns a list of all tags in use
//   excludeTag - if present, excludes tags that are themselves tagged with excludeTag
// Returns an array of arrays where [tag][0] is the name of the tag and [tag][1] is the number of occurances
TiddlyWiki.prototype.getTags = function(excludeTag)
{
  var results = [];
  this.forEachTiddler(function(title,tiddler) {
    for(var g=0; g<tiddler.tags.length; g++) {
      var tag = tiddler.tags[g];
      var n = true;
      for(var c=0; c<results.length; c++) {
        if(results[c][0] == tag) {
          n = false;
          results[c][1]++;
        }
      }
      if(n && excludeTag) {
        var t = this.fetchTiddler(tag);
        if(t && t.isTagged(excludeTag))
          n = false;
      }
      if(n)
        results.push([tag,1]);
    }
  });
  results.sort(function(a,b) {return a[0].toLowerCase() < b[0].toLowerCase() ? -1 : (a[0].toLowerCase() == b[0].toLowerCase() ? 0 : +1);});
  return results;
};

// Return an array of the tiddlers that are tagged with a given tag
TiddlyWiki.prototype.getTaggedTiddlers = function(tag,sortField)
{
  return this.reverseLookup("tags",tag,true,sortField);
};

// Return an array of the tiddlers that link to a given tiddler
TiddlyWiki.prototype.getReferringTiddlers = function(title,unusedParameter,sortField)
{
  if(!this.tiddlersUpdated)
    this.updateTiddlers();
  return this.reverseLookup("links",title,true,sortField);
};

// Return an array of the tiddlers that do or do not have a specified entry in the specified storage array (ie, "links" or "tags")
// lookupMatch == true to match tiddlers, false to exclude tiddlers
TiddlyWiki.prototype.reverseLookup = function(lookupField,lookupValue,lookupMatch,sortField)
{
  var results = [];
  this.forEachTiddler(function(title,tiddler) {
    var f = !lookupMatch;
    for(var lookup=0; lookup<tiddler[lookupField].length; lookup++) {
      if(tiddler[lookupField][lookup] == lookupValue)
        f = lookupMatch;
    }
    if(f)
      results.push(tiddler);
  });
  if(!sortField)
    sortField = "title";
  results.sort(function(a,b) {return a[sortField] < b[sortField] ? -1 : (a[sortField] == b[sortField] ? 0 : +1);});
  return results;
};

// Return the tiddlers as a sorted array
TiddlyWiki.prototype.getTiddlers = function(field,excludeTag)
{
  var results = [];
  this.forEachTiddler(function(title,tiddler) {
    if(excludeTag == undefined || !tiddler.isTagged(excludeTag))
      results.push(tiddler);
  });
  if(field)
    results.sort(function(a,b) {return a[field] < b[field] ? -1 : (a[field] == b[field] ? 0 : +1);});
  return results;
};

// Return array of names of tiddlers that are referred to but not defined
TiddlyWiki.prototype.getMissingLinks = function(sortField)
{
  if(!this.tiddlersUpdated)
    this.updateTiddlers();
  var results = [];
  this.forEachTiddler(function (title,tiddler) {
    if(tiddler.isTagged("excludeMissing") || tiddler.isTagged("systemConfig"))
      return;
    for(var n=0; n<tiddler.links.length;n++) {
      var link = tiddler.links[n];
      if(this.fetchTiddler(link) == null && !this.isShadowTiddler(link))
        results.pushUnique(link);
    }
  });
  results.sort();
  return results;
};

// Return an array of names of tiddlers that are defined but not referred to
TiddlyWiki.prototype.getOrphans = function()
{
  var results = [];
  this.forEachTiddler(function (title,tiddler) {
    if(this.getReferringTiddlers(title).length == 0 && !tiddler.isTagged("excludeLists"))
      results.push(title);
  });
  results.sort();
  return results;
};

// Return an array of names of all the shadow tiddlers
TiddlyWiki.prototype.getShadowed = function()
{
  var results = [];
  for(var t in config.shadowTiddlers) {
    if(this.isShadowTiddler(t))
      results.push(t);
  }
  results.sort();
  return results;
};

// Return an array of tiddlers that have been touched since they were downloaded or created
TiddlyWiki.prototype.getTouched = function()
{
  var results = [];
  this.forEachTiddler(function(title,tiddler) {
    if(tiddler.isTouched())
      results.push(tiddler);
    });
  results.sort();
  return results;
};

// Resolves a Tiddler reference or tiddler title into a Tiddler object, or null if it doesn't exist
TiddlyWiki.prototype.resolveTiddler = function(tiddler)
{
  var t = (typeof tiddler == "string") ? this.getTiddler(tiddler) : tiddler;
  return t instanceof Tiddler ? t : null;
};

// Filter a list of tiddlers
TiddlyWiki.prototype.filterTiddlers = function(filter)
{
  var results = [];
  if(filter) {
    var tiddler;
    var re = /([^\s\[\]]+)|(?:\[([ \w]+)\[([^\]]+)\]\])|(?:\[\[([^\]]+)\]\])/mg;
    var match = re.exec(filter);
    while(match) {
      if(match[1] || match[4]) {
        var title = match[1] || match[4];
        tiddler = this.fetchTiddler(title);
        if(tiddler) {
          results.pushUnique(tiddler);
        } else if(this.isShadowTiddler(title)) {
          tiddler = new Tiddler();
          tiddler.set(title,this.getTiddlerText(title));
          results.pushUnique(tiddler);
        } else {
          results.pushUnique(new Tiddler(title));
        }
      } else if(match[2]) {
        switch(match[2]) {
          case "tag":
            var matched = this.getTaggedTiddlers(match[3]);
            for(var m = 0; m < matched.length; m++)
              results.pushUnique(matched[m]);
            break;
          case "sort":
            results = this.sortTiddlers(results,match[3]);
            break;
        }
      }
      match = re.exec(filter);
    }
  }
  return results;
};

// Sort a list of tiddlers
TiddlyWiki.prototype.sortTiddlers = function(tiddlers,field)
{
  var asc = +1;
  switch(field.substr(0,1)) {
  case "-":
    asc = -1;
    // Note: this fall-through is intentional
    /*jsl:fallthru*/
  case "+":
    field = field.substr(1);
    break;
  }
  if(TiddlyWiki.standardFieldAccess[field])
    tiddlers.sort(function(a,b) {return a[field] < b[field] ? -asc : (a[field] == b[field] ? 0 : asc);});
  else
    tiddlers.sort(function(a,b) {return a.fields[field] < b.fields[field] ? -asc : (a.fields[field] == b.fields[field] ? 0 : +asc);});
  return tiddlers;
};

// Returns true if path is a valid field name (path),
// i.e. a sequence of identifiers, separated by "."
TiddlyWiki.isValidFieldName = function(name)
{
  var match = /[a-zA-Z_]\w*(\.[a-zA-Z_]\w*)*/.exec(name);
  return match && (match[0] == name);
};

// Throws an exception when name is not a valid field name.
TiddlyWiki.checkFieldName = function(name)
{
  if(!TiddlyWiki.isValidFieldName(name))
    throw config.messages.invalidFieldName.format([name]);
};

function StringFieldAccess(n,readOnly)
{
  this.set = readOnly ?
      function(t,v) {if(v != t[n]) throw config.messages.fieldCannotBeChanged.format([n]);} :
      function(t,v) {if(v != t[n]) {t[n] = v; return true;}};
  this.get = function(t) {return t[n];};
}

function DateFieldAccess(n)
{
  this.set = function(t,v) {
    var d = v instanceof Date ? v : Date.convertFromYYYYMMDDHHMM(v);
    if(d != t[n]) {
      t[n] = d; return true;
    }
  };
  this.get = function(t) {return t[n].convertToYYYYMMDDHHMM();};
}

function LinksFieldAccess(n)
{
  this.set = function(t,v) {
    var s = (typeof v == "string") ? v.readBracketedList() : v;
    if(s.toString() != t[n].toString()) {
      t[n] = s; return true;
    }
  };
  this.get = function(t) {return String.encodeTiddlyLinkList(t[n]);};
}

TiddlyWiki.standardFieldAccess = {
  // The set functions return true when setting the data has changed the value.
  "title":    new StringFieldAccess("title",true),
  // Handle the "tiddler" field name as the title
  "tiddler":  new StringFieldAccess("title",true),
  "text":     new StringFieldAccess("text"),
  "modifier": new StringFieldAccess("modifier"),
  "modified": new DateFieldAccess("modified"),
  "created":  new DateFieldAccess("created"),
  "tags":     new LinksFieldAccess("tags")
};

TiddlyWiki.isStandardField = function(name)
{
  return TiddlyWiki.standardFieldAccess[name] != undefined;
};

// Sets the value of the given field of the tiddler to the value.
// Setting an ExtendedField's value to null or undefined removes the field.
// Setting a namespace to undefined removes all fields of that namespace.
// The fieldName is case-insensitive.
// All values will be converted to a string value.
TiddlyWiki.prototype.setValue = function(tiddler,fieldName,value)
{
  TiddlyWiki.checkFieldName(fieldName);
  var t = this.resolveTiddler(tiddler);
  if(!t)
    return;
  fieldName = fieldName.toLowerCase();
  var isRemove = (value === undefined) || (value === null);
  var accessor = TiddlyWiki.standardFieldAccess[fieldName];
  if(accessor) {
    if(isRemove)
      // don't remove StandardFields
      return;
    var h = TiddlyWiki.standardFieldAccess[fieldName];
    if(!h.set(t,value))
      return;
  } else {
    var oldValue = t.fields[fieldName];
    if(isRemove) {
      if(oldValue !== undefined) {
        // deletes a single field
        delete t.fields[fieldName];
      } else {
        // no concrete value is defined for the fieldName
        // so we guess this is a namespace path.
        // delete all fields in a namespace
        var re = new RegExp("^"+fieldName+"\\.");
        var dirty = false;
        for(var n in t.fields) {
          if(n.match(re)) {
            delete t.fields[n];
            dirty = true;
          }
        }
        if(!dirty)
          return;
      }
    } else {
      // the "normal" set case. value is defined (not null/undefined)
      // For convenience provide a nicer conversion Date->String
      value = value instanceof Date ? value.convertToYYYYMMDDHHMMSSMMM() : String(value);
      if(oldValue == value)
        return;
      t.fields[fieldName] = value;
    }
  }
  // When we are here the tiddler/store really was changed.
  this.notify(t.title,true);
  if(!fieldName.match(/^temp\./))
    this.setDirty(true);
};

// Returns the value of the given field of the tiddler.
// The fieldName is case-insensitive.
// Will only return String values (or undefined).
TiddlyWiki.prototype.getValue = function(tiddler,fieldName)
{
  var t = this.resolveTiddler(tiddler);
  if(!t)
    return undefined;
  fieldName = fieldName.toLowerCase();
  var accessor = TiddlyWiki.standardFieldAccess[fieldName];
  if(accessor) {
    return accessor.get(t);
  }
  return t.fields[fieldName];
};

// Calls the callback function for every field in the tiddler.
// When callback function returns a non-false value the iteration stops
// and that value is returned.
// The order of the fields is not defined.
// @param callback a function(tiddler,fieldName,value).
TiddlyWiki.prototype.forEachField = function(tiddler,callback,onlyExtendedFields)
{
  var t = this.resolveTiddler(tiddler);
  if(!t)
    return undefined;
  var n,result;
  for(n in t.fields) {
    result = callback(t,n,t.fields[n]);
    if(result)
      return result;
    }
  if(onlyExtendedFields)
    return undefined;
  for(n in TiddlyWiki.standardFieldAccess) {
    if(n == "tiddler")
      // even though the "title" field can also be referenced through the name "tiddler"
      // we only visit this field once.
      continue;
    result = callback(t,n,TiddlyWiki.standardFieldAccess[n].get(t));
    if(result)
      return result;
  }
  return undefined;
};

//--
//-- Story functions
//--

function Story(containerId,idPrefix)
{
  this.container = containerId;
  this.idPrefix = idPrefix;
  this.highlightRegExp = null;
  this.tiddlerId = function(title) {
    var id = this.idPrefix + title;
    return id==this.container ? this.idPrefix + "_" + title : id;
  };
  this.containerId = function() {
    return this.container;
  };
}

Story.prototype.getTiddler = function(title)
{
  return document.getElementById(this.tiddlerId(title));
};

Story.prototype.getContainer = function()
{
  return document.getElementById(this.containerId());
};

Story.prototype.forEachTiddler = function(fn)
{
  var place = this.getContainer();
  if(!place)
    return;
  var e = place.firstChild;
  while(e) {
    var n = e.nextSibling;
    var title = e.getAttribute("tiddler");
    fn.call(this,title,e);
    e = n;
  }
};

Story.prototype.displayDefaultTiddlers = function()
{
  this.displayTiddlers(null,store.filterTiddlers(store.getTiddlerText("DefaultTiddlers")));
};

Story.prototype.displayTiddlers = function(srcElement,titles,template,animate,unused,customFields,toggle)
{
  for(var t = titles.length-1;t>=0;t--)
    this.displayTiddler(srcElement,titles[t],template,animate,unused,customFields);
};

Story.prototype.displayTiddler = function(srcElement,tiddler,template,animate,unused,customFields,toggle,animationSrc)
{
  var title = (tiddler instanceof Tiddler) ? tiddler.title : tiddler;
  var tiddlerElem = this.getTiddler(title);
  if(tiddlerElem) {
    if(toggle)
      this.closeTiddler(title,true);
    else
      this.refreshTiddler(title,template,false,customFields);
  } else {
    var place = this.getContainer();
    var before = this.positionTiddler(srcElement);
    tiddlerElem = this.createTiddler(place,before,title,template,customFields);
  }
  if(animationSrc && typeof animationSrc !== "string") {
    srcElement = animationSrc;
  }
  if(srcElement && typeof srcElement !== "string") {
    if(config.options.chkAnimate && (animate == undefined || animate == true) && anim && typeof Zoomer == "function" && typeof Scroller == "function")
      anim.startAnimating(new Zoomer(title,srcElement,tiddlerElem),new Scroller(tiddlerElem));
    else
      window.scrollTo(0,ensureVisible(tiddlerElem));
  }
};

Story.prototype.positionTiddler = function(srcElement)
{
  var place = this.getContainer();
  var before = null;
  if(typeof srcElement == "string") {
    switch(srcElement) {
    case "top":
      before = place.firstChild;
      break;
    case "bottom":
      before = null;
      break;
    }
  } else {
    var after = this.findContainingTiddler(srcElement);
    if(after == null) {
      before = place.firstChild;
    } else if(after.nextSibling) {
      before = after.nextSibling;
      if(before.nodeType != 1)
        before = null;
    }
  }
  return before;
};

Story.prototype.createTiddler = function(place,before,title,template,customFields)
{
  var tiddlerElem = createTiddlyElement(null,"div",this.tiddlerId(title),"tiddler");
  tiddlerElem.setAttribute("refresh","tiddler");
  if(customFields)
    tiddlerElem.setAttribute("tiddlyFields",customFields);
  place.insertBefore(tiddlerElem,before);
  var defaultText = null;
  if(!store.tiddlerExists(title) && !store.isShadowTiddler(title))
    defaultText = this.loadMissingTiddler(title,customFields,tiddlerElem);
  this.refreshTiddler(title,template,false,customFields,defaultText);
  return tiddlerElem;
};

Story.prototype.loadMissingTiddler = function(title,fields,tiddlerElem)
{
  var getTiddlerCallback = function(context)
  {
    if(context.status) {
      var t = context.tiddler;
      if(!t.created)
        t.created = new Date();
      if(!t.modified)
        t.modified = t.created;
      store.saveTiddler(t.title,t.title,t.text,t.modifier,t.modified,t.tags,t.fields,true,t.created);
      autoSaveChanges();
    } else {
      story.refreshTiddler(context.title,null,true);
    }
    context.adaptor.close();
    delete context.adaptor;
  };
  var tiddler = new Tiddler(title);
  tiddler.fields = typeof fields == "string" ? fields.decodeHashMap() : fields||{};
  var context = {serverType:tiddler.getServerType()};
  if(!context.serverType)
    return;
  context.host = tiddler.fields['server.host'];
  context.workspace = tiddler.fields['server.workspace'];
  var adaptor = new config.adaptors[context.serverType];
  adaptor.getTiddler(title,context,null,getTiddlerCallback);
  return config.messages.loadingMissingTiddler.format([title,context.serverType,context.host,context.workspace]);
};

Story.prototype.chooseTemplateForTiddler = function(title,template)
{
  if(!template)
    template = DEFAULT_VIEW_TEMPLATE;
  if(template == DEFAULT_VIEW_TEMPLATE || template == DEFAULT_EDIT_TEMPLATE)
    template = config.tiddlerTemplates[template];
  return template;
};

Story.prototype.getTemplateForTiddler = function(title,template,tiddler)
{
  return store.getRecursiveTiddlerText(template,null,10);
};

Story.prototype.refreshTiddler = function(title,template,force,customFields,defaultText)
{
  var tiddlerElem = this.getTiddler(title);
  if(tiddlerElem) {
    if(tiddlerElem.getAttribute("dirty") == "true" && !force)
      return tiddlerElem;
    template = this.chooseTemplateForTiddler(title,template);
    var currTemplate = tiddlerElem.getAttribute("template");
    if((template != currTemplate) || force) {
      var tiddler = store.getTiddler(title);
      if(!tiddler) {
        tiddler = new Tiddler();
        if(store.isShadowTiddler(title)) {
          var tags = [];
          tiddler.set(title,store.getTiddlerText(title),config.views.wikified.shadowModifier,version.date,tags,version.date);
        } else {
          var text = template=="EditTemplate" ?
                config.views.editor.defaultText.format([title]) :
                config.views.wikified.defaultText.format([title]);
          text = defaultText || text;
          var fields = customFields ? customFields.decodeHashMap() : null;
          tiddler.set(title,text,config.views.wikified.defaultModifier,version.date,[],version.date,fields);
        }
      }
      tiddlerElem.setAttribute("tags",tiddler.tags.join(" "));
      tiddlerElem.setAttribute("tiddler",title);
      tiddlerElem.setAttribute("template",template);
      tiddlerElem.onmouseover = this.onTiddlerMouseOver;
      tiddlerElem.onmouseout = this.onTiddlerMouseOut;
      tiddlerElem.ondblclick = this.onTiddlerDblClick;
      tiddlerElem[window.event?"onkeydown":"onkeypress"] = this.onTiddlerKeyPress;
      tiddlerElem.innerHTML = this.getTemplateForTiddler(title,template,tiddler);
      applyHtmlMacros(tiddlerElem,tiddler);
      if(store.getTaggedTiddlers(title).length > 0)
        addClass(tiddlerElem,"isTag");
      else
        removeClass(tiddlerElem,"isTag");
      if(store.tiddlerExists(title)) {
        removeClass(tiddlerElem,"shadow");
        removeClass(tiddlerElem,"missing");
      } else {
        addClass(tiddlerElem, store.isShadowTiddler(title) ? "shadow" : "missing");
      }
      if(customFields)
        this.addCustomFields(tiddlerElem,customFields);
      forceReflow();
    }
  }
  return tiddlerElem;
};

Story.prototype.addCustomFields = function(place,customFields)
{
  var fields = customFields.decodeHashMap();
  var w = createTiddlyElement(place,"div",null,"customFields");
  w.style.display = "none";
  for(var t in fields) {
    var e = document.createElement("input");
    e.setAttribute("type","text");
    e.setAttribute("value",fields[t]);
    w.appendChild(e);
    e.setAttribute("edit",t);
  }
};

Story.prototype.refreshAllTiddlers = function(force)
{
  var e = this.getContainer().firstChild;
  while(e) {
    var template = e.getAttribute("template");
    if(template && e.getAttribute("dirty") != "true") {
      this.refreshTiddler(e.getAttribute("tiddler"),force ? null : template,true);
    }
    e = e.nextSibling;
  }
};

Story.prototype.onTiddlerMouseOver = function(e)
{
  addClass(this, "selected");
};

Story.prototype.onTiddlerMouseOut = function(e)
{
  removeClass(this,"selected");
};

Story.prototype.onTiddlerDblClick = function(ev)
{
  var e = ev || window.event;
  var target = resolveTarget(e);
  if(target && target.nodeName.toLowerCase() != "input" && target.nodeName.toLowerCase() != "textarea") {
    if(document.selection && document.selection.empty)
      document.selection.empty();
    config.macros.toolbar.invokeCommand(this,"defaultCommand",e);
    e.cancelBubble = true;
    if(e.stopPropagation) e.stopPropagation();
    return true;
  }
  return false;
};

Story.prototype.onTiddlerKeyPress = function(ev)
{
  var e = ev || window.event;
  clearMessage();
  var consume = false;
  var title = this.getAttribute("tiddler");
  var target = resolveTarget(e);
  switch(e.keyCode) {
  case 9: // Tab
    if(config.options.chkInsertTabs && target.tagName.toLowerCase() == "textarea") {
      replaceSelection(target,String.fromCharCode(9));
      consume = true;
    }
    if(config.isOpera) {
      target.onblur = function() {
        this.focus();
        this.onblur = null;
      };
    }
    break;
  case 13: // Ctrl-Enter
  case 10: // Ctrl-Enter on IE PC
  case 77: // Ctrl-Enter is "M" on some platforms
    if(e.ctrlKey) {
      blurElement(this);
      config.macros.toolbar.invokeCommand(this,"defaultCommand",e);
      consume = true;
    }
    break;
  case 27: // Escape
    blurElement(this);
    config.macros.toolbar.invokeCommand(this,"cancelCommand",e);
    consume = true;
    break;
  }
  e.cancelBubble = consume;
  if(consume) {
    if(e.stopPropagation) e.stopPropagation(); // Stop Propagation
    e.returnValue = true; // Cancel The Event in IE
    if(e.preventDefault ) e.preventDefault(); // Cancel The Event in Moz
  }
  return !consume;
};

Story.prototype.getTiddlerField = function(title,field)
{
  var tiddlerElem = this.getTiddler(title);
  var e = null;
  if(tiddlerElem ) {
    var children = tiddlerElem.getElementsByTagName("*");
    for(var t=0; t<children.length; t++) {
      var c = children[t];
      if(c.tagName.toLowerCase() == "input" || c.tagName.toLowerCase() == "textarea") {
        if(!e)
          e = c;
        if(c.getAttribute("edit") == field)
          e = c;
      }
    }
  }
  return e;
};

Story.prototype.focusTiddler = function(title,field)
{
  var e = this.getTiddlerField(title,field);
  if(e) {
    e.focus();
    e.select();
  }
};

Story.prototype.blurTiddler = function(title)
{
  var tiddlerElem = this.getTiddler(title);
  if(tiddlerElem && tiddlerElem.focus && tiddlerElem.blur) {
    tiddlerElem.focus();
    tiddlerElem.blur();
  }
};

Story.prototype.setTiddlerField = function(title,tag,mode,field)
{
  var c = this.getTiddlerField(title,field);
  var tags = c.value.readBracketedList();
  tags.setItem(tag,mode);
  c.value = String.encodeTiddlyLinkList(tags);
};

Story.prototype.setTiddlerTag = function(title,tag,mode)
{
  this.setTiddlerField(title,tag,mode,"tags");
};

Story.prototype.closeTiddler = function(title,animate,unused)
{
  var tiddlerElem = this.getTiddler(title);
  if(tiddlerElem) {
    clearMessage();
    this.scrubTiddler(tiddlerElem);
    if(config.options.chkAnimate && animate && anim && typeof Slider == "function")
      anim.startAnimating(new Slider(tiddlerElem,false,null,"all"));
    else {
      removeNode(tiddlerElem);
      forceReflow();
    }
  }
};

Story.prototype.scrubTiddler = function(tiddlerElem)
{
  tiddlerElem.id = null;
};

Story.prototype.setDirty = function(title,dirty)
{
  var tiddlerElem = this.getTiddler(title);
  if(tiddlerElem)
    tiddlerElem.setAttribute("dirty",dirty ? "true" : "false");
};

Story.prototype.isDirty = function(title)
{
  var tiddlerElem = this.getTiddler(title);
  if(tiddlerElem)
    return tiddlerElem.getAttribute("dirty") == "true";
  return null;
};

Story.prototype.areAnyDirty = function()
{
  var r = false;
  this.forEachTiddler(function(title,element) {
    if(this.isDirty(title))
      r = true;
  });
  return r;
};

Story.prototype.closeAllTiddlers = function(exclude)
{
  clearMessage();
  this.forEachTiddler(function(title,element) {
    if((title != exclude) && element.getAttribute("dirty") != "true")
      this.closeTiddler(title);
  });
  window.scrollTo(0,ensureVisible(this.container));
};

Story.prototype.isEmpty = function()
{
  var place = this.getContainer();
  return place && place.firstChild == null;
};

Story.prototype.search = function(text,useCaseSensitive,useRegExp)
{
  this.closeAllTiddlers();
  highlightHack = new RegExp(useRegExp ? text : text.escapeRegExp(),useCaseSensitive ? "mg" : "img");
  var matches = store.search(highlightHack,"title","excludeSearch");
  this.displayTiddlers(null,matches);
  highlightHack = null;
  var q = useRegExp ? "/" : "'";
  if(matches.length > 0)
    displayMessage(config.macros.search.successMsg.format([matches.length.toString(),q + text + q]));
  else
    displayMessage(config.macros.search.failureMsg.format([q + text + q]));
};

Story.prototype.findContainingTiddler = function(e)
{
  while(e && !hasClass(e,"tiddler"))
    e = e.parentNode;
  return e;
};

Story.prototype.gatherSaveFields = function(e,fields)
{
  if(e && e.getAttribute) {
    var f = e.getAttribute("edit");
    if(f)
      fields[f] = e.value.replace(/\r/mg,"");
    if(e.hasChildNodes()) {
      var c = e.childNodes;
      for(var t=0; t<c.length; t++)
        this.gatherSaveFields(c[t],fields);
    }
  }
};

Story.prototype.hasChanges = function(title)
{
  var e = this.getTiddler(title);
  if(e) {
    var fields = {};
    this.gatherSaveFields(e,fields);
    if(store.fetchTiddler(title)) {
      for(var n in fields) {
        if(store.getValue(title,n) != fields[n]) //# tiddler changed
          return true;
      }
    } else {
      if(store.isShadowTiddler(title) && store.getShadowTiddlerText(title) == fields.text) { //# not checking for title or tags
        return false;
      } else { //# changed shadow or new tiddler
        return true;
      }
    }
  }
  return false;
};

Story.prototype.saveTiddler = function(title,minorUpdate)
{
  var tiddlerElem = this.getTiddler(title);
  if(tiddlerElem) {
    var fields = {};
    this.gatherSaveFields(tiddlerElem,fields);
    var newTitle = fields.title || title;
    if(!store.tiddlerExists(newTitle))
      newTitle = newTitle.trim();
    if(store.tiddlerExists(newTitle) && newTitle != title) {
      if(!confirm(config.messages.overwriteWarning.format([newTitle.toString()])))
        return null;
    }
    if(newTitle != title)
      this.closeTiddler(newTitle,false);
    tiddlerElem.id = this.tiddlerId(newTitle);
    tiddlerElem.setAttribute("tiddler",newTitle);
    tiddlerElem.setAttribute("template",DEFAULT_VIEW_TEMPLATE);
    tiddlerElem.setAttribute("dirty","false");
    if(config.options.chkForceMinorUpdate)
      minorUpdate = !minorUpdate;
    if(!store.tiddlerExists(newTitle))
      minorUpdate = false;
    var newDate = new Date();
    if(store.tiddlerExists(title)) {
      var extendedFields = store.fetchTiddler(title).fields;
    } else {
      extendedFields = merge({},config.defaultCustomFields);
    }
    for(var n in fields) {
      if(!TiddlyWiki.isStandardField(n))
        extendedFields[n] = fields[n];
    }
    var tiddler = store.saveTiddler(title,newTitle,fields.text,minorUpdate ? undefined : config.options.txtUserName,minorUpdate ? undefined : newDate,fields.tags,extendedFields);
    autoSaveChanges(null,[tiddler]);
    return newTitle;
  }
  return null;
};

Story.prototype.permaView = function()
{
  var links = [];
  this.forEachTiddler(function(title,element) {
    links.push(String.encodeTiddlyLink(title));
  });
  var t = encodeURIComponent(links.join(" "));
  if(t == "")
    t = "#";
  if(window.location.hash != t)
    window.location.hash = t;
};

Story.prototype.switchTheme = function(theme)
{
  if(safeMode)
    return;

  var isAvailable = function(title) {
    var s = title ? title.indexOf(config.textPrimitives.sectionSeparator) : -1;
    if(s!=-1)
      title = title.substr(0,s);
    return store.tiddlerExists(title) || store.isShadowTiddler(title);
  };

  var getSlice = function(theme,slice) {
    var r;
    if(readOnly)
      r = store.getTiddlerSlice(theme,slice+"ReadOnly") || store.getTiddlerSlice(theme,"Web"+slice);
    r = r || store.getTiddlerSlice(theme,slice);
    if(r && r.indexOf(config.textPrimitives.sectionSeparator)==0)
      r = theme + r;
    return isAvailable(r) ? r : slice;
  };

  var replaceNotification = function(i,name,theme,slice) {
    var newName = getSlice(theme,slice);
    if(name!=newName && store.namedNotifications[i].name==name) {
      store.namedNotifications[i].name = newName;
      return newName;
    }
    return name;
  };

  var pt = config.refresherData.pageTemplate;
  var vi = DEFAULT_VIEW_TEMPLATE;
  var vt = config.tiddlerTemplates[vi];
  var ei = DEFAULT_EDIT_TEMPLATE;
  var et = config.tiddlerTemplates[ei];

  for(var i=0; i<config.notifyTiddlers.length; i++) {
    var name = config.notifyTiddlers[i].name;
    switch(name) {
    case "PageTemplate":
      config.refresherData.pageTemplate = replaceNotification(i,config.refresherData.pageTemplate,theme,name);
      break;
    case "StyleSheet":
      removeStyleSheet(config.refresherData.styleSheet);
      config.refresherData.styleSheet = replaceNotification(i,config.refresherData.styleSheet,theme,name);
      break;
    case "ColorPalette":
      config.refresherData.colorPalette = replaceNotification(i,config.refresherData.colorPalette,theme,name);
      break;
    default:
      break;
    }
  }
  config.tiddlerTemplates[vi] = getSlice(theme,"ViewTemplate");
  config.tiddlerTemplates[ei] = getSlice(theme,"EditTemplate");
  if(!startingUp) {
    if(config.refresherData.pageTemplate!=pt || config.tiddlerTemplates[vi]!=vt || config.tiddlerTemplates[ei]!=et) {
      refreshAll();
      this.refreshAllTiddlers(true);
    } else {
      setStylesheet(store.getRecursiveTiddlerText(config.refresherData.styleSheet,"",10),config.refreshers.styleSheet);
    }
    config.options.txtTheme = theme;
    saveOptionCookie("txtTheme");
  }
};

//--
//-- Backstage
//--

var backstage = {
  area: null,
  toolbar: null,
  button: null,
  showButton: null,
  hideButton: null,
  cloak: null,
  panel: null,
  panelBody: null,
  panelFooter: null,
  currTabName: null,
  currTabElem: null,
  content: null,

  init: function() {
    var cmb = config.messages.backstage;
    this.area = document.getElementById("backstageArea");
    this.toolbar = document.getElementById("backstageToolbar");
    this.button = document.getElementById("backstageButton");
    this.button.style.display = "block";
    var t = cmb.open.text + " " + glyph("bentArrowLeft");
    this.showButton = createTiddlyButton(this.button,t,cmb.open.tooltip,
            function(e) {backstage.show(); return false;},null,"backstageShow");
    t = glyph("bentArrowRight") + " " + cmb.close.text;
    this.hideButton = createTiddlyButton(this.button,t,cmb.close.tooltip,
            function(e) {backstage.hide(); return false;},null,"backstageHide");
    this.cloak = document.getElementById("backstageCloak");
    this.panel = document.getElementById("backstagePanel");
    this.panelFooter = createTiddlyElement(this.panel,"div",null,"backstagePanelFooter");
    this.panelBody = createTiddlyElement(this.panel,"div",null,"backstagePanelBody");
    this.cloak.onmousedown = function(e) {backstage.switchTab(null);};
    createTiddlyText(this.toolbar,cmb.prompt);
    for(t=0; t<config.backstageTasks.length; t++) {
      var taskName = config.backstageTasks[t];
      var task = config.tasks[taskName];
      var handler = task.action ? this.onClickCommand : this.onClickTab;
      var text = task.text + (task.action ? "" : glyph("downTriangle"));
      var btn = createTiddlyButton(this.toolbar,text,task.tooltip,handler,"backstageTab");
      addClass(btn,task.action ? "backstageAction" : "backstageTask");
      btn.setAttribute("task", taskName);
      }
    this.content = document.getElementById("contentWrapper");
    if(config.options.chkBackstage)
      this.show();
    else
      this.hide();
  },

  isVisible: function() {
    return this.area ? this.area.style.display == "block" : false;
  },

  show: function() {
    this.area.style.display = "block";
    if(anim && config.options.chkAnimate) {
      backstage.toolbar.style.left = findWindowWidth() + "px";
      var p = [{style: "left", start: findWindowWidth(), end: 0, template: "%0px"}];
      anim.startAnimating(new Morpher(backstage.toolbar,config.animDuration,p));
    } else {
      backstage.area.style.left = "0px";
    }
    jQuery(this.showButton).hide();
    jQuery(this.hideButton).show();
    config.options.chkBackstage = true;
    saveOptionCookie("chkBackstage");
    addClass(this.content,"backstageVisible");
  },

  hide: function() {
    if(this.currTabElem) {
      this.switchTab(null);
    } else {
      backstage.toolbar.style.left = "0px";
      if(anim && config.options.chkAnimate) {
        var p = [{style: "left", start: 0, end: findWindowWidth(), template: "%0px"}];
        var c = function(element,properties) {backstage.area.style.display = "none";};
        anim.startAnimating(new Morpher(backstage.toolbar,config.animDuration,p,c));
      } else {
        this.area.style.display = "none";
      }
      this.showButton.style.display = "block";
      this.hideButton.style.display = "none";
      config.options.chkBackstage = false;
      saveOptionCookie("chkBackstage");
      removeClass(this.content, "backstageVisible");
    }
  },

  onClickCommand: function(e) {
    var task = config.tasks[this.getAttribute("task")];
    displayMessage(task);
    if(task.action) {
      backstage.switchTab(null);
      task.action();
    }
    return false;
  },

  onClickTab: function(e) {
    backstage.switchTab(this.getAttribute("task"));
    return false;
  },

  // Switch to a given tab, or none if null is passed
  switchTab: function(tabName) {
    var tabElem = null;
    var e = this.toolbar.firstChild;
    while(e)
      {
      if(e.getAttribute && e.getAttribute("task") == tabName)
        tabElem = e;
      e = e.nextSibling;
      }
    if(tabName == backstage.currTabName) {
      backstage.hidePanel();
      return;
    }
    if(backstage.currTabElem) {
      removeClass(this.currTabElem, "backstageSelTab");
    }
    if(tabElem && tabName) {
      backstage.preparePanel();
      addClass(tabElem,"backstageSelTab");
      var task = config.tasks[tabName];
      wikify(task.content,backstage.panelBody,null,null);
      backstage.showPanel();
    } else if(backstage.currTabElem) {
      backstage.hidePanel();
    }
    backstage.currTabName = tabName;
    backstage.currTabElem = tabElem;
  },

  isPanelVisible: function() {
    return backstage.panel ? backstage.panel.style.display == "block" : false;
  },

  preparePanel: function() {
    backstage.cloak.style.height = findWindowHeight() + "px";
    backstage.cloak.style.display = "block";
    removeChildren(backstage.panelBody);
    return backstage.panelBody;
  },

  showPanel: function() {
    backstage.panel.style.display = "block";
    if(anim && config.options.chkAnimate) {
      backstage.panel.style.top = (-backstage.panel.offsetHeight) + "px";
      var p = [{style: "top", start: -backstage.panel.offsetHeight, end: 0, template: "%0px"}];
      anim.startAnimating(new Morpher(backstage.panel,config.animDuration,p),new Scroller(backstage.panel,false));
    } else {
      backstage.panel.style.top = "0px";
    }
    return backstage.panelBody;
  },

  hidePanel: function() {
    if(backstage.currTabElem)
      removeClass(backstage.currTabElem, "backstageSelTab");
    backstage.currTabElem = null;
    backstage.currTabName = null;
    if(anim && config.options.chkAnimate) {
      var p = [
        {style: "top", start: 0, end: -(backstage.panel.offsetHeight), template: "%0px"},
        {style: "display", atEnd: "none"}
      ];
      var c = function(element,properties) {backstage.cloak.style.display = "none";};
      anim.startAnimating(new Morpher(backstage.panel,config.animDuration,p,c));
    } else {
      jQuery([backstage.panel,backstage.cloak]).hide();
    }
  }
};

config.macros.backstage = {};

config.macros.backstage.handler = function(place,macroName,params)
{
  var backstageTask = config.tasks[params[0]];
  if(backstageTask)
    createTiddlyButton(place,backstageTask.text,backstageTask.tooltip,function(e) {backstage.switchTab(params[0]); return false;});
};

//--
//-- ImportTiddlers macro
//--

config.macros.importTiddlers.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
  if(readOnly) {
    createTiddlyElement(place,"div",null,"marked",this.readOnlyWarning);
    return;
  }
  var w = new Wizard();
  w.createWizard(place,this.wizardTitle);
  this.restart(w);
};

config.macros.importTiddlers.onCancel = function(e)
{
  var wizard = new Wizard(this);
  var place = wizard.clear();
  config.macros.importTiddlers.restart(wizard);
  return false;
};

config.macros.importTiddlers.onClose = function(e)
{
  backstage.hidePanel();
  return false;
};

config.macros.importTiddlers.restart = function(wizard)
{
  wizard.addStep(this.step1Title,this.step1Html);
  var s = wizard.getElement("selTypes");
  for(var t in config.adaptors) {
    var e = createTiddlyElement(s,"option",null,null,config.adaptors[t].serverLabel ? config.adaptors[t].serverLabel : t);
    e.value = t;
  }
  if(config.defaultAdaptor)
    s.value = config.defaultAdaptor;
  s = wizard.getElement("selFeeds");
  var feeds = this.getFeeds();
  for(t in feeds) {
    e = createTiddlyElement(s,"option",null,null,t);
    e.value = t;
  }
  wizard.setValue("feeds",feeds);
  s.onchange = config.macros.importTiddlers.onFeedChange;
  var fileInput = wizard.getElement("txtBrowse");
  fileInput.onchange = config.macros.importTiddlers.onBrowseChange;
  fileInput.onkeyup = config.macros.importTiddlers.onBrowseChange;
  wizard.setButtons([{caption: this.openLabel, tooltip: this.openPrompt, onClick: config.macros.importTiddlers.onOpen}]);
  wizard.formElem.action = "javascript:;";
  wizard.formElem.onsubmit = function() {
    if(!this.txtPath || this.txtPath.value.length) //# check for manually entered path in first step
      this.lastChild.firstChild.onclick();
  };
};

config.macros.importTiddlers.getFeeds = function()
{
  var feeds = {};
  var tagged = store.getTaggedTiddlers("systemServer","title");
  for(var t=0; t<tagged.length; t++) {
    var title = tagged[t].title;
    var serverType = store.getTiddlerSlice(title,"Type");
    if(!serverType)
      serverType = "file";
    feeds[title] = {title: title,
            url: store.getTiddlerSlice(title,"URL"),
            workspace: store.getTiddlerSlice(title,"Workspace"),
            workspaceList: store.getTiddlerSlice(title,"WorkspaceList"),
            tiddlerFilter: store.getTiddlerSlice(title,"TiddlerFilter"),
            serverType: serverType,
            description: store.getTiddlerSlice(title,"Description")};
  }
  return feeds;
};

config.macros.importTiddlers.onFeedChange = function(e)
{
  var wizard = new Wizard(this);
  var selTypes = wizard.getElement("selTypes");
  var fileInput = wizard.getElement("txtPath");
  var feeds = wizard.getValue("feeds");
  var f = feeds[this.value];
  if(f) {
    selTypes.value = f.serverType;
    fileInput.value = f.url;
    wizard.setValue("feedName",f.serverType);
    wizard.setValue("feedHost",f.url);
    wizard.setValue("feedWorkspace",f.workspace);
    wizard.setValue("feedWorkspaceList",f.workspaceList);
    wizard.setValue("feedTiddlerFilter",f.tiddlerFilter);
  }
  return false;
};

config.macros.importTiddlers.onBrowseChange = function(e)
{
  var wizard = new Wizard(this);
  var fileInput = wizard.getElement("txtPath");
  fileInput.value = config.macros.importTiddlers.getURLFromLocalPath(this.value);
  var serverType = wizard.getElement("selTypes");
  serverType.value = "file";
  return true;
};

config.macros.importTiddlers.getURLFromLocalPath = function(v)
{
  if(!v||!v.length)
    return v;
  v = v.replace(/\\/g,"/"); // use "/" for cross-platform consistency
  var u;
  var t = v.split(":");
  var p = t[1]||t[0]; // remove drive letter (if any)
  if (t[1] && (t[0]=="http"||t[0]=="https"||t[0]=="file")) {
    u = v;
  } else if(p.substr(0,1)=="/") {
    u = document.location.protocol + "//" + document.location.hostname + (t[1] ? "/" : "") + v;
  } else {
    var c = document.location.href.replace(/\\/g,"/");
    var pos = c.lastIndexOf("/");
    if (pos!=-1)
      c = c.substr(0,pos); // remove filename
    u = c + "/" + p;
  }
  return u;
};

config.macros.importTiddlers.onOpen = function(e)
{
  var wizard = new Wizard(this);
  var fileInput = wizard.getElement("txtPath");
  var url = fileInput.value;
  var serverType = wizard.getElement("selTypes").value || config.defaultAdaptor;
  var adaptor = new config.adaptors[serverType]();
  wizard.setValue("adaptor",adaptor);
  wizard.setValue("serverType",serverType);
  wizard.setValue("host",url);
  var ret = adaptor.openHost(url,null,wizard,config.macros.importTiddlers.onOpenHost);
  if(ret !== true)
    displayMessage(ret);
  wizard.setButtons([{caption: config.macros.importTiddlers.cancelLabel, tooltip: config.macros.importTiddlers.cancelPrompt, onClick: config.macros.importTiddlers.onCancel}],config.macros.importTiddlers.statusOpenHost);
  return false;
};

config.macros.importTiddlers.onOpenHost = function(context,wizard)
{
  var adaptor = wizard.getValue("adaptor");
  if(context.status !== true)
    displayMessage("Error in importTiddlers.onOpenHost: " + context.statusText);
  var ret = adaptor.getWorkspaceList(context,wizard,config.macros.importTiddlers.onGetWorkspaceList);
  if(ret !== true)
    displayMessage(ret);
  wizard.setButtons([{caption: config.macros.importTiddlers.cancelLabel, tooltip: config.macros.importTiddlers.cancelPrompt, onClick: config.macros.importTiddlers.onCancel}],config.macros.importTiddlers.statusGetWorkspaceList);
};

config.macros.importTiddlers.onGetWorkspaceList = function(context,wizard)
{
  if(context.status !== true)
    displayMessage("Error in importTiddlers.onGetWorkspaceList: " + context.statusText);
  wizard.setValue("context",context);
  var workspace = wizard.getValue("feedWorkspace");
  if(!workspace && context.workspaces.length==1)
    workspace = context.workspaces[0].title;
  if(workspace) {
    var ret = context.adaptor.openWorkspace(workspace,context,wizard,config.macros.importTiddlers.onOpenWorkspace);
    if(ret !== true)
      displayMessage(ret);
    wizard.setValue("workspace",workspace);
    wizard.setButtons([{caption: config.macros.importTiddlers.cancelLabel, tooltip: config.macros.importTiddlers.cancelPrompt, onClick: config.macros.importTiddlers.onCancel}],config.macros.importTiddlers.statusOpenWorkspace);
    return;
  }
  wizard.addStep(config.macros.importTiddlers.step2Title,config.macros.importTiddlers.step2Html);
  var s = wizard.getElement("selWorkspace");
  s.onchange = config.macros.importTiddlers.onWorkspaceChange;
  for(var t=0; t<context.workspaces.length; t++) {
    var e = createTiddlyElement(s,"option",null,null,context.workspaces[t].title);
    e.value = context.workspaces[t].title;
  }
  var workspaceList = wizard.getValue("feedWorkspaceList");
  if(workspaceList) {
    var list = workspaceList.parseParams("workspace",null,false,true);
    for(var n=1; n<list.length; n++) {
      if(context.workspaces.findByField("title",list[n].value) == null) {
        e = createTiddlyElement(s,"option",null,null,list[n].value);
        e.value = list[n].value;
      }
    }
  }
  if(workspace) {
    t = wizard.getElement("txtWorkspace");
    t.value = workspace;
  }
  wizard.setButtons([{caption: config.macros.importTiddlers.openLabel, tooltip: config.macros.importTiddlers.openPrompt, onClick: config.macros.importTiddlers.onChooseWorkspace}]);
};

config.macros.importTiddlers.onWorkspaceChange = function(e)
{
  var wizard = new Wizard(this);
  var t = wizard.getElement("txtWorkspace");
  t.value = this.value;
  this.selectedIndex = 0;
  return false;
};

config.macros.importTiddlers.onChooseWorkspace = function(e)
{
  var wizard = new Wizard(this);
  var adaptor = wizard.getValue("adaptor");
  var workspace = wizard.getElement("txtWorkspace").value;
  wizard.setValue("workspace",workspace);
  var context = wizard.getValue("context");
  var ret = adaptor.openWorkspace(workspace,context,wizard,config.macros.importTiddlers.onOpenWorkspace);
  if(ret !== true)
    displayMessage(ret);
  wizard.setButtons([{caption: config.macros.importTiddlers.cancelLabel, tooltip: config.macros.importTiddlers.cancelPrompt, onClick: config.macros.importTiddlers.onCancel}],config.macros.importTiddlers.statusOpenWorkspace);
  return false;
};

config.macros.importTiddlers.onOpenWorkspace = function(context,wizard)
{
  if(context.status !== true)
    displayMessage("Error in importTiddlers.onOpenWorkspace: " + context.statusText);
  var adaptor = wizard.getValue("adaptor");
  var ret = adaptor.getTiddlerList(context,wizard,config.macros.importTiddlers.onGetTiddlerList,wizard.getValue("feedTiddlerFilter"));
  if(ret !== true)
    displayMessage(ret);
  wizard.setButtons([{caption: config.macros.importTiddlers.cancelLabel, tooltip: config.macros.importTiddlers.cancelPrompt, onClick: config.macros.importTiddlers.onCancel}],config.macros.importTiddlers.statusGetTiddlerList);
};

config.macros.importTiddlers.onGetTiddlerList = function(context,wizard)
{
  if(context.status !== true) {
    wizard.setButtons([{caption: config.macros.importTiddlers.cancelLabel, tooltip: config.macros.importTiddlers.cancelPrompt, onClick: config.macros.importTiddlers.onCancel}],config.macros.importTiddlers.errorGettingTiddlerList);
    return;
  }
  // Extract data for the listview
  var listedTiddlers = [];
  if(context.tiddlers) {
    for(var n=0; n<context.tiddlers.length; n++) {
      var tiddler = context.tiddlers[n];
      listedTiddlers.push({
        title: tiddler.title,
        modified: tiddler.modified,
        modifier: tiddler.modifier,
        text: tiddler.text ? wikifyPlainText(tiddler.text,100) : "",
        tags: tiddler.tags,
        size: tiddler.text ? tiddler.text.length : 0,
        tiddler: tiddler
      });
    }
  }
  listedTiddlers.sort(function(a,b) {return a.title < b.title ? -1 : (a.title == b.title ? 0 : +1);});
  // Display the listview
  wizard.addStep(config.macros.importTiddlers.step3Title,config.macros.importTiddlers.step3Html);
  var markList = wizard.getElement("markList");
  var listWrapper = document.createElement("div");
  markList.parentNode.insertBefore(listWrapper,markList);
  var listView = ListView.create(listWrapper,listedTiddlers,config.macros.importTiddlers.listViewTemplate);
  wizard.setValue("listView",listView);
  wizard.setValue("context",context);
  var txtSaveTiddler = wizard.getElement("txtSaveTiddler");
  txtSaveTiddler.value = config.macros.importTiddlers.generateSystemServerName(wizard);
  wizard.setButtons([
      {caption: config.macros.importTiddlers.cancelLabel, tooltip: config.macros.importTiddlers.cancelPrompt, onClick: config.macros.importTiddlers.onCancel},
      {caption: config.macros.importTiddlers.importLabel, tooltip: config.macros.importTiddlers.importPrompt, onClick: config.macros.importTiddlers.doImport}
    ]);
};

config.macros.importTiddlers.generateSystemServerName = function(wizard)
{
  var serverType = wizard.getValue("serverType");
  var host = wizard.getValue("host");
  var workspace = wizard.getValue("workspace");
  var pattern = config.macros.importTiddlers[workspace ? "systemServerNamePattern" : "systemServerNamePatternNoWorkspace"];
  return pattern.format([serverType,host,workspace]);
};

config.macros.importTiddlers.saveServerTiddler = function(wizard)
{
  var txtSaveTiddler = wizard.getElement("txtSaveTiddler").value;
  if(store.tiddlerExists(txtSaveTiddler)) {
    if(!confirm(config.macros.importTiddlers.confirmOverwriteSaveTiddler.format([txtSaveTiddler])))
      return;
    store.suspendNotifications();
    store.removeTiddler(txtSaveTiddler);
    store.resumeNotifications();
  }
  var serverType = wizard.getValue("serverType");
  var host = wizard.getValue("host");
  var workspace = wizard.getValue("workspace");
  var text = config.macros.importTiddlers.serverSaveTemplate.format([serverType,host,workspace]);
  store.saveTiddler(txtSaveTiddler,txtSaveTiddler,text,config.macros.importTiddlers.serverSaveModifier,new Date(),["systemServer"]);
};

config.macros.importTiddlers.doImport = function(e)
{
  var wizard = new Wizard(this);
  if(wizard.getElement("chkSave").checked)
    config.macros.importTiddlers.saveServerTiddler(wizard);
  var chkSync = wizard.getElement("chkSync").checked;
  wizard.setValue("sync",chkSync);
  var listView = wizard.getValue("listView");
  var rowNames = ListView.getSelectedRows(listView);
  var adaptor = wizard.getValue("adaptor");
  var overwrite = [];
  var t;
  for(t=0; t<rowNames.length; t++) {
    if(store.tiddlerExists(rowNames[t]))
      overwrite.push(rowNames[t]);
  }
  if(overwrite.length > 0) {
    if(!confirm(config.macros.importTiddlers.confirmOverwriteText.format([overwrite.join(", ")])))
      return false;
  }
  wizard.addStep(config.macros.importTiddlers.step4Title.format([rowNames.length]),config.macros.importTiddlers.step4Html);
  for(t=0; t<rowNames.length; t++) {
    var link = document.createElement("div");
    createTiddlyLink(link,rowNames[t],true);
    var place = wizard.getElement("markReport");
    place.parentNode.insertBefore(link,place);
  }
  wizard.setValue("remainingImports",rowNames.length);
  wizard.setButtons([
      {caption: config.macros.importTiddlers.cancelLabel, tooltip: config.macros.importTiddlers.cancelPrompt, onClick: config.macros.importTiddlers.onCancel}
    ],config.macros.importTiddlers.statusDoingImport);
  var wizardContext = wizard.getValue("context");
  var tiddlers = wizardContext ? wizardContext.tiddlers : [];
  for(t=0; t<rowNames.length; t++) {
    var context = {
      allowSynchronous:true,
      tiddler:tiddlers[tiddlers.findByField("title",rowNames[t])]
    };
    adaptor.getTiddler(rowNames[t],context,wizard,config.macros.importTiddlers.onGetTiddler);
  }
  return false;
};

config.macros.importTiddlers.onGetTiddler = function(context,wizard)
{
  if(!context.status)
    displayMessage("Error in importTiddlers.onGetTiddler: " + context.statusText);
  var tiddler = context.tiddler;
  store.suspendNotifications();
  store.saveTiddler(tiddler.title, tiddler.title, tiddler.text, tiddler.modifier, tiddler.modified, tiddler.tags, tiddler.fields, true, tiddler.created);
  if(!wizard.getValue("sync")) {
    store.setValue(tiddler.title,'server',null);
  }
  store.resumeNotifications();
  if(!context.isSynchronous)
    store.notify(tiddler.title,true);
  var remainingImports = wizard.getValue("remainingImports")-1;
  wizard.setValue("remainingImports",remainingImports);
  if(remainingImports == 0) {
    if(context.isSynchronous) {
      store.notifyAll();
      refreshDisplay();
    }
    wizard.setButtons([
        {caption: config.macros.importTiddlers.doneLabel, tooltip: config.macros.importTiddlers.donePrompt, onClick: config.macros.importTiddlers.onClose}
      ],config.macros.importTiddlers.statusDoneImport);
    autoSaveChanges();
  }
};

//--
//-- Upgrade macro
//--

config.macros.upgrade.handler = function(place)
{
  var w = new Wizard();
  w.createWizard(place,this.wizardTitle);
  w.addStep(this.step1Title,this.step1Html.format([this.source,this.source]));
  w.setButtons([{caption: this.upgradeLabel, tooltip: this.upgradePrompt, onClick: this.onClickUpgrade}]);
};

config.macros.upgrade.onClickUpgrade = function(e)
{
  var me = config.macros.upgrade;
  var w = new Wizard(this);
  if(window.location.protocol != "file:") {
    alert(me.errorCantUpgrade);
    return false;
  }
  if(story.areAnyDirty() || store.isDirty()) {
    alert(me.errorNotSaved);
    return false;
  }
  var localPath = getLocalPath(document.location.toString());
  var backupPath = getBackupPath(localPath,me.backupExtension);
  w.setValue("backupPath",backupPath);
  w.setButtons([],me.statusPreparingBackup);
  var original = loadOriginal(localPath);
  w.setButtons([],me.statusSavingBackup);
  var backup = copyFile(backupPath,localPath);
  if(!backup)
    backup = saveFile(backupPath,original);
  if(!backup) {
    w.setButtons([],me.errorSavingBackup);
    alert(me.errorSavingBackup);
    return false;
  }
  w.setButtons([],me.statusLoadingCore);
  var load = loadRemoteFile(me.source,me.onLoadCore,w);
  if(typeof load == "string") {
    w.setButtons([],me.errorLoadingCore);
    alert(me.errorLoadingCore);
    return false;
  }
  return false;
};

config.macros.upgrade.onLoadCore = function(status,params,responseText,url,xhr)
{
  var me = config.macros.upgrade;
  var w = params;
  var errMsg;
  if(!status)
    errMsg = me.errorLoadingCore;
  var newVer = me.extractVersion(responseText);
  if(!newVer)
    errMsg = me.errorCoreFormat;
  if(errMsg) {
    w.setButtons([],errMsg);
    alert(errMsg);
    return;
  }
  var onStartUpgrade = function(e) {
    w.setButtons([],me.statusSavingCore);
    var localPath = getLocalPath(document.location.toString());
    saveFile(localPath,responseText);
    w.setButtons([],me.statusReloadingCore);
    var backupPath = w.getValue("backupPath");
    var newLoc = document.location.toString() + "?time=" + new Date().convertToYYYYMMDDHHMM() + "#upgrade:[[" + encodeURI(backupPath) + "]]";
    window.setTimeout(function () {window.location = newLoc;},10);
  };
  var step2 = [me.step2Html_downgrade,me.step2Html_restore,me.step2Html_upgrade][compareVersions(version,newVer) + 1];
  w.addStep(me.step2Title,step2.format([formatVersion(newVer),formatVersion(version)]));
  w.setButtons([{caption: me.startLabel, tooltip: me.startPrompt, onClick: onStartUpgrade},{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel}]);
};

config.macros.upgrade.onCancel = function(e)
{
  var me = config.macros.upgrade;
  var w = new Wizard(this);
  w.addStep(me.step3Title,me.step3Html);
  w.setButtons([]);
  return false;
};

config.macros.upgrade.extractVersion = function(upgradeFile)
{
  var re = /^var version = \{title: "([^"]+)", major: (\d+), minor: (\d+), revision: (\d+)(, beta: (\d+)){0,1}, date: new Date\("([^"]+)"\)/mg;
  var m = re.exec(upgradeFile);
  return  m ? {title: m[1], major: m[2], minor: m[3], revision: m[4], beta: m[6], date: new Date(m[7])} : null;
};

function upgradeFrom(path)
{
  var importStore = new TiddlyWiki();
  var tw = loadFile(path);
  if(window.netscape !== undefined)
    tw = convertUTF8ToUnicode(tw);
  importStore.importTiddlyWiki(tw);
  importStore.forEachTiddler(function(title,tiddler) {
    if(!store.getTiddler(title)) {
      store.addTiddler(tiddler);
    }
  });
  refreshDisplay();
  saveChanges(); //# To create appropriate Markup* sections
  alert(config.messages.upgradeDone.format([formatVersion()]));
  window.location = window.location.toString().substr(0,window.location.toString().lastIndexOf("?"));
}

//--
//-- Sync macro
//--

// Synchronisation handlers
config.syncers = {};

// Sync state.
var currSync = null;

// sync macro
config.macros.sync.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
  if(!wikifier.isStatic)
    this.startSync(place);
};

config.macros.sync.cancelSync = function()
{
  currSync = null;
};

config.macros.sync.startSync = function(place)
{
  if(currSync)
    config.macros.sync.cancelSync();
  currSync = {};
  currSync.syncList = this.getSyncableTiddlers();
  currSync.syncTasks = this.createSyncTasks(currSync.syncList);
  this.preProcessSyncableTiddlers(currSync.syncList);
  var wizard = new Wizard();
  currSync.wizard = wizard;
  wizard.createWizard(place,this.wizardTitle);
  wizard.addStep(this.step1Title,this.step1Html);
  var markList = wizard.getElement("markList");
  var listWrapper = document.createElement("div");
  markList.parentNode.insertBefore(listWrapper,markList);
  currSync.listView = ListView.create(listWrapper,currSync.syncList,this.listViewTemplate);
  this.processSyncableTiddlers(currSync.syncList);
  wizard.setButtons([{caption: this.syncLabel, tooltip: this.syncPrompt, onClick: this.doSync}]);
};

config.macros.sync.getSyncableTiddlers = function()
{
  var list = [];
  store.forEachTiddler(function(title,tiddler) {
    var syncItem = {};
    syncItem.serverType = tiddler.getServerType();
    syncItem.serverHost = tiddler.fields['server.host'];
    if(syncItem.serverType && syncItem.serverHost) {
      syncItem.adaptor = new config.adaptors[syncItem.serverType];
      syncItem.serverWorkspace = tiddler.fields['server.workspace'];
      syncItem.tiddler = tiddler;
      syncItem.title = tiddler.title;
      syncItem.isTouched = tiddler.isTouched();
      syncItem.selected = syncItem.isTouched;
      syncItem.syncStatus = config.macros.sync.syncStatusList[syncItem.isTouched ? "changedLocally" : "none"];
      syncItem.status = syncItem.syncStatus.text;
      list.push(syncItem);
    }
    });
  list.sort(function(a,b) {return a.title < b.title ? -1 : (a.title == b.title ? 0 : +1);});
  return list;
};

config.macros.sync.preProcessSyncableTiddlers = function(syncList)
{
  for(var i=0; i<syncList.length; i++) {
    var si = syncList[i];
    si.serverUrl = si.adaptor.generateTiddlerInfo(si.tiddler).uri;
  }
};

config.macros.sync.processSyncableTiddlers = function(syncList)
{
  for(var i=0; i<syncList.length; i++) {
    var si = syncList[i];
    if(si.syncStatus.display)
      si.rowElement.style.display = si.syncStatus.display;
    if(si.syncStatus.className)
      si.rowElement.className = si.syncStatus.className;
  }
};

config.macros.sync.createSyncTasks = function(syncList)
{
  var syncTasks = [];
  for(var i=0; i<syncList.length; i++) {
    var si = syncList[i];
    var r = null;
    for(var j=0; j<syncTasks.length; j++) {
      var cst = syncTasks[j];
      if(si.serverType == cst.serverType && si.serverHost == cst.serverHost && si.serverWorkspace == cst.serverWorkspace)
        r = cst;
    }
    if(r) {
      si.syncTask = r;
      r.syncItems.push(si);
    } else {
      si.syncTask = this.createSyncTask(si);
      syncTasks.push(si.syncTask);
    }
  }
  return syncTasks;
};

config.macros.sync.createSyncTask = function(syncItem)
{
  var st = {};
  st.serverType = syncItem.serverType;
  st.serverHost = syncItem.serverHost;
  st.serverWorkspace = syncItem.serverWorkspace;
  st.syncItems = [syncItem];

  var openWorkspaceCallback = function(context,syncItems) {
    if(context.status) {
      context.adaptor.getTiddlerList(context,syncItems,getTiddlerListCallback);
      return true;
    }
    displayMessage(context.statusText);
    return false;
  };

  var getTiddlerListCallback = function(context,sycnItems) {
    if(!context.status) {
      displayMessage(context.statusText);
      return false;
    }
    syncItems = context.userParams;
    var tiddlers = context.tiddlers;
    for(var i=0; i<syncItems.length; i++) {
      var si = syncItems[i];
      var f = tiddlers.findByField("title",si.title);
      if(f !== null) {
        if(tiddlers[f].fields['server.page.revision'] > si.tiddler.fields['server.page.revision']) {
          si.syncStatus = config.macros.sync.syncStatusList[si.isTouched ? 'changedBoth' : 'changedServer'];
        }
      } else {
        si.syncStatus = config.macros.sync.syncStatusList.notFound;
      }
      config.macros.sync.updateSyncStatus(si);
    }
    return true;
  };
  var context = {host:st.serverHost,workspace:st.serverWorkspace};
  syncItem.adaptor.openHost(st.serverHost);
  syncItem.adaptor.openWorkspace(st.serverWorkspace,context,st.syncItems,openWorkspaceCallback);
  return st;
};

config.macros.sync.updateSyncStatus = function(syncItem)
{
  var e = syncItem.colElements["status"];
  removeChildren(e);
  createTiddlyText(e,syncItem.syncStatus.text);
  if(syncItem.syncStatus.display)
    syncItem.rowElement.style.display = syncItem.syncStatus.display;
  if(syncItem.syncStatus.className)
    syncItem.rowElement.className = syncItem.syncStatus.className;
};

config.macros.sync.doSync = function(e)
{
  var getTiddlerCallback = function(context,syncItem) {
    if(syncItem) {
      var tiddler = context.tiddler;
      store.saveTiddler(tiddler.title,tiddler.title,tiddler.text,tiddler.modifier,tiddler.modified,tiddler.tags,tiddler.fields,true,tiddler.created);
      syncItem.syncStatus = config.macros.sync.syncStatusList.gotFromServer;
      config.macros.sync.updateSyncStatus(syncItem);
    }
  };
  var putTiddlerCallback = function(context,syncItem) {
    if(syncItem) {
      store.resetTiddler(context.title);
      syncItem.syncStatus = config.macros.sync.syncStatusList.putToServer;
      config.macros.sync.updateSyncStatus(syncItem);
    }
  };

  var rowNames = ListView.getSelectedRows(currSync.listView);
  var sl = config.macros.sync.syncStatusList;
  for(var i=0; i<currSync.syncList.length; i++) {
    var si = currSync.syncList[i];
    if(rowNames.indexOf(si.title) != -1) {
      var errorMsg = "Error in doSync: ";
      try {
        var r = true;
        switch(si.syncStatus) {
        case sl.changedServer:
          r = si.adaptor.getTiddler(si.title,null,si,getTiddlerCallback);
          break;
        case sl.notFound:
        case sl.changedLocally:
        case sl.changedBoth:
          r = si.adaptor.putTiddler(si.tiddler,null,si,putTiddlerCallback);
          break;
        default:
          break;
        }
        if(!r)
          displayMessage(errorMsg + r);
      } catch(ex) {
        if(ex.name == "TypeError")
          displayMessage("sync operation unsupported: " + ex.message);
        else
          displayMessage(errorMsg + ex.message);
      }
    }
  }
  return false;
};

//--
//-- Manager UI for groups of tiddlers
//--

config.macros.plugins.handler = function(place,macroName,params,wikifier,paramString)
{
  var wizard = new Wizard();
  wizard.createWizard(place,this.wizardTitle);
  wizard.addStep(this.step1Title,this.step1Html);
  var markList = wizard.getElement("markList");
  var listWrapper = document.createElement("div");
  markList.parentNode.insertBefore(listWrapper,markList);
  listWrapper.setAttribute("refresh","macro");
  listWrapper.setAttribute("macroName","plugins");
  listWrapper.setAttribute("params",paramString);
  this.refresh(listWrapper,paramString);
};

config.macros.plugins.refresh = function(listWrapper,params)
{
  var wizard = new Wizard(listWrapper);
  var selectedRows = [];
  ListView.forEachSelector(listWrapper,function(e,rowName) {
      if(e.checked)
        selectedRows.push(e.getAttribute("rowName"));
    });
  removeChildren(listWrapper);
  params = params.parseParams("anon");
  var plugins = installedPlugins.slice(0);
  var t,tiddler,p;
  var configTiddlers = store.getTaggedTiddlers("systemConfig");
  for(t=0; t<configTiddlers.length; t++) {
    tiddler = configTiddlers[t];
    if(plugins.findByField("title",tiddler.title) == null) {
      p = getPluginInfo(tiddler);
      p.executed = false;
      p.log.splice(0,0,this.skippedText);
      plugins.push(p);
    }
  }
  for(t=0; t<plugins.length; t++) {
    p = plugins[t];
    p.size = p.tiddler.text ? p.tiddler.text.length : 0;
    p.forced = p.tiddler.isTagged("systemConfigForce");
    p.disabled = p.tiddler.isTagged("systemConfigDisable");
    p.Selected = selectedRows.indexOf(plugins[t].title) != -1;
  }
  if(plugins.length == 0) {
    createTiddlyElement(listWrapper,"em",null,null,this.noPluginText);
    wizard.setButtons([]);
  } else {
    var listView = ListView.create(listWrapper,plugins,this.listViewTemplate,this.onSelectCommand);
    wizard.setValue("listView",listView);
    wizard.setButtons([
        {caption: config.macros.plugins.removeLabel, tooltip: config.macros.plugins.removePrompt, onClick: config.macros.plugins.doRemoveTag},
        {caption: config.macros.plugins.deleteLabel, tooltip: config.macros.plugins.deletePrompt, onClick: config.macros.plugins.doDelete}
      ]);
  }
};

config.macros.plugins.doRemoveTag = function(e)
{
  var wizard = new Wizard(this);
  var listView = wizard.getValue("listView");
  var rowNames = ListView.getSelectedRows(listView);
  if(rowNames.length == 0) {
    alert(config.messages.nothingSelected);
  } else {
    for(var t=0; t<rowNames.length; t++)
      store.setTiddlerTag(rowNames[t],false,"systemConfig");
  }
};

config.macros.plugins.doDelete = function(e)
{
  var wizard = new Wizard(this);
  var listView = wizard.getValue("listView");
  var rowNames = ListView.getSelectedRows(listView);
  if(rowNames.length == 0) {
    alert(config.messages.nothingSelected);
  } else {
    if(confirm(config.macros.plugins.confirmDeleteText.format([rowNames.join(", ")]))) {
      for(var t=0; t<rowNames.length; t++) {
        store.removeTiddler(rowNames[t]);
        story.closeTiddler(rowNames[t],true);
      }
    }
  }
};

//--
//-- Message area
//--

function getMessageDiv()
{
  var msgArea = document.getElementById("messageArea");
  if(!msgArea)
    return null;
  if(!msgArea.hasChildNodes())
    createTiddlyButton(createTiddlyElement(msgArea,"div",null,"messageToolbar"),
      config.messages.messageClose.text,
      config.messages.messageClose.tooltip,
      clearMessage);
  msgArea.style.display = "block";
  return createTiddlyElement(msgArea,"div");
}

function displayMessage(text,linkText)
{
  var e = getMessageDiv();
  if(!e) {
    alert(text);
    return;
  }
  if(linkText) {
    var link = createTiddlyElement(e,"a",null,null,text);
    link.href = linkText;
    link.target = "_blank";
  } else {
    e.appendChild(document.createTextNode(text));
  }
}

function clearMessage()
{
  var msgArea = document.getElementById("messageArea");
  if(msgArea) {
    removeChildren(msgArea);
    msgArea.style.display = "none";
  }
  return false;
}

//--
//-- Refresh mechanism
//--

config.notifyTiddlers = [
  {name: "StyleSheetLayout", notify: refreshStyles},
  {name: "StyleSheetColors", notify: refreshStyles},
  {name: "StyleSheet", notify: refreshStyles},
  {name: "StyleSheetPrint", notify: refreshStyles},
  {name: "PageTemplate", notify: refreshPageTemplate},
  {name: "SiteTitle", notify: refreshPageTitle},
  {name: "SiteSubtitle", notify: refreshPageTitle},
  {name: "ColorPalette", notify: refreshColorPalette},
  {name: null, notify: refreshDisplay}
];

config.refreshers = {
  link: function(e,changeList)
    {
    var title = e.getAttribute("tiddlyLink");
    refreshTiddlyLink(e,title);
    return true;
    },

  tiddler: function(e,changeList)
    {
    var title = e.getAttribute("tiddler");
    var template = e.getAttribute("template");
    if(changeList && changeList.indexOf(title) != -1 && !story.isDirty(title))
      story.refreshTiddler(title,template,true);
    else
      refreshElements(e,changeList);
    return true;
    },

  content: function(e,changeList)
    {
    var title = e.getAttribute("tiddler");
    var force = e.getAttribute("force");
    if(force != null || changeList == null || changeList.indexOf(title) != -1) {
      removeChildren(e);
      wikify(store.getTiddlerText(title,""),e,null,store.fetchTiddler(title));
      return true;
    } else
      return false;
    },

  macro: function(e,changeList)
    {
    var macro = e.getAttribute("macroName");
    var params = e.getAttribute("params");
    if(macro)
      macro = config.macros[macro];
    if(macro && macro.refresh)
      macro.refresh(e,params);
    return true;
    }
};

config.refresherData = {
  styleSheet: "StyleSheet",
  defaultStyleSheet: "StyleSheet",
  pageTemplate: "PageTemplate",
  defaultPageTemplate: "PageTemplate",
  colorPalette: "ColorPalette",
  defaultColorPalette: "ColorPalette"
};

function refreshElements(root,changeList)
{
  var nodes = root.childNodes;
  for(var c=0; c<nodes.length; c++) {
    var e = nodes[c], type = null;
    if(e.getAttribute && (e.tagName ? e.tagName != "IFRAME" : true))
      type = e.getAttribute("refresh");
    var refresher = config.refreshers[type];
    var refreshed = false;
    if(refresher != undefined)
      refreshed = refresher(e,changeList);
    if(e.hasChildNodes() && !refreshed)
      refreshElements(e,changeList);
  }
}

function applyHtmlMacros(root,tiddler)
{
  var e = root.firstChild;
  while(e) {
    var nextChild = e.nextSibling;
    if(e.getAttribute) {
      var macro = e.getAttribute("macro");
      if(macro) {
        e.removeAttribute("macro");
        var params = "";
        var p = macro.indexOf(" ");
        if(p != -1) {
          params = macro.substr(p+1);
          macro = macro.substr(0,p);
        }
        invokeMacro(e,macro,params,null,tiddler);
      }
    }
    if(e.hasChildNodes())
      applyHtmlMacros(e,tiddler);
    e = nextChild;
  }
}

function refreshPageTemplate(title)
{
  var stash = jQuery("<div/>").appendTo("body").hide()[0];
  var display = story.getContainer();
  var nodes,t;
  if(display) {
    nodes = display.childNodes;
    for(t=nodes.length-1; t>=0; t--)
      stash.appendChild(nodes[t]);
  }
  var wrapper = document.getElementById("contentWrapper");

  var isAvailable = function(title) {
    var s = title ? title.indexOf(config.textPrimitives.sectionSeparator) : -1;
    if(s!=-1)
      title = title.substr(0,s);
    return store.tiddlerExists(title) || store.isShadowTiddler(title);
  };
  if(!title || !isAvailable(title))
    title = config.refresherData.pageTemplate;
  if(!isAvailable(title))
    title = config.refresherData.defaultPageTemplate; //# this one is always avaialable
  wrapper.innerHTML = store.getRecursiveTiddlerText(title,null,10);
  applyHtmlMacros(wrapper);
  refreshElements(wrapper);
  display = story.getContainer();
  removeChildren(display);
  if(!display)
    display = createTiddlyElement(wrapper,"div",story.containerId());
  nodes = stash.childNodes;
  for(t=nodes.length-1; t>=0; t--)
    display.appendChild(nodes[t]);
  removeNode(stash);
}

function refreshDisplay(hint)
{
  if(typeof hint == "string")
    hint = [hint];
  var e = document.getElementById("contentWrapper");
  refreshElements(e,hint);
  if(backstage.isPanelVisible()) {
    e = document.getElementById("backstage");
    refreshElements(e,hint);
  }
}

function refreshPageTitle()
{
  document.title = getPageTitle();
}

function getPageTitle()
{
  var st = wikifyPlain("SiteTitle");
  var ss = wikifyPlain("SiteSubtitle");
  return st + ((st == "" || ss == "") ? "" : " - ") + ss;
}

function refreshStyles(title,doc)
{
  setStylesheet(title == null ? "" : store.getRecursiveTiddlerText(title,"",10),title,doc || document);
}

function refreshColorPalette(title)
{
  if(!startingUp)
    refreshAll();
}

function refreshAll()
{
  refreshPageTemplate();
  refreshDisplay();
  refreshStyles("StyleSheetLayout");
  refreshStyles("StyleSheetColors");
  refreshStyles(config.refresherData.styleSheet);
  refreshStyles("StyleSheetPrint");
}

//--
//-- Options stuff
//--

config.optionHandlers = {
  'txt': {
    get: function(name) {return encodeCookie(config.options[name].toString());},
    set: function(name,value) {config.options[name] = decodeCookie(value);}
  },
  'chk': {
    get: function(name) {return config.options[name] ? "true" : "false";},
    set: function(name,value) {config.options[name] = value == "true";}
  }
};

function loadOptionsCookie()
{
  if(safeMode)
    return;
  var cookies = document.cookie.split(";");
  for(var c=0; c<cookies.length; c++) {
    var p = cookies[c].indexOf("=");
    if(p != -1) {
      var name = cookies[c].substr(0,p).trim();
      var value = cookies[c].substr(p+1).trim();
      var optType = name.substr(0,3);
      if(config.optionHandlers[optType] && config.optionHandlers[optType].set)
        config.optionHandlers[optType].set(name,value);
    }
  }
}

function saveOptionCookie(name)
{
  if(safeMode)
    return;
  var c = name + "=";
  var optType = name.substr(0,3);
  if(config.optionHandlers[optType] && config.optionHandlers[optType].get)
    c += config.optionHandlers[optType].get(name);
  c += "; expires=Fri, 1 Jan 2038 12:00:00 UTC; path=/";
  document.cookie = c;
}

function removeCookie(name)
{
  document.cookie = name + "=; expires=Thu, 01-Jan-1970 00:00:01 UTC; path=/;";
}

function encodeCookie(s)
{
  return escape(convertUnicodeToHtmlEntities(s));
}

function decodeCookie(s)
{
  s = unescape(s);
  var re = /&#[0-9]{1,5};/g;
  return s.replace(re,function($0) {return String.fromCharCode(eval($0.replace(/[&#;]/g,"")));});
}


config.macros.option.genericCreate = function(place,type,opt,className,desc)
{
  var typeInfo = config.macros.option.types[type];
  var c = document.createElement(typeInfo.elementType);
  if(typeInfo.typeValue)
    c.setAttribute("type",typeInfo.typeValue);
  c[typeInfo.eventName] = typeInfo.onChange;
  c.setAttribute("option",opt);
  c.className = className || typeInfo.className;
  if(config.optionsDesc[opt])
    c.setAttribute("title",config.optionsDesc[opt]);
  place.appendChild(c);
  if(desc != "no")
    createTiddlyText(place,config.optionsDesc[opt] || opt);
  c[typeInfo.valueField] = config.options[opt];
  return c;
};

config.macros.option.genericOnChange = function(e)
{
  var opt = this.getAttribute("option");
  if(opt) {
    var optType = opt.substr(0,3);
    var handler = config.macros.option.types[optType];
    if(handler.elementType && handler.valueField)
      config.macros.option.propagateOption(opt,handler.valueField,this[handler.valueField],handler.elementType,this);
  }
  return true;
};

config.macros.option.types = {
  'txt': {
    elementType: "input",
    valueField: "value",
    eventName: "onchange",
    className: "txtOptionInput",
    create: config.macros.option.genericCreate,
    onChange: config.macros.option.genericOnChange
  },
  'chk': {
    elementType: "input",
    valueField: "checked",
    eventName: "onclick",
    className: "chkOptionInput",
    typeValue: "checkbox",
    create: config.macros.option.genericCreate,
    onChange: config.macros.option.genericOnChange
  }
};

config.macros.option.propagateOption = function(opt,valueField,value,elementType,elem)
{
  config.options[opt] = value;
  saveOptionCookie(opt);
  var nodes = document.getElementsByTagName(elementType);
  for(var t=0; t<nodes.length; t++) {
    var optNode = nodes[t].getAttribute("option");
    if(opt == optNode && nodes[t]!=elem)
      nodes[t][valueField] = value;
  }
};

config.macros.option.handler = function(place,macroName,params,wikifier,paramString)
{
  params = paramString.parseParams("anon",null,true,false,false);
  var opt = (params[1] && params[1].name == "anon") ? params[1].value : getParam(params,"name",null);
  var className = (params[2] && params[2].name == "anon") ? params[2].value : getParam(params,"class",null);
  var desc = getParam(params,"desc","no");
  var type = opt.substr(0,3);
  var h = config.macros.option.types[type];
  if(h && h.create)
    h.create(place,type,opt,className,desc);
};

config.macros.options.handler = function(place,macroName,params,wikifier,paramString)
{
  params = paramString.parseParams("anon",null,true,false,false);
  var showUnknown = getParam(params,"showUnknown","no");
  var wizard = new Wizard();
  wizard.createWizard(place,this.wizardTitle);
  wizard.addStep(this.step1Title,this.step1Html);
  var markList = wizard.getElement("markList");
  var chkUnknown = wizard.getElement("chkUnknown");
  chkUnknown.checked = showUnknown == "yes";
  chkUnknown.onchange = this.onChangeUnknown;
  var listWrapper = document.createElement("div");
  markList.parentNode.insertBefore(listWrapper,markList);
  wizard.setValue("listWrapper",listWrapper);
  this.refreshOptions(listWrapper,showUnknown == "yes");
};

config.macros.options.refreshOptions = function(listWrapper,showUnknown)
{
  var opts = [];
  for(var n in config.options) {
    var opt = {};
    opt.option = "";
    opt.name = n;
    opt.lowlight = !config.optionsDesc[n];
    opt.description = opt.lowlight ? this.unknownDescription : config.optionsDesc[n];
    if(!opt.lowlight || showUnknown)
      opts.push(opt);
  }
  opts.sort(function(a,b) {return a.name.substr(3) < b.name.substr(3) ? -1 : (a.name.substr(3) == b.name.substr(3) ? 0 : +1);});
  var listview = ListView.create(listWrapper,opts,this.listViewTemplate);
  for(n=0; n<opts.length; n++) {
    var type = opts[n].name.substr(0,3);
    var h = config.macros.option.types[type];
    if(h && h.create) {
      h.create(opts[n].colElements['option'],type,opts[n].name,null,"no");
    }
  }
};

config.macros.options.onChangeUnknown = function(e)
{
  var wizard = new Wizard(this);
  var listWrapper = wizard.getValue("listWrapper");
  removeChildren(listWrapper);
  config.macros.options.refreshOptions(listWrapper,this.checked);
  return false;
};

//--
//-- Saving
//--

var saveUsingSafari = false;

var startSaveArea = '<div id="' + 'storeArea">'; // Split up into two so that indexOf() of this source doesn't find it
var endSaveArea = '</d' + 'iv>';

// If there are unsaved changes, force the user to confirm before exitting
function confirmExit()
{
  hadConfirmExit = true;
  if((store && store.isDirty && store.isDirty()) || (story && story.areAnyDirty && story.areAnyDirty()))
    return config.messages.confirmExit;
}

// Give the user a chance to save changes before exitting
function checkUnsavedChanges()
{
  if(store && store.isDirty && store.isDirty() && window.hadConfirmExit === false) {
    if(confirm(config.messages.unsavedChangesWarning))
      saveChanges();
  }
}

function updateLanguageAttribute(s)
{
  if(config.locale) {
    var mRE = /(<html(?:.*?)?)(?: xml:lang\="([a-z]+)")?(?: lang\="([a-z]+)")?>/;
    var m = mRE.exec(s);
    if(m) {
      var t = m[1];
      if(m[2])
        t += ' xml:lang="' + config.locale + '"';
      if(m[3])
        t += ' lang="' + config.locale + '"';
      t += ">";
      s = s.substr(0,m.index) + t + s.substr(m.index+m[0].length);
    }
  }
  return s;
}

function updateMarkupBlock(s,blockName,tiddlerName)
{
  return s.replaceChunk(
      "<!--%0-START-->".format([blockName]),
      "<!--%0-END-->".format([blockName]),
      "\n" + convertUnicodeToFileFormat(store.getRecursiveTiddlerText(tiddlerName,"")) + "\n");
}

function updateOriginal(original,posDiv,localPath)
{
  if(!posDiv)
    posDiv = locateStoreArea(original);
  if(!posDiv) {
    alert(config.messages.invalidFileError.format([localPath]));
    return null;
  }
  var revised = original.substr(0,posDiv[0] + startSaveArea.length) + "\n" +
        convertUnicodeToFileFormat(store.allTiddlersAsHtml()) + "\n" +
        original.substr(posDiv[1]);
  var newSiteTitle = convertUnicodeToFileFormat(getPageTitle()).htmlEncode();
  revised = revised.replaceChunk("<title"+">","</title"+">"," " + newSiteTitle + " ");
  revised = updateLanguageAttribute(revised);
  revised = updateMarkupBlock(revised,"PRE-HEAD","MarkupPreHead");
  revised = updateMarkupBlock(revised,"POST-HEAD","MarkupPostHead");
  revised = updateMarkupBlock(revised,"PRE-BODY","MarkupPreBody");
  revised = updateMarkupBlock(revised,"POST-SCRIPT","MarkupPostBody");
  return revised;
}

function locateStoreArea(original)
{
  // Locate the storeArea div's
  var posOpeningDiv = original.indexOf(startSaveArea);
  var limitClosingDiv = original.indexOf("<"+"!--POST-STOREAREA--"+">");
  if(limitClosingDiv == -1)
    limitClosingDiv = original.indexOf("<"+"!--POST-BODY-START--"+">");
  var posClosingDiv = original.lastIndexOf(endSaveArea,limitClosingDiv == -1 ? original.length : limitClosingDiv);
  return (posOpeningDiv != -1 && posClosingDiv != -1) ? [posOpeningDiv,posClosingDiv] : null;
}

function autoSaveChanges(onlyIfDirty,tiddlers)
{
  if(config.options.chkAutoSave)
    saveChanges(onlyIfDirty,tiddlers);
}

function loadOriginal(localPath)
{
  return loadFile(localPath);
}

// Save this tiddlywiki with the pending changes
function saveChanges(onlyIfDirty,tiddlers)
{
  if(onlyIfDirty && !store.isDirty())
    return;
  clearMessage();
  var t0 = new Date();
  var originalPath = document.location.toString();
  if(originalPath.substr(0,5) != "file:") {
    alert(config.messages.notFileUrlError);
    if(store.tiddlerExists(config.messages.saveInstructions))
      story.displayTiddler(null,config.messages.saveInstructions);
    return;
  }
  var localPath = getLocalPath(originalPath);
  var original = loadOriginal(localPath);
  if(original == null) {
    alert(config.messages.cantSaveError);
    if(store.tiddlerExists(config.messages.saveInstructions))
      story.displayTiddler(null,config.messages.saveInstructions);
    return;
  }
  var posDiv = locateStoreArea(original);
  if(!posDiv) {
    alert(config.messages.invalidFileError.format([localPath]));
    return;
  }
  saveMain(localPath,original,posDiv);
  if(config.options.chkSaveBackups)
    saveBackup(localPath,original);
  if(config.options.chkSaveEmptyTemplate)
    saveEmpty(localPath,original,posDiv);
  if(config.options.chkGenerateAnRssFeed && saveRss instanceof Function)
    saveRss(localPath);
  if(config.options.chkDisplayInstrumentation)
    displayMessage("saveChanges " + (new Date()-t0) + " ms");
}

function saveMain(localPath,original,posDiv)
{
  var save;
  try {
    var revised = updateOriginal(original,posDiv,localPath);
    save = saveFile(localPath,revised);
  } catch (ex) {
    showException(ex);
  }
  if(save) {
    displayMessage(config.messages.mainSaved,"file://" + localPath);
    store.setDirty(false);
  } else {
    alert(config.messages.mainFailed);
  }
}

function saveBackup(localPath,original)
{
  var backupPath = getBackupPath(localPath);
  var backup = copyFile(backupPath,localPath);
  if(!backup)
    backup = saveFile(backupPath,original);
  if(backup)
    displayMessage(config.messages.backupSaved,"file://" + backupPath);
  else
    alert(config.messages.backupFailed);
}

function saveEmpty(localPath,original,posDiv)
{
  var emptyPath,p;
  if((p = localPath.lastIndexOf("/")) != -1)
    emptyPath = localPath.substr(0,p) + "/";
  else if((p = localPath.lastIndexOf("\\")) != -1)
    emptyPath = localPath.substr(0,p) + "\\";
  else
    emptyPath = localPath + ".";
  emptyPath += "empty.html";
  var empty = original.substr(0,posDiv[0] + startSaveArea.length) + original.substr(posDiv[1]);
  var emptySave = saveFile(emptyPath,empty);
  if(emptySave)
    displayMessage(config.messages.emptySaved,"file://" + emptyPath);
  else
    alert(config.messages.emptyFailed);
}

function getLocalPath(origPath)
{
  var originalPath = convertUriToUTF8(origPath,config.options.txtFileSystemCharSet);
  // Remove any location or query part of the URL
  var argPos = originalPath.indexOf("?");
  if(argPos != -1)
    originalPath = originalPath.substr(0,argPos);
  var hashPos = originalPath.indexOf("#");
  if(hashPos != -1)
    originalPath = originalPath.substr(0,hashPos);
  // Convert file://localhost/ to file:///
  if(originalPath.indexOf("file://localhost/") == 0)
    originalPath = "file://" + originalPath.substr(16);
  // Convert to a native file format
  var localPath;
  if(originalPath.charAt(9) == ":") // pc local file
    localPath = unescape(originalPath.substr(8)).replace(new RegExp("/","g"),"\\");
  else if(originalPath.indexOf("file://///") == 0) // FireFox pc network file
    localPath = "\\\\" + unescape(originalPath.substr(10)).replace(new RegExp("/","g"),"\\");
  else if(originalPath.indexOf("file:///") == 0) // mac/unix local file
    localPath = unescape(originalPath.substr(7));
  else if(originalPath.indexOf("file:/") == 0) // mac/unix local file
    localPath = unescape(originalPath.substr(5));
  else // pc network file
    localPath = "\\\\" + unescape(originalPath.substr(7)).replace(new RegExp("/","g"),"\\");
  return localPath;
}

function getBackupPath(localPath,title,extension)
{
  var slash = "\\";
  var dirPathPos = localPath.lastIndexOf("\\");
  if(dirPathPos == -1) {
    dirPathPos = localPath.lastIndexOf("/");
    slash = "/";
  }
  var backupFolder = config.options.txtBackupFolder;
  if(!backupFolder || backupFolder == "")
    backupFolder = ".";
  var backupPath = localPath.substr(0,dirPathPos) + slash + backupFolder + localPath.substr(dirPathPos);
  backupPath = backupPath.substr(0,backupPath.lastIndexOf(".")) + ".";
  if(title)
    backupPath += title.replace(/[\\\/\*\?\":<> ]/g,"_") + ".";
  backupPath += (new Date()).convertToYYYYMMDDHHMMSSMMM() + "." + (extension || "html");
  return backupPath;
}

//--
//-- RSS Saving
//--

function saveRss(localPath)
{
  var rssPath = localPath.substr(0,localPath.lastIndexOf(".")) + ".xml";
  if(saveFile(rssPath,convertUnicodeToFileFormat(generateRss())))
    displayMessage(config.messages.rssSaved,"file://" + rssPath);
  else
    alert(config.messages.rssFailed);
}

tiddlerToRssItem = function(tiddler,uri)
{
  var s = "<title" + ">" + tiddler.title.htmlEncode() + "</title" + ">\n";
  s += "<description>" + wikifyStatic(tiddler.text,null,tiddler).htmlEncode() + "</description>\n";
  for(var i=0; i<tiddler.tags.length; i++)
    s += "<category>" + tiddler.tags[i] + "</category>\n";
  s += "<link>" + uri + "#" + encodeURIComponent(String.encodeTiddlyLink(tiddler.title)) + "</link>\n";
  s +="<pubDate>" + tiddler.modified.toGMTString() + "</pubDate>\n";
  return s;
};

function generateRss()
{
  var s = [];
  var d = new Date();
  var u = store.getTiddlerText("SiteUrl");
  // Assemble the header
  s.push("<" + "?xml version=\"1.0\"?" + ">");
  s.push("<rss version=\"2.0\">");
  s.push("<channel>");
  s.push("<title" + ">" + wikifyPlain("SiteTitle").htmlEncode() + "</title" + ">");
  if(u)
    s.push("<link>" + u.htmlEncode() + "</link>");
  s.push("<description>" + wikifyPlain("SiteSubtitle").htmlEncode() + "</description>");
  s.push("<language>" + config.locale + "</language>");
  s.push("<copyright>Copyright " + d.getFullYear() + " " + config.options.txtUserName.htmlEncode() + "</copyright>");
  s.push("<pubDate>" + d.toGMTString() + "</pubDate>");
  s.push("<lastBuildDate>" + d.toGMTString() + "</lastBuildDate>");
  s.push("<docs>http://blogs.law.harvard.edu/tech/rss</docs>");
  s.push("<generator>TiddlyWiki " + formatVersion() + "</generator>");
  // The body
  var tiddlers = store.getTiddlers("modified","excludeLists");
  var n = config.numRssItems > tiddlers.length ? 0 : tiddlers.length-config.numRssItems;
  for(var i=tiddlers.length-1; i>=n; i--) {
    s.push("<item>\n" + tiddlerToRssItem(tiddlers[i],u) + "\n</item>");
  }
  // And footer
  s.push("</channel>");
  s.push("</rss>");
  // Save it all
  return s.join("\n");
}

//--
//-- Filesystem code
//--

function convertUTF8ToUnicode(u)
{
  return config.browser.isOpera || !window.netscape ? manualConvertUTF8ToUnicode(u) : mozConvertUTF8ToUnicode(u);
}

function manualConvertUTF8ToUnicode(utf)
{
  var uni = utf;
  var src = 0;
  var dst = 0;
  var b1, b2, b3;
  var c;
  while(src < utf.length) {
    b1 = utf.charCodeAt(src++);
    if(b1 < 0x80) {
      dst++;
    } else if(b1 < 0xE0) {
      b2 = utf.charCodeAt(src++);
      c = String.fromCharCode(((b1 & 0x1F) << 6) | (b2 & 0x3F));
      uni = uni.substring(0,dst++).concat(c,utf.substr(src));
    } else {
      b2 = utf.charCodeAt(src++);
      b3 = utf.charCodeAt(src++);
      c = String.fromCharCode(((b1 & 0xF) << 12) | ((b2 & 0x3F) << 6) | (b3 & 0x3F));
      uni = uni.substring(0,dst++).concat(c,utf.substr(src));
    }
  }
  return uni;
}

function mozConvertUTF8ToUnicode(u)
{
  try {
    netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
    var converter = Components.classes["@mozilla.org/intl/scriptableunicodeconverter"].createInstance(Components.interfaces.nsIScriptableUnicodeConverter);
    converter.charset = "UTF-8";
  } catch(ex) {
    return manualConvertUTF8ToUnicode(u);
  } // fallback
  var s = converter.ConvertToUnicode(u);
  var fin = converter.Finish();
  return fin.length > 0 ? s+fin : s;
}

function convertUnicodeToFileFormat(s)
{
  return config.browser.isOpera || !window.netscape ? convertUnicodeToHtmlEntities(s) : mozConvertUnicodeToUTF8(s);
}

function convertUnicodeToHtmlEntities(s)
{
  var re = /[^\u0000-\u007F]/g;
  return s.replace(re,function($0) {return "&#" + $0.charCodeAt(0).toString() + ";";});
}

function convertUnicodeToUTF8(s)
{
// return convertUnicodeToFileFormat to allow plugin migration
  return convertUnicodeToFileFormat(s);
}

function manualConvertUnicodeToUTF8(s)
{
  return unescape(encodeURIComponent(s));
}

function mozConvertUnicodeToUTF8(s)
{
  try {
    netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
    var converter = Components.classes["@mozilla.org/intl/scriptableunicodeconverter"].createInstance(Components.interfaces.nsIScriptableUnicodeConverter);
    converter.charset = "UTF-8";
  } catch(ex) {
    return manualConvertUnicodeToUTF8(s);
  } // fallback
  var u = converter.ConvertFromUnicode(s);
  var fin = converter.Finish();
  return fin.length > 0 ? u + fin : u;
}

function convertUriToUTF8(uri,charSet)
{
  if(window.netscape == undefined || charSet == undefined || charSet == "")
    return uri;
  try {
    netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
    var converter = Components.classes["@mozilla.org/intl/utf8converterservice;1"].getService(Components.interfaces.nsIUTF8ConverterService);
  } catch(ex) {
    return uri;
  }
  return converter.convertURISpecToUTF8(uri,charSet);
}

function copyFile(dest,source)
{
  return config.browser.isIE ? ieCopyFile(dest,source) : false;
}

function saveFile(fileUrl,content)
{
  var r = mozillaSaveFile(fileUrl,content);
  if(!r)
    r = ieSaveFile(fileUrl,content);
  if(!r)
    r = javaSaveFile(fileUrl,content);
  return r;
}

function loadFile(fileUrl)
{
  var r = mozillaLoadFile(fileUrl);
  if((r == null) || (r == false))
    r = ieLoadFile(fileUrl);
  if((r == null) || (r == false))
    r = javaLoadFile(fileUrl);
  return r;
}

function ieCreatePath(path)
{
  try {
    var fso = new ActiveXObject("Scripting.FileSystemObject");
  } catch(ex) {
    return null;
  }

  var pos = path.lastIndexOf("\\");
  if(pos==-1)
    pos = path.lastIndexOf("/");
  if(pos!=-1)
    path = path.substring(0,pos+1);

  var scan = [path];
  var parent = fso.GetParentFolderName(path);
  while(parent && !fso.FolderExists(parent)) {
    scan.push(parent);
    parent = fso.GetParentFolderName(parent);
  }

  for(i=scan.length-1;i>=0;i--) {
    if(!fso.FolderExists(scan[i])) {
      fso.CreateFolder(scan[i]);
    }
  }
  return true;
}

// Returns null if it can't do it, false if there's an error, true if it saved OK
function ieSaveFile(filePath,content)
{
  ieCreatePath(filePath);
  try {
    var fso = new ActiveXObject("Scripting.FileSystemObject");
  } catch(ex) {
    return null;
  }
  var file = fso.OpenTextFile(filePath,2,-1,0);
  file.Write(content);
  file.Close();
  return true;
}

// Returns null if it can't do it, false if there's an error, or a string of the content if successful
function ieLoadFile(filePath)
{
  try {
    var fso = new ActiveXObject("Scripting.FileSystemObject");
    var file = fso.OpenTextFile(filePath,1);
    var content = file.ReadAll();
    file.Close();
  } catch(ex) {
    return null;
  }
  return content;
}

function ieCopyFile(dest,source)
{
  ieCreatePath(dest);
  try {
    var fso = new ActiveXObject("Scripting.FileSystemObject");
    fso.GetFile(source).Copy(dest);
  } catch(ex) {
    return false;
  }
  return true;
}

// Returns null if it can't do it, false if there's an error, true if it saved OK
function mozillaSaveFile(filePath,content)
{
  if(window.Components) {
    try {
      netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
      var file = Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);
      file.initWithPath(filePath);
      if(!file.exists())
        file.create(0,0664);
      var out = Components.classes["@mozilla.org/network/file-output-stream;1"].createInstance(Components.interfaces.nsIFileOutputStream);
      out.init(file,0x20|0x02,00004,null);
      out.write(content,content.length);
      out.flush();
      out.close();
      return true;
    } catch(ex) {
      return false;
    }
  }
  return null;
}

// Returns null if it can't do it, false if there's an error, or a string of the content if successful
function mozillaLoadFile(filePath)
{
  if(window.Components) {
    try {
      netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
      var file = Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);
      file.initWithPath(filePath);
      if(!file.exists())
        return null;
      var inputStream = Components.classes["@mozilla.org/network/file-input-stream;1"].createInstance(Components.interfaces.nsIFileInputStream);
      inputStream.init(file,0x01,00004,null);
      var sInputStream = Components.classes["@mozilla.org/scriptableinputstream;1"].createInstance(Components.interfaces.nsIScriptableInputStream);
      sInputStream.init(inputStream);
      var contents = sInputStream.read(sInputStream.available());
      sInputStream.close();
      inputStream.close();
      return contents;
    } catch(ex) {
      return false;
    }
  }
  return null;
}

function javaUrlToFilename(url)
{
  var f = "//localhost";
  if(url.indexOf(f) == 0)
    return url.substring(f.length);
  var i = url.indexOf(":");
  return i > 0 ? url.substring(i-1) : url;
}

function javaSaveFile(filePath,content)
{
  try {
    if(document.applets["TiddlySaver"])
      return document.applets["TiddlySaver"].saveFile(javaUrlToFilename(filePath),"UTF-8",content);
  } catch(ex) {
  }
  try {
    var s = new java.io.PrintStream(new java.io.FileOutputStream(javaUrlToFilename(filePath)));
    s.print(content);
    s.close();
  } catch(ex) {
    return null;
  }
  return true;
}

function javaLoadFile(filePath)
{
  try {
    if(document.applets["TiddlySaver"])
      return String(document.applets["TiddlySaver"].loadFile(javaUrlToFilename(filePath),"UTF-8"));
  } catch(ex) {
  }
  var content = [];
  try {
    var r = new java.io.BufferedReader(new java.io.FileReader(javaUrlToFilename(filePath)));
    var line;
    while((line = r.readLine()) != null)
      content.push(new String(line));
    r.close();
  } catch(ex) {
    return null;
  }
  return content.join("\n");
}

//--
//-- Server adaptor base class
//--

function AdaptorBase()
{
  this.host = null;
  this.store = null;
  return this;
}

AdaptorBase.prototype.close = function()
{
  return true;
};

AdaptorBase.prototype.fullHostName = function(host)
{
  if(!host)
    return '';
  host = host.trim();
  if(!host.match(/:\/\//))
    host = 'http://' + host;
  if(host.substr(host.length-1) == '/')
    host = host.substr(0,host.length-1);
  return host;
};

AdaptorBase.minHostName = function(host)
{
  return host ? host.replace(/^http:\/\//,'').replace(/\/$/,'') : '';
};

AdaptorBase.prototype.setContext = function(context,userParams,callback)
{
  if(!context) context = {};
  context.userParams = userParams;
  if(callback) context.callback = callback;
  context.adaptor = this;
  if(!context.host)
    context.host = this.host;
  context.host = this.fullHostName(context.host);
  if(!context.workspace)
    context.workspace = this.workspace;
  return context;
};

// Open the specified host
AdaptorBase.prototype.openHost = function(host,context,userParams,callback)
{
  this.host = host;
  context = this.setContext(context,userParams,callback);
  context.status = true;
  if(callback)
    window.setTimeout(function() {context.callback(context,userParams);},10);
  return true;
};

// Open the specified workspace
AdaptorBase.prototype.openWorkspace = function(workspace,context,userParams,callback)
{
  this.workspace = workspace;
  context = this.setContext(context,userParams,callback);
  context.status = true;
  if(callback)
    window.setTimeout(function() {callback(context,userParams);},10);
  return true;
};

//--
//-- Server adaptor for talking to static TiddlyWiki files
//--

function FileAdaptor()
{
}

FileAdaptor.prototype = new AdaptorBase();

FileAdaptor.serverType = 'file';
FileAdaptor.serverLabel = 'TiddlyWiki';

FileAdaptor.loadTiddlyWikiCallback = function(status,context,responseText,url,xhr)
{
  context.status = status;
  if(!status) {
    context.statusText = "Error reading file";
  } else {
    context.adaptor.store = new TiddlyWiki();
    if(!context.adaptor.store.importTiddlyWiki(responseText)) {
      context.statusText = config.messages.invalidFileError.format([url]);
      context.status = false;
    }
  }
  context.complete(context,context.userParams);
};

// Get the list of workspaces on a given server
FileAdaptor.prototype.getWorkspaceList = function(context,userParams,callback)
{
  context = this.setContext(context,userParams,callback);
  context.workspaces = [{title:"(default)"}];
  context.status = true;
  if(callback)
    window.setTimeout(function() {callback(context,userParams);},10);
  return true;
};

// Gets the list of tiddlers within a given workspace
FileAdaptor.prototype.getTiddlerList = function(context,userParams,callback,filter)
{
  context = this.setContext(context,userParams,callback);
  if(!context.filter)
    context.filter = filter;
  context.complete = FileAdaptor.getTiddlerListComplete;
  if(this.store) {
    var ret = context.complete(context,context.userParams);
  } else {
    ret = loadRemoteFile(context.host,FileAdaptor.loadTiddlyWikiCallback,context);
    if(typeof ret != "string")
      ret = true;
  }
  return ret;
};

FileAdaptor.getTiddlerListComplete = function(context,userParams)
{
  if(context.status) {
    if(context.filter) {
      context.tiddlers = context.adaptor.store.filterTiddlers(context.filter);
    } else {
      context.tiddlers = [];
      context.adaptor.store.forEachTiddler(function(title,tiddler) {context.tiddlers.push(tiddler);});
    }
    for(var i=0; i<context.tiddlers.length; i++) {
      context.tiddlers[i].fields['server.type'] = FileAdaptor.serverType;
      context.tiddlers[i].fields['server.host'] = AdaptorBase.minHostName(context.host);
      context.tiddlers[i].fields['server.page.revision'] = context.tiddlers[i].modified.convertToYYYYMMDDHHMM();
    }
    context.status = true;
  }
  if(context.callback) {
    window.setTimeout(function() {context.callback(context,userParams);},10);
  }
  return true;
};

FileAdaptor.prototype.generateTiddlerInfo = function(tiddler)
{
  var info = {};
  info.uri = tiddler.fields['server.host'] + "#" + tiddler.title;
  return info;
};

// Retrieve a tiddler from a given workspace on a given server
FileAdaptor.prototype.getTiddler = function(title,context,userParams,callback)
{
  context = this.setContext(context,userParams,callback);
  context.title = title;
  context.complete = FileAdaptor.getTiddlerComplete;
  return context.adaptor.store ?
    context.complete(context,context.userParams) :
    loadRemoteFile(context.host,FileAdaptor.loadTiddlyWikiCallback,context);
};

FileAdaptor.getTiddlerComplete = function(context,userParams)
{
  var t = context.adaptor.store.fetchTiddler(context.title);
  if(t) {
    t.fields['server.type'] = FileAdaptor.serverType;
    t.fields['server.host'] = AdaptorBase.minHostName(context.host);
    t.fields['server.page.revision'] = t.modified.convertToYYYYMMDDHHMM();
    context.tiddler = t;
    context.status = true;
  } else { //# tiddler does not exist in document
    context.status = false;
  }
  if(context.allowSynchronous) {
    context.isSynchronous = true;
    context.callback(context,userParams);
  } else {
    window.setTimeout(function() {context.callback(context,userParams);},10);
  }
  return true;
};

FileAdaptor.prototype.close = function()
{
  delete this.store;
  this.store = null;
};

config.adaptors[FileAdaptor.serverType] = FileAdaptor;

config.defaultAdaptor = FileAdaptor.serverType;

//--
//-- HTTP request code
//--

function ajaxReq(args)
{
  if(window.Components && window.netscape && window.netscape.security && document.location.protocol.indexOf("http") == -1)
    window.netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");
  return jQuery.ajax(args);
}

//--
//-- TiddlyWiki-specific utility functions
//--

// Returns TiddlyWiki version string
function formatVersion(v)
{
  v = v || version;
  return v.major + "." + v.minor + "." + v.revision +
    (v.alpha ? " (alpha " + v.alpha + ")" : "") +
    (v.beta ? " (beta " + v.beta + ")" : "");
}

function compareVersions(v1,v2)
{
  var a = ["major","minor","revision"];
  for(var i = 0; i<a.length; i++) {
    var x1 = v1[a[i]] || 0;
    var x2 = v2[a[i]] || 0;
    if(x1<x2)
      return 1;
    if(x1>x2)
      return -1;
  }
  x1 = v1.beta || 9999;
  x2 = v2.beta || 9999;
  if(x1<x2)
    return 1;
  return x1 > x2 ? -1 : 0;
}

function createTiddlyButton(parent,text,tooltip,action,className,id,accessKey,attribs)
{
  var btn = document.createElement("a");
  if(action) {
    btn.onclick = action;
    btn.setAttribute("href","javascript:;");
  }
  if(tooltip)
    btn.setAttribute("title",tooltip);
  if(text)
    btn.appendChild(document.createTextNode(text));
  btn.className = className || "button";
  if(id)
    btn.id = id;
  if(attribs) {
    for(var i in attribs) {
      btn.setAttribute(i,attribs[i]);
    }
  }
  if(parent)
    parent.appendChild(btn);
  if(accessKey)
    btn.setAttribute("accessKey",accessKey);
  return btn;
}

function createTiddlyLink(place,title,includeText,className,isStatic,linkedFromTiddler,noToggle)
{
  var text = includeText ? title : null;
  var i = getTiddlyLinkInfo(title,className);
  var btn = isStatic ? createExternalLink(place,store.getTiddlerText("SiteUrl",null) + "#" + title) : createTiddlyButton(place,text,i.subTitle,onClickTiddlerLink,i.classes);
  if(isStatic)
    btn.className += ' ' + className;
  btn.setAttribute("refresh","link");
  btn.setAttribute("tiddlyLink",title);
  if(noToggle)
    btn.setAttribute("noToggle","true");
  if(linkedFromTiddler) {
    var fields = linkedFromTiddler.getInheritedFields();
    if(fields)
      btn.setAttribute("tiddlyFields",fields);
  }
  return btn;
}

function refreshTiddlyLink(e,title)
{
  var i = getTiddlyLinkInfo(title,e.className);
  e.className = i.classes;
  e.title = i.subTitle;
}

function getTiddlyLinkInfo(title,currClasses)
{
  var classes = currClasses ? currClasses.split(" ") : [];
  classes.pushUnique("tiddlyLink");
  var tiddler = store.fetchTiddler(title);
  var subTitle;
  if(tiddler) {
    subTitle = tiddler.getSubtitle();
    classes.pushUnique("tiddlyLinkExisting");
    classes.remove("tiddlyLinkNonExisting");
    classes.remove("shadow");
  } else {
    classes.remove("tiddlyLinkExisting");
    classes.pushUnique("tiddlyLinkNonExisting");
    if(store.isShadowTiddler(title)) {
      subTitle = config.messages.shadowedTiddlerToolTip.format([title]);
      classes.pushUnique("shadow");
    } else {
      subTitle = config.messages.undefinedTiddlerToolTip.format([title]);
      classes.remove("shadow");
    }
  }
  if(typeof config.annotations[title]=="string")
    subTitle = config.annotations[title];
  return {classes: classes.join(" "),subTitle: subTitle};
}

function createExternalLink(place,url,label)
{
  var link = document.createElement("a");
  link.className = "externalLink";
  link.href = url;
  link.title = config.messages.externalLinkTooltip.format([url]);
  if(config.options.chkOpenInNewWindow)
    link.target = "_blank";
  place.appendChild(link);
  if(label)
    createTiddlyText(link, label);
  return link;
}

// Event handler for clicking on a tiddly link
function onClickTiddlerLink(ev)
{
  var e = ev || window.event;
  var target = resolveTarget(e);
  var link = target;
  var title = null;
  var fields = null;
  var noToggle = null;
  do {
    title = link.getAttribute("tiddlyLink");
    fields = link.getAttribute("tiddlyFields");
    noToggle = link.getAttribute("noToggle");
    link = link.parentNode;
  } while(title == null && link != null);
  if(!store.isShadowTiddler(title)) {
    var f = fields ? fields.decodeHashMap() : {};
    fields = String.encodeHashMap(merge(f,config.defaultCustomFields,true));
  }
  if(title) {
    var toggling = e.metaKey || e.ctrlKey;
    if(config.options.chkToggleLinks)
      toggling = !toggling;
    if(noToggle)
      toggling = false;
    if(store.getTiddler(title))
      fields = null;
    story.displayTiddler(target,title,null,true,null,fields,toggling);
  }
  clearMessage();
  return false;
}

// Create a button for a tag with a popup listing all the tiddlers that it tags
function createTagButton(place,tag,excludeTiddler,title,tooltip)
{
  var btn = createTiddlyButton(place,title||tag,(tooltip||config.views.wikified.tag.tooltip).format([tag]),onClickTag);
  btn.setAttribute("tag",tag);
  if(excludeTiddler)
    btn.setAttribute("tiddler",excludeTiddler);
  return btn;
}

// Event handler for clicking on a tiddler tag
function onClickTag(ev)
{
  var e = ev || window.event;
  var popup = Popup.create(this);
  addClass(popup,"taggedTiddlerList");
  var tag = this.getAttribute("tag");
  var title = this.getAttribute("tiddler");
  if(popup && tag) {
    var tagged = store.getTaggedTiddlers(tag);
    var titles = [];
    var li,r;
    for(r=0;r<tagged.length;r++) {
      if(tagged[r].title != title)
        titles.push(tagged[r].title);
    }
    var lingo = config.views.wikified.tag;
    if(titles.length > 0) {
      var openAll = createTiddlyButton(createTiddlyElement(popup,"li"),lingo.openAllText.format([tag]),lingo.openAllTooltip,onClickTagOpenAll);
      openAll.setAttribute("tag",tag);
      createTiddlyElement(createTiddlyElement(popup,"li",null,"listBreak"),"div");
      for(r=0; r<titles.length; r++) {
        createTiddlyLink(createTiddlyElement(popup,"li"),titles[r],true);
      }
    } else {
      createTiddlyElement(popup,"li",null,"disabled",lingo.popupNone.format([tag]));
    }
    createTiddlyElement(createTiddlyElement(popup,"li",null,"listBreak"),"div");
    var h = createTiddlyLink(createTiddlyElement(popup,"li"),tag,false);
    createTiddlyText(h,lingo.openTag.format([tag]));
  }
  Popup.show();
  e.cancelBubble = true;
  if(e.stopPropagation) e.stopPropagation();
  return false;
}

// Event handler for 'open all' on a tiddler popup
function onClickTagOpenAll(ev)
{
  var tiddlers = store.getTaggedTiddlers(this.getAttribute("tag"));
  story.displayTiddlers(this,tiddlers);
  return false;
}

function onClickError(ev)
{
  var e = ev || window.event;
  var popup = Popup.create(this);
  var lines = this.getAttribute("errorText").split("\n");
  for(var t=0; t<lines.length; t++)
    createTiddlyElement(popup,"li",null,null,lines[t]);
  Popup.show();
  e.cancelBubble = true;
  if(e.stopPropagation) e.stopPropagation();
  return false;
}

function createTiddlyDropDown(place,onchange,options,defaultValue)
{
  var sel = createTiddlyElement(place,"select");
  sel.onchange = onchange;
  for(var t=0; t<options.length; t++) {
    var e = createTiddlyElement(sel,"option",null,null,options[t].caption);
    e.value = options[t].name;
    if(options[t].name == defaultValue)
      e.selected = true;
  }
  return sel;
}

function createTiddlyPopup(place,caption,tooltip,tiddler)
{
  if(tiddler.text) {
    createTiddlyLink(place,caption,true);
    var btn = createTiddlyButton(place,glyph("downArrow"),tooltip,onClickTiddlyPopup,"tiddlerPopupButton");
    btn.tiddler = tiddler;
  } else {
    createTiddlyText(place,caption);
  }
}

function onClickTiddlyPopup(ev)
{
  var e = ev || window.event;
  var tiddler = this.tiddler;
  if(tiddler.text) {
    var popup = Popup.create(this,"div","popupTiddler");
    wikify(tiddler.text,popup,null,tiddler);
    Popup.show();
  }
  if(e) e.cancelBubble = true;
  if(e && e.stopPropagation) e.stopPropagation();
  return false;
}

function createTiddlyError(place,title,text)
{
  var btn = createTiddlyButton(place,title,null,onClickError,"errorButton");
  if(text) btn.setAttribute("errorText",text);
}

function merge(dst,src,preserveExisting)
{
  for(var i in src) {
    if(!preserveExisting || dst[i] === undefined)
      dst[i] = src[i];
  }
  return dst;
}

// Returns a string containing the description of an exception, optionally prepended by a message
function exceptionText(e,message)
{
  var s = e.description || e.toString();
  return message ? "%0:\n%1".format([message,s]) : s;
}

// Displays an alert of an exception description with optional message
function showException(e,message)
{
  alert(exceptionText(e,message));
}

function alertAndThrow(m)
{
  alert(m);
  throw(m);
}

function glyph(name)
{
  var g = config.glyphs;
  var b = g.currBrowser;
  if(b == null) {
    b = 0;
    while(!g.browsers[b]() && b < g.browsers.length-1)
      b++;
    g.currBrowser = b;
  }
  if(!g.codes[name])
    return "";
  return g.codes[name][b];
}

if(!window.console) {
  console = {tiddlywiki:true,log:function(message) {displayMessage(message);}};
}

//-
//- Animation engine
//-

function Animator()
{
  this.running = 0; // Incremented at start of each animation, decremented afterwards. If zero, the interval timer is disabled
  this.timerID = 0; // ID of the timer used for animating
  this.animations = []; // List of animations in progress
  return this;
}

// Start animation engine
Animator.prototype.startAnimating = function() //# Variable number of arguments
{
  for(var t=0; t<arguments.length; t++)
    this.animations.push(arguments[t]);
  if(this.running == 0) {
    var me = this;
    this.timerID = window.setInterval(function() {me.doAnimate(me);},10);
  }
  this.running += arguments.length;
};

// Perform an animation engine tick, calling each of the known animation modules
Animator.prototype.doAnimate = function(me)
{
  var a = 0;
  while(a < me.animations.length) {
    var animation = me.animations[a];
    if(animation.tick()) {
      a++;
    } else {
      me.animations.splice(a,1);
      if(--me.running == 0)
        window.clearInterval(me.timerID);
    }
  }
};

Animator.slowInSlowOut = function(progress)
{
  return(1-((Math.cos(progress * Math.PI)+1)/2));
};

//--
//-- Morpher animation
//--

// Animate a set of properties of an element
function Morpher(element,duration,properties,callback)
{
  this.element = element;
  this.duration = duration;
  this.properties = properties;
  this.startTime = new Date();
  this.endTime = Number(this.startTime) + duration;
  this.callback = callback;
  this.tick();
  return this;
}

Morpher.prototype.assignStyle = function(element,style,value)
{
  switch(style) {
  case "-tw-vertScroll":
    window.scrollTo(findScrollX(),value);
    break;
  case "-tw-horizScroll":
    window.scrollTo(value,findScrollY());
    break;
  default:
    element.style[style] = value;
    break;
  }
};

Morpher.prototype.stop = function()
{
  for(var t=0; t<this.properties.length; t++) {
    var p = this.properties[t];
    if(p.atEnd !== undefined) {
      this.assignStyle(this.element,p.style,p.atEnd);
    }
  }
  if(this.callback)
    this.callback(this.element,this.properties);
};

Morpher.prototype.tick = function()
{
  var currTime = Number(new Date());
  var progress = Animator.slowInSlowOut(Math.min(1,(currTime-this.startTime)/this.duration));
  for(var t=0; t<this.properties.length; t++) {
    var p = this.properties[t];
    if(p.start !== undefined && p.end !== undefined) {
      var template = p.template || "%0";
      switch(p.format) {
      case undefined:
      case "style":
        var v = p.start + (p.end-p.start) * progress;
        this.assignStyle(this.element,p.style,template.format([v]));
        break;
      case "color":
        break;
      }
    }
  }
  if(currTime >= this.endTime) {
    this.stop();
    return false;
  }
  return true;
};

//--
//-- Zoomer animation
//--

function Zoomer(text,startElement,targetElement,unused)
{
  var e = createTiddlyElement(document.body,"div",null,"zoomer");
  createTiddlyElement(e,"div",null,null,text);
  var winWidth = findWindowWidth();
  var winHeight = findWindowHeight();
  var p = [
    {style: 'left', start: findPosX(startElement), end: findPosX(targetElement), template: '%0px'},
    {style: 'top', start: findPosY(startElement), end: findPosY(targetElement), template: '%0px'},
    {style: 'width', start: Math.min(startElement.scrollWidth,winWidth), end: Math.min(targetElement.scrollWidth,winWidth), template: '%0px', atEnd: 'auto'},
    {style: 'height', start: Math.min(startElement.scrollHeight,winHeight), end: Math.min(targetElement.scrollHeight,winHeight), template: '%0px', atEnd: 'auto'},
    {style: 'fontSize', start: 8, end: 24, template: '%0pt'}
  ];
  var c = function(element,properties) {removeNode(element);};
  return new Morpher(e,config.animDuration,p,c);
}

//--
//-- Scroller animation
//--

function Scroller(targetElement)
{
  var p = [{style: '-tw-vertScroll', start: findScrollY(), end: ensureVisible(targetElement)}];
  return new Morpher(targetElement,config.animDuration,p);
}

//--
//-- Slider animation
//--

// deleteMode - "none", "all" [delete target element and it's children], [only] "children" [but not the target element]
function Slider(element,opening,unused,deleteMode)
{
  element.style.overflow = 'hidden';
  if(opening)
    element.style.height = '0px'; // Resolves a Firefox flashing bug
  element.style.display = 'block';
  var left = findPosX(element);
  var width = element.scrollWidth;
  var height = element.scrollHeight;
  var winWidth = findWindowWidth();
  var p = [];
  var c = null;
  if(opening) {
    p.push({style: 'height', start: 0, end: height, template: '%0px', atEnd: 'auto'});
    p.push({style: 'opacity', start: 0, end: 1, template: '%0'});
    p.push({style: 'filter', start: 0, end: 100, template: 'alpha(opacity:%0)'});
  } else {
    p.push({style: 'height', start: height, end: 0, template: '%0px'});
    p.push({style: 'display', atEnd: 'none'});
    p.push({style: 'opacity', start: 1, end: 0, template: '%0'});
    p.push({style: 'filter', start: 100, end: 0, template: 'alpha(opacity:%0)'});
    switch(deleteMode) {
    case "all":
      c = function(element,properties) {removeNode(element);};
      break;
    case "children":
      c = function(element,properties) {removeChildren(element);};
      break;
    }
  }
  return new Morpher(element,config.animDuration,p,c);
}

//--
//-- Popup menu
//--

var Popup = {
  stack: [] // Array of objects with members root: and popup:
  };

Popup.create = function(root,elem,className)
{
  var stackPosition = this.find(root,"popup");
  Popup.remove(stackPosition+1);
  var popup = createTiddlyElement(document.body,elem || "ol","popup",className || "popup");
  popup.stackPosition = stackPosition;
  Popup.stack.push({root: root, popup: popup});
  return popup;
};

Popup.onDocumentClick = function(ev)
{
  var e = ev || window.event;
  if(e.eventPhase == undefined)
    Popup.remove();
  else if(e.eventPhase == Event.BUBBLING_PHASE || e.eventPhase == Event.AT_TARGET)
    Popup.remove();
  return true;
};

Popup.show = function(valign,halign,offset)
{
  var curr = Popup.stack[Popup.stack.length-1];
  this.place(curr.root,curr.popup,valign,halign,offset);
  addClass(curr.root,"highlight");
  if(config.options.chkAnimate && anim && typeof Scroller == "function")
    anim.startAnimating(new Scroller(curr.popup));
  else
    window.scrollTo(0,ensureVisible(curr.popup));
};

Popup.place = function(root,popup,valign,halign,offset)
{
  if(!offset)
    var offset = {x:0,y:0};
  if(popup.stackPosition >= 0 && !valign && !halign) {
    offset.x = offset.x + root.offsetWidth;
  } else {
    offset.x = (halign == "right") ? offset.x + root.offsetWidth : offset.x;
    offset.y = (valign == "top") ? offset.y : offset.y + root.offsetHeight;
  }
  var rootLeft = findPosX(root);
  var rootTop = findPosY(root);
  var popupLeft = rootLeft + offset.x;
  var popupTop = rootTop + offset.y;
  var winWidth = findWindowWidth();
  if(popup.offsetWidth > winWidth*0.75)
    popup.style.width = winWidth*0.75 + "px";
  var popupWidth = popup.offsetWidth;
  var scrollWidth = winWidth - document.body.offsetWidth;
  if(popupLeft + popupWidth > winWidth - scrollWidth - 1) {
    if(halign == "right")
      popupLeft = popupLeft - root.offsetWidth - popupWidth;
    else
      popupLeft = winWidth - popupWidth - scrollWidth - 1;
  }
  popup.style.left = popupLeft + "px";
  popup.style.top = popupTop + "px";
  popup.style.display = "block";
};

Popup.find = function(e)
{
  var pos = -1;
  for (var t=this.stack.length-1; t>=0; t--) {
    if(isDescendant(e,this.stack[t].popup))
      pos = t;
  }
  return pos;
};

Popup.remove = function(pos)
{
  if(!pos) var pos = 0;
  if(Popup.stack.length > pos) {
    Popup.removeFrom(pos);
  }
};

Popup.removeFrom = function(from)
{
  for(var t=Popup.stack.length-1; t>=from; t--) {
    var p = Popup.stack[t];
    removeClass(p.root,"highlight");
    removeNode(p.popup);
  }
  Popup.stack = Popup.stack.slice(0,from);
};

//--
//-- Wizard support
//--

function Wizard(elem)
{
  if(elem) {
    this.formElem = findRelated(elem,"wizard","className");
    this.bodyElem = findRelated(this.formElem.firstChild,"wizardBody","className","nextSibling");
    this.footElem = findRelated(this.formElem.firstChild,"wizardFooter","className","nextSibling");
  } else {
    this.formElem = null;
    this.bodyElem = null;
    this.footElem = null;
  }
}

Wizard.prototype.setValue = function(name,value)
{
  if(this.formElem)
    this.formElem[name] = value;
};

Wizard.prototype.getValue = function(name)
{
  return this.formElem ? this.formElem[name] : null;
};

Wizard.prototype.createWizard = function(place,title)
{
  this.formElem = createTiddlyElement(place,"form",null,"wizard");
  createTiddlyElement(this.formElem,"h1",null,null,title);
  this.bodyElem = createTiddlyElement(this.formElem,"div",null,"wizardBody");
  this.footElem = createTiddlyElement(this.formElem,"div",null,"wizardFooter");
};

Wizard.prototype.clear = function()
{
  removeChildren(this.bodyElem);
};

Wizard.prototype.setButtons = function(buttonInfo,status)
{
  removeChildren(this.footElem);
  for(var t=0; t<buttonInfo.length; t++) {
    createTiddlyButton(this.footElem,buttonInfo[t].caption,buttonInfo[t].tooltip,buttonInfo[t].onClick);
    insertSpacer(this.footElem);
    }
  if(typeof status == "string") {
    createTiddlyElement(this.footElem,"span",null,"status",status);
  }
};

Wizard.prototype.addStep = function(stepTitle,html)
{
  removeChildren(this.bodyElem);
  var w = createTiddlyElement(this.bodyElem,"div");
  createTiddlyElement(w,"h2",null,null,stepTitle);
  var step = createTiddlyElement(w,"div",null,"wizardStep");
  step.innerHTML = html;
  applyHtmlMacros(step,tiddler);
};

Wizard.prototype.getElement = function(name)
{
  return this.formElem.elements[name];
};

//--
//-- ListView gadget
//--

var ListView = {};

// Create a listview
ListView.create = function(place,listObject,listTemplate,callback,className)
{
  var table = createTiddlyElement(place,"table",null,className || "listView twtable");
  var thead = createTiddlyElement(table,"thead");
  var r = createTiddlyElement(thead,"tr");
  for(var t=0; t<listTemplate.columns.length; t++) {
    var columnTemplate = listTemplate.columns[t];
    var c = createTiddlyElement(r,"th");
    var colType = ListView.columnTypes[columnTemplate.type];
    if(colType && colType.createHeader) {
      colType.createHeader(c,columnTemplate,t);
      if(columnTemplate.className)
        addClass(c,columnTemplate.className);
    }
  }
  var tbody = createTiddlyElement(table,"tbody");
  for(var rc=0; rc<listObject.length; rc++) {
    var rowObject = listObject[rc];
    r = createTiddlyElement(tbody,"tr");
    for(c=0; c<listTemplate.rowClasses.length; c++) {
      if(rowObject[listTemplate.rowClasses[c].field])
        addClass(r,listTemplate.rowClasses[c].className);
    }
    rowObject.rowElement = r;
    rowObject.colElements = {};
    for(var cc=0; cc<listTemplate.columns.length; cc++) {
      c = createTiddlyElement(r,"td");
      columnTemplate = listTemplate.columns[cc];
      var field = columnTemplate.field;
      colType = ListView.columnTypes[columnTemplate.type];
      if(colType && colType.createItem) {
        colType.createItem(c,rowObject,field,columnTemplate,cc,rc);
        if(columnTemplate.className)
          addClass(c,columnTemplate.className);
      }
      rowObject.colElements[field] = c;
    }
  }
  if(callback && listTemplate.actions)
    createTiddlyDropDown(place,ListView.getCommandHandler(callback),listTemplate.actions);
  if(callback && listTemplate.buttons) {
    for(t=0; t<listTemplate.buttons.length; t++) {
      var a = listTemplate.buttons[t];
      if(a && a.name != "")
        createTiddlyButton(place,a.caption,null,ListView.getCommandHandler(callback,a.name,a.allowEmptySelection));
    }
  }
  return table;
};

ListView.getCommandHandler = function(callback,name,allowEmptySelection)
{
  return function(e) {
    var view = findRelated(this,"TABLE",null,"previousSibling");
    var tiddlers = [];
    ListView.forEachSelector(view,function(e,rowName) {
          if(e.checked)
            tiddlers.push(rowName);
          });
    if(tiddlers.length == 0 && !allowEmptySelection) {
      alert(config.messages.nothingSelected);
    } else {
      if(this.nodeName.toLowerCase() == "select") {
        callback(view,this.value,tiddlers);
        this.selectedIndex = 0;
      } else {
        callback(view,name,tiddlers);
      }
    }
  };
};

// Invoke a callback for each selector checkbox in the listview
ListView.forEachSelector = function(view,callback)
{
  var checkboxes = view.getElementsByTagName("input");
  var hadOne = false;
  for(var t=0; t<checkboxes.length; t++) {
    var cb = checkboxes[t];
    if(cb.getAttribute("type") == "checkbox") {
      var rn = cb.getAttribute("rowName");
      if(rn) {
        callback(cb,rn);
        hadOne = true;
      }
    }
  }
  return hadOne;
};

ListView.getSelectedRows = function(view)
{
  var rowNames = [];
  ListView.forEachSelector(view,function(e,rowName) {
        if(e.checked)
          rowNames.push(rowName);
        });
  return rowNames;
};

ListView.columnTypes = {};

ListView.columnTypes.String = {
  createHeader: function(place,columnTemplate,col)
    {
      createTiddlyText(place,columnTemplate.title);
    },
  createItem: function(place,listObject,field,columnTemplate,col,row)
    {
      var v = listObject[field];
      if(v != undefined)
        createTiddlyText(place,v);
    }
};

ListView.columnTypes.WikiText = {
  createHeader: ListView.columnTypes.String.createHeader,
  createItem: function(place,listObject,field,columnTemplate,col,row)
    {
      var v = listObject[field];
      if(v != undefined)
        wikify(v,place,null,null);
    }
};

ListView.columnTypes.Tiddler = {
  createHeader: ListView.columnTypes.String.createHeader,
  createItem: function(place,listObject,field,columnTemplate,col,row)
    {
      var v = listObject[field];
      if(v != undefined && v.title)
        createTiddlyPopup(place,v.title,config.messages.listView.tiddlerTooltip,v);
    }
};

ListView.columnTypes.Size = {
  createHeader: ListView.columnTypes.String.createHeader,
  createItem: function(place,listObject,field,columnTemplate,col,row)
    {
      var v = listObject[field];
      if(v != undefined) {
        var t = 0;
        while(t<config.messages.sizeTemplates.length-1 && v<config.messages.sizeTemplates[t].unit)
          t++;
        createTiddlyText(place,config.messages.sizeTemplates[t].template.format([Math.round(v/config.messages.sizeTemplates[t].unit)]));
      }
    }
};

ListView.columnTypes.Link = {
  createHeader: ListView.columnTypes.String.createHeader,
  createItem: function(place,listObject,field,columnTemplate,col,row)
    {
      var v = listObject[field];
      var c = columnTemplate.text;
      if(v != undefined)
        createExternalLink(place,v,c || v);
    }
};

ListView.columnTypes.Date = {
  createHeader: ListView.columnTypes.String.createHeader,
  createItem: function(place,listObject,field,columnTemplate,col,row)
    {
      var v = listObject[field];
      if(v != undefined)
        createTiddlyText(place,v.formatString(columnTemplate.dateFormat));
    }
};

ListView.columnTypes.StringList = {
  createHeader: ListView.columnTypes.String.createHeader,
  createItem: function(place,listObject,field,columnTemplate,col,row)
    {
      var v = listObject[field];
      if(v != undefined) {
        for(var t=0; t<v.length; t++) {
          createTiddlyText(place,v[t]);
          createTiddlyElement(place,"br");
        }
      }
    }
};

ListView.columnTypes.Selector = {
  createHeader: function(place,columnTemplate,col)
    {
      createTiddlyCheckbox(place,null,false,this.onHeaderChange);
    },
  createItem: function(place,listObject,field,columnTemplate,col,row)
    {
      var e = createTiddlyCheckbox(place,null,listObject[field],null);
      e.setAttribute("rowName",listObject[columnTemplate.rowName]);
    },
  onHeaderChange: function(e)
    {
      var state = this.checked;
      var view = findRelated(this,"TABLE");
      if(!view)
        return;
      ListView.forEachSelector(view,function(e,rowName) {
                e.checked = state;
              });
    }
};

ListView.columnTypes.Tags = {
  createHeader: ListView.columnTypes.String.createHeader,
  createItem: function(place,listObject,field,columnTemplate,col,row)
    {
      var tags = listObject[field];
      createTiddlyText(place,String.encodeTiddlyLinkList(tags));
    }
};

ListView.columnTypes.Boolean = {
  createHeader: ListView.columnTypes.String.createHeader,
  createItem: function(place,listObject,field,columnTemplate,col,row)
    {
      if(listObject[field] == true)
        createTiddlyText(place,columnTemplate.trueText);
      if(listObject[field] == false)
        createTiddlyText(place,columnTemplate.falseText);
    }
};

ListView.columnTypes.TagCheckbox = {
  createHeader: ListView.columnTypes.String.createHeader,
  createItem: function(place,listObject,field,columnTemplate,col,row)
    {
      var e = createTiddlyCheckbox(place,null,listObject[field],this.onChange);
      e.setAttribute("tiddler",listObject.title);
      e.setAttribute("tag",columnTemplate.tag);
    },
  onChange : function(e)
    {
      var tag = this.getAttribute("tag");
      var tiddler = this.getAttribute("tiddler");
      store.setTiddlerTag(tiddler,this.checked,tag);
    }
};

ListView.columnTypes.TiddlerLink = {
  createHeader: ListView.columnTypes.String.createHeader,
  createItem: function(place,listObject,field,columnTemplate,col,row)
    {
      var v = listObject[field];
      if(v != undefined) {
        var link = createTiddlyLink(place,listObject[columnTemplate.tiddlerLink],false,null);
        createTiddlyText(link,listObject[field]);
      }
    }
};

//--
//-- Augmented methods for the JavaScript Number(), Array(), String() and Date() objects
//--

// Clamp a number to a range
Number.prototype.clamp = function(min,max)
{
  var c = this;
  if(c < min)
    c = min;
  if(c > max)
    c = max;
  return Number(c);
};

// Add indexOf function if browser does not support it
if(!Array.indexOf) {
Array.prototype.indexOf = function(item,from)
{
  if(!from)
    from = 0;
  for(var i=from; i<this.length; i++) {
    if(this[i] === item)
      return i;
  }
  return -1;
};}

// Find an entry in a given field of the members of an array
Array.prototype.findByField = function(field,value)
{
  for(var t=0; t<this.length; t++) {
    if(this[t][field] === value)
      return t;
  }
  return null;
};

// Return whether an entry exists in an array
Array.prototype.contains = function(item)
{
  return this.indexOf(item) != -1;
};

// Adds, removes or toggles a particular value within an array
//  value - value to add
//  mode - +1 to add value, -1 to remove value, 0 to toggle it
Array.prototype.setItem = function(value,mode)
{
  var p = this.indexOf(value);
  if(mode == 0)
    mode = (p == -1) ? +1 : -1;
  if(mode == +1) {
    if(p == -1)
      this.push(value);
  } else if(mode == -1) {
    if(p != -1)
      this.splice(p,1);
  }
};

// Return whether one of a list of values exists in an array
Array.prototype.containsAny = function(items)
{
  for(var i=0; i<items.length; i++) {
    if(this.indexOf(items[i]) != -1)
      return true;
  }
  return false;
};

// Return whether all of a list of values exists in an array
Array.prototype.containsAll = function(items)
{
  for(var i = 0; i<items.length; i++) {
    if(this.indexOf(items[i]) == -1)
      return false;
  }
  return true;
};

// Push a new value into an array only if it is not already present in the array. If the optional unique parameter is false, it reverts to a normal push
Array.prototype.pushUnique = function(item,unique)
{
  if(unique === false) {
    this.push(item);
  } else {
    if(this.indexOf(item) == -1)
      this.push(item);
  }
};

Array.prototype.remove = function(item)
{
  var p = this.indexOf(item);
  if(p != -1)
    this.splice(p,1);
};

if(!Array.prototype.map) {
Array.prototype.map = function(fn,thisObj)
{
  var scope = thisObj || window;
  var a = [];
  for(var i=0, j=this.length; i < j; ++i) {
    a.push(fn.call(scope,this[i],i,this));
  }
  return a;
};}

// Get characters from the right end of a string
String.prototype.right = function(n)
{
  return n < this.length ? this.slice(this.length-n) : this;
};

// Trim whitespace from both ends of a string
String.prototype.trim = function()
{
  return this.replace(/^\s*|\s*$/g,"");
};

// Convert a string from a CSS style property name to a JavaScript style name ("background-color" -> "backgroundColor")
String.prototype.unDash = function()
{
  var s = this.split("-");
  if(s.length > 1) {
    for(var t=1; t<s.length; t++)
      s[t] = s[t].substr(0,1).toUpperCase() + s[t].substr(1);
  }
  return s.join("");
};

// Substitute substrings from an array into a format string that includes '%1'-type specifiers
String.prototype.format = function(substrings)
{
  var subRegExp = /(?:%(\d+))/mg;
  var currPos = 0;
  var r = [];
  do {
    var match = subRegExp.exec(this);
    if(match && match[1]) {
      if(match.index > currPos)
        r.push(this.substring(currPos,match.index));
      r.push(substrings[parseInt(match[1])]);
      currPos = subRegExp.lastIndex;
    }
  } while(match);
  if(currPos < this.length)
    r.push(this.substring(currPos,this.length));
  return r.join("");
};

// Escape any special RegExp characters with that character preceded by a backslash
String.prototype.escapeRegExp = function()
{
  var s = "\\^$*+?()=!|,{}[].";
  var c = this;
  for(var t=0; t<s.length; t++)
    c = c.replace(new RegExp("\\" + s.substr(t,1),"g"),"\\" + s.substr(t,1));
  return c;
};

// Convert "\" to "\s", newlines to "\n" (and remove carriage returns)
String.prototype.escapeLineBreaks = function()
{
  return this.replace(/\\/mg,"\\s").replace(/\n/mg,"\\n").replace(/\r/mg,"");
};

// Convert "\n" to newlines, "\b" to " ", "\s" to "\" (and remove carriage returns)
String.prototype.unescapeLineBreaks = function()
{
  return this.replace(/\\n/mg,"\n").replace(/\\b/mg," ").replace(/\\s/mg,"\\").replace(/\r/mg,"");
};

// Convert & to "&amp;", < to "&lt;", > to "&gt;" and " to "&quot;"
String.prototype.htmlEncode = function()
{
  return this.replace(/&/mg,"&amp;").replace(/</mg,"&lt;").replace(/>/mg,"&gt;").replace(/\"/mg,"&quot;");
};

// Convert "&amp;" to &, "&lt;" to <, "&gt;" to > and "&quot;" to "
String.prototype.htmlDecode = function()
{
  return this.replace(/&lt;/mg,"<").replace(/&gt;/mg,">").replace(/&quot;/mg,"\"").replace(/&amp;/mg,"&");
};

// Parse a space-separated string of name:value parameters
// The result is an array of objects:
//   result[0] = object with a member for each parameter name, value of that member being an array of values
//   result[1..n] = one object for each parameter, with 'name' and 'value' members
String.prototype.parseParams = function(defaultName,defaultValue,allowEval,noNames,cascadeDefaults)
{
  var parseToken = function(match,p) {
    var n;
    if(match[p]) // Double quoted
      n = match[p];
    else if(match[p+1]) // Single quoted
      n = match[p+1];
    else if(match[p+2]) // Double-square-bracket quoted
      n = match[p+2];
    else if(match[p+3]) // Double-brace quoted
      try {
        n = match[p+3];
        if(allowEval)
          n = window.eval(n);
      } catch(ex) {
        throw "Unable to evaluate {{" + match[p+3] + "}}: " + exceptionText(ex);
      }
    else if(match[p+4]) // Unquoted
      n = match[p+4];
    else if(match[p+5]) // empty quote
      n = "";
    return n;
  };
  var r = [{}];
  var dblQuote = "(?:\"((?:(?:\\\\\")|[^\"])+)\")";
  var sngQuote = "(?:'((?:(?:\\\\\')|[^'])+)')";
  var dblSquare = "(?:\\[\\[((?:\\s|\\S)*?)\\]\\])";
  var dblBrace = "(?:\\{\\{((?:\\s|\\S)*?)\\}\\})";
  var unQuoted = noNames ? "([^\"'\\s]\\S*)" : "([^\"':\\s][^\\s:]*)";
  var emptyQuote = "((?:\"\")|(?:''))";
  var skipSpace = "(?:\\s*)";
  var token = "(?:" + dblQuote + "|" + sngQuote + "|" + dblSquare + "|" + dblBrace + "|" + unQuoted + "|" + emptyQuote + ")";
  var re = noNames ? new RegExp(token,"mg") : new RegExp(skipSpace + token + skipSpace + "(?:(\\:)" + skipSpace + token + ")?","mg");
  var params = [];
  do {
    var match = re.exec(this);
    if(match) {
      var n = parseToken(match,1);
      if(noNames) {
        r.push({name:"",value:n});
      } else {
        var v = parseToken(match,8);
        if(v == null && defaultName) {
          v = n;
          n = defaultName;
        } else if(v == null && defaultValue) {
          v = defaultValue;
        }
        r.push({name:n,value:v});
        if(cascadeDefaults) {
          defaultName = n;
          defaultValue = v;
        }
      }
    }
  } while(match);
  // Summarise parameters into first element
  for(var t=1; t<r.length; t++) {
    if(r[0][r[t].name])
      r[0][r[t].name].push(r[t].value);
    else
      r[0][r[t].name] = [r[t].value];
  }
  return r;
};

// Process a string list of macro parameters into an array. Parameters can be quoted with "", '',
// [[]], {{ }} or left unquoted (and therefore space-separated). Double-braces {{}} results in
// an *evaluated* parameter: e.g. {{config.options.txtUserName}} results in the current user's name.
String.prototype.readMacroParams = function()
{
  var p = this.parseParams("list",null,true,true);
  var n = [];
  for(var t=1; t<p.length; t++)
    n.push(p[t].value);
  return n;
};

// Process a string list of unique tiddler names into an array. Tiddler names that have spaces in them must be [[bracketed]]
String.prototype.readBracketedList = function(unique)
{
  var p = this.parseParams("list",null,false,true);
  var n = [];
  for(var t=1; t<p.length; t++) {
    if(p[t].value)
      n.pushUnique(p[t].value,unique);
  }
  return n;
};

// Returns array with start and end index of chunk between given start and end marker, or undefined.
String.prototype.getChunkRange = function(start,end)
{
  var s = this.indexOf(start);
  if(s != -1) {
    s += start.length;
    var e = this.indexOf(end,s);
    if(e != -1)
      return [s,e];
  }
};

// Replace a chunk of a string given start and end markers
String.prototype.replaceChunk = function(start,end,sub)
{
  var r = this.getChunkRange(start,end);
  return r ? this.substring(0,r[0]) + sub + this.substring(r[1]) : this;
};

// Returns a chunk of a string between start and end markers, or undefined
String.prototype.getChunk = function(start,end)
{
  var r = this.getChunkRange(start,end);
  if(r)
    return this.substring(r[0],r[1]);
};


// Static method to bracket a string with double square brackets if it contains a space
String.encodeTiddlyLink = function(title)
{
  return title.indexOf(" ") == -1 ? title : "[[" + title + "]]";
};

// Static method to encodeTiddlyLink for every item in an array and join them with spaces
String.encodeTiddlyLinkList = function(list)
{
  if(list) {
    var results = [];
    for(var t=0; t<list.length; t++)
      results.push(String.encodeTiddlyLink(list[t]));
    return results.join(" ");
  } else {
    return "";
  }
};

// Convert a string as a sequence of name:"value" pairs into a hashmap
String.prototype.decodeHashMap = function()
{
  var fields = this.parseParams("anon","",false);
  var r = {};
  for(var t=1; t<fields.length; t++)
    r[fields[t].name] = fields[t].value;
  return r;
};

// Static method to encode a hashmap into a name:"value"... string
String.encodeHashMap = function(hashmap)
{
  var r = [];
  for(var t in hashmap)
    r.push(t + ':"' + hashmap[t] + '"');
  return r.join(" ");
};

// Static method to left-pad a string with 0s to a certain width
String.zeroPad = function(n,d)
{
  var s = n.toString();
  if(s.length < d)
    s = "000000000000000000000000000".substr(0,d-s.length) + s;
  return s;
};

String.prototype.startsWith = function(prefix)
{
  return !prefix || this.substring(0,prefix.length) == prefix;
};

// Returns the first value of the given named parameter.
function getParam(params,name,defaultValue)
{
  if(!params)
    return defaultValue;
  var p = params[0][name];
  return p ? p[0] : defaultValue;
}

// Returns the first value of the given boolean named parameter.
function getFlag(params,name,defaultValue)
{
  return !!getParam(params,name,defaultValue);
}

// Substitute date components into a string
Date.prototype.formatString = function(template)
{
  var t = template.replace(/0hh12/g,String.zeroPad(this.getHours12(),2));
  t = t.replace(/hh12/g,this.getHours12());
  t = t.replace(/0hh/g,String.zeroPad(this.getHours(),2));
  t = t.replace(/hh/g,this.getHours());
  t = t.replace(/mmm/g,config.messages.dates.shortMonths[this.getMonth()]);
  t = t.replace(/0mm/g,String.zeroPad(this.getMinutes(),2));
  t = t.replace(/mm/g,this.getMinutes());
  t = t.replace(/0ss/g,String.zeroPad(this.getSeconds(),2));
  t = t.replace(/ss/g,this.getSeconds());
  t = t.replace(/[ap]m/g,this.getAmPm().toLowerCase());
  t = t.replace(/[AP]M/g,this.getAmPm().toUpperCase());
  t = t.replace(/wYYYY/g,this.getYearForWeekNo());
  t = t.replace(/wYY/g,String.zeroPad(this.getYearForWeekNo()-2000,2));
  t = t.replace(/YYYY/g,this.getFullYear());
  t = t.replace(/YY/g,String.zeroPad(this.getFullYear()-2000,2));
  t = t.replace(/MMM/g,config.messages.dates.months[this.getMonth()]);
  t = t.replace(/0MM/g,String.zeroPad(this.getMonth()+1,2));
  t = t.replace(/MM/g,this.getMonth()+1);
  t = t.replace(/0WW/g,String.zeroPad(this.getWeek(),2));
  t = t.replace(/WW/g,this.getWeek());
  t = t.replace(/DDD/g,config.messages.dates.days[this.getDay()]);
  t = t.replace(/ddd/g,config.messages.dates.shortDays[this.getDay()]);
  t = t.replace(/0DD/g,String.zeroPad(this.getDate(),2));
  t = t.replace(/DDth/g,this.getDate()+this.daySuffix());
  t = t.replace(/DD/g,this.getDate());
  var tz = this.getTimezoneOffset();
  var atz = Math.abs(tz);
  t = t.replace(/TZD/g,(tz < 0 ? '+' : '-') + String.zeroPad(Math.floor(atz / 60),2) + ':' + String.zeroPad(atz % 60,2));
  t = t.replace(/\\/g,"");
  return t;
};

Date.prototype.getWeek = function()
{
  var dt = new Date(this.getTime());
  var d = dt.getDay();
  if(d==0) d=7;// JavaScript Sun=0, ISO Sun=7
  dt.setTime(dt.getTime()+(4-d)*86400000);// shift day to Thurs of same week to calculate weekNo
  var n = Math.floor((dt.getTime()-new Date(dt.getFullYear(),0,1)+3600000)/86400000);
  return Math.floor(n/7)+1;
};

Date.prototype.getYearForWeekNo = function()
{
  var dt = new Date(this.getTime());
  var d = dt.getDay();
  if(d==0) d=7;// JavaScript Sun=0, ISO Sun=7
  dt.setTime(dt.getTime()+(4-d)*86400000);// shift day to Thurs of same week
  return dt.getFullYear();
};

Date.prototype.getHours12 = function()
{
  var h = this.getHours();
  return h > 12 ? h-12 : ( h > 0 ? h : 12 );
};

Date.prototype.getAmPm = function()
{
  return this.getHours() >= 12 ? config.messages.dates.pm : config.messages.dates.am;
};

Date.prototype.daySuffix = function()
{
  return config.messages.dates.daySuffixes[this.getDate()-1];
};

// Convert a date to local YYYYMMDDHHMM string format
Date.prototype.convertToLocalYYYYMMDDHHMM = function()
{
  return this.getFullYear() + String.zeroPad(this.getMonth()+1,2) + String.zeroPad(this.getDate(),2) + String.zeroPad(this.getHours(),2) + String.zeroPad(this.getMinutes(),2);
};

// Convert a date to UTC YYYYMMDDHHMM string format
Date.prototype.convertToYYYYMMDDHHMM = function()
{
  return this.getUTCFullYear() + String.zeroPad(this.getUTCMonth()+1,2) + String.zeroPad(this.getUTCDate(),2) + String.zeroPad(this.getUTCHours(),2) + String.zeroPad(this.getUTCMinutes(),2);
};

// Convert a date to UTC YYYYMMDD.HHMMSSMMM string format
Date.prototype.convertToYYYYMMDDHHMMSSMMM = function()
{
  return this.getUTCFullYear() + String.zeroPad(this.getUTCMonth()+1,2) + String.zeroPad(this.getUTCDate(),2) + "." + String.zeroPad(this.getUTCHours(),2) + String.zeroPad(this.getUTCMinutes(),2) + String.zeroPad(this.getUTCSeconds(),2) + String.zeroPad(this.getUTCMilliseconds(),4);
};

// Static method to create a date from a UTC YYYYMMDDHHMM format string
Date.convertFromYYYYMMDDHHMM = function(d)
{
  var hh = d.substr(8,2) || "00";
  var mm = d.substr(10,2) || "00";
  return new Date(Date.UTC(parseInt(d.substr(0,4),10),
      parseInt(d.substr(4,2),10)-1,
      parseInt(d.substr(6,2),10),
      parseInt(hh,10),
      parseInt(mm,10),0,0));
};

//--
//-- RGB colour object
//--

// Construct an RGB colour object from a '#rrggbb', '#rgb' or 'rgb(n,n,n)' string or from separate r,g,b values
function RGB(r,g,b)
{
  this.r = 0;
  this.g = 0;
  this.b = 0;
  if(typeof r == "string") {
    if(r.substr(0,1) == "#") {
      if(r.length == 7) {
        this.r = parseInt(r.substr(1,2),16)/255;
        this.g = parseInt(r.substr(3,2),16)/255;
        this.b = parseInt(r.substr(5,2),16)/255;
      } else {
        this.r = parseInt(r.substr(1,1),16)/15;
        this.g = parseInt(r.substr(2,1),16)/15;
        this.b = parseInt(r.substr(3,1),16)/15;
      }
    } else {
      var rgbPattern = /rgb\s*\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)/;
      var c = r.match(rgbPattern);
      if(c) {
        this.r = parseInt(c[1],10)/255;
        this.g = parseInt(c[2],10)/255;
        this.b = parseInt(c[3],10)/255;
      }
    }
  } else {
    this.r = r;
    this.g = g;
    this.b = b;
  }
  return this;
}

// Mixes this colour with another in a specified proportion
// c = other colour to mix
// f = 0..1 where 0 is this colour and 1 is the new colour
// Returns an RGB object
RGB.prototype.mix = function(c,f)
{
  return new RGB(this.r + (c.r-this.r) * f,this.g + (c.g-this.g) * f,this.b + (c.b-this.b) * f);
};

// Return an rgb colour as a #rrggbb format hex string
RGB.prototype.toString = function()
{
  return "#" + ("0" + Math.floor(this.r.clamp(0,1) * 255).toString(16)).right(2) +
         ("0" + Math.floor(this.g.clamp(0,1) * 255).toString(16)).right(2) +
         ("0" + Math.floor(this.b.clamp(0,1) * 255).toString(16)).right(2);
};

//--
//-- DOM utilities - many derived from www.quirksmode.org
//--

// Resolve the target object of an event
function resolveTarget(e)
{
  var obj;
  if(e.target)
    obj = e.target;
  else if(e.srcElement)
    obj = e.srcElement;
  if(obj.nodeType == 3) // defeat Safari bug
    obj = obj.parentNode;
  return obj;
}

function drawGradient(place,horiz,locolors,hicolors)
{
  if(!hicolors)
    hicolors = locolors;
  for(var t=0; t<= 100; t+=2) {
    var bar = document.createElement("div");
    place.appendChild(bar);
    bar.style.position = "absolute";
    bar.style.left = horiz ? t + "%" : 0;
    bar.style.top = horiz ? 0 : t + "%";
    bar.style.width = horiz ? (101-t) + "%" : "100%";
    bar.style.height = horiz ? "100%" : (101-t) + "%";
    bar.style.zIndex = -1;
    var p = t/100*(locolors.length-1);
    var hc = hicolors[Math.floor(p)];
    if(typeof hc == "string")
      hc = new RGB(hc);
    var lc = locolors[Math.ceil(p)];
    if(typeof lc == "string")
      lc = new RGB(lc);
    bar.style.backgroundColor = hc.mix(lc,p-Math.floor(p)).toString();
  }
}

function createTiddlyText(parent,text)
{
  return parent.appendChild(document.createTextNode(text));
}

function createTiddlyCheckbox(parent,caption,checked,onChange)
{
  var cb = document.createElement("input");
  cb.setAttribute("type","checkbox");
  cb.onclick = onChange;
  parent.appendChild(cb);
  cb.checked = checked;
  cb.className = "chkOptionInput";
  if(caption)
    wikify(caption,parent);
  return cb;
}

function createTiddlyElement(parent,element,id,className,text,attribs)
{
  var e = document.createElement(element);
  if(className != null)
    e.className = className;
  if(id != null)
    e.setAttribute("id",id);
  if(text != null)
    e.appendChild(document.createTextNode(text));
  if(attribs) {
    for(var n in attribs) {
      e.setAttribute(n,attribs[n]);
    }
  }
  if(parent != null)
    parent.appendChild(e);
  return e;
}

function addEvent(obj,type,fn)
{
  if(obj.attachEvent) {
    obj["e"+type+fn] = fn;
    obj[type+fn] = function(){obj["e"+type+fn](window.event);};
    obj.attachEvent("on"+type,obj[type+fn]);
  } else {
    obj.addEventListener(type,fn,false);
  }
}

function removeEvent(obj,type,fn)
{
  if(obj.detachEvent) {
    obj.detachEvent("on"+type,obj[type+fn]);
    obj[type+fn] = null;
  } else {
    obj.removeEventListener(type,fn,false);
  }
}


// Find the closest relative with a given property value (property defaults to tagName, relative defaults to parentNode)
function findRelated(e,value,name,relative)
{
  name = name || "tagName";
  relative = relative || "parentNode";
  if(name == "className") {
    while(e && !hasClass(e,value)) {
      e = e[relative];
    }
  } else {
    while(e && e[name] != value) {
      e = e[relative];
    }
  }
  return e;
}

// Get the scroll position for window.scrollTo necessary to scroll a given element into view
function ensureVisible(e)
{
  var posTop = findPosY(e);
  var posBot = posTop + e.offsetHeight;
  var winTop = findScrollY();
  var winHeight = findWindowHeight();
  var winBot = winTop + winHeight;
  if(posTop < winTop) {
    return posTop;
  } else if(posBot > winBot) {
    if(e.offsetHeight < winHeight)
      return posTop - (winHeight - e.offsetHeight);
    else
      return posTop;
  } else {
    return winTop;
  }
}

// Get the current width of the display window
function findWindowWidth()
{
  return window.innerWidth || document.documentElement.clientWidth;
}

// Get the current height of the display window
function findWindowHeight()
{
  return window.innerHeight || document.documentElement.clientHeight;
}

// Get the current horizontal page scroll position
function findScrollX()
{
  return window.scrollX || document.documentElement.scrollLeft;
}

// Get the current vertical page scroll position
function findScrollY()
{
  return window.scrollY || document.documentElement.scrollTop;
}

function findPosX(obj)
{
  var curleft = 0;
  while(obj.offsetParent) {
    curleft += obj.offsetLeft;
    obj = obj.offsetParent;
  }
  return curleft;
}

function findPosY(obj)
{
  var curtop = 0;
  while(obj.offsetParent) {
    curtop += obj.offsetTop;
    obj = obj.offsetParent;
  }
  return curtop;
}

// Blur a particular element
function blurElement(e)
{
  if(e && e.focus && e.blur) {
    e.focus();
    e.blur();
  }
}

// Create a non-breaking space
function insertSpacer(place)
{
  var e = document.createTextNode(String.fromCharCode(160));
  if(place)
    place.appendChild(e);
  return e;
}

// Force the browser to do a document reflow when needed to workaround browser bugs
function forceReflow()
{
  if(config.browser.isGecko) {
    setStylesheet("body {top:0px;margin-top:0px;}","forceReflow");
    setTimeout(function() {setStylesheet("","forceReflow");},1);
  }
}

// Replace the current selection of a textarea or text input and scroll it into view
function replaceSelection(e,text)
{
  if(e.setSelectionRange) {
    var oldpos = e.selectionStart;
    var isRange = e.selectionEnd > e.selectionStart;
    e.value = e.value.substr(0,e.selectionStart) + text + e.value.substr(e.selectionEnd);
    e.setSelectionRange(isRange ? oldpos : oldpos + text.length,oldpos + text.length);
    var linecount = e.value.split("\n").length;
    var thisline = e.value.substr(0,e.selectionStart).split("\n").length-1;
    e.scrollTop = Math.floor((thisline - e.rows / 2) * e.scrollHeight / linecount);
  } else if(document.selection) {
    var range = document.selection.createRange();
    if(range.parentElement() == e) {
      var isCollapsed = range.text == "";
      range.text = text;
      if(!isCollapsed) {
        range.moveStart("character", -text.length);
        range.select();
      }
    }
  }
}

// Returns the text of the given (text) node, possibly merging subsequent text nodes
function getNodeText(e)
{
  var t = "";
  while(e && e.nodeName == "#text") {
    t += e.nodeValue;
    e = e.nextSibling;
  }
  return t;
}

// Returns true if the element e has a given ancestor element
function isDescendant(e,ancestor)
{
  while(e) {
    if(e === ancestor)
      return true;
    e = e.parentNode;
  }
  return false;
}


// deprecate the following...

// Prevent an event from bubbling
function stopEvent(e)
{
  var ev = e || window.event;
  ev.cancelBubble = true;
  if(ev.stopPropagation) ev.stopPropagation();
  return false;
}

// Remove any event handlers or non-primitve custom attributes
function scrubNode(e)
{
  if(!config.browser.isIE)
    return;
  var att = e.attributes;
  if(att) {
    for(var t=0; t<att.length; t++) {
      var n = att[t].name;
      if(n !== "style" && (typeof e[n] === "function" || (typeof e[n] === "object" && e[n] != null))) {
        try {
          e[n] = null;
        } catch(ex) {
        }
      }
    }
  }
  var c = e.firstChild;
  while(c) {
    scrubNode(c);
    c = c.nextSibling;
  }
}

function addClass(e,className)
{
  jQuery(e).addClass(className);
}

function removeClass(e,className)
{
  jQuery(e).removeClass(className);
}

function hasClass(e,className)
{
  return jQuery(e).hasClass(className);
}

// Remove all children of a node
function removeChildren(e)
{
  jQuery(e).empty();
}

// Return the content of an element as plain text with no formatting
function getPlainText(e)
{
  return jQuery(e).text();
}

// Remove a node and all it's children
function removeNode(e)
{
  jQuery(e).remove();
}

//--
//-- LoaderBase and SaverBase
//--

function LoaderBase() {}

LoaderBase.prototype.loadTiddler = function(store,node,tiddlers)
{
  var title = this.getTitle(store,node);
  if(safeMode && store.isShadowTiddler(title))
    return;
  if(title) {
    var tiddler = store.createTiddler(title);
    this.internalizeTiddler(store,tiddler,title,node);
    tiddlers.push(tiddler);
  }
};

LoaderBase.prototype.loadTiddlers = function(store,nodes)
{
  var tiddlers = [];
  for(var t = 0; t < nodes.length; t++) {
    try {
      this.loadTiddler(store,nodes[t],tiddlers);
    } catch(ex) {
      showException(ex,config.messages.tiddlerLoadError.format([this.getTitle(store,nodes[t])]));
    }
  }
  return tiddlers;
};

function SaverBase() {}

SaverBase.prototype.externalize = function(store)
{
  var results = [];
  var tiddlers = store.getTiddlers("title");
  for(var t = 0; t < tiddlers.length; t++) {
    if(!tiddlers[t].doNotSave())
      results.push(this.externalizeTiddler(store, tiddlers[t]));
  }
  return results.join("\n");
};

//--
//-- TW21Loader (inherits from LoaderBase)
//--

function TW21Loader() {}

TW21Loader.prototype = new LoaderBase();

TW21Loader.prototype.getTitle = function(store,node)
{
  var title = null;
  if(node.getAttribute) {
    title = node.getAttribute("title");
    if(!title)
      title = node.getAttribute("tiddler");
  }
  if(!title && node.id) {
    var lenPrefix = store.idPrefix.length;
    if(node.id.substr(0,lenPrefix) == store.idPrefix)
      title = node.id.substr(lenPrefix);
  }
  return title;
};

TW21Loader.prototype.internalizeTiddler = function(store,tiddler,title,node)
{
  var e = node.firstChild;
  var text = null;
  if(node.getAttribute("tiddler")) {
    text = getNodeText(e).unescapeLineBreaks();
  } else {
    while(e.nodeName!="PRE" && e.nodeName!="pre") {
      e = e.nextSibling;
    }
    text = e.innerHTML.replace(/\r/mg,"").htmlDecode();
  }
  var modifier = node.getAttribute("modifier");
  var c = node.getAttribute("created");
  var m = node.getAttribute("modified");
  var created = c ? Date.convertFromYYYYMMDDHHMM(c) : version.date;
  var modified = m ? Date.convertFromYYYYMMDDHHMM(m) : created;
  var tags = node.getAttribute("tags");
  var fields = {};
  var attrs = node.attributes;
  for(var i = attrs.length-1; i >= 0; i--) {
    var name = attrs[i].name;
    if(attrs[i].specified && !TiddlyWiki.isStandardField(name)) {
      fields[name] = attrs[i].value.unescapeLineBreaks();
    }
  }
  tiddler.assign(title,text,modifier,modified,tags,created,fields);
  return tiddler;
};

//--
//-- TW21Saver (inherits from SaverBase)
//--

function TW21Saver() {}

TW21Saver.prototype = new SaverBase();

TW21Saver.prototype.externalizeTiddler = function(store,tiddler)
{
  try {
    var extendedAttributes = "";
    var usePre = config.options.chkUsePreForStorage;
    store.forEachField(tiddler,
      function(tiddler,fieldName,value) {
        // don't store stuff from the temp namespace
        if(typeof value != "string")
          value = "";
        if(!fieldName.match(/^temp\./))
          extendedAttributes += ' %0="%1"'.format([fieldName,value.escapeLineBreaks().htmlEncode()]);
      },true);
    var created = tiddler.created;
    var modified = tiddler.modified;
    var attributes = tiddler.modifier ? ' modifier="' + tiddler.modifier.htmlEncode() + '"' : "";
    attributes += (usePre && created == version.date) ? "" :' created="' + created.convertToYYYYMMDDHHMM() + '"';
    attributes += (usePre && modified == created) ? "" : ' modified="' + modified.convertToYYYYMMDDHHMM() +'"';
    var tags = tiddler.getTags();
    if(!usePre || tags)
      attributes += ' tags="' + tags.htmlEncode() + '"';
    return ('<div %0="%1"%2%3>%4</'+'div>').format([
        usePre ? "title" : "tiddler",
        tiddler.title.htmlEncode(),
        attributes,
        extendedAttributes,
        usePre ? "\n<pre>" + tiddler.text.htmlEncode() + "</pre>\n" : tiddler.text.escapeLineBreaks().htmlEncode()
      ]);
  } catch (ex) {
    throw exceptionText(ex,config.messages.tiddlerSaveError.format([tiddler.title]));
  }
};

//]]>
</script>
<script id="jsdeprecatedArea" type="text/javascript">
//<![CDATA[
//--
//-- Deprecated Crypto functions and associated conversion routines.
//-- Use the jQuery.encoding functions directly instead.
//--

// Crypto 'namespace'
function Crypto() {}

// Convert a string to an array of big-endian 32-bit words
Crypto.strToBe32s = function(str)
{
  return jQuery.encoding.strToBe32s(str);
};

// Convert an array of big-endian 32-bit words to a string
Crypto.be32sToStr = function(be)
{
  return jQuery.encoding.be32sToStr(be);
};

// Convert an array of big-endian 32-bit words to a hex string
Crypto.be32sToHex = function(be)
{
  return jQuery.encoding.be32sToHex(be);
};

// Return, in hex, the SHA-1 hash of a string
Crypto.hexSha1Str = function(str)
{
  return jQuery.encoding.digests.hexSha1Str(str);
};

// Return the SHA-1 hash of a string
Crypto.sha1Str = function(str)
{
  return jQuery.encoding.digests.sha1Str(str);
};

// Calculate the SHA-1 hash of an array of blen bytes of big-endian 32-bit words
Crypto.sha1 = function(x,blen)
{
  return jQuery.encoding.digests.sha1(x,blen);
};

//--
//-- Deprecated DOM utilities
//--

// @Deprecated: Use jQuery.stylesheet instead
function setStylesheet(s,id,doc)
{
  jQuery.twStylesheet(s,{ id: id, doc: doc });
}

// @Deprecated: Use jQuery.stylesheet.remove instead
function removeStyleSheet(id)
{
  jQuery.twStylesheet.remove({ id: id });
}
//--
//-- Deprecated HTTP request code
//-- Use the jQuery ajax functions directly instead
//--

function loadRemoteFile(url,callback,params)
{
  return httpReq("GET",url,callback,params);
}

function doHttp(type,url,data,contentType,username,password,callback,params,headers,allowCache)
{
  return httpReq(type,url,callback,params,headers,data,contentType,username,password,allowCache);
}

function httpReq(type,url,callback,params,headers,data,contentType,username,password,allowCache)
{
  var options = {
    type:type,
    url:url,
    processData:false,
    data:data,
    cache:!!allowCache,
    beforeSend: function(xhr) {
      for(var i in headers)
        xhr.setRequestHeader(i,headers[i]);
      xhr.setRequestHeader("X-Requested-With", "TiddlyWiki " + formatVersion());
    }
  };

  if(callback) {
    options.complete = function(xhr,textStatus) {
      if(jQuery.httpSuccess(xhr))
        callback(true,params,xhr.responseText,url,xhr);
      else
        callback(false,params,null,url,xhr);
    };
  }
  if(contentType)
    options.contentType = contentType;
  if(username)
    options.username = username;
  if(password)
    options.password = password;
  if(window.Components && window.netscape && window.netscape.security && document.location.protocol.indexOf("http") == -1)
    window.netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");
  jQuery.ajax(options);
}

//--
//-- Deprecated String functions
//--

// @Deprecated: no direct replacement, since not used in core code
String.prototype.toJSONString = function()
{
  // Convert a string to it's JSON representation by encoding control characters, double quotes and backslash. See json.org
  var m = {
    '\b': '\\b',
    '\f': '\\f',
    '\n': '\\n',
    '\r': '\\r',
    '\t': '\\t',
    '"' : '\\"',
    '\\': '\\\\'
    };
  var replaceFn = function(a,b) {
    var c = m[b];
    if(c)
      return c;
    c = b.charCodeAt();
    return '\\u00' + Math.floor(c / 16).toString(16) + (c % 16).toString(16);
    };
  if(/["\\\x00-\x1f]/.test(this))
    return '"' + this.replace(/([\x00-\x1f\\"])/g,replaceFn) + '"';
  return '"' + this + '"';
};

//--
//-- Deprecated Tiddler code
//--

// @Deprecated: Use tiddlerToRssItem(tiddler,uri) instead
Tiddler.prototype.toRssItem = function(uri)
{
  return tiddlerToRssItem(this,uri);
};

// @Deprecated: Use "<item>\n" + tiddlerToRssItem(tiddler,uri)  + "\n</item>" instead
Tiddler.prototype.saveToRss = function(uri)
{
  return "<item>\n" + tiddlerToRssItem(this,uri) + "\n</item>";
};

// @Deprecated: Use jQuery.encoding.digests.hexSha1Str instead
Tiddler.prototype.generateFingerprint = function()
{
  return "0x" + Crypto.hexSha1Str(this.text);
};

//]]>
</script>
<script id="jslibArea" type="text/javascript">
//<![CDATA[
/*
 * jQuery JavaScript Library v1.3.2
 * http://jquery.com/
 *
 * Copyright (c) 2009 John Resig
 * Dual licensed under the MIT and GPL licenses.
 * http://docs.jquery.com/License
 *
 * Date: 2009-02-19 17:34:21 -0500 (Thu, 19 Feb 2009)
 * Revision: 6246
 */
(function(){var l=this,g,y=l.jQuery,p=l.$,o=l.jQuery=l.$=function(E,F){return new o.fn.init(E,F)},D=/^[^<]*(<(.|\s)+>)[^>]*$|^#([\w-]+)$/,f=/^.[^:#\[\.,]*$/;o.fn=o.prototype={init:function(E,H){E=E||document;if(E.nodeType){this[0]=E;this.length=1;this.context=E;return this}if(typeof E==="string"){var G=D.exec(E);if(G&&(G[1]||!H)){if(G[1]){E=o.clean([G[1]],H)}else{var I=document.getElementById(G[3]);if(I&&I.id!=G[3]){return o().find(E)}var F=o(I||[]);F.context=document;F.selector=E;return F}}else{return o(H).find(E)}}else{if(o.isFunction(E)){return o(document).ready(E)}}if(E.selector&&E.context){this.selector=E.selector;this.context=E.context}return this.setArray(o.isArray(E)?E:o.makeArray(E))},selector:"",jquery:"1.3.2",size:function(){return this.length},get:function(E){return E===g?Array.prototype.slice.call(this):this[E]},pushStack:function(F,H,E){var G=o(F);G.prevObject=this;G.context=this.context;if(H==="find"){G.selector=this.selector+(this.selector?" ":"")+E}else{if(H){G.selector=this.selector+"."+H+"("+E+")"}}return G},setArray:function(E){this.length=0;Array.prototype.push.apply(this,E);return this},each:function(F,E){return o.each(this,F,E)},index:function(E){return o.inArray(E&&E.jquery?E[0]:E,this)},attr:function(F,H,G){var E=F;if(typeof F==="string"){if(H===g){return this[0]&&o[G||"attr"](this[0],F)}else{E={};E[F]=H}}return this.each(function(I){for(F in E){o.attr(G?this.style:this,F,o.prop(this,E[F],G,I,F))}})},css:function(E,F){if((E=="width"||E=="height")&&parseFloat(F)<0){F=g}return this.attr(E,F,"curCSS")},text:function(F){if(typeof F!=="object"&&F!=null){return this.empty().append((this[0]&&this[0].ownerDocument||document).createTextNode(F))}var E="";o.each(F||this,function(){o.each(this.childNodes,function(){if(this.nodeType!=8){E+=this.nodeType!=1?this.nodeValue:o.fn.text([this])}})});return E},wrapAll:function(E){if(this[0]){var F=o(E,this[0].ownerDocument).clone();if(this[0].parentNode){F.insertBefore(this[0])}F.map(function(){var G=this;while(G.firstChild){G=G.firstChild}return G}).append(this)}return this},wrapInner:function(E){return this.each(function(){o(this).contents().wrapAll(E)})},wrap:function(E){return this.each(function(){o(this).wrapAll(E)})},append:function(){return this.domManip(arguments,true,function(E){if(this.nodeType==1){this.appendChild(E)}})},prepend:function(){return this.domManip(arguments,true,function(E){if(this.nodeType==1){this.insertBefore(E,this.firstChild)}})},before:function(){return this.domManip(arguments,false,function(E){this.parentNode.insertBefore(E,this)})},after:function(){return this.domManip(arguments,false,function(E){this.parentNode.insertBefore(E,this.nextSibling)})},end:function(){return this.prevObject||o([])},push:[].push,sort:[].sort,splice:[].splice,find:function(E){if(this.length===1){var F=this.pushStack([],"find",E);F.length=0;o.find(E,this[0],F);return F}else{return this.pushStack(o.unique(o.map(this,function(G){return o.find(E,G)})),"find",E)}},clone:function(G){var E=this.map(function(){if(!o.support.noCloneEvent&&!o.isXMLDoc(this)){var I=this.outerHTML;if(!I){var J=this.ownerDocument.createElement("div");J.appendChild(this.cloneNode(true));I=J.innerHTML}return o.clean([I.replace(/ jQuery\d+="(?:\d+|null)"/g,"").replace(/^\s*/,"")])[0]}else{return this.cloneNode(true)}});if(G===true){var H=this.find("*").andSelf(),F=0;E.find("*").andSelf().each(function(){if(this.nodeName!==H[F].nodeName){return}var I=o.data(H[F],"events");for(var K in I){for(var J in I[K]){o.event.add(this,K,I[K][J],I[K][J].data)}}F++})}return E},filter:function(E){return this.pushStack(o.isFunction(E)&&o.grep(this,function(G,F){return E.call(G,F)})||o.multiFilter(E,o.grep(this,function(F){return F.nodeType===1})),"filter",E)},closest:function(E){var G=o.expr.match.POS.test(E)?o(E):null,F=0;return this.map(function(){var H=this;while(H&&H.ownerDocument){if(G?G.index(H)>-1:o(H).is(E)){o.data(H,"closest",F);return H}H=H.parentNode;F++}})},not:function(E){if(typeof E==="string"){if(f.test(E)){return this.pushStack(o.multiFilter(E,this,true),"not",E)}else{E=o.multiFilter(E,this)}}var F=E.length&&E[E.length-1]!==g&&!E.nodeType;return this.filter(function(){return F?o.inArray(this,E)<0:this!=E})},add:function(E){return this.pushStack(o.unique(o.merge(this.get(),typeof E==="string"?o(E):o.makeArray(E))))},is:function(E){return !!E&&o.multiFilter(E,this).length>0},hasClass:function(E){return !!E&&this.is("."+E)},val:function(K){if(K===g){var E=this[0];if(E){if(o.nodeName(E,"option")){return(E.attributes.value||{}).specified?E.value:E.text}if(o.nodeName(E,"select")){var I=E.selectedIndex,L=[],M=E.options,H=E.type=="select-one";if(I<0){return null}for(var F=H?I:0,J=H?I+1:M.length;F<J;F++){var G=M[F];if(G.selected){K=o(G).val();if(H){return K}L.push(K)}}return L}return(E.value||"").replace(/\r/g,"")}return g}if(typeof K==="number"){K+=""}return this.each(function(){if(this.nodeType!=1){return}if(o.isArray(K)&&/radio|checkbox/.test(this.type)){this.checked=(o.inArray(this.value,K)>=0||o.inArray(this.name,K)>=0)}else{if(o.nodeName(this,"select")){var N=o.makeArray(K);o("option",this).each(function(){this.selected=(o.inArray(this.value,N)>=0||o.inArray(this.text,N)>=0)});if(!N.length){this.selectedIndex=-1}}else{this.value=K}}})},html:function(E){return E===g?(this[0]?this[0].innerHTML.replace(/ jQuery\d+="(?:\d+|null)"/g,""):null):this.empty().append(E)},replaceWith:function(E){return this.after(E).remove()},eq:function(E){return this.slice(E,+E+1)},slice:function(){return this.pushStack(Array.prototype.slice.apply(this,arguments),"slice",Array.prototype.slice.call(arguments).join(","))},map:function(E){return this.pushStack(o.map(this,function(G,F){return E.call(G,F,G)}))},andSelf:function(){return this.add(this.prevObject)},domManip:function(J,M,L){if(this[0]){var I=(this[0].ownerDocument||this[0]).createDocumentFragment(),F=o.clean(J,(this[0].ownerDocument||this[0]),I),H=I.firstChild;if(H){for(var G=0,E=this.length;G<E;G++){L.call(K(this[G],H),this.length>1||G>0?I.cloneNode(true):I)}}if(F){o.each(F,z)}}return this;function K(N,O){return M&&o.nodeName(N,"table")&&o.nodeName(O,"tr")?(N.getElementsByTagName("tbody")[0]||N.appendChild(N.ownerDocument.createElement("tbody"))):N}}};o.fn.init.prototype=o.fn;function z(E,F){if(F.src){o.ajax({url:F.src,async:false,dataType:"script"})}else{o.globalEval(F.text||F.textContent||F.innerHTML||"")}if(F.parentNode){F.parentNode.removeChild(F)}}function e(){return +new Date}o.extend=o.fn.extend=function(){var J=arguments[0]||{},H=1,I=arguments.length,E=false,G;if(typeof J==="boolean"){E=J;J=arguments[1]||{};H=2}if(typeof J!=="object"&&!o.isFunction(J)){J={}}if(I==H){J=this;--H}for(;H<I;H++){if((G=arguments[H])!=null){for(var F in G){var K=J[F],L=G[F];if(J===L){continue}if(E&&L&&typeof L==="object"&&!L.nodeType){J[F]=o.extend(E,K||(L.length!=null?[]:{}),L)}else{if(L!==g){J[F]=L}}}}}return J};var b=/z-?index|font-?weight|opacity|zoom|line-?height/i,q=document.defaultView||{},s=Object.prototype.toString;o.extend({noConflict:function(E){l.$=p;if(E){l.jQuery=y}return o},isFunction:function(E){return s.call(E)==="[object Function]"},isArray:function(E){return s.call(E)==="[object Array]"},isXMLDoc:function(E){return E.nodeType===9&&E.documentElement.nodeName!=="HTML"||!!E.ownerDocument&&o.isXMLDoc(E.ownerDocument)},globalEval:function(G){if(G&&/\S/.test(G)){var F=document.getElementsByTagName("head")[0]||document.documentElement,E=document.createElement("script");E.type="text/javascript";if(o.support.scriptEval){E.appendChild(document.createTextNode(G))}else{E.text=G}F.insertBefore(E,F.firstChild);F.removeChild(E)}},nodeName:function(F,E){return F.nodeName&&F.nodeName.toUpperCase()==E.toUpperCase()},each:function(G,K,F){var E,H=0,I=G.length;if(F){if(I===g){for(E in G){if(K.apply(G[E],F)===false){break}}}else{for(;H<I;){if(K.apply(G[H++],F)===false){break}}}}else{if(I===g){for(E in G){if(K.call(G[E],E,G[E])===false){break}}}else{for(var J=G[0];H<I&&K.call(J,H,J)!==false;J=G[++H]){}}}return G},prop:function(H,I,G,F,E){if(o.isFunction(I)){I=I.call(H,F)}return typeof I==="number"&&G=="curCSS"&&!b.test(E)?I+"px":I},className:{add:function(E,F){o.each((F||"").split(/\s+/),function(G,H){if(E.nodeType==1&&!o.className.has(E.className,H)){E.className+=(E.className?" ":"")+H}})},remove:function(E,F){if(E.nodeType==1){E.className=F!==g?o.grep(E.className.split(/\s+/),function(G){return !o.className.has(F,G)}).join(" "):""}},has:function(F,E){return F&&o.inArray(E,(F.className||F).toString().split(/\s+/))>-1}},swap:function(H,G,I){var E={};for(var F in G){E[F]=H.style[F];H.style[F]=G[F]}I.call(H);for(var F in G){H.style[F]=E[F]}},css:function(H,F,J,E){if(F=="width"||F=="height"){var L,G={position:"absolute",visibility:"hidden",display:"block"},K=F=="width"?["Left","Right"]:["Top","Bottom"];function I(){L=F=="width"?H.offsetWidth:H.offsetHeight;if(E==="border"){return}o.each(K,function(){if(!E){L-=parseFloat(o.curCSS(H,"padding"+this,true))||0}if(E==="margin"){L+=parseFloat(o.curCSS(H,"margin"+this,true))||0}else{L-=parseFloat(o.curCSS(H,"border"+this+"Width",true))||0}})}if(H.offsetWidth!==0){I()}else{o.swap(H,G,I)}return Math.max(0,Math.round(L))}return o.curCSS(H,F,J)},curCSS:function(I,F,G){var L,E=I.style;if(F=="opacity"&&!o.support.opacity){L=o.attr(E,"opacity");return L==""?"1":L}if(F.match(/float/i)){F=w}if(!G&&E&&E[F]){L=E[F]}else{if(q.getComputedStyle){if(F.match(/float/i)){F="float"}F=F.replace(/([A-Z])/g,"-$1").toLowerCase();var M=q.getComputedStyle(I,null);if(M){L=M.getPropertyValue(F)}if(F=="opacity"&&L==""){L="1"}}else{if(I.currentStyle){var J=F.replace(/\-(\w)/g,function(N,O){return O.toUpperCase()});L=I.currentStyle[F]||I.currentStyle[J];if(!/^\d+(px)?$/i.test(L)&&/^\d/.test(L)){var H=E.left,K=I.runtimeStyle.left;I.runtimeStyle.left=I.currentStyle.left;E.left=L||0;L=E.pixelLeft+"px";E.left=H;I.runtimeStyle.left=K}}}}return L},clean:function(F,K,I){K=K||document;if(typeof K.createElement==="undefined"){K=K.ownerDocument||K[0]&&K[0].ownerDocument||document}if(!I&&F.length===1&&typeof F[0]==="string"){var H=/^<(\w+)\s*\/?>$/.exec(F[0]);if(H){return[K.createElement(H[1])]}}var G=[],E=[],L=K.createElement("div");o.each(F,function(P,S){if(typeof S==="number"){S+=""}if(!S){return}if(typeof S==="string"){S=S.replace(/(<(\w+)[^>]*?)\/>/g,function(U,V,T){return T.match(/^(abbr|br|col|img|input|link|meta|param|hr|area|embed)$/i)?U:V+"></"+T+">"});var O=S.replace(/^\s+/,"").substring(0,10).toLowerCase();var Q=!O.indexOf("<opt")&&[1,"<select multiple='multiple'>","</select>"]||!O.indexOf("<leg")&&[1,"<fieldset>","</fieldset>"]||O.match(/^<(thead|tbody|tfoot|colg|cap)/)&&[1,"<table>","</table>"]||!O.indexOf("<tr")&&[2,"<table><tbody>","</tbody></table>"]||(!O.indexOf("<td")||!O.indexOf("<th"))&&[3,"<table><tbody><tr>","</tr></tbody></table>"]||!O.indexOf("<col")&&[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"]||!o.support.htmlSerialize&&[1,"div<div>","</div>"]||[0,"",""];L.innerHTML=Q[1]+S+Q[2];while(Q[0]--){L=L.lastChild}if(!o.support.tbody){var R=/<tbody/i.test(S),N=!O.indexOf("<table")&&!R?L.firstChild&&L.firstChild.childNodes:Q[1]=="<table>"&&!R?L.childNodes:[];for(var M=N.length-1;M>=0;--M){if(o.nodeName(N[M],"tbody")&&!N[M].childNodes.length){N[M].parentNode.removeChild(N[M])}}}if(!o.support.leadingWhitespace&&/^\s/.test(S)){L.insertBefore(K.createTextNode(S.match(/^\s*/)[0]),L.firstChild)}S=o.makeArray(L.childNodes)}if(S.nodeType){G.push(S)}else{G=o.merge(G,S)}});if(I){for(var J=0;G[J];J++){if(o.nodeName(G[J],"script")&&(!G[J].type||G[J].type.toLowerCase()==="text/javascript")){E.push(G[J].parentNode?G[J].parentNode.removeChild(G[J]):G[J])}else{if(G[J].nodeType===1){G.splice.apply(G,[J+1,0].concat(o.makeArray(G[J].getElementsByTagName("script"))))}I.appendChild(G[J])}}return E}return G},attr:function(J,G,K){if(!J||J.nodeType==3||J.nodeType==8){return g}var H=!o.isXMLDoc(J),L=K!==g;G=H&&o.props[G]||G;if(J.tagName){var F=/href|src|style/.test(G);if(G=="selected"&&J.parentNode){J.parentNode.selectedIndex}if(G in J&&H&&!F){if(L){if(G=="type"&&o.nodeName(J,"input")&&J.parentNode){throw"type property can't be changed"}J[G]=K}if(o.nodeName(J,"form")&&J.getAttributeNode(G)){return J.getAttributeNode(G).nodeValue}if(G=="tabIndex"){var I=J.getAttributeNode("tabIndex");return I&&I.specified?I.value:J.nodeName.match(/(button|input|object|select|textarea)/i)?0:J.nodeName.match(/^(a|area)$/i)&&J.href?0:g}return J[G]}if(!o.support.style&&H&&G=="style"){return o.attr(J.style,"cssText",K)}if(L){J.setAttribute(G,""+K)}var E=!o.support.hrefNormalized&&H&&F?J.getAttribute(G,2):J.getAttribute(G);return E===null?g:E}if(!o.support.opacity&&G=="opacity"){if(L){J.zoom=1;J.filter=(J.filter||"").replace(/alpha\([^)]*\)/,"")+(parseInt(K)+""=="NaN"?"":"alpha(opacity="+K*100+")")}return J.filter&&J.filter.indexOf("opacity=")>=0?(parseFloat(J.filter.match(/opacity=([^)]*)/)[1])/100)+"":""}G=G.replace(/-([a-z])/ig,function(M,N){return N.toUpperCase()});if(L){J[G]=K}return J[G]},trim:function(E){return(E||"").replace(/^\s+|\s+$/g,"")},makeArray:function(G){var E=[];if(G!=null){var F=G.length;if(F==null||typeof G==="string"||o.isFunction(G)||G.setInterval){E[0]=G}else{while(F){E[--F]=G[F]}}}return E},inArray:function(G,H){for(var E=0,F=H.length;E<F;E++){if(H[E]===G){return E}}return -1},merge:function(H,E){var F=0,G,I=H.length;if(!o.support.getAll){while((G=E[F++])!=null){if(G.nodeType!=8){H[I++]=G}}}else{while((G=E[F++])!=null){H[I++]=G}}return H},unique:function(K){var F=[],E={};try{for(var G=0,H=K.length;G<H;G++){var J=o.data(K[G]);if(!E[J]){E[J]=true;F.push(K[G])}}}catch(I){F=K}return F},grep:function(F,J,E){var G=[];for(var H=0,I=F.length;H<I;H++){if(!E!=!J(F[H],H)){G.push(F[H])}}return G},map:function(E,J){var F=[];for(var G=0,H=E.length;G<H;G++){var I=J(E[G],G);if(I!=null){F[F.length]=I}}return F.concat.apply([],F)}});var C=navigator.userAgent.toLowerCase();o.browser={version:(C.match(/.+(?:rv|it|ra|ie)[\/: ]([\d.]+)/)||[0,"0"])[1],safari:/webkit/.test(C),opera:/opera/.test(C),msie:/msie/.test(C)&&!/opera/.test(C),mozilla:/mozilla/.test(C)&&!/(compatible|webkit)/.test(C)};o.each({parent:function(E){return E.parentNode},parents:function(E){return o.dir(E,"parentNode")},next:function(E){return o.nth(E,2,"nextSibling")},prev:function(E){return o.nth(E,2,"previousSibling")},nextAll:function(E){return o.dir(E,"nextSibling")},prevAll:function(E){return o.dir(E,"previousSibling")},siblings:function(E){return o.sibling(E.parentNode.firstChild,E)},children:function(E){return o.sibling(E.firstChild)},contents:function(E){return o.nodeName(E,"iframe")?E.contentDocument||E.contentWindow.document:o.makeArray(E.childNodes)}},function(E,F){o.fn[E]=function(G){var H=o.map(this,F);if(G&&typeof G=="string"){H=o.multiFilter(G,H)}return this.pushStack(o.unique(H),E,G)}});o.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(E,F){o.fn[E]=function(G){var J=[],L=o(G);for(var K=0,H=L.length;K<H;K++){var I=(K>0?this.clone(true):this).get();o.fn[F].apply(o(L[K]),I);J=J.concat(I)}return this.pushStack(J,E,G)}});o.each({removeAttr:function(E){o.attr(this,E,"");if(this.nodeType==1){this.removeAttribute(E)}},addClass:function(E){o.className.add(this,E)},removeClass:function(E){o.className.remove(this,E)},toggleClass:function(F,E){if(typeof E!=="boolean"){E=!o.className.has(this,F)}o.className[E?"add":"remove"](this,F)},remove:function(E){if(!E||o.filter(E,[this]).length){o("*",this).add([this]).each(function(){o.event.remove(this);o.removeData(this)});if(this.parentNode){this.parentNode.removeChild(this)}}},empty:function(){o(this).children().remove();while(this.firstChild){this.removeChild(this.firstChild)}}},function(E,F){o.fn[E]=function(){return this.each(F,arguments)}});function j(E,F){return E[0]&&parseInt(o.curCSS(E[0],F,true),10)||0}var h="jQuery"+e(),v=0,A={};o.extend({cache:{},data:function(F,E,G){F=F==l?A:F;var H=F[h];if(!H){H=F[h]=++v}if(E&&!o.cache[H]){o.cache[H]={}}if(G!==g){o.cache[H][E]=G}return E?o.cache[H][E]:H},removeData:function(F,E){F=F==l?A:F;var H=F[h];if(E){if(o.cache[H]){delete o.cache[H][E];E="";for(E in o.cache[H]){break}if(!E){o.removeData(F)}}}else{try{delete F[h]}catch(G){if(F.removeAttribute){F.removeAttribute(h)}}delete o.cache[H]}},queue:function(F,E,H){if(F){E=(E||"fx")+"queue";var G=o.data(F,E);if(!G||o.isArray(H)){G=o.data(F,E,o.makeArray(H))}else{if(H){G.push(H)}}}return G},dequeue:function(H,G){var E=o.queue(H,G),F=E.shift();if(!G||G==="fx"){F=E[0]}if(F!==g){F.call(H)}}});o.fn.extend({data:function(E,G){var H=E.split(".");H[1]=H[1]?"."+H[1]:"";if(G===g){var F=this.triggerHandler("getData"+H[1]+"!",[H[0]]);if(F===g&&this.length){F=o.data(this[0],E)}return F===g&&H[1]?this.data(H[0]):F}else{return this.trigger("setData"+H[1]+"!",[H[0],G]).each(function(){o.data(this,E,G)})}},removeData:function(E){return this.each(function(){o.removeData(this,E)})},queue:function(E,F){if(typeof E!=="string"){F=E;E="fx"}if(F===g){return o.queue(this[0],E)}return this.each(function(){var G=o.queue(this,E,F);if(E=="fx"&&G.length==1){G[0].call(this)}})},dequeue:function(E){return this.each(function(){o.dequeue(this,E)})}});
/*
 * Sizzle CSS Selector Engine - v0.9.3
 *  Copyright 2009, The Dojo Foundation
 *  Released under the MIT, BSD, and GPL Licenses.
 *  More information: http://sizzlejs.com/
 */
(function(){var R=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^[\]]*\]|['"][^'"]*['"]|[^[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?/g,L=0,H=Object.prototype.toString;var F=function(Y,U,ab,ac){ab=ab||[];U=U||document;if(U.nodeType!==1&&U.nodeType!==9){return[]}if(!Y||typeof Y!=="string"){return ab}var Z=[],W,af,ai,T,ad,V,X=true;R.lastIndex=0;while((W=R.exec(Y))!==null){Z.push(W[1]);if(W[2]){V=RegExp.rightContext;break}}if(Z.length>1&&M.exec(Y)){if(Z.length===2&&I.relative[Z[0]]){af=J(Z[0]+Z[1],U)}else{af=I.relative[Z[0]]?[U]:F(Z.shift(),U);while(Z.length){Y=Z.shift();if(I.relative[Y]){Y+=Z.shift()}af=J(Y,af)}}}else{var ae=ac?{expr:Z.pop(),set:E(ac)}:F.find(Z.pop(),Z.length===1&&U.parentNode?U.parentNode:U,Q(U));af=F.filter(ae.expr,ae.set);if(Z.length>0){ai=E(af)}else{X=false}while(Z.length){var ah=Z.pop(),ag=ah;if(!I.relative[ah]){ah=""}else{ag=Z.pop()}if(ag==null){ag=U}I.relative[ah](ai,ag,Q(U))}}if(!ai){ai=af}if(!ai){throw"Syntax error, unrecognized expression: "+(ah||Y)}if(H.call(ai)==="[object Array]"){if(!X){ab.push.apply(ab,ai)}else{if(U.nodeType===1){for(var aa=0;ai[aa]!=null;aa++){if(ai[aa]&&(ai[aa]===true||ai[aa].nodeType===1&&K(U,ai[aa]))){ab.push(af[aa])}}}else{for(var aa=0;ai[aa]!=null;aa++){if(ai[aa]&&ai[aa].nodeType===1){ab.push(af[aa])}}}}}else{E(ai,ab)}if(V){F(V,U,ab,ac);if(G){hasDuplicate=false;ab.sort(G);if(hasDuplicate){for(var aa=1;aa<ab.length;aa++){if(ab[aa]===ab[aa-1]){ab.splice(aa--,1)}}}}}return ab};F.matches=function(T,U){return F(T,null,null,U)};F.find=function(aa,T,ab){var Z,X;if(!aa){return[]}for(var W=0,V=I.order.length;W<V;W++){var Y=I.order[W],X;if((X=I.match[Y].exec(aa))){var U=RegExp.leftContext;if(U.substr(U.length-1)!=="\\"){X[1]=(X[1]||"").replace(/\\/g,"");Z=I.find[Y](X,T,ab);if(Z!=null){aa=aa.replace(I.match[Y],"");break}}}}if(!Z){Z=T.getElementsByTagName("*")}return{set:Z,expr:aa}};F.filter=function(ad,ac,ag,W){var V=ad,ai=[],aa=ac,Y,T,Z=ac&&ac[0]&&Q(ac[0]);while(ad&&ac.length){for(var ab in I.filter){if((Y=I.match[ab].exec(ad))!=null){var U=I.filter[ab],ah,af;T=false;if(aa==ai){ai=[]}if(I.preFilter[ab]){Y=I.preFilter[ab](Y,aa,ag,ai,W,Z);if(!Y){T=ah=true}else{if(Y===true){continue}}}if(Y){for(var X=0;(af=aa[X])!=null;X++){if(af){ah=U(af,Y,X,aa);var ae=W^!!ah;if(ag&&ah!=null){if(ae){T=true}else{aa[X]=false}}else{if(ae){ai.push(af);T=true}}}}}if(ah!==g){if(!ag){aa=ai}ad=ad.replace(I.match[ab],"");if(!T){return[]}break}}}if(ad==V){if(T==null){throw"Syntax error, unrecognized expression: "+ad}else{break}}V=ad}return aa};var I=F.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF_-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF_-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF_-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF_-]|\\.)+)\s*(?:(\S?=)\s*(['"]*)(.*?)\3|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*_-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\((even|odd|[\dn+-]*)\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF_-]|\\.)+)(?:\((['"]*)((?:\([^\)]+\)|[^\2\(\)]*)+)\2\))?/},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(T){return T.getAttribute("href")}},relative:{"+":function(aa,T,Z){var X=typeof T==="string",ab=X&&!/\W/.test(T),Y=X&&!ab;if(ab&&!Z){T=T.toUpperCase()}for(var W=0,V=aa.length,U;W<V;W++){if((U=aa[W])){while((U=U.previousSibling)&&U.nodeType!==1){}aa[W]=Y||U&&U.nodeName===T?U||false:U===T}}if(Y){F.filter(T,aa,true)}},">":function(Z,U,aa){var X=typeof U==="string";if(X&&!/\W/.test(U)){U=aa?U:U.toUpperCase();for(var V=0,T=Z.length;V<T;V++){var Y=Z[V];if(Y){var W=Y.parentNode;Z[V]=W.nodeName===U?W:false}}}else{for(var V=0,T=Z.length;V<T;V++){var Y=Z[V];if(Y){Z[V]=X?Y.parentNode:Y.parentNode===U}}if(X){F.filter(U,Z,true)}}},"":function(W,U,Y){var V=L++,T=S;if(!U.match(/\W/)){var X=U=Y?U:U.toUpperCase();T=P}T("parentNode",U,V,W,X,Y)},"~":function(W,U,Y){var V=L++,T=S;if(typeof U==="string"&&!U.match(/\W/)){var X=U=Y?U:U.toUpperCase();T=P}T("previousSibling",U,V,W,X,Y)}},find:{ID:function(U,V,W){if(typeof V.getElementById!=="undefined"&&!W){var T=V.getElementById(U[1]);return T?[T]:[]}},NAME:function(V,Y,Z){if(typeof Y.getElementsByName!=="undefined"){var U=[],X=Y.getElementsByName(V[1]);for(var W=0,T=X.length;W<T;W++){if(X[W].getAttribute("name")===V[1]){U.push(X[W])}}return U.length===0?null:U}},TAG:function(T,U){return U.getElementsByTagName(T[1])}},preFilter:{CLASS:function(W,U,V,T,Z,aa){W=" "+W[1].replace(/\\/g,"")+" ";if(aa){return W}for(var X=0,Y;(Y=U[X])!=null;X++){if(Y){if(Z^(Y.className&&(" "+Y.className+" ").indexOf(W)>=0)){if(!V){T.push(Y)}}else{if(V){U[X]=false}}}}return false},ID:function(T){return T[1].replace(/\\/g,"")},TAG:function(U,T){for(var V=0;T[V]===false;V++){}return T[V]&&Q(T[V])?U[1]:U[1].toUpperCase()},CHILD:function(T){if(T[1]=="nth"){var U=/(-?)(\d*)n((?:\+|-)?\d*)/.exec(T[2]=="even"&&"2n"||T[2]=="odd"&&"2n+1"||!/\D/.test(T[2])&&"0n+"+T[2]||T[2]);T[2]=(U[1]+(U[2]||1))-0;T[3]=U[3]-0}T[0]=L++;return T},ATTR:function(X,U,V,T,Y,Z){var W=X[1].replace(/\\/g,"");if(!Z&&I.attrMap[W]){X[1]=I.attrMap[W]}if(X[2]==="~="){X[4]=" "+X[4]+" "}return X},PSEUDO:function(X,U,V,T,Y){if(X[1]==="not"){if(X[3].match(R).length>1||/^\w/.test(X[3])){X[3]=F(X[3],null,null,U)}else{var W=F.filter(X[3],U,V,true^Y);if(!V){T.push.apply(T,W)}return false}}else{if(I.match.POS.test(X[0])||I.match.CHILD.test(X[0])){return true}}return X},POS:function(T){T.unshift(true);return T}},filters:{enabled:function(T){return T.disabled===false&&T.type!=="hidden"},disabled:function(T){return T.disabled===true},checked:function(T){return T.checked===true},selected:function(T){T.parentNode.selectedIndex;return T.selected===true},parent:function(T){return !!T.firstChild},empty:function(T){return !T.firstChild},has:function(V,U,T){return !!F(T[3],V).length},header:function(T){return/h\d/i.test(T.nodeName)},text:function(T){return"text"===T.type},radio:function(T){return"radio"===T.type},checkbox:function(T){return"checkbox"===T.type},file:function(T){return"file"===T.type},password:function(T){return"password"===T.type},submit:function(T){return"submit"===T.type},image:function(T){return"image"===T.type},reset:function(T){return"reset"===T.type},button:function(T){return"button"===T.type||T.nodeName.toUpperCase()==="BUTTON"},input:function(T){return/input|select|textarea|button/i.test(T.nodeName)}},setFilters:{first:function(U,T){return T===0},last:function(V,U,T,W){return U===W.length-1},even:function(U,T){return T%2===0},odd:function(U,T){return T%2===1},lt:function(V,U,T){return U<T[3]-0},gt:function(V,U,T){return U>T[3]-0},nth:function(V,U,T){return T[3]-0==U},eq:function(V,U,T){return T[3]-0==U}},filter:{PSEUDO:function(Z,V,W,aa){var U=V[1],X=I.filters[U];if(X){return X(Z,W,V,aa)}else{if(U==="contains"){return(Z.textContent||Z.innerText||"").indexOf(V[3])>=0}else{if(U==="not"){var Y=V[3];for(var W=0,T=Y.length;W<T;W++){if(Y[W]===Z){return false}}return true}}}},CHILD:function(T,W){var Z=W[1],U=T;switch(Z){case"only":case"first":while(U=U.previousSibling){if(U.nodeType===1){return false}}if(Z=="first"){return true}U=T;case"last":while(U=U.nextSibling){if(U.nodeType===1){return false}}return true;case"nth":var V=W[2],ac=W[3];if(V==1&&ac==0){return true}var Y=W[0],ab=T.parentNode;if(ab&&(ab.sizcache!==Y||!T.nodeIndex)){var X=0;for(U=ab.firstChild;U;U=U.nextSibling){if(U.nodeType===1){U.nodeIndex=++X}}ab.sizcache=Y}var aa=T.nodeIndex-ac;if(V==0){return aa==0}else{return(aa%V==0&&aa/V>=0)}}},ID:function(U,T){return U.nodeType===1&&U.getAttribute("id")===T},TAG:function(U,T){return(T==="*"&&U.nodeType===1)||U.nodeName===T},CLASS:function(U,T){return(" "+(U.className||U.getAttribute("class"))+" ").indexOf(T)>-1},ATTR:function(Y,W){var V=W[1],T=I.attrHandle[V]?I.attrHandle[V](Y):Y[V]!=null?Y[V]:Y.getAttribute(V),Z=T+"",X=W[2],U=W[4];return T==null?X==="!=":X==="="?Z===U:X==="*="?Z.indexOf(U)>=0:X==="~="?(" "+Z+" ").indexOf(U)>=0:!U?Z&&T!==false:X==="!="?Z!=U:X==="^="?Z.indexOf(U)===0:X==="$="?Z.substr(Z.length-U.length)===U:X==="|="?Z===U||Z.substr(0,U.length+1)===U+"-":false},POS:function(X,U,V,Y){var T=U[2],W=I.setFilters[T];if(W){return W(X,V,U,Y)}}}};var M=I.match.POS;for(var O in I.match){I.match[O]=RegExp(I.match[O].source+/(?![^\[]*\])(?![^\(]*\))/.source)}var E=function(U,T){U=Array.prototype.slice.call(U);if(T){T.push.apply(T,U);return T}return U};try{Array.prototype.slice.call(document.documentElement.childNodes)}catch(N){E=function(X,W){var U=W||[];if(H.call(X)==="[object Array]"){Array.prototype.push.apply(U,X)}else{if(typeof X.length==="number"){for(var V=0,T=X.length;V<T;V++){U.push(X[V])}}else{for(var V=0;X[V];V++){U.push(X[V])}}}return U}}var G;if(document.documentElement.compareDocumentPosition){G=function(U,T){var V=U.compareDocumentPosition(T)&4?-1:U===T?0:1;if(V===0){hasDuplicate=true}return V}}else{if("sourceIndex" in document.documentElement){G=function(U,T){var V=U.sourceIndex-T.sourceIndex;if(V===0){hasDuplicate=true}return V}}else{if(document.createRange){G=function(W,U){var V=W.ownerDocument.createRange(),T=U.ownerDocument.createRange();V.selectNode(W);V.collapse(true);T.selectNode(U);T.collapse(true);var X=V.compareBoundaryPoints(Range.START_TO_END,T);if(X===0){hasDuplicate=true}return X}}}}(function(){var U=document.createElement("form"),V="script"+(new Date).getTime();U.innerHTML="<input name='"+V+"'/>";var T=document.documentElement;T.insertBefore(U,T.firstChild);if(!!document.getElementById(V)){I.find.ID=function(X,Y,Z){if(typeof Y.getElementById!=="undefined"&&!Z){var W=Y.getElementById(X[1]);return W?W.id===X[1]||typeof W.getAttributeNode!=="undefined"&&W.getAttributeNode("id").nodeValue===X[1]?[W]:g:[]}};I.filter.ID=function(Y,W){var X=typeof Y.getAttributeNode!=="undefined"&&Y.getAttributeNode("id");return Y.nodeType===1&&X&&X.nodeValue===W}}T.removeChild(U)})();(function(){var T=document.createElement("div");T.appendChild(document.createComment(""));if(T.getElementsByTagName("*").length>0){I.find.TAG=function(U,Y){var X=Y.getElementsByTagName(U[1]);if(U[1]==="*"){var W=[];for(var V=0;X[V];V++){if(X[V].nodeType===1){W.push(X[V])}}X=W}return X}}T.innerHTML="<a href='#'></a>";if(T.firstChild&&typeof T.firstChild.getAttribute!=="undefined"&&T.firstChild.getAttribute("href")!=="#"){I.attrHandle.href=function(U){return U.getAttribute("href",2)}}})();if(document.querySelectorAll){(function(){var T=F,U=document.createElement("div");U.innerHTML="<p class='TEST'></p>";if(U.querySelectorAll&&U.querySelectorAll(".TEST").length===0){return}F=function(Y,X,V,W){X=X||document;if(!W&&X.nodeType===9&&!Q(X)){try{return E(X.querySelectorAll(Y),V)}catch(Z){}}return T(Y,X,V,W)};F.find=T.find;F.filter=T.filter;F.selectors=T.selectors;F.matches=T.matches})()}if(document.getElementsByClassName&&document.documentElement.getElementsByClassName){(function(){var T=document.createElement("div");T.innerHTML="<div class='test e'></div><div class='test'></div>";if(T.getElementsByClassName("e").length===0){return}T.lastChild.className="e";if(T.getElementsByClassName("e").length===1){return}I.order.splice(1,0,"CLASS");I.find.CLASS=function(U,V,W){if(typeof V.getElementsByClassName!=="undefined"&&!W){return V.getElementsByClassName(U[1])}}})()}function P(U,Z,Y,ad,aa,ac){var ab=U=="previousSibling"&&!ac;for(var W=0,V=ad.length;W<V;W++){var T=ad[W];if(T){if(ab&&T.nodeType===1){T.sizcache=Y;T.sizset=W}T=T[U];var X=false;while(T){if(T.sizcache===Y){X=ad[T.sizset];break}if(T.nodeType===1&&!ac){T.sizcache=Y;T.sizset=W}if(T.nodeName===Z){X=T;break}T=T[U]}ad[W]=X}}}function S(U,Z,Y,ad,aa,ac){var ab=U=="previousSibling"&&!ac;for(var W=0,V=ad.length;W<V;W++){var T=ad[W];if(T){if(ab&&T.nodeType===1){T.sizcache=Y;T.sizset=W}T=T[U];var X=false;while(T){if(T.sizcache===Y){X=ad[T.sizset];break}if(T.nodeType===1){if(!ac){T.sizcache=Y;T.sizset=W}if(typeof Z!=="string"){if(T===Z){X=true;break}}else{if(F.filter(Z,[T]).length>0){X=T;break}}}T=T[U]}ad[W]=X}}}var K=document.compareDocumentPosition?function(U,T){return U.compareDocumentPosition(T)&16}:function(U,T){return U!==T&&(U.contains?U.contains(T):true)};var Q=function(T){return T.nodeType===9&&T.documentElement.nodeName!=="HTML"||!!T.ownerDocument&&Q(T.ownerDocument)};var J=function(T,aa){var W=[],X="",Y,V=aa.nodeType?[aa]:aa;while((Y=I.match.PSEUDO.exec(T))){X+=Y[0];T=T.replace(I.match.PSEUDO,"")}T=I.relative[T]?T+"*":T;for(var Z=0,U=V.length;Z<U;Z++){F(T,V[Z],W)}return F.filter(X,W)};o.find=F;o.filter=F.filter;o.expr=F.selectors;o.expr[":"]=o.expr.filters;F.selectors.filters.hidden=function(T){return T.offsetWidth===0||T.offsetHeight===0};F.selectors.filters.visible=function(T){return T.offsetWidth>0||T.offsetHeight>0};F.selectors.filters.animated=function(T){return o.grep(o.timers,function(U){return T===U.elem}).length};o.multiFilter=function(V,T,U){if(U){V=":not("+V+")"}return F.matches(V,T)};o.dir=function(V,U){var T=[],W=V[U];while(W&&W!=document){if(W.nodeType==1){T.push(W)}W=W[U]}return T};o.nth=function(X,T,V,W){T=T||1;var U=0;for(;X;X=X[V]){if(X.nodeType==1&&++U==T){break}}return X};o.sibling=function(V,U){var T=[];for(;V;V=V.nextSibling){if(V.nodeType==1&&V!=U){T.push(V)}}return T};return;l.Sizzle=F})();o.event={add:function(I,F,H,K){if(I.nodeType==3||I.nodeType==8){return}if(I.setInterval&&I!=l){I=l}if(!H.guid){H.guid=this.guid++}if(K!==g){var G=H;H=this.proxy(G);H.data=K}var E=o.data(I,"events")||o.data(I,"events",{}),J=o.data(I,"handle")||o.data(I,"handle",function(){return typeof o!=="undefined"&&!o.event.triggered?o.event.handle.apply(arguments.callee.elem,arguments):g});J.elem=I;o.each(F.split(/\s+/),function(M,N){var O=N.split(".");N=O.shift();H.type=O.slice().sort().join(".");var L=E[N];if(o.event.specialAll[N]){o.event.specialAll[N].setup.call(I,K,O)}if(!L){L=E[N]={};if(!o.event.special[N]||o.event.special[N].setup.call(I,K,O)===false){if(I.addEventListener){I.addEventListener(N,J,false)}else{if(I.attachEvent){I.attachEvent("on"+N,J)}}}}L[H.guid]=H;o.event.global[N]=true});I=null},guid:1,global:{},remove:function(K,H,J){if(K.nodeType==3||K.nodeType==8){return}var G=o.data(K,"events"),F,E;if(G){if(H===g||(typeof H==="string"&&H.charAt(0)==".")){for(var I in G){this.remove(K,I+(H||""))}}else{if(H.type){J=H.handler;H=H.type}o.each(H.split(/\s+/),function(M,O){var Q=O.split(".");O=Q.shift();var N=RegExp("(^|\\.)"+Q.slice().sort().join(".*\\.")+"(\\.|$)");if(G[O]){if(J){delete G[O][J.guid]}else{for(var P in G[O]){if(N.test(G[O][P].type)){delete G[O][P]}}}if(o.event.specialAll[O]){o.event.specialAll[O].teardown.call(K,Q)}for(F in G[O]){break}if(!F){if(!o.event.special[O]||o.event.special[O].teardown.call(K,Q)===false){if(K.removeEventListener){K.removeEventListener(O,o.data(K,"handle"),false)}else{if(K.detachEvent){K.detachEvent("on"+O,o.data(K,"handle"))}}}F=null;delete G[O]}}})}for(F in G){break}if(!F){var L=o.data(K,"handle");if(L){L.elem=null}o.removeData(K,"events");o.removeData(K,"handle")}}},trigger:function(I,K,H,E){var G=I.type||I;if(!E){I=typeof I==="object"?I[h]?I:o.extend(o.Event(G),I):o.Event(G);if(G.indexOf("!")>=0){I.type=G=G.slice(0,-1);I.exclusive=true}if(!H){I.stopPropagation();if(this.global[G]){o.each(o.cache,function(){if(this.events&&this.events[G]){o.event.trigger(I,K,this.handle.elem)}})}}if(!H||H.nodeType==3||H.nodeType==8){return g}I.result=g;I.target=H;K=o.makeArray(K);K.unshift(I)}I.currentTarget=H;var J=o.data(H,"handle");if(J){J.apply(H,K)}if((!H[G]||(o.nodeName(H,"a")&&G=="click"))&&H["on"+G]&&H["on"+G].apply(H,K)===false){I.result=false}if(!E&&H[G]&&!I.isDefaultPrevented()&&!(o.nodeName(H,"a")&&G=="click")){this.triggered=true;try{H[G]()}catch(L){}}this.triggered=false;if(!I.isPropagationStopped()){var F=H.parentNode||H.ownerDocument;if(F){o.event.trigger(I,K,F,true)}}},handle:function(K){var J,E;K=arguments[0]=o.event.fix(K||l.event);K.currentTarget=this;var L=K.type.split(".");K.type=L.shift();J=!L.length&&!K.exclusive;var I=RegExp("(^|\\.)"+L.slice().sort().join(".*\\.")+"(\\.|$)");E=(o.data(this,"events")||{})[K.type];for(var G in E){var H=E[G];if(J||I.test(H.type)){K.handler=H;K.data=H.data;var F=H.apply(this,arguments);if(F!==g){K.result=F;if(F===false){K.preventDefault();K.stopPropagation()}}if(K.isImmediatePropagationStopped()){break}}}},props:"altKey attrChange attrName bubbles button cancelable charCode clientX clientY ctrlKey currentTarget data detail eventPhase fromElement handler keyCode metaKey newValue originalTarget pageX pageY prevValue relatedNode relatedTarget screenX screenY shiftKey srcElement target toElement view wheelDelta which".split(" "),fix:function(H){if(H[h]){return H}var F=H;H=o.Event(F);for(var G=this.props.length,J;G;){J=this.props[--G];H[J]=F[J]}if(!H.target){H.target=H.srcElement||document}if(H.target.nodeType==3){H.target=H.target.parentNode}if(!H.relatedTarget&&H.fromElement){H.relatedTarget=H.fromElement==H.target?H.toElement:H.fromElement}if(H.pageX==null&&H.clientX!=null){var I=document.documentElement,E=document.body;H.pageX=H.clientX+(I&&I.scrollLeft||E&&E.scrollLeft||0)-(I.clientLeft||0);H.pageY=H.clientY+(I&&I.scrollTop||E&&E.scrollTop||0)-(I.clientTop||0)}if(!H.which&&((H.charCode||H.charCode===0)?H.charCode:H.keyCode)){H.which=H.charCode||H.keyCode}if(!H.metaKey&&H.ctrlKey){H.metaKey=H.ctrlKey}if(!H.which&&H.button){H.which=(H.button&1?1:(H.button&2?3:(H.button&4?2:0)))}return H},proxy:function(F,E){E=E||function(){return F.apply(this,arguments)};E.guid=F.guid=F.guid||E.guid||this.guid++;return E},special:{ready:{setup:B,teardown:function(){}}},specialAll:{live:{setup:function(E,F){o.event.add(this,F[0],c)},teardown:function(G){if(G.length){var E=0,F=RegExp("(^|\\.)"+G[0]+"(\\.|$)");o.each((o.data(this,"events").live||{}),function(){if(F.test(this.type)){E++}});if(E<1){o.event.remove(this,G[0],c)}}}}}};o.Event=function(E){if(!this.preventDefault){return new o.Event(E)}if(E&&E.type){this.originalEvent=E;this.type=E.type}else{this.type=E}this.timeStamp=e();this[h]=true};function k(){return false}function u(){return true}o.Event.prototype={preventDefault:function(){this.isDefaultPrevented=u;var E=this.originalEvent;if(!E){return}if(E.preventDefault){E.preventDefault()}E.returnValue=false},stopPropagation:function(){this.isPropagationStopped=u;var E=this.originalEvent;if(!E){return}if(E.stopPropagation){E.stopPropagation()}E.cancelBubble=true},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=u;this.stopPropagation()},isDefaultPrevented:k,isPropagationStopped:k,isImmediatePropagationStopped:k};var a=function(F){var E=F.relatedTarget;while(E&&E!=this){try{E=E.parentNode}catch(G){E=this}}if(E!=this){F.type=F.data;o.event.handle.apply(this,arguments)}};o.each({mouseover:"mouseenter",mouseout:"mouseleave"},function(F,E){o.event.special[E]={setup:function(){o.event.add(this,F,a,E)},teardown:function(){o.event.remove(this,F,a)}}});o.fn.extend({bind:function(F,G,E){return F=="unload"?this.one(F,G,E):this.each(function(){o.event.add(this,F,E||G,E&&G)})},one:function(G,H,F){var E=o.event.proxy(F||H,function(I){o(this).unbind(I,E);return(F||H).apply(this,arguments)});return this.each(function(){o.event.add(this,G,E,F&&H)})},unbind:function(F,E){return this.each(function(){o.event.remove(this,F,E)})},trigger:function(E,F){return this.each(function(){o.event.trigger(E,F,this)})},triggerHandler:function(E,G){if(this[0]){var F=o.Event(E);F.preventDefault();F.stopPropagation();o.event.trigger(F,G,this[0]);return F.result}},toggle:function(G){var E=arguments,F=1;while(F<E.length){o.event.proxy(G,E[F++])}return this.click(o.event.proxy(G,function(H){this.lastToggle=(this.lastToggle||0)%F;H.preventDefault();return E[this.lastToggle++].apply(this,arguments)||false}))},hover:function(E,F){return this.mouseenter(E).mouseleave(F)},ready:function(E){B();if(o.isReady){E.call(document,o)}else{o.readyList.push(E)}return this},live:function(G,F){var E=o.event.proxy(F);E.guid+=this.selector+G;o(document).bind(i(G,this.selector),this.selector,E);return this},die:function(F,E){o(document).unbind(i(F,this.selector),E?{guid:E.guid+this.selector+F}:null);return this}});function c(H){var E=RegExp("(^|\\.)"+H.type+"(\\.|$)"),G=true,F=[];o.each(o.data(this,"events").live||[],function(I,J){if(E.test(J.type)){var K=o(H.target).closest(J.data)[0];if(K){F.push({elem:K,fn:J})}}});F.sort(function(J,I){return o.data(J.elem,"closest")-o.data(I.elem,"closest")});o.each(F,function(){if(this.fn.call(this.elem,H,this.fn.data)===false){return(G=false)}});return G}function i(F,E){return["live",F,E.replace(/\./g,"`").replace(/ /g,"|")].join(".")}o.extend({isReady:false,readyList:[],ready:function(){if(!o.isReady){o.isReady=true;if(o.readyList){o.each(o.readyList,function(){this.call(document,o)});o.readyList=null}o(document).triggerHandler("ready")}}});var x=false;function B(){if(x){return}x=true;if(document.addEventListener){document.addEventListener("DOMContentLoaded",function(){document.removeEventListener("DOMContentLoaded",arguments.callee,false);o.ready()},false)}else{if(document.attachEvent){document.attachEvent("onreadystatechange",function(){if(document.readyState==="complete"){document.detachEvent("onreadystatechange",arguments.callee);o.ready()}});if(document.documentElement.doScroll&&l==l.top){(function(){if(o.isReady){return}try{document.documentElement.doScroll("left")}catch(E){setTimeout(arguments.callee,0);return}o.ready()})()}}}o.event.add(l,"load",o.ready)}o.each(("blur,focus,load,resize,scroll,unload,click,dblclick,mousedown,mouseup,mousemove,mouseover,mouseout,mouseenter,mouseleave,change,select,submit,keydown,keypress,keyup,error").split(","),function(F,E){o.fn[E]=function(G){return G?this.bind(E,G):this.trigger(E)}});o(l).bind("unload",function(){for(var E in o.cache){if(E!=1&&o.cache[E].handle){o.event.remove(o.cache[E].handle.elem)}}});(function(){o.support={};var F=document.documentElement,G=document.createElement("script"),K=document.createElement("div"),J="script"+(new Date).getTime();K.style.display="none";K.innerHTML='   <link/><table></table><a href="/a" style="color:red;float:left;opacity:.5;">a</a><select><option>text</option></select><object><param/></object>';var H=K.getElementsByTagName("*"),E=K.getElementsByTagName("a")[0];if(!H||!H.length||!E){return}o.support={leadingWhitespace:K.firstChild.nodeType==3,tbody:!K.getElementsByTagName("tbody").length,objectAll:!!K.getElementsByTagName("object")[0].getElementsByTagName("*").length,htmlSerialize:!!K.getElementsByTagName("link").length,style:/red/.test(E.getAttribute("style")),hrefNormalized:E.getAttribute("href")==="/a",opacity:E.style.opacity==="0.5",cssFloat:!!E.style.cssFloat,scriptEval:false,noCloneEvent:true,boxModel:null};G.type="text/javascript";try{G.appendChild(document.createTextNode("window."+J+"=1;"))}catch(I){}F.insertBefore(G,F.firstChild);if(l[J]){o.support.scriptEval=true;delete l[J]}F.removeChild(G);if(K.attachEvent&&K.fireEvent){K.attachEvent("onclick",function(){o.support.noCloneEvent=false;K.detachEvent("onclick",arguments.callee)});K.cloneNode(true).fireEvent("onclick")}o(function(){var L=document.createElement("div");L.style.width=L.style.paddingLeft="1px";document.body.appendChild(L);o.boxModel=o.support.boxModel=L.offsetWidth===2;document.body.removeChild(L).style.display="none"})})();var w=o.support.cssFloat?"cssFloat":"styleFloat";o.props={"for":"htmlFor","class":"className","float":w,cssFloat:w,styleFloat:w,readonly:"readOnly",maxlength:"maxLength",cellspacing:"cellSpacing",rowspan:"rowSpan",tabindex:"tabIndex"};o.fn.extend({_load:o.fn.load,load:function(G,J,K){if(typeof G!=="string"){return this._load(G)}var I=G.indexOf(" ");if(I>=0){var E=G.slice(I,G.length);G=G.slice(0,I)}var H="GET";if(J){if(o.isFunction(J)){K=J;J=null}else{if(typeof J==="object"){J=o.param(J);H="POST"}}}var F=this;o.ajax({url:G,type:H,dataType:"html",data:J,complete:function(M,L){if(L=="success"||L=="notmodified"){F.html(E?o("<div/>").append(M.responseText.replace(/<script(.|\s)*?\/script>/g,"")).find(E):M.responseText)}if(K){F.each(K,[M.responseText,L,M])}}});return this},serialize:function(){return o.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?o.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||/select|textarea/i.test(this.nodeName)||/text|hidden|password|search/i.test(this.type))}).map(function(E,F){var G=o(this).val();return G==null?null:o.isArray(G)?o.map(G,function(I,H){return{name:F.name,value:I}}):{name:F.name,value:G}}).get()}});o.each("ajaxStart,ajaxStop,ajaxComplete,ajaxError,ajaxSuccess,ajaxSend".split(","),function(E,F){o.fn[F]=function(G){return this.bind(F,G)}});var r=e();o.extend({get:function(E,G,H,F){if(o.isFunction(G)){H=G;G=null}return o.ajax({type:"GET",url:E,data:G,success:H,dataType:F})},getScript:function(E,F){return o.get(E,null,F,"script")},getJSON:function(E,F,G){return o.get(E,F,G,"json")},post:function(E,G,H,F){if(o.isFunction(G)){H=G;G={}}return o.ajax({type:"POST",url:E,data:G,success:H,dataType:F})},ajaxSetup:function(E){o.extend(o.ajaxSettings,E)},ajaxSettings:{url:location.href,global:true,type:"GET",contentType:"application/x-www-form-urlencoded",processData:true,async:true,xhr:function(){return l.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest()},accepts:{xml:"application/xml, text/xml",html:"text/html",script:"text/javascript, application/javascript",json:"application/json, text/javascript",text:"text/plain",_default:"*/*"}},lastModified:{},ajax:function(M){M=o.extend(true,M,o.extend(true,{},o.ajaxSettings,M));var W,F=/=\?(&|$)/g,R,V,G=M.type.toUpperCase();if(M.data&&M.processData&&typeof M.data!=="string"){M.data=o.param(M.data)}if(M.dataType=="jsonp"){if(G=="GET"){if(!M.url.match(F)){M.url+=(M.url.match(/\?/)?"&":"?")+(M.jsonp||"callback")+"=?"}}else{if(!M.data||!M.data.match(F)){M.data=(M.data?M.data+"&":"")+(M.jsonp||"callback")+"=?"}}M.dataType="json"}if(M.dataType=="json"&&(M.data&&M.data.match(F)||M.url.match(F))){W="jsonp"+r++;if(M.data){M.data=(M.data+"").replace(F,"="+W+"$1")}M.url=M.url.replace(F,"="+W+"$1");M.dataType="script";l[W]=function(X){V=X;I();L();l[W]=g;try{delete l[W]}catch(Y){}if(H){H.removeChild(T)}}}if(M.dataType=="script"&&M.cache==null){M.cache=false}if(M.cache===false&&G=="GET"){var E=e();var U=M.url.replace(/(\?|&)_=.*?(&|$)/,"$1_="+E+"$2");M.url=U+((U==M.url)?(M.url.match(/\?/)?"&":"?")+"_="+E:"")}if(M.data&&G=="GET"){M.url+=(M.url.match(/\?/)?"&":"?")+M.data;M.data=null}if(M.global&&!o.active++){o.event.trigger("ajaxStart")}var Q=/^(\w+:)?\/\/([^\/?#]+)/.exec(M.url);if(M.dataType=="script"&&G=="GET"&&Q&&(Q[1]&&Q[1]!=location.protocol||Q[2]!=location.host)){var H=document.getElementsByTagName("head")[0];var T=document.createElement("script");T.src=M.url;if(M.scriptCharset){T.charset=M.scriptCharset}if(!W){var O=false;T.onload=T.onreadystatechange=function(){if(!O&&(!this.readyState||this.readyState=="loaded"||this.readyState=="complete")){O=true;I();L();T.onload=T.onreadystatechange=null;H.removeChild(T)}}}H.appendChild(T);return g}var K=false;var J=M.xhr();if(M.username){J.open(G,M.url,M.async,M.username,M.password)}else{J.open(G,M.url,M.async)}try{if(M.data){J.setRequestHeader("Content-Type",M.contentType)}if(M.ifModified){J.setRequestHeader("If-Modified-Since",o.lastModified[M.url]||"Thu, 01 Jan 1970 00:00:00 GMT")}J.setRequestHeader("X-Requested-With","XMLHttpRequest");J.setRequestHeader("Accept",M.dataType&&M.accepts[M.dataType]?M.accepts[M.dataType]+", */*":M.accepts._default)}catch(S){}if(M.beforeSend&&M.beforeSend(J,M)===false){if(M.global&&!--o.active){o.event.trigger("ajaxStop")}J.abort();return false}if(M.global){o.event.trigger("ajaxSend",[J,M])}var N=function(X){if(J.readyState==0){if(P){clearInterval(P);P=null;if(M.global&&!--o.active){o.event.trigger("ajaxStop")}}}else{if(!K&&J&&(J.readyState==4||X=="timeout")){K=true;if(P){clearInterval(P);P=null}R=X=="timeout"?"timeout":!o.httpSuccess(J)?"error":M.ifModified&&o.httpNotModified(J,M.url)?"notmodified":"success";if(R=="success"){try{V=o.httpData(J,M.dataType,M)}catch(Z){R="parsererror"}}if(R=="success"){var Y;try{Y=J.getResponseHeader("Last-Modified")}catch(Z){}if(M.ifModified&&Y){o.lastModified[M.url]=Y}if(!W){I()}}else{o.handleError(M,J,R)}L();if(X){J.abort()}if(M.async){J=null}}}};if(M.async){var P=setInterval(N,13);if(M.timeout>0){setTimeout(function(){if(J&&!K){N("timeout")}},M.timeout)}}try{J.send(M.data)}catch(S){o.handleError(M,J,null,S)}if(!M.async){N()}function I(){if(M.success){M.success(V,R)}if(M.global){o.event.trigger("ajaxSuccess",[J,M])}}function L(){if(M.complete){M.complete(J,R)}if(M.global){o.event.trigger("ajaxComplete",[J,M])}if(M.global&&!--o.active){o.event.trigger("ajaxStop")}}return J},handleError:function(F,H,E,G){if(F.error){F.error(H,E,G)}if(F.global){o.event.trigger("ajaxError",[H,F,G])}},active:0,httpSuccess:function(F){try{return !F.status&&location.protocol=="file:"||(F.status>=200&&F.status<300)||F.status==304||F.status==1223}catch(E){}return false},httpNotModified:function(G,E){try{var H=G.getResponseHeader("Last-Modified");return G.status==304||H==o.lastModified[E]}catch(F){}return false},httpData:function(J,H,G){var F=J.getResponseHeader("content-type"),E=H=="xml"||!H&&F&&F.indexOf("xml")>=0,I=E?J.responseXML:J.responseText;if(E&&I.documentElement.tagName=="parsererror"){throw"parsererror"}if(G&&G.dataFilter){I=G.dataFilter(I,H)}if(typeof I==="string"){if(H=="script"){o.globalEval(I)}if(H=="json"){I=l["eval"]("("+I+")")}}return I},param:function(E){var G=[];function H(I,J){G[G.length]=encodeURIComponent(I)+"="+encodeURIComponent(J)}if(o.isArray(E)||E.jquery){o.each(E,function(){H(this.name,this.value)})}else{for(var F in E){if(o.isArray(E[F])){o.each(E[F],function(){H(F,this)})}else{H(F,o.isFunction(E[F])?E[F]():E[F])}}}return G.join("&").replace(/%20/g,"+")}});var m={},n,d=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]];function t(F,E){var G={};o.each(d.concat.apply([],d.slice(0,E)),function(){G[this]=F});return G}o.fn.extend({show:function(J,L){if(J){return this.animate(t("show",3),J,L)}else{for(var H=0,F=this.length;H<F;H++){var E=o.data(this[H],"olddisplay");this[H].style.display=E||"";if(o.css(this[H],"display")==="none"){var G=this[H].tagName,K;if(m[G]){K=m[G]}else{var I=o("<"+G+" />").appendTo("body");K=I.css("display");if(K==="none"){K="block"}I.remove();m[G]=K}o.data(this[H],"olddisplay",K)}}for(var H=0,F=this.length;H<F;H++){this[H].style.display=o.data(this[H],"olddisplay")||""}return this}},hide:function(H,I){if(H){return this.animate(t("hide",3),H,I)}else{for(var G=0,F=this.length;G<F;G++){var E=o.data(this[G],"olddisplay");if(!E&&E!=="none"){o.data(this[G],"olddisplay",o.css(this[G],"display"))}}for(var G=0,F=this.length;G<F;G++){this[G].style.display="none"}return this}},_toggle:o.fn.toggle,toggle:function(G,F){var E=typeof G==="boolean";return o.isFunction(G)&&o.isFunction(F)?this._toggle.apply(this,arguments):G==null||E?this.each(function(){var H=E?G:o(this).is(":hidden");o(this)[H?"show":"hide"]()}):this.animate(t("toggle",3),G,F)},fadeTo:function(E,G,F){return this.animate({opacity:G},E,F)},animate:function(I,F,H,G){var E=o.speed(F,H,G);return this[E.queue===false?"each":"queue"](function(){var K=o.extend({},E),M,L=this.nodeType==1&&o(this).is(":hidden"),J=this;for(M in I){if(I[M]=="hide"&&L||I[M]=="show"&&!L){return K.complete.call(this)}if((M=="height"||M=="width")&&this.style){K.display=o.css(this,"display");K.overflow=this.style.overflow}}if(K.overflow!=null){this.style.overflow="hidden"}K.curAnim=o.extend({},I);o.each(I,function(O,S){var R=new o.fx(J,K,O);if(/toggle|show|hide/.test(S)){R[S=="toggle"?L?"show":"hide":S](I)}else{var Q=S.toString().match(/^([+-]=)?([\d+-.]+)(.*)$/),T=R.cur(true)||0;if(Q){var N=parseFloat(Q[2]),P=Q[3]||"px";if(P!="px"){J.style[O]=(N||1)+P;T=((N||1)/R.cur(true))*T;J.style[O]=T+P}if(Q[1]){N=((Q[1]=="-="?-1:1)*N)+T}R.custom(T,N,P)}else{R.custom(T,S,"")}}});return true})},stop:function(F,E){var G=o.timers;if(F){this.queue([])}this.each(function(){for(var H=G.length-1;H>=0;H--){if(G[H].elem==this){if(E){G[H](true)}G.splice(H,1)}}});if(!E){this.dequeue()}return this}});o.each({slideDown:t("show",1),slideUp:t("hide",1),slideToggle:t("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"}},function(E,F){o.fn[E]=function(G,H){return this.animate(F,G,H)}});o.extend({speed:function(G,H,F){var E=typeof G==="object"?G:{complete:F||!F&&H||o.isFunction(G)&&G,duration:G,easing:F&&H||H&&!o.isFunction(H)&&H};E.duration=o.fx.off?0:typeof E.duration==="number"?E.duration:o.fx.speeds[E.duration]||o.fx.speeds._default;E.old=E.complete;E.complete=function(){if(E.queue!==false){o(this).dequeue()}if(o.isFunction(E.old)){E.old.call(this)}};return E},easing:{linear:function(G,H,E,F){return E+F*G},swing:function(G,H,E,F){return((-Math.cos(G*Math.PI)/2)+0.5)*F+E}},timers:[],fx:function(F,E,G){this.options=E;this.elem=F;this.prop=G;if(!E.orig){E.orig={}}}});o.fx.prototype={update:function(){if(this.options.step){this.options.step.call(this.elem,this.now,this)}(o.fx.step[this.prop]||o.fx.step._default)(this);if((this.prop=="height"||this.prop=="width")&&this.elem.style){this.elem.style.display="block"}},cur:function(F){if(this.elem[this.prop]!=null&&(!this.elem.style||this.elem.style[this.prop]==null)){return this.elem[this.prop]}var E=parseFloat(o.css(this.elem,this.prop,F));return E&&E>-10000?E:parseFloat(o.curCSS(this.elem,this.prop))||0},custom:function(I,H,G){this.startTime=e();this.start=I;this.end=H;this.unit=G||this.unit||"px";this.now=this.start;this.pos=this.state=0;var E=this;function F(J){return E.step(J)}F.elem=this.elem;if(F()&&o.timers.push(F)&&!n){n=setInterval(function(){var K=o.timers;for(var J=0;J<K.length;J++){if(!K[J]()){K.splice(J--,1)}}if(!K.length){clearInterval(n);n=g}},13)}},show:function(){this.options.orig[this.prop]=o.attr(this.elem.style,this.prop);this.options.show=true;this.custom(this.prop=="width"||this.prop=="height"?1:0,this.cur());o(this.elem).show()},hide:function(){this.options.orig[this.prop]=o.attr(this.elem.style,this.prop);this.options.hide=true;this.custom(this.cur(),0)},step:function(H){var G=e();if(H||G>=this.options.duration+this.startTime){this.now=this.end;this.pos=this.state=1;this.update();this.options.curAnim[this.prop]=true;var E=true;for(var F in this.options.curAnim){if(this.options.curAnim[F]!==true){E=false}}if(E){if(this.options.display!=null){this.elem.style.overflow=this.options.overflow;this.elem.style.display=this.options.display;if(o.css(this.elem,"display")=="none"){this.elem.style.display="block"}}if(this.options.hide){o(this.elem).hide()}if(this.options.hide||this.options.show){for(var I in this.options.curAnim){o.attr(this.elem.style,I,this.options.orig[I])}}this.options.complete.call(this.elem)}return false}else{var J=G-this.startTime;this.state=J/this.options.duration;this.pos=o.easing[this.options.easing||(o.easing.swing?"swing":"linear")](this.state,J,0,1,this.options.duration);this.now=this.start+((this.end-this.start)*this.pos);this.update()}return true}};o.extend(o.fx,{speeds:{slow:600,fast:200,_default:400},step:{opacity:function(E){o.attr(E.elem.style,"opacity",E.now)},_default:function(E){if(E.elem.style&&E.elem.style[E.prop]!=null){E.elem.style[E.prop]=E.now+E.unit}else{E.elem[E.prop]=E.now}}}});if(document.documentElement.getBoundingClientRect){o.fn.offset=function(){if(!this[0]){return{top:0,left:0}}if(this[0]===this[0].ownerDocument.body){return o.offset.bodyOffset(this[0])}var G=this[0].getBoundingClientRect(),J=this[0].ownerDocument,F=J.body,E=J.documentElement,L=E.clientTop||F.clientTop||0,K=E.clientLeft||F.clientLeft||0,I=G.top+(self.pageYOffset||o.boxModel&&E.scrollTop||F.scrollTop)-L,H=G.left+(self.pageXOffset||o.boxModel&&E.scrollLeft||F.scrollLeft)-K;return{top:I,left:H}}}else{o.fn.offset=function(){if(!this[0]){return{top:0,left:0}}if(this[0]===this[0].ownerDocument.body){return o.offset.bodyOffset(this[0])}o.offset.initialized||o.offset.initialize();var J=this[0],G=J.offsetParent,F=J,O=J.ownerDocument,M,H=O.documentElement,K=O.body,L=O.defaultView,E=L.getComputedStyle(J,null),N=J.offsetTop,I=J.offsetLeft;while((J=J.parentNode)&&J!==K&&J!==H){M=L.getComputedStyle(J,null);N-=J.scrollTop,I-=J.scrollLeft;if(J===G){N+=J.offsetTop,I+=J.offsetLeft;if(o.offset.doesNotAddBorder&&!(o.offset.doesAddBorderForTableAndCells&&/^t(able|d|h)$/i.test(J.tagName))){N+=parseInt(M.borderTopWidth,10)||0,I+=parseInt(M.borderLeftWidth,10)||0}F=G,G=J.offsetParent}if(o.offset.subtractsBorderForOverflowNotVisible&&M.overflow!=="visible"){N+=parseInt(M.borderTopWidth,10)||0,I+=parseInt(M.borderLeftWidth,10)||0}E=M}if(E.position==="relative"||E.position==="static"){N+=K.offsetTop,I+=K.offsetLeft}if(E.position==="fixed"){N+=Math.max(H.scrollTop,K.scrollTop),I+=Math.max(H.scrollLeft,K.scrollLeft)}return{top:N,left:I}}}o.offset={initialize:function(){if(this.initialized){return}var L=document.body,F=document.createElement("div"),H,G,N,I,M,E,J=L.style.marginTop,K='<div style="position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;"><div></div></div><table style="position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;" cellpadding="0" cellspacing="0"><tr><td></td></tr></table>';M={position:"absolute",top:0,left:0,margin:0,border:0,width:"1px",height:"1px",visibility:"hidden"};for(E in M){F.style[E]=M[E]}F.innerHTML=K;L.insertBefore(F,L.firstChild);H=F.firstChild,G=H.firstChild,I=H.nextSibling.firstChild.firstChild;this.doesNotAddBorder=(G.offsetTop!==5);this.doesAddBorderForTableAndCells=(I.offsetTop===5);H.style.overflow="hidden",H.style.position="relative";this.subtractsBorderForOverflowNotVisible=(G.offsetTop===-5);L.style.marginTop="1px";this.doesNotIncludeMarginInBodyOffset=(L.offsetTop===0);L.style.marginTop=J;L.removeChild(F);this.initialized=true},bodyOffset:function(E){o.offset.initialized||o.offset.initialize();var G=E.offsetTop,F=E.offsetLeft;if(o.offset.doesNotIncludeMarginInBodyOffset){G+=parseInt(o.curCSS(E,"marginTop",true),10)||0,F+=parseInt(o.curCSS(E,"marginLeft",true),10)||0}return{top:G,left:F}}};o.fn.extend({position:function(){var I=0,H=0,F;if(this[0]){var G=this.offsetParent(),J=this.offset(),E=/^body|html$/i.test(G[0].tagName)?{top:0,left:0}:G.offset();J.top-=j(this,"marginTop");J.left-=j(this,"marginLeft");E.top+=j(G,"borderTopWidth");E.left+=j(G,"borderLeftWidth");F={top:J.top-E.top,left:J.left-E.left}}return F},offsetParent:function(){var E=this[0].offsetParent||document.body;while(E&&(!/^body|html$/i.test(E.tagName)&&o.css(E,"position")=="static")){E=E.offsetParent}return o(E)}});o.each(["Left","Top"],function(F,E){var G="scroll"+E;o.fn[G]=function(H){if(!this[0]){return null}return H!==g?this.each(function(){this==l||this==document?l.scrollTo(!F?H:o(l).scrollLeft(),F?H:o(l).scrollTop()):this[G]=H}):this[0]==l||this[0]==document?self[F?"pageYOffset":"pageXOffset"]||o.boxModel&&document.documentElement[G]||document.body[G]:this[0][G]}});o.each(["Height","Width"],function(I,G){var E=I?"Left":"Top",H=I?"Right":"Bottom",F=G.toLowerCase();o.fn["inner"+G]=function(){return this[0]?o.css(this[0],F,false,"padding"):null};o.fn["outer"+G]=function(K){return this[0]?o.css(this[0],F,false,K?"margin":"border"):null};var J=G.toLowerCase();o.fn[J]=function(K){return this[0]==l?document.compatMode=="CSS1Compat"&&document.documentElement["client"+G]||document.body["client"+G]:this[0]==document?Math.max(document.documentElement["client"+G],document.body["scroll"+G],document.documentElement["scroll"+G],document.body["offset"+G],document.documentElement["offset"+G]):K===g?(this.length?o.css(this[0],J):null):this.css(J,typeof K==="string"?K:K+"px")}})})();
//]]>
</script>
<script id="jqueryArea" type="text/javascript">
//<![CDATA[
/*
jQuery.encoding.digests.sha1.js

SHA-1 digest and associated utility functions

Copyright (c) UnaMesa Association 2009

Dual licensed under the MIT and GPL licenses:
  http://www.opensource.org/licenses/mit-license.php
  http://www.gnu.org/licenses/gpl.html
*/

(function($) {

if(!$.encoding)
  $.encoding = {};
  $.extend($.encoding,{
    strToBe32s: function(str) {
      // Convert a string to an array of big-endian 32-bit words
      var be=[];
      var len=Math.floor(str.length/4);
      var i, j;
      for(i=0, j=0; i<len; i++, j+=4) {
        be[i]=((str.charCodeAt(j)&0xff) << 24)|((str.charCodeAt(j+1)&0xff) << 16)|((str.charCodeAt(j+2)&0xff) << 8)|(str.charCodeAt(j+3)&0xff);
      }
      while(j<str.length) {
        be[j>>2] |= (str.charCodeAt(j)&0xff)<<(24-(j*8)%32);
        j++;
      }
      return be;
    },
    be32sToStr: function(be) {
      // Convert an array of big-endian 32-bit words to a string
      var str='';
      for(var i=0;i<be.length*32;i+=8) {
        str += String.fromCharCode((be[i>>5]>>>(24-i%32)) & 0xff);
      }
      return str;
    },
    be32sToHex: function(be) {
      // Convert an array of big-endian 32-bit words to a hex string
      var hex='0123456789ABCDEF';
      var str='';
      for(var i=0;i<be.length*4;i++) {
        str += hex.charAt((be[i>>2]>>((3-i%4)*8+4))&0xF) + hex.charAt((be[i>>2]>>((3-i%4)*8))&0xF);
      }
      return str;
    }
  });
})(jQuery);


(function($) {

if(!$.encoding.digests)
  $.encoding.digests = {};
  $.extend($.encoding.digests,{
    hexSha1Str: function(str) {
      // Return, in hex, the SHA-1 hash of a string
      return $.encoding.be32sToHex($.encoding.digests.sha1Str(str));
    },
    sha1Str: function(str) {
      // Return the SHA-1 hash of a string
      return sha1($.encoding.strToBe32s(str),str.length);
    },
    sha1: function(x,blen) {
      // Calculate the SHA-1 hash of an array of blen bytes of big-endian 32-bit words
      return sha1($.encoding.strToBe32s(str),str.length);
    }
  });

  // Private functions.
  function sha1(x,blen) {
    // Calculate the SHA-1 hash of an array of blen bytes of big-endian 32-bit words
    function add32(a,b) {
      // Add 32-bit integers, wrapping at 32 bits
      // Uses 16-bit operations internally to work around bugs in some JavaScript interpreters.
      var lsw=(a&0xFFFF)+(b&0xFFFF);
      var msw=(a>>16)+(b>>16)+(lsw>>16);
      return (msw<<16)|(lsw&0xFFFF);
    }
    function AA(a,b,c,d,e) {
      // Cryptographic round helper function. Add five 32-bit integers, wrapping at 32 bits, second parameter is rotated left 5 bits before the addition
      // Uses 16-bit operations internally to work around bugs in some JavaScript interpreters.
      b=(b>>>27)|(b<<5);
      var lsw=(a&0xFFFF)+(b&0xFFFF)+(c&0xFFFF)+(d&0xFFFF)+(e&0xFFFF);
      var msw=(a>>16)+(b>>16)+(c>>16)+(d>>16)+(e>>16)+(lsw>>16);
      return (msw<<16)|(lsw&0xFFFF);
    }
    function RR(w,j) {
      // Cryptographic round helper function.
      var n=w[j-3]^w[j-8]^w[j-14]^w[j-16];
      return (n>>>31)|(n<<1);
    }

    var len=blen*8;
    x[len>>5] |= 0x80 << (24-len%32);
    x[((len+64>>9)<<4)+15]=len;
    var w=new Array(80);

    var k1=0x5A827999;
    var k2=0x6ED9EBA1;
    var k3=0x8F1BBCDC;
    var k4=0xCA62C1D6;

    var h0=0x67452301;
    var h1=0xEFCDAB89;
    var h2=0x98BADCFE;
    var h3=0x10325476;
    var h4=0xC3D2E1F0;

    for(var i=0;i<x.length;i+=16) {
      var j=0;
      var t;
      var a=h0;
      var b=h1;
      var c=h2;
      var d=h3;
      var e=h4;
      while(j<16) {
        w[j]=x[i+j];
        t=AA(e,a,d^(b&(c^d)),w[j],k1);
        e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;
      }
      while(j<20) {
        w[j]=RR(w,j);
        t=AA(e,a,d^(b&(c^d)),w[j],k1);
        e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;
      }
      while(j<40) {
        w[j]=RR(w,j);
        t=AA(e,a,b^c^d,w[j],k2);
        e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;
      }
      while(j<60) {
        w[j]=RR(w,j);
        t=AA(e,a,(b&c)|(d&(b|c)),w[j],k3);
        e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;
      }
      while(j<80) {
        w[j]=RR(w,j);
        t=AA(e,a,b^c^d,w[j],k4);
        e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;
      }
      h0=add32(h0,a);
      h1=add32(h1,b);
      h2=add32(h2,c);
      h3=add32(h3,d);
      h4=add32(h4,e);
    }
    return [h0,h1,h2,h3,h4];
  }
})(jQuery);
/*
jQuery.twStylesheet.js

jQuery plugin to dynamically insert CSS rules into a document

Usage:
  jQuery.twStylesheet applies style definitions
  jQuery.twStylesheet.remove neutralizes style definitions

Copyright (c) UnaMesa Association 2009

Triple licensed under the BSD, MIT and GPL licenses:
  http://www.opensource.org/licenses/bsd-license.php
  http://www.opensource.org/licenses/mit-license.php
  http://www.gnu.org/licenses/gpl.html
*/

(function($) {

var defaultId = "customStyleSheet"; // XXX: rename to dynamicStyleSheet?

// Add or replace a style sheet
// css argument is a string of CSS rule sets
// options.id is an optional name identifying the style sheet
// options.doc is an optional document reference
// N.B.: Uses DOM methods instead of jQuery to ensure cross-browser comaptibility.
$.twStylesheet = function(css, options) {
  options = options || {};
  var id = options.id || defaultId;
  var doc = options.doc || document;
  var el = doc.getElementById(id);
  if(doc.createStyleSheet) { // IE-specific handling
    if(el) {
      el.parentNode.removeChild(el);
    }
    doc.getElementsByTagName("head")[0].insertAdjacentHTML("beforeEnd",
      "&nbsp;<style id='" + id + "'>" + css + "</style>"); // fails without &nbsp;
  } else { // modern browsers
    if(el) {
      el.replaceChild(doc.createTextNode(css), el.firstChild);
    } else {
      el = doc.createElement("style");
      el.type = "text/css";
      el.id = id;
      el.appendChild(doc.createTextNode(css));
      doc.getElementsByTagName("head")[0].appendChild(el);
    }
  }
};

// Remove existing style sheet
// options.id is an optional name identifying the style sheet
// options.doc is an optional document reference
$.twStylesheet.remove = function(options) {
  options = options || {};
  var id = options.id || defaultId;
  var doc = options.doc || document;
  var el = doc.getElementById(id);
  if(el) {
    el.parentNode.removeChild(el);
  }
};

})(jQuery);
//]]>
</script>
<script type="text/javascript">
//<![CDATA[
if(useJavaSaver)
  document.write("<applet style='position:absolute;left:-1px' name='TiddlySaver' code='TiddlySaver.class' archive='TiddlySaver.jar' width='1' height='1'></applet>");
//]]>
</script>
<!--POST-SCRIPT-START-->

<!--POST-SCRIPT-END-->
</body>
</html>
